(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3789,t=>{t.v("/cs416-web-demo/_next/static/media/ort-wasm-simd-threaded.jsep.8d20f3cb.wasm")},19489,t=>{t.v("/cs416-web-demo/_next/static/media/ort.bundle.min.1f5335f2.mjs")},42778,(t,r,i)=>{(function(){var n,a="4.17.21",s=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",u="Invalid `variable` option passed into `_.template`",h="__lodash_hash_undefined__",f=500,d="__lodash_placeholder__",c=1,p=2,m=4,g=1,_=2,b=1,y=2,v=4,w=8,x=16,k=32,E=64,S=128,$=256,I=512,A=30,M="...",T=800,C=16,z=1,R=2,B=3,O=1/0,P=0x1fffffffffffff,D=17976931348623157e292,N=0/0,L=0xffffffff,U=0xfffffffe,j=0x7fffffff,F=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],G="[object Arguments]",W="[object Array]",q="[object AsyncFunction]",H="[object Boolean]",V="[object Date]",Z="[object DOMException]",K="[object Error]",Y="[object Function]",X="[object GeneratorFunction]",Q="[object Map]",J="[object Number]",ee="[object Null]",et="[object Object]",er="[object Promise]",ei="[object Proxy]",en="[object RegExp]",ea="[object Set]",es="[object String]",eo="[object Symbol]",el="[object Undefined]",eu="[object WeakMap]",eh="[object WeakSet]",ef="[object ArrayBuffer]",ed="[object DataView]",ec="[object Float32Array]",ep="[object Float64Array]",em="[object Int8Array]",eg="[object Int16Array]",e_="[object Int32Array]",eb="[object Uint8Array]",ey="[object Uint8ClampedArray]",ev="[object Uint16Array]",ew="[object Uint32Array]",ex=/\b__p \+= '';/g,ek=/\b(__p \+=) '' \+/g,eE=/(__e\(.*?\)|\b__t\)) \+\n'';/g,eS=/&(?:amp|lt|gt|quot|#39);/g,e$=/[&<>"']/g,eI=RegExp(eS.source),eA=RegExp(e$.source),eM=/<%-([\s\S]+?)%>/g,eT=/<%([\s\S]+?)%>/g,eC=/<%=([\s\S]+?)%>/g,ez=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,eR=/^\w*$/,eB=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,eO=/[\\^$.*+?()[\]{}|]/g,eP=RegExp(eO.source),eD=/^\s+/,eN=/\s/,eL=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,eU=/\{\n\/\* \[wrapped with (.+)\] \*/,ej=/,? & /,eF=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,eG=/[()=,{}\[\]\/\s]/,eW=/\\(\\)?/g,eq=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,eH=/\w*$/,eV=/^[-+]0x[0-9a-f]+$/i,eZ=/^0b[01]+$/i,eK=/^\[object .+?Constructor\]$/,eY=/^0o[0-7]+$/i,eX=/^(?:0|[1-9]\d*)$/,eQ=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,eJ=/($^)/,e0=/['\n\r\u2028\u2029\\]/g,e1="\ud800-\udfff",e2="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",e3="\\u2700-\\u27bf",e5="a-z\\xdf-\\xf6\\xf8-\\xff",e4="A-Z\\xc0-\\xd6\\xd8-\\xde",e8="\\ufe0e\\ufe0f",e6="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",e7="['’]",e9="["+e1+"]",te="["+e6+"]",tt="["+e2+"]",tr="\\d+",ti="["+e3+"]",tn="["+e5+"]",ta="[^"+e1+e6+tr+e3+e5+e4+"]",ts="\ud83c[\udffb-\udfff]",to="[^"+e1+"]",tl="(?:\ud83c[\udde6-\uddff]){2}",tu="[\ud800-\udbff][\udc00-\udfff]",th="["+e4+"]",tf="\\u200d",td="(?:"+tn+"|"+ta+")",tc="(?:"+th+"|"+ta+")",tp="(?:"+e7+"(?:d|ll|m|re|s|t|ve))?",tm="(?:"+e7+"(?:D|LL|M|RE|S|T|VE))?",tg="(?:"+tt+"|"+ts+")?",t_="["+e8+"]?",tb="(?:"+tf+"(?:"+[to,tl,tu].join("|")+")"+t_+tg+")*",ty="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",tv="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",tw=t_+tg+tb,tx="(?:"+[ti,tl,tu].join("|")+")"+tw,tk="(?:"+[to+tt+"?",tt,tl,tu,e9].join("|")+")",tE=RegExp(e7,"g"),tS=RegExp(tt,"g"),t$=RegExp(ts+"(?="+ts+")|"+tk+tw,"g"),tI=RegExp([th+"?"+tn+"+"+tp+"(?="+[te,th,"$"].join("|")+")",tc+"+"+tm+"(?="+[te,th+td,"$"].join("|")+")",th+"?"+td+"+"+tp,th+"+"+tm,tv,ty,tr,tx].join("|"),"g"),tA=RegExp("["+tf+e1+e2+e8+"]"),tM=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,tT=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],tC=-1,tz={};tz[ec]=tz[ep]=tz[em]=tz[eg]=tz[e_]=tz[eb]=tz[ey]=tz[ev]=tz[ew]=!0,tz[G]=tz[W]=tz[ef]=tz[H]=tz[ed]=tz[V]=tz[K]=tz[Y]=tz[Q]=tz[J]=tz[et]=tz[en]=tz[ea]=tz[es]=tz[eu]=!1;var tR={};tR[G]=tR[W]=tR[ef]=tR[ed]=tR[H]=tR[V]=tR[ec]=tR[ep]=tR[em]=tR[eg]=tR[e_]=tR[Q]=tR[J]=tR[et]=tR[en]=tR[ea]=tR[es]=tR[eo]=tR[eb]=tR[ey]=tR[ev]=tR[ew]=!0,tR[K]=tR[Y]=tR[eu]=!1;var tB={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},tO={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},tP={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},tD={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},tN=parseFloat,tL=parseInt,tU=t.g&&t.g.Object===Object&&t.g,tj="object"==typeof self&&self&&self.Object===Object&&self,tF=tU||tj||Function("return this")(),tG=i&&!i.nodeType&&i,tW=tG&&r&&!r.nodeType&&r,tq=tW&&tW.exports===tG,tH=tq&&tU.process,tV=function(){try{var t=tW&&tW.require&&tW.require("util").types;if(t)return t;return tH&&tH.binding&&tH.binding("util")}catch(t){}}(),tZ=tV&&tV.isArrayBuffer,tK=tV&&tV.isDate,tY=tV&&tV.isMap,tX=tV&&tV.isRegExp,tQ=tV&&tV.isSet,tJ=tV&&tV.isTypedArray;function t0(t,r,i){switch(i.length){case 0:return t.call(r);case 1:return t.call(r,i[0]);case 2:return t.call(r,i[0],i[1]);case 3:return t.call(r,i[0],i[1],i[2])}return t.apply(r,i)}function t1(t,r,i,n){for(var a=-1,s=null==t?0:t.length;++a<s;){var o=t[a];r(n,o,i(o),t)}return n}function t2(t,r){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==r(t[i],i,t););return t}function t3(t,r){for(var i=null==t?0:t.length;i--&&!1!==r(t[i],i,t););return t}function t5(t,r){for(var i=-1,n=null==t?0:t.length;++i<n;)if(!r(t[i],i,t))return!1;return!0}function t4(t,r){for(var i=-1,n=null==t?0:t.length,a=0,s=[];++i<n;){var o=t[i];r(o,i,t)&&(s[a++]=o)}return s}function t8(t,r){return!!(null==t?0:t.length)&&rl(t,r,0)>-1}function t6(t,r,i){for(var n=-1,a=null==t?0:t.length;++n<a;)if(i(r,t[n]))return!0;return!1}function t7(t,r){for(var i=-1,n=null==t?0:t.length,a=Array(n);++i<n;)a[i]=r(t[i],i,t);return a}function t9(t,r){for(var i=-1,n=r.length,a=t.length;++i<n;)t[a+i]=r[i];return t}function re(t,r,i,n){var a=-1,s=null==t?0:t.length;for(n&&s&&(i=t[++a]);++a<s;)i=r(i,t[a],a,t);return i}function rt(t,r,i,n){var a=null==t?0:t.length;for(n&&a&&(i=t[--a]);a--;)i=r(i,t[a],a,t);return i}function rr(t,r){for(var i=-1,n=null==t?0:t.length;++i<n;)if(r(t[i],i,t))return!0;return!1}var ri=rd("length");function rn(t){return t.split("")}function ra(t){return t.match(eF)||[]}function rs(t,r,i){var n;return i(t,function(t,i,a){if(r(t,i,a))return n=i,!1}),n}function ro(t,r,i,n){for(var a=t.length,s=i+(n?1:-1);n?s--:++s<a;)if(r(t[s],s,t))return s;return -1}function rl(t,r,i){return r==r?rN(t,r,i):ro(t,rh,i)}function ru(t,r,i,n){for(var a=i-1,s=t.length;++a<s;)if(n(t[a],r))return a;return -1}function rh(t){return t!=t}function rf(t,r){var i=null==t?0:t.length;return i?rg(t,r)/i:N}function rd(t){return function(r){return null==r?n:r[t]}}function rc(t){return function(r){return null==t?n:t[r]}}function rp(t,r,i,n,a){return a(t,function(t,a,s){i=n?(n=!1,t):r(i,t,a,s)}),i}function rm(t,r){var i=t.length;for(t.sort(r);i--;)t[i]=t[i].value;return t}function rg(t,r){for(var i,a=-1,s=t.length;++a<s;){var o=r(t[a]);n!==o&&(i=n===i?o:i+o)}return i}function r_(t,r){for(var i=-1,n=Array(t);++i<t;)n[i]=r(i);return n}function rb(t,r){return t7(r,function(r){return[r,t[r]]})}function ry(t){return t?t.slice(0,rF(t)+1).replace(eD,""):t}function rv(t){return function(r){return t(r)}}function rw(t,r){return t7(r,function(r){return t[r]})}function rx(t,r){return t.has(r)}function rk(t,r){for(var i=-1,n=t.length;++i<n&&rl(r,t[i],0)>-1;);return i}function rE(t,r){for(var i=t.length;i--&&rl(r,t[i],0)>-1;);return i}function rS(t,r){for(var i=t.length,n=0;i--;)t[i]===r&&++n;return n}var r$=rc(tB),rI=rc(tO);function rA(t){return"\\"+tD[t]}function rM(t,r){return null==t?n:t[r]}function rT(t){return tA.test(t)}function rC(t){return tM.test(t)}function rz(t){for(var r,i=[];!(r=t.next()).done;)i.push(r.value);return i}function rR(t){var r=-1,i=Array(t.size);return t.forEach(function(t,n){i[++r]=[n,t]}),i}function rB(t,r){return function(i){return t(r(i))}}function rO(t,r){for(var i=-1,n=t.length,a=0,s=[];++i<n;){var o=t[i];(o===r||o===d)&&(t[i]=d,s[a++]=i)}return s}function rP(t){var r=-1,i=Array(t.size);return t.forEach(function(t){i[++r]=t}),i}function rD(t){var r=-1,i=Array(t.size);return t.forEach(function(t){i[++r]=[t,t]}),i}function rN(t,r,i){for(var n=i-1,a=t.length;++n<a;)if(t[n]===r)return n;return -1}function rL(t,r,i){for(var n=i+1;n--&&t[n]!==r;);return n}function rU(t){return rT(t)?rW(t):ri(t)}function rj(t){return rT(t)?rq(t):rn(t)}function rF(t){for(var r=t.length;r--&&eN.test(t.charAt(r)););return r}var rG=rc(tP);function rW(t){for(var r=t$.lastIndex=0;t$.test(t);)++r;return r}function rq(t){return t.match(t$)||[]}function rH(t){return t.match(tI)||[]}var rV=function t(r){var i=(r=null==r?tF:rV.defaults(tF.Object(),r,rV.pick(tF,tT))).Array,eN=r.Date,eF=r.Error,e1=r.Function,e2=r.Math,e3=r.Object,e5=r.RegExp,e4=r.String,e8=r.TypeError,e6=i.prototype,e7=e1.prototype,e9=e3.prototype,te=r["__core-js_shared__"],tt=e7.toString,tr=e9.hasOwnProperty,ti=0,tn=function(){var t=/[^.]+$/.exec(te&&te.keys&&te.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ta=e9.toString,ts=tt.call(e3),to=tF._,tl=e5("^"+tt.call(tr).replace(eO,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),tu=tq?r.Buffer:n,th=r.Symbol,tf=r.Uint8Array,td=tu?tu.allocUnsafe:n,tc=rB(e3.getPrototypeOf,e3),tp=e3.create,tm=e9.propertyIsEnumerable,tg=e6.splice,t_=th?th.isConcatSpreadable:n,tb=th?th.iterator:n,ty=th?th.toStringTag:n,tv=function(){try{var t=aQ(e3,"defineProperty");return t({},"",{}),t}catch(t){}}(),tw=r.clearTimeout!==tF.clearTimeout&&r.clearTimeout,tx=eN&&eN.now!==tF.Date.now&&eN.now,tk=r.setTimeout!==tF.setTimeout&&r.setTimeout,t$=e2.ceil,tI=e2.floor,tA=e3.getOwnPropertySymbols,tM=tu?tu.isBuffer:n,tB=r.isFinite,tO=e6.join,tP=rB(e3.keys,e3),tD=e2.max,tU=e2.min,tj=eN.now,tG=r.parseInt,tW=e2.random,tH=e6.reverse,tV=aQ(r,"DataView"),ri=aQ(r,"Map"),rn=aQ(r,"Promise"),rc=aQ(r,"Set"),rN=aQ(r,"WeakMap"),rW=aQ(e3,"create"),rq=rN&&new rN,rZ={},rK=sI(tV),rY=sI(ri),rX=sI(rn),rQ=sI(rc),rJ=sI(rN),r0=th?th.prototype:n,r1=r0?r0.valueOf:n,r2=r0?r0.toString:n;function r3(t){if(l0(t)&&!lD(t)&&!(t instanceof r6)){if(t instanceof r8)return t;if(tr.call(t,"__wrapped__"))return sM(t)}return new r8(t)}var r5=function(){function t(){}return function(r){if(!lJ(r))return{};if(tp)return tp(r);t.prototype=r;var i=new t;return t.prototype=n,i}}();function r4(){}function r8(t,r){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!r,this.__index__=0,this.__values__=n}function r6(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=L,this.__views__=[]}function r7(){var t=new r6(this.__wrapped__);return t.__actions__=au(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=au(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=au(this.__views__),t}function r9(){if(this.__filtered__){var t=new r6(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function ie(){var t=this.__wrapped__.value(),r=this.__dir__,i=lD(t),n=r<0,a=i?t.length:0,s=a3(0,a,this.__views__),o=s.start,l=s.end,u=l-o,h=n?l:o-1,f=this.__iteratees__,d=f.length,c=0,p=tU(u,this.__takeCount__);if(!i||!n&&a==u&&p==u)return n0(t,this.__actions__);var m=[];e:for(;u--&&c<p;){for(var g=-1,_=t[h+=r];++g<d;){var b=f[g],y=b.iteratee,v=b.type,w=y(_);if(v==R)_=w;else if(!w)if(v==z)continue e;else break e}m[c++]=_}return m}function it(t){var r=-1,i=null==t?0:t.length;for(this.clear();++r<i;){var n=t[r];this.set(n[0],n[1])}}function ir(){this.__data__=rW?rW(null):{},this.size=0}function ii(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=!!r,r}function ia(t){var r=this.__data__;if(rW){var i=r[t];return i===h?n:i}return tr.call(r,t)?r[t]:n}function is(t){var r=this.__data__;return rW?r[t]!==n:tr.call(r,t)}function io(t,r){var i=this.__data__;return this.size+=+!this.has(t),i[t]=rW&&n===r?h:r,this}function il(t){var r=-1,i=null==t?0:t.length;for(this.clear();++r<i;){var n=t[r];this.set(n[0],n[1])}}function iu(){this.__data__=[],this.size=0}function ih(t){var r=this.__data__,i=iP(r,t);return!(i<0)&&(i==r.length-1?r.pop():tg.call(r,i,1),--this.size,!0)}function id(t){var r=this.__data__,i=iP(r,t);return i<0?n:r[i][1]}function ic(t){return iP(this.__data__,t)>-1}function ip(t,r){var i=this.__data__,n=iP(i,t);return n<0?(++this.size,i.push([t,r])):i[n][1]=r,this}function im(t){var r=-1,i=null==t?0:t.length;for(this.clear();++r<i;){var n=t[r];this.set(n[0],n[1])}}function ig(){this.size=0,this.__data__={hash:new it,map:new(ri||il),string:new it}}function i_(t){var r=aY(this,t).delete(t);return this.size-=!!r,r}function ib(t){return aY(this,t).get(t)}function iy(t){return aY(this,t).has(t)}function iv(t,r){var i=aY(this,t),n=i.size;return i.set(t,r),this.size+=+(i.size!=n),this}function iw(t){var r=-1,i=null==t?0:t.length;for(this.__data__=new im;++r<i;)this.add(t[r])}function ix(t){return this.__data__.set(t,h),this}function ik(t){return this.__data__.has(t)}function iE(t){var r=this.__data__=new il(t);this.size=r.size}function iS(){this.__data__=new il,this.size=0}function i$(t){var r=this.__data__,i=r.delete(t);return this.size=r.size,i}function iI(t){return this.__data__.get(t)}function iA(t){return this.__data__.has(t)}function iM(t,r){var i=this.__data__;if(i instanceof il){var n=i.__data__;if(!ri||n.length<s-1)return n.push([t,r]),this.size=++i.size,this;i=this.__data__=new im(n)}return i.set(t,r),this.size=i.size,this}function iT(t,r){var i=lD(t),n=!i&&lP(t),a=!i&&!n&&lF(t),s=!i&&!n&&!a&&ua(t),o=i||n||a||s,l=o?r_(t.length,e4):[],u=l.length;for(var h in t)(r||tr.call(t,h))&&!(o&&("length"==h||a&&("offset"==h||"parent"==h)||s&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||st(h,u)))&&l.push(h);return l}function iC(t){var r=t.length;return r?t[nR(0,r-1)]:n}function iz(t,r){return sE(au(t),iF(r,0,t.length))}function iR(t){return sE(au(t))}function iB(t,r,i){(n===i||lR(t[r],i))&&(n!==i||r in t)||iU(t,r,i)}function iO(t,r,i){var a=t[r];tr.call(t,r)&&lR(a,i)&&(n!==i||r in t)||iU(t,r,i)}function iP(t,r){for(var i=t.length;i--;)if(lR(t[i][0],r))return i;return -1}function iD(t,r,i,n){return iZ(t,function(t,a,s){r(n,t,i(t),s)}),n}function iN(t,r){return t&&ah(r,uj(r),t)}function iL(t,r){return t&&ah(r,uF(r),t)}function iU(t,r,i){"__proto__"==r&&tv?tv(t,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[r]=i}function ij(t,r){for(var a=-1,s=r.length,o=i(s),l=null==t;++a<s;)o[a]=l?n:uO(t,r[a]);return o}function iF(t,r,i){return t==t&&(n!==i&&(t=t<=i?t:i),n!==r&&(t=t>=r?t:r)),t}function iG(t,r,i,a,s,o){var l,u=r&c,h=r&p,f=r&m;if(i&&(l=s?i(t,a,s,o):i(t)),n!==l)return l;if(!lJ(t))return t;var d=lD(t);if(d){if(l=a8(t),!u)return au(t,l)}else{var g=a2(t),_=g==Y||g==X;if(lF(t))return n9(t,u);if(g==et||g==G||_&&!s){if(l=h||_?{}:a6(t),!u)return h?ad(t,iL(l,t)):af(t,iN(l,t))}else{if(!tR[g])return s?t:{};l=a7(t,g,u)}}o||(o=new iE);var b=o.get(t);if(b)return b;o.set(t,l),ur(t)?t.forEach(function(n){l.add(iG(n,r,i,n,t,o))}):l1(t)&&t.forEach(function(n,a){l.set(a,iG(n,r,i,a,t,o))});var y=f?h?aq:aW:h?uF:uj,v=d?n:y(t);return t2(v||t,function(n,a){v&&(n=t[a=n]),iO(l,a,iG(n,r,i,a,t,o))}),l}function iW(t){var r=uj(t);return function(i){return iq(i,t,r)}}function iq(t,r,i){var a=i.length;if(null==t)return!a;for(t=e3(t);a--;){var s=i[a],o=r[s],l=t[s];if(n===l&&!(s in t)||!o(l))return!1}return!0}function iH(t,r,i){if("function"!=typeof t)throw new e8(l);return sv(function(){t.apply(n,i)},r)}function iV(t,r,i,n){var a=-1,o=t8,l=!0,u=t.length,h=[],f=r.length;if(!u)return h;i&&(r=t7(r,rv(i))),n?(o=t6,l=!1):r.length>=s&&(o=rx,l=!1,r=new iw(r));e:for(;++a<u;){var d=t[a],c=null==i?d:i(d);if(d=n||0!==d?d:0,l&&c==c){for(var p=f;p--;)if(r[p]===c)continue e;h.push(d)}else o(r,c,n)||h.push(d)}return h}r3.templateSettings={escape:eM,evaluate:eT,interpolate:eC,variable:"",imports:{_:r3}},r3.prototype=r4.prototype,r3.prototype.constructor=r3,r8.prototype=r5(r4.prototype),r8.prototype.constructor=r8,r6.prototype=r5(r4.prototype),r6.prototype.constructor=r6,it.prototype.clear=ir,it.prototype.delete=ii,it.prototype.get=ia,it.prototype.has=is,it.prototype.set=io,il.prototype.clear=iu,il.prototype.delete=ih,il.prototype.get=id,il.prototype.has=ic,il.prototype.set=ip,im.prototype.clear=ig,im.prototype.delete=i_,im.prototype.get=ib,im.prototype.has=iy,im.prototype.set=iv,iw.prototype.add=iw.prototype.push=ix,iw.prototype.has=ik,iE.prototype.clear=iS,iE.prototype.delete=i$,iE.prototype.get=iI,iE.prototype.has=iA,iE.prototype.set=iM;var iZ=am(i3),iK=am(i5,!0);function iY(t,r){var i=!0;return iZ(t,function(t,n,a){return i=!!r(t,n,a)}),i}function iX(t,r,i){for(var a=-1,s=t.length;++a<s;){var o=t[a],l=r(o);if(null!=l&&(n===u?l==l&&!un(l):i(l,u)))var u=l,h=o}return h}function iQ(t,r,i,a){var s=t.length;for((i=uc(i))<0&&(i=-i>s?0:s+i),(a=n===a||a>s?s:uc(a))<0&&(a+=s),a=i>a?0:up(a);i<a;)t[i++]=r;return t}function iJ(t,r){var i=[];return iZ(t,function(t,n,a){r(t,n,a)&&i.push(t)}),i}function i0(t,r,i,n,a){var s=-1,o=t.length;for(i||(i=se),a||(a=[]);++s<o;){var l=t[s];r>0&&i(l)?r>1?i0(l,r-1,i,n,a):t9(a,l):n||(a[a.length]=l)}return a}var i1=ag(),i2=ag(!0);function i3(t,r){return t&&i1(t,r,uj)}function i5(t,r){return t&&i2(t,r,uj)}function i4(t,r){return t4(r,function(r){return lY(t[r])})}function i8(t,r){r=n4(r,t);for(var i=0,a=r.length;null!=t&&i<a;)t=t[s$(r[i++])];return i&&i==a?t:n}function i6(t,r,i){var n=r(t);return lD(t)?n:t9(n,i(t))}function i7(t){return null==t?n===t?el:ee:ty&&ty in e3(t)?aJ(t):sp(t)}function i9(t,r){return t>r}function ne(t,r){return null!=t&&tr.call(t,r)}function nt(t,r){return null!=t&&r in e3(t)}function nr(t,r,i){return t>=tU(r,i)&&t<tD(r,i)}function ni(t,r,a){for(var s=a?t6:t8,o=t[0].length,l=t.length,u=l,h=i(l),f=1/0,d=[];u--;){var c=t[u];u&&r&&(c=t7(c,rv(r))),f=tU(c.length,f),h[u]=!a&&(r||o>=120&&c.length>=120)?new iw(u&&c):n}c=t[0];var p=-1,m=h[0];e:for(;++p<o&&d.length<f;){var g=c[p],_=r?r(g):g;if(g=a||0!==g?g:0,!(m?rx(m,_):s(d,_,a))){for(u=l;--u;){var b=h[u];if(!(b?rx(b,_):s(t[u],_,a)))continue e}m&&m.push(_),d.push(g)}}return d}function nn(t,r,i,n){return i3(t,function(t,a,s){r(n,i(t),a,s)}),n}function na(t,r,i){r=n4(r,t);var a=null==(t=sg(t,r))?t:t[s$(s0(r))];return null==a?n:t0(a,t,i)}function ns(t){return l0(t)&&i7(t)==G}function no(t){return l0(t)&&i7(t)==ef}function nl(t){return l0(t)&&i7(t)==V}function nu(t,r,i,n,a){return t===r||(null!=t&&null!=r&&(l0(t)||l0(r))?nh(t,r,i,n,nu,a):t!=t&&r!=r)}function nh(t,r,i,n,a,s){var o=lD(t),l=lD(r),u=o?W:a2(t),h=l?W:a2(r);u=u==G?et:u,h=h==G?et:h;var f=u==et,d=h==et,c=u==h;if(c&&lF(t)){if(!lF(r))return!1;o=!0,f=!1}if(c&&!f)return s||(s=new iE),o||ua(t)?aU(t,r,i,n,a,s):aj(t,r,u,i,n,a,s);if(!(i&g)){var p=f&&tr.call(t,"__wrapped__"),m=d&&tr.call(r,"__wrapped__");if(p||m){var _=p?t.value():t,b=m?r.value():r;return s||(s=new iE),a(_,b,i,n,s)}}return!!c&&(s||(s=new iE),aF(t,r,i,n,a,s))}function nf(t){return l0(t)&&a2(t)==Q}function nd(t,r,i,a){var s=i.length,o=s,l=!a;if(null==t)return!o;for(t=e3(t);s--;){var u=i[s];if(l&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++s<o;){var h=(u=i[s])[0],f=t[h],d=u[1];if(l&&u[2]){if(n===f&&!(h in t))return!1}else{var c=new iE;if(a)var p=a(f,d,h,t,r,c);if(!(n===p?nu(d,f,g|_,a,c):p))return!1}}return!0}function nc(t){return!(!lJ(t)||ss(t))&&(lY(t)?tl:eK).test(sI(t))}function np(t){return l0(t)&&i7(t)==en}function nm(t){return l0(t)&&a2(t)==ea}function ng(t){return l0(t)&&lQ(t.length)&&!!tz[i7(t)]}function n_(t){return"function"==typeof t?t:null==t?hL:"object"==typeof t?lD(t)?nk(t[0],t[1]):nx(t):hQ(t)}function nb(t){if(!sl(t))return tP(t);var r=[];for(var i in e3(t))tr.call(t,i)&&"constructor"!=i&&r.push(i);return r}function ny(t){if(!lJ(t))return sc(t);var r=sl(t),i=[];for(var n in t)"constructor"==n&&(r||!tr.call(t,n))||i.push(n);return i}function nv(t,r){return t<r}function nw(t,r){var n=-1,a=lL(t)?i(t.length):[];return iZ(t,function(t,i,s){a[++n]=r(t,i,s)}),a}function nx(t){var r=aX(t);return 1==r.length&&r[0][2]?sh(r[0][0],r[0][1]):function(i){return i===t||nd(i,t,r)}}function nk(t,r){return si(t)&&su(r)?sh(s$(t),r):function(i){var a=uO(i,t);return n===a&&a===r?uD(i,t):nu(r,a,g|_)}}function nE(t,r,i,a,s){t!==r&&i1(r,function(o,l){if(s||(s=new iE),lJ(o))nS(t,r,l,i,nE,a,s);else{var u=a?a(sb(t,l),o,l+"",t,r,s):n;n===u&&(u=o),iB(t,l,u)}},uF)}function nS(t,r,i,a,s,o,l){var u=sb(t,i),h=sb(r,i),f=l.get(h);if(f)return void iB(t,i,f);var d=o?o(u,h,i+"",t,r,l):n,c=n===d;if(c){var p=lD(h),m=!p&&lF(h),g=!p&&!m&&ua(h);d=h,p||m||g?lD(u)?d=u:lU(u)?d=au(u):m?(c=!1,d=n9(h,!0)):g?(c=!1,d=an(h,!0)):d=[]:l9(h)||lP(h)?(d=u,lP(u)?d=ug(u):(!lJ(u)||lY(u))&&(d=a6(h))):c=!1}c&&(l.set(h,d),s(d,h,a,o,l),l.delete(h)),iB(t,i,d)}function n$(t,r){var i=t.length;if(i)return st(r+=r<0?i:0,i)?t[r]:n}function nI(t,r,i){r=r.length?t7(r,function(t){return lD(t)?function(r){return i8(r,1===t.length?t[0]:t)}:t}):[hL];var n=-1;return r=t7(r,rv(aK())),rm(nw(t,function(t,i,a){return{criteria:t7(r,function(r){return r(t)}),index:++n,value:t}}),function(t,r){return as(t,r,i)})}function nA(t,r){return nM(t,r,function(r,i){return uD(t,i)})}function nM(t,r,i){for(var n=-1,a=r.length,s={};++n<a;){var o=r[n],l=i8(t,o);i(l,o)&&nL(s,n4(o,t),l)}return s}function nT(t){return function(r){return i8(r,t)}}function nC(t,r,i,n){var a=n?ru:rl,s=-1,o=r.length,l=t;for(t===r&&(r=au(r)),i&&(l=t7(t,rv(i)));++s<o;)for(var u=0,h=r[s],f=i?i(h):h;(u=a(l,f,u,n))>-1;)l!==t&&tg.call(l,u,1),tg.call(t,u,1);return t}function nz(t,r){for(var i=t?r.length:0,n=i-1;i--;){var a=r[i];if(i==n||a!==s){var s=a;st(a)?tg.call(t,a,1):nX(t,a)}}return t}function nR(t,r){return t+tI(tW()*(r-t+1))}function nB(t,r,n,a){for(var s=-1,o=tD(t$((r-t)/(n||1)),0),l=i(o);o--;)l[a?o:++s]=t,t+=n;return l}function nO(t,r){var i="";if(!t||r<1||r>P)return i;do r%2&&(i+=t),(r=tI(r/2))&&(t+=t);while(r)return i}function nP(t,r){return sw(sm(t,r,hL),t+"")}function nD(t){return iC(u8(t))}function nN(t,r){var i=u8(t);return sE(i,iF(r,0,i.length))}function nL(t,r,i,a){if(!lJ(t))return t;r=n4(r,t);for(var s=-1,o=r.length,l=o-1,u=t;null!=u&&++s<o;){var h=s$(r[s]),f=i;if("__proto__"===h||"constructor"===h||"prototype"===h)break;if(s!=l){var d=u[h];f=a?a(d,h,u):n,n===f&&(f=lJ(d)?d:st(r[s+1])?[]:{})}iO(u,h,f),u=u[h]}return t}var nU=rq?function(t,r){return rq.set(t,r),t}:hL,nj=tv?function(t,r){return tv(t,"toString",{configurable:!0,enumerable:!1,value:hO(r),writable:!0})}:hL;function nF(t){return sE(u8(t))}function nG(t,r,n){var a=-1,s=t.length;r<0&&(r=-r>s?0:s+r),(n=n>s?s:n)<0&&(n+=s),s=r>n?0:n-r>>>0,r>>>=0;for(var o=i(s);++a<s;)o[a]=t[a+r];return o}function nW(t,r){var i;return iZ(t,function(t,n,a){return!(i=r(t,n,a))}),!!i}function nq(t,r,i){var n=0,a=null==t?n:t.length;if("number"==typeof r&&r==r&&a<=j){for(;n<a;){var s=n+a>>>1,o=t[s];null!==o&&!un(o)&&(i?o<=r:o<r)?n=s+1:a=s}return a}return nH(t,r,hL,i)}function nH(t,r,i,a){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var l=(r=i(r))!=r,u=null===r,h=un(r),f=n===r;s<o;){var d=tI((s+o)/2),c=i(t[d]),p=n!==c,m=null===c,g=c==c,_=un(c);if(l)var b=a||g;else b=f?g&&(a||p):u?g&&p&&(a||!m):h?g&&p&&!m&&(a||!_):!m&&!_&&(a?c<=r:c<r);b?s=d+1:o=d}return tU(o,U)}function nV(t,r){for(var i=-1,n=t.length,a=0,s=[];++i<n;){var o=t[i],l=r?r(o):o;if(!i||!lR(l,u)){var u=l;s[a++]=0===o?0:o}}return s}function nZ(t){return"number"==typeof t?t:un(t)?N:+t}function nK(t){if("string"==typeof t)return t;if(lD(t))return t7(t,nK)+"";if(un(t))return r2?r2.call(t):"";var r=t+"";return"0"==r&&1/t==-O?"-0":r}function nY(t,r,i){var n=-1,a=t8,o=t.length,l=!0,u=[],h=u;if(i)l=!1,a=t6;else if(o>=s){var f=r?null:aB(t);if(f)return rP(f);l=!1,a=rx,h=new iw}else h=r?[]:u;e:for(;++n<o;){var d=t[n],c=r?r(d):d;if(d=i||0!==d?d:0,l&&c==c){for(var p=h.length;p--;)if(h[p]===c)continue e;r&&h.push(c),u.push(d)}else a(h,c,i)||(h!==u&&h.push(c),u.push(d))}return u}function nX(t,r){return r=n4(r,t),null==(t=sg(t,r))||delete t[s$(s0(r))]}function nQ(t,r,i,n){return nL(t,r,i(i8(t,r)),n)}function nJ(t,r,i,n){for(var a=t.length,s=n?a:-1;(n?s--:++s<a)&&r(t[s],s,t););return i?nG(t,n?0:s,n?s+1:a):nG(t,n?s+1:0,n?a:s)}function n0(t,r){var i=t;return i instanceof r6&&(i=i.value()),re(r,function(t,r){return r.func.apply(r.thisArg,t9([t],r.args))},i)}function n1(t,r,n){var a=t.length;if(a<2)return a?nY(t[0]):[];for(var s=-1,o=i(a);++s<a;)for(var l=t[s],u=-1;++u<a;)u!=s&&(o[s]=iV(o[s]||l,t[u],r,n));return nY(i0(o,1),r,n)}function n2(t,r,i){for(var a=-1,s=t.length,o=r.length,l={};++a<s;){var u=a<o?r[a]:n;i(l,t[a],u)}return l}function n3(t){return lU(t)?t:[]}function n5(t){return"function"==typeof t?t:hL}function n4(t,r){return lD(t)?t:si(t,r)?[t]:sS(ub(t))}var n8=nP;function n6(t,r,i){var a=t.length;return i=n===i?a:i,!r&&i>=a?t:nG(t,r,i)}var n7=tw||function(t){return tF.clearTimeout(t)};function n9(t,r){if(r)return t.slice();var i=t.length,n=td?td(i):new t.constructor(i);return t.copy(n),n}function ae(t){var r=new t.constructor(t.byteLength);return new tf(r).set(new tf(t)),r}function at(t,r){var i=r?ae(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}function ar(t){var r=new t.constructor(t.source,eH.exec(t));return r.lastIndex=t.lastIndex,r}function ai(t){return r1?e3(r1.call(t)):{}}function an(t,r){var i=r?ae(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function aa(t,r){if(t!==r){var i=n!==t,a=null===t,s=t==t,o=un(t),l=n!==r,u=null===r,h=r==r,f=un(r);if(!u&&!f&&!o&&t>r||o&&l&&h&&!u&&!f||a&&l&&h||!i&&h||!s)return 1;if(!a&&!o&&!f&&t<r||f&&i&&s&&!a&&!o||u&&i&&s||!l&&s||!h)return -1}return 0}function as(t,r,i){for(var n=-1,a=t.criteria,s=r.criteria,o=a.length,l=i.length;++n<o;){var u=aa(a[n],s[n]);if(u){if(n>=l)return u;return u*("desc"==i[n]?-1:1)}}return t.index-r.index}function ao(t,r,n,a){for(var s=-1,o=t.length,l=n.length,u=-1,h=r.length,f=tD(o-l,0),d=i(h+f),c=!a;++u<h;)d[u]=r[u];for(;++s<l;)(c||s<o)&&(d[n[s]]=t[s]);for(;f--;)d[u++]=t[s++];return d}function al(t,r,n,a){for(var s=-1,o=t.length,l=-1,u=n.length,h=-1,f=r.length,d=tD(o-u,0),c=i(d+f),p=!a;++s<d;)c[s]=t[s];for(var m=s;++h<f;)c[m+h]=r[h];for(;++l<u;)(p||s<o)&&(c[m+n[l]]=t[s++]);return c}function au(t,r){var n=-1,a=t.length;for(r||(r=i(a));++n<a;)r[n]=t[n];return r}function ah(t,r,i,a){var s=!i;i||(i={});for(var o=-1,l=r.length;++o<l;){var u=r[o],h=a?a(i[u],t[u],u,i,t):n;n===h&&(h=t[u]),s?iU(i,u,h):iO(i,u,h)}return i}function af(t,r){return ah(t,a0(t),r)}function ad(t,r){return ah(t,a1(t),r)}function ac(t,r){return function(i,n){var a=lD(i)?t1:iD,s=r?r():{};return a(i,t,aK(n,2),s)}}function ap(t){return nP(function(r,i){var a=-1,s=i.length,o=s>1?i[s-1]:n,l=s>2?i[2]:n;for(o=t.length>3&&"function"==typeof o?(s--,o):n,l&&sr(i[0],i[1],l)&&(o=s<3?n:o,s=1),r=e3(r);++a<s;){var u=i[a];u&&t(r,u,a,o)}return r})}function am(t,r){return function(i,n){if(null==i)return i;if(!lL(i))return t(i,n);for(var a=i.length,s=r?a:-1,o=e3(i);(r?s--:++s<a)&&!1!==n(o[s],s,o););return i}}function ag(t){return function(r,i,n){for(var a=-1,s=e3(r),o=n(r),l=o.length;l--;){var u=o[t?l:++a];if(!1===i(s[u],u,s))break}return r}}function a_(t,r,i){var n=r&b,a=av(t);function s(){return(this&&this!==tF&&this instanceof s?a:t).apply(n?i:this,arguments)}return s}function ab(t){return function(r){var i=rT(r=ub(r))?rj(r):n,a=i?i[0]:r.charAt(0),s=i?n6(i,1).join(""):r.slice(1);return a[t]()+s}}function ay(t){return function(r){return re(hT(hi(r).replace(tE,"")),t,"")}}function av(t){return function(){var r=arguments;switch(r.length){case 0:return new t;case 1:return new t(r[0]);case 2:return new t(r[0],r[1]);case 3:return new t(r[0],r[1],r[2]);case 4:return new t(r[0],r[1],r[2],r[3]);case 5:return new t(r[0],r[1],r[2],r[3],r[4]);case 6:return new t(r[0],r[1],r[2],r[3],r[4],r[5]);case 7:return new t(r[0],r[1],r[2],r[3],r[4],r[5],r[6])}var i=r5(t.prototype),n=t.apply(i,r);return lJ(n)?n:i}}function aw(t,r,a){var s=av(t);function o(){for(var l=arguments.length,u=i(l),h=l,f=aZ(o);h--;)u[h]=arguments[h];var d=l<3&&u[0]!==f&&u[l-1]!==f?[]:rO(u,f);return(l-=d.length)<a?az(t,r,aE,o.placeholder,n,u,d,n,n,a-l):t0(this&&this!==tF&&this instanceof o?s:t,this,u)}return o}function ax(t){return function(r,i,a){var s=e3(r);if(!lL(r)){var o=aK(i,3);r=uj(r),i=function(t){return o(s[t],t,s)}}var l=t(r,i,a);return l>-1?s[o?r[l]:l]:n}}function ak(t){return aG(function(r){var i=r.length,a=i,s=r8.prototype.thru;for(t&&r.reverse();a--;){var o=r[a];if("function"!=typeof o)throw new e8(l);if(s&&!u&&"wrapper"==aV(o))var u=new r8([],!0)}for(a=u?a:i;++a<i;){var h=aV(o=r[a]),f="wrapper"==h?aH(o):n;u=f&&sa(f[0])&&f[1]==(S|w|k|$)&&!f[4].length&&1==f[9]?u[aV(f[0])].apply(u,f[3]):1==o.length&&sa(o)?u[h]():u.thru(o)}return function(){var t=arguments,n=t[0];if(u&&1==t.length&&lD(n))return u.plant(n).value();for(var a=0,s=i?r[a].apply(this,t):n;++a<i;)s=r[a].call(this,s);return s}})}function aE(t,r,a,s,o,l,u,h,f,d){var c=r&S,p=r&b,m=r&y,g=r&(w|x),_=r&I,v=m?n:av(t);function k(){for(var n=arguments.length,b=i(n),y=n;y--;)b[y]=arguments[y];if(g)var w=aZ(k),x=rS(b,w);if(s&&(b=ao(b,s,o,g)),l&&(b=al(b,l,u,g)),n-=x,g&&n<d){var E=rO(b,w);return az(t,r,aE,k.placeholder,a,b,E,h,f,d-n)}var S=p?a:this,$=m?S[t]:t;return n=b.length,h?b=s_(b,h):_&&n>1&&b.reverse(),c&&f<n&&(b.length=f),this&&this!==tF&&this instanceof k&&($=v||av($)),$.apply(S,b)}return k}function aS(t,r){return function(i,n){return nn(i,t,r(n),{})}}function a$(t,r){return function(i,a){var s;if(n===i&&n===a)return r;if(n!==i&&(s=i),n!==a){if(n===s)return a;"string"==typeof i||"string"==typeof a?(i=nK(i),a=nK(a)):(i=nZ(i),a=nZ(a)),s=t(i,a)}return s}}function aI(t){return aG(function(r){return r=t7(r,rv(aK())),nP(function(i){var n=this;return t(r,function(t){return t0(t,n,i)})})})}function aA(t,r){var i=(r=n===r?" ":nK(r)).length;if(i<2)return i?nO(r,t):r;var a=nO(r,t$(t/rU(r)));return rT(r)?n6(rj(a),0,t).join(""):a.slice(0,t)}function aM(t,r,n,a){var s=r&b,o=av(t);function l(){for(var r=-1,u=arguments.length,h=-1,f=a.length,d=i(f+u),c=this&&this!==tF&&this instanceof l?o:t;++h<f;)d[h]=a[h];for(;u--;)d[h++]=arguments[++r];return t0(c,s?n:this,d)}return l}function aT(t){return function(r,i,a){return a&&"number"!=typeof a&&sr(r,i,a)&&(i=a=n),r=ud(r),n===i?(i=r,r=0):i=ud(i),a=n===a?r<i?1:-1:ud(a),nB(r,i,a,t)}}function aC(t){return function(r,i){return("string"!=typeof r||"string"!=typeof i)&&(r=um(r),i=um(i)),t(r,i)}}function az(t,r,i,a,s,o,l,u,h,f){var d=r&w,c=d?l:n,p=d?n:l,m=d?o:n,g=d?n:o;r|=d?k:E,(r&=~(d?E:k))&v||(r&=~(b|y));var _=[t,r,s,m,c,g,p,u,h,f],x=i.apply(n,_);return sa(t)&&sy(x,_),x.placeholder=a,sx(x,t,r)}function aR(t){var r=e2[t];return function(t,i){if(t=um(t),(i=null==i?0:tU(uc(i),292))&&tB(t)){var n=(ub(t)+"e").split("e");return+((n=(ub(r(n[0]+"e"+(+n[1]+i)))+"e").split("e"))[0]+"e"+(n[1]-i))}return r(t)}}var aB=rc&&1/rP(new rc([,-0]))[1]==O?function(t){return new rc(t)}:hV;function aO(t){return function(r){var i=a2(r);return i==Q?rR(r):i==ea?rD(r):rb(r,t(r))}}function aP(t,r,i,a,s,o,u,h){var f=r&y;if(!f&&"function"!=typeof t)throw new e8(l);var d=a?a.length:0;if(d||(r&=~(k|E),a=s=n),u=n===u?u:tD(uc(u),0),h=n===h?h:uc(h),d-=s?s.length:0,r&E){var c=a,p=s;a=s=n}var m=f?n:aH(t),g=[t,r,i,a,s,c,p,o,u,h];if(m&&sd(g,m),t=g[0],r=g[1],i=g[2],a=g[3],s=g[4],(h=g[9]=g[9]===n?f?0:t.length:tD(g[9]-d,0))||!(r&(w|x))||(r&=~(w|x)),r&&r!=b)_=r==w||r==x?aw(t,r,h):r!=k&&r!=(b|k)||s.length?aE.apply(n,g):aM(t,r,i,a);else var _=a_(t,r,i);return sx((m?nU:sy)(_,g),t,r)}function aD(t,r,i,a){return n===t||lR(t,e9[i])&&!tr.call(a,i)?r:t}function aN(t,r,i,a,s,o){return lJ(t)&&lJ(r)&&(o.set(r,t),nE(t,r,n,aN,o),o.delete(r)),t}function aL(t){return l9(t)?n:t}function aU(t,r,i,a,s,o){var l=i&g,u=t.length,h=r.length;if(u!=h&&!(l&&h>u))return!1;var f=o.get(t),d=o.get(r);if(f&&d)return f==r&&d==t;var c=-1,p=!0,m=i&_?new iw:n;for(o.set(t,r),o.set(r,t);++c<u;){var b=t[c],y=r[c];if(a)var v=l?a(y,b,c,r,t,o):a(b,y,c,t,r,o);if(n!==v){if(v)continue;p=!1;break}if(m){if(!rr(r,function(t,r){if(!rx(m,r)&&(b===t||s(b,t,i,a,o)))return m.push(r)})){p=!1;break}}else if(!(b===y||s(b,y,i,a,o))){p=!1;break}}return o.delete(t),o.delete(r),p}function aj(t,r,i,n,a,s,o){switch(i){case ed:if(t.byteLength!=r.byteLength||t.byteOffset!=r.byteOffset)break;t=t.buffer,r=r.buffer;case ef:if(t.byteLength!=r.byteLength||!s(new tf(t),new tf(r)))break;return!0;case H:case V:case J:return lR(+t,+r);case K:return t.name==r.name&&t.message==r.message;case en:case es:return t==r+"";case Q:var l=rR;case ea:var u=n&g;if(l||(l=rP),t.size!=r.size&&!u)break;var h=o.get(t);if(h)return h==r;n|=_,o.set(t,r);var f=aU(l(t),l(r),n,a,s,o);return o.delete(t),f;case eo:if(r1)return r1.call(t)==r1.call(r)}return!1}function aF(t,r,i,a,s,o){var l=i&g,u=aW(t),h=u.length;if(h!=aW(r).length&&!l)return!1;for(var f=h;f--;){var d=u[f];if(!(l?d in r:tr.call(r,d)))return!1}var c=o.get(t),p=o.get(r);if(c&&p)return c==r&&p==t;var m=!0;o.set(t,r),o.set(r,t);for(var _=l;++f<h;){var b=t[d=u[f]],y=r[d];if(a)var v=l?a(y,b,d,r,t,o):a(b,y,d,t,r,o);if(!(n===v?b===y||s(b,y,i,a,o):v)){m=!1;break}_||(_="constructor"==d)}if(m&&!_){var w=t.constructor,x=r.constructor;w!=x&&"constructor"in t&&"constructor"in r&&!("function"==typeof w&&w instanceof w&&"function"==typeof x&&x instanceof x)&&(m=!1)}return o.delete(t),o.delete(r),m}function aG(t){return sw(sm(t,n,sG),t+"")}function aW(t){return i6(t,uj,a0)}function aq(t){return i6(t,uF,a1)}var aH=rq?function(t){return rq.get(t)}:hV;function aV(t){for(var r=t.name+"",i=rZ[r],n=tr.call(rZ,r)?i.length:0;n--;){var a=i[n],s=a.func;if(null==s||s==t)return a.name}return r}function aZ(t){return(tr.call(r3,"placeholder")?r3:t).placeholder}function aK(){var t=r3.iteratee||hU;return t=t===hU?n_:t,arguments.length?t(arguments[0],arguments[1]):t}function aY(t,r){var i=t.__data__;return sn(r)?i["string"==typeof r?"string":"hash"]:i.map}function aX(t){for(var r=uj(t),i=r.length;i--;){var n=r[i],a=t[n];r[i]=[n,a,su(a)]}return r}function aQ(t,r){var i=rM(t,r);return nc(i)?i:n}function aJ(t){var r=tr.call(t,ty),i=t[ty];try{t[ty]=n;var a=!0}catch(t){}var s=ta.call(t);return a&&(r?t[ty]=i:delete t[ty]),s}var a0=tA?function(t){return null==t?[]:t4(tA(t=e3(t)),function(r){return tm.call(t,r)})}:h2,a1=tA?function(t){for(var r=[];t;)t9(r,a0(t)),t=tc(t);return r}:h2,a2=i7;function a3(t,r,i){for(var n=-1,a=i.length;++n<a;){var s=i[n],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":r-=o;break;case"take":r=tU(r,t+o);break;case"takeRight":t=tD(t,r-o)}}return{start:t,end:r}}function a5(t){var r=t.match(eU);return r?r[1].split(ej):[]}function a4(t,r,i){r=n4(r,t);for(var n=-1,a=r.length,s=!1;++n<a;){var o=s$(r[n]);if(!(s=null!=t&&i(t,o)))break;t=t[o]}return s||++n!=a?s:!!(a=null==t?0:t.length)&&lQ(a)&&st(o,a)&&(lD(t)||lP(t))}function a8(t){var r=t.length,i=new t.constructor(r);return r&&"string"==typeof t[0]&&tr.call(t,"index")&&(i.index=t.index,i.input=t.input),i}function a6(t){return"function"!=typeof t.constructor||sl(t)?{}:r5(tc(t))}function a7(t,r,i){var n=t.constructor;switch(r){case ef:return ae(t);case H:case V:return new n(+t);case ed:return at(t,i);case ec:case ep:case em:case eg:case e_:case eb:case ey:case ev:case ew:return an(t,i);case Q:return new n;case J:case es:return new n(t);case en:return ar(t);case ea:return new n;case eo:return ai(t)}}function a9(t,r){var i=r.length;if(!i)return t;var n=i-1;return r[n]=(i>1?"& ":"")+r[n],r=r.join(i>2?", ":" "),t.replace(eL,"{\n/* [wrapped with "+r+"] */\n")}function se(t){return lD(t)||lP(t)||!!(t_&&t&&t[t_])}function st(t,r){var i=typeof t;return!!(r=null==r?P:r)&&("number"==i||"symbol"!=i&&eX.test(t))&&t>-1&&t%1==0&&t<r}function sr(t,r,i){if(!lJ(i))return!1;var n=typeof r;return("number"==n?!!(lL(i)&&st(r,i.length)):"string"==n&&r in i)&&lR(i[r],t)}function si(t,r){if(lD(t))return!1;var i=typeof t;return!!("number"==i||"symbol"==i||"boolean"==i||null==t||un(t))||eR.test(t)||!ez.test(t)||null!=r&&t in e3(r)}function sn(t){var r=typeof t;return"string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t}function sa(t){var r=aV(t),i=r3[r];if("function"!=typeof i||!(r in r6.prototype))return!1;if(t===i)return!0;var n=aH(i);return!!n&&t===n[0]}function ss(t){return!!tn&&tn in t}(tV&&a2(new tV(new ArrayBuffer(1)))!=ed||ri&&a2(new ri)!=Q||rn&&a2(rn.resolve())!=er||rc&&a2(new rc)!=ea||rN&&a2(new rN)!=eu)&&(a2=function(t){var r=i7(t),i=r==et?t.constructor:n,a=i?sI(i):"";if(a)switch(a){case rK:return ed;case rY:return Q;case rX:return er;case rQ:return ea;case rJ:return eu}return r});var so=te?lY:h3;function sl(t){var r=t&&t.constructor;return t===("function"==typeof r&&r.prototype||e9)}function su(t){return t==t&&!lJ(t)}function sh(t,r){return function(i){return null!=i&&i[t]===r&&(n!==r||t in e3(i))}}function sf(t){var r=lm(t,function(t){return i.size===f&&i.clear(),t}),i=r.cache;return r}function sd(t,r){var i=t[1],n=r[1],a=i|n,s=a<(b|y|S),o=n==S&&i==w||n==S&&i==$&&t[7].length<=r[8]||n==(S|$)&&r[7].length<=r[8]&&i==w;if(!(s||o))return t;n&b&&(t[2]=r[2],a|=i&b?0:v);var l=r[3];if(l){var u=t[3];t[3]=u?ao(u,l,r[4]):l,t[4]=u?rO(t[3],d):r[4]}return(l=r[5])&&(u=t[5],t[5]=u?al(u,l,r[6]):l,t[6]=u?rO(t[5],d):r[6]),(l=r[7])&&(t[7]=l),n&S&&(t[8]=null==t[8]?r[8]:tU(t[8],r[8])),null==t[9]&&(t[9]=r[9]),t[0]=r[0],t[1]=a,t}function sc(t){var r=[];if(null!=t)for(var i in e3(t))r.push(i);return r}function sp(t){return ta.call(t)}function sm(t,r,a){return r=tD(n===r?t.length-1:r,0),function(){for(var n=arguments,s=-1,o=tD(n.length-r,0),l=i(o);++s<o;)l[s]=n[r+s];s=-1;for(var u=i(r+1);++s<r;)u[s]=n[s];return u[r]=a(l),t0(t,this,u)}}function sg(t,r){return r.length<2?t:i8(t,nG(r,0,-1))}function s_(t,r){for(var i=t.length,a=tU(r.length,i),s=au(t);a--;){var o=r[a];t[a]=st(o,i)?s[o]:n}return t}function sb(t,r){if(("constructor"!==r||"function"!=typeof t[r])&&"__proto__"!=r)return t[r]}var sy=sk(nU),sv=tk||function(t,r){return tF.setTimeout(t,r)},sw=sk(nj);function sx(t,r,i){var n=r+"";return sw(t,a9(n,sA(a5(n),i)))}function sk(t){var r=0,i=0;return function(){var a=tj(),s=C-(a-i);if(i=a,s>0){if(++r>=T)return arguments[0]}else r=0;return t.apply(n,arguments)}}function sE(t,r){var i=-1,a=t.length,s=a-1;for(r=n===r?a:r;++i<r;){var o=nR(i,s),l=t[o];t[o]=t[i],t[i]=l}return t.length=r,t}var sS=sf(function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(eB,function(t,i,n,a){r.push(n?a.replace(eW,"$1"):i||t)}),r});function s$(t){if("string"==typeof t||un(t))return t;var r=t+"";return"0"==r&&1/t==-O?"-0":r}function sI(t){if(null!=t){try{return tt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function sA(t,r){return t2(F,function(i){var n="_."+i[0];r&i[1]&&!t8(t,n)&&t.push(n)}),t.sort()}function sM(t){if(t instanceof r6)return t.clone();var r=new r8(t.__wrapped__,t.__chain__);return r.__actions__=au(t.__actions__),r.__index__=t.__index__,r.__values__=t.__values__,r}function sT(t,r,a){r=(a?sr(t,r,a):n===r)?1:tD(uc(r),0);var s=null==t?0:t.length;if(!s||r<1)return[];for(var o=0,l=0,u=i(t$(s/r));o<s;)u[l++]=nG(t,o,o+=r);return u}function sC(t){for(var r=-1,i=null==t?0:t.length,n=0,a=[];++r<i;){var s=t[r];s&&(a[n++]=s)}return a}function sz(){var t=arguments.length;if(!t)return[];for(var r=i(t-1),n=arguments[0],a=t;a--;)r[a-1]=arguments[a];return t9(lD(n)?au(n):[n],i0(r,1))}var sR=nP(function(t,r){return lU(t)?iV(t,i0(r,1,lU,!0)):[]}),sB=nP(function(t,r){var i=s0(r);return lU(i)&&(i=n),lU(t)?iV(t,i0(r,1,lU,!0),aK(i,2)):[]}),sO=nP(function(t,r){var i=s0(r);return lU(i)&&(i=n),lU(t)?iV(t,i0(r,1,lU,!0),n,i):[]});function sP(t,r,i){var a=null==t?0:t.length;return a?nG(t,(r=i||n===r?1:uc(r))<0?0:r,a):[]}function sD(t,r,i){var a=null==t?0:t.length;return a?nG(t,0,(r=a-(r=i||n===r?1:uc(r)))<0?0:r):[]}function sN(t,r){return t&&t.length?nJ(t,aK(r,3),!0,!0):[]}function sL(t,r){return t&&t.length?nJ(t,aK(r,3),!0):[]}function sU(t,r,i,n){var a=null==t?0:t.length;return a?(i&&"number"!=typeof i&&sr(t,r,i)&&(i=0,n=a),iQ(t,r,i,n)):[]}function sj(t,r,i){var n=null==t?0:t.length;if(!n)return -1;var a=null==i?0:uc(i);return a<0&&(a=tD(n+a,0)),ro(t,aK(r,3),a)}function sF(t,r,i){var a=null==t?0:t.length;if(!a)return -1;var s=a-1;return n!==i&&(s=uc(i),s=i<0?tD(a+s,0):tU(s,a-1)),ro(t,aK(r,3),s,!0)}function sG(t){return(null==t?0:t.length)?i0(t,1):[]}function sW(t){return(null==t?0:t.length)?i0(t,O):[]}function sq(t,r){return(null==t?0:t.length)?i0(t,r=n===r?1:uc(r)):[]}function sH(t){for(var r=-1,i=null==t?0:t.length,n={};++r<i;){var a=t[r];n[a[0]]=a[1]}return n}function sV(t){return t&&t.length?t[0]:n}function sZ(t,r,i){var n=null==t?0:t.length;if(!n)return -1;var a=null==i?0:uc(i);return a<0&&(a=tD(n+a,0)),rl(t,r,a)}function sK(t){return(null==t?0:t.length)?nG(t,0,-1):[]}var sY=nP(function(t){var r=t7(t,n3);return r.length&&r[0]===t[0]?ni(r):[]}),sX=nP(function(t){var r=s0(t),i=t7(t,n3);return r===s0(i)?r=n:i.pop(),i.length&&i[0]===t[0]?ni(i,aK(r,2)):[]}),sQ=nP(function(t){var r=s0(t),i=t7(t,n3);return(r="function"==typeof r?r:n)&&i.pop(),i.length&&i[0]===t[0]?ni(i,n,r):[]});function sJ(t,r){return null==t?"":tO.call(t,r)}function s0(t){var r=null==t?0:t.length;return r?t[r-1]:n}function s1(t,r,i){var a=null==t?0:t.length;if(!a)return -1;var s=a;return n!==i&&(s=(s=uc(i))<0?tD(a+s,0):tU(s,a-1)),r==r?rL(t,r,s):ro(t,rh,s,!0)}function s2(t,r){return t&&t.length?n$(t,uc(r)):n}var s3=nP(s5);function s5(t,r){return t&&t.length&&r&&r.length?nC(t,r):t}function s4(t,r,i){return t&&t.length&&r&&r.length?nC(t,r,aK(i,2)):t}function s8(t,r,i){return t&&t.length&&r&&r.length?nC(t,r,n,i):t}var s6=aG(function(t,r){var i=null==t?0:t.length,n=ij(t,r);return nz(t,t7(r,function(t){return st(t,i)?+t:t}).sort(aa)),n});function s7(t,r){var i=[];if(!(t&&t.length))return i;var n=-1,a=[],s=t.length;for(r=aK(r,3);++n<s;){var o=t[n];r(o,n,t)&&(i.push(o),a.push(n))}return nz(t,a),i}function s9(t){return null==t?t:tH.call(t)}function oe(t,r,i){var a=null==t?0:t.length;return a?(i&&"number"!=typeof i&&sr(t,r,i)?(r=0,i=a):(r=null==r?0:uc(r),i=n===i?a:uc(i)),nG(t,r,i)):[]}function ot(t,r){return nq(t,r)}function or(t,r,i){return nH(t,r,aK(i,2))}function oi(t,r){var i=null==t?0:t.length;if(i){var n=nq(t,r);if(n<i&&lR(t[n],r))return n}return -1}function on(t,r){return nq(t,r,!0)}function oa(t,r,i){return nH(t,r,aK(i,2),!0)}function os(t,r){if(null==t?0:t.length){var i=nq(t,r,!0)-1;if(lR(t[i],r))return i}return -1}function oo(t){return t&&t.length?nV(t):[]}function ol(t,r){return t&&t.length?nV(t,aK(r,2)):[]}function ou(t){var r=null==t?0:t.length;return r?nG(t,1,r):[]}function oh(t,r,i){return t&&t.length?nG(t,0,(r=i||n===r?1:uc(r))<0?0:r):[]}function of(t,r,i){var a=null==t?0:t.length;return a?nG(t,(r=a-(r=i||n===r?1:uc(r)))<0?0:r,a):[]}function od(t,r){return t&&t.length?nJ(t,aK(r,3),!1,!0):[]}function oc(t,r){return t&&t.length?nJ(t,aK(r,3)):[]}var op=nP(function(t){return nY(i0(t,1,lU,!0))}),om=nP(function(t){var r=s0(t);return lU(r)&&(r=n),nY(i0(t,1,lU,!0),aK(r,2))}),og=nP(function(t){var r=s0(t);return r="function"==typeof r?r:n,nY(i0(t,1,lU,!0),n,r)});function o_(t){return t&&t.length?nY(t):[]}function ob(t,r){return t&&t.length?nY(t,aK(r,2)):[]}function oy(t,r){return r="function"==typeof r?r:n,t&&t.length?nY(t,n,r):[]}function ov(t){if(!(t&&t.length))return[];var r=0;return t=t4(t,function(t){if(lU(t))return r=tD(t.length,r),!0}),r_(r,function(r){return t7(t,rd(r))})}function ow(t,r){if(!(t&&t.length))return[];var i=ov(t);return null==r?i:t7(i,function(t){return t0(r,n,t)})}var ox=nP(function(t,r){return lU(t)?iV(t,r):[]}),ok=nP(function(t){return n1(t4(t,lU))}),oE=nP(function(t){var r=s0(t);return lU(r)&&(r=n),n1(t4(t,lU),aK(r,2))}),oS=nP(function(t){var r=s0(t);return r="function"==typeof r?r:n,n1(t4(t,lU),n,r)}),o$=nP(ov);function oI(t,r){return n2(t||[],r||[],iO)}function oA(t,r){return n2(t||[],r||[],nL)}var oM=nP(function(t){var r=t.length,i=r>1?t[r-1]:n;return i="function"==typeof i?(t.pop(),i):n,ow(t,i)});function oT(t){var r=r3(t);return r.__chain__=!0,r}function oC(t,r){return r(t),t}function oz(t,r){return r(t)}var oR=aG(function(t){var r=t.length,i=r?t[0]:0,a=this.__wrapped__,s=function(r){return ij(r,t)};return!(r>1)&&!this.__actions__.length&&a instanceof r6&&st(i)?((a=a.slice(i,+i+ +!!r)).__actions__.push({func:oz,args:[s],thisArg:n}),new r8(a,this.__chain__).thru(function(t){return r&&!t.length&&t.push(n),t})):this.thru(s)});function oB(){return oT(this)}function oO(){return new r8(this.value(),this.__chain__)}function oP(){this.__values__===n&&(this.__values__=uf(this.value()));var t=this.__index__>=this.__values__.length,r=t?n:this.__values__[this.__index__++];return{done:t,value:r}}function oD(){return this}function oN(t){for(var r,i=this;i instanceof r4;){var a=sM(i);a.__index__=0,a.__values__=n,r?s.__wrapped__=a:r=a;var s=a;i=i.__wrapped__}return s.__wrapped__=t,r}function oL(){var t=this.__wrapped__;if(t instanceof r6){var r=t;return this.__actions__.length&&(r=new r6(this)),(r=r.reverse()).__actions__.push({func:oz,args:[s9],thisArg:n}),new r8(r,this.__chain__)}return this.thru(s9)}function oU(){return n0(this.__wrapped__,this.__actions__)}var oj=ac(function(t,r,i){tr.call(t,i)?++t[i]:iU(t,i,1)});function oF(t,r,i){var a=lD(t)?t5:iY;return i&&sr(t,r,i)&&(r=n),a(t,aK(r,3))}function oG(t,r){return(lD(t)?t4:iJ)(t,aK(r,3))}var oW=ax(sj),oq=ax(sF);function oH(t,r){return i0(o1(t,r),1)}function oV(t,r){return i0(o1(t,r),O)}function oZ(t,r,i){return i=n===i?1:uc(i),i0(o1(t,r),i)}function oK(t,r){return(lD(t)?t2:iZ)(t,aK(r,3))}function oY(t,r){return(lD(t)?t3:iK)(t,aK(r,3))}var oX=ac(function(t,r,i){tr.call(t,i)?t[i].push(r):iU(t,i,[r])});function oQ(t,r,i,n){t=lL(t)?t:u8(t),i=i&&!n?uc(i):0;var a=t.length;return i<0&&(i=tD(a+i,0)),ui(t)?i<=a&&t.indexOf(r,i)>-1:!!a&&rl(t,r,i)>-1}var oJ=nP(function(t,r,n){var a=-1,s="function"==typeof r,o=lL(t)?i(t.length):[];return iZ(t,function(t){o[++a]=s?t0(r,t,n):na(t,r,n)}),o}),o0=ac(function(t,r,i){iU(t,i,r)});function o1(t,r){return(lD(t)?t7:nw)(t,aK(r,3))}function o2(t,r,i,a){return null==t?[]:(lD(r)||(r=null==r?[]:[r]),lD(i=a?n:i)||(i=null==i?[]:[i]),nI(t,r,i))}var o3=ac(function(t,r,i){t[+!i].push(r)},function(){return[[],[]]});function o5(t,r,i){var n=lD(t)?re:rp,a=arguments.length<3;return n(t,aK(r,4),i,a,iZ)}function o4(t,r,i){var n=lD(t)?rt:rp,a=arguments.length<3;return n(t,aK(r,4),i,a,iK)}function o8(t,r){return(lD(t)?t4:iJ)(t,lg(aK(r,3)))}function o6(t){return(lD(t)?iC:nD)(t)}function o7(t,r,i){return r=(i?sr(t,r,i):n===r)?1:uc(r),(lD(t)?iz:nN)(t,r)}function o9(t){return(lD(t)?iR:nF)(t)}function le(t){if(null==t)return 0;if(lL(t))return ui(t)?rU(t):t.length;var r=a2(t);return r==Q||r==ea?t.size:nb(t).length}function lt(t,r,i){var a=lD(t)?rr:nW;return i&&sr(t,r,i)&&(r=n),a(t,aK(r,3))}var lr=nP(function(t,r){if(null==t)return[];var i=r.length;return i>1&&sr(t,r[0],r[1])?r=[]:i>2&&sr(r[0],r[1],r[2])&&(r=[r[0]]),nI(t,i0(r,1),[])}),li=tx||function(){return tF.Date.now()};function ln(t,r){if("function"!=typeof r)throw new e8(l);return t=uc(t),function(){if(--t<1)return r.apply(this,arguments)}}function la(t,r,i){return r=i?n:r,r=t&&null==r?t.length:r,aP(t,S,n,n,n,n,r)}function ls(t,r){var i;if("function"!=typeof r)throw new e8(l);return t=uc(t),function(){return--t>0&&(i=r.apply(this,arguments)),t<=1&&(r=n),i}}var lo=nP(function(t,r,i){var n=b;if(i.length){var a=rO(i,aZ(lo));n|=k}return aP(t,n,r,i,a)}),ll=nP(function(t,r,i){var n=b|y;if(i.length){var a=rO(i,aZ(ll));n|=k}return aP(r,n,t,i,a)});function lu(t,r,i){r=i?n:r;var a=aP(t,w,n,n,n,n,n,r);return a.placeholder=lu.placeholder,a}function lh(t,r,i){r=i?n:r;var a=aP(t,x,n,n,n,n,n,r);return a.placeholder=lh.placeholder,a}function lf(t,r,i){var a,s,o,u,h,f,d=0,c=!1,p=!1,m=!0;if("function"!=typeof t)throw new e8(l);function g(r){var i=a,o=s;return a=s=n,d=r,u=t.apply(o,i)}function _(t){return d=t,h=sv(v,r),c?g(t):u}function b(t){var i=t-f,n=t-d,a=r-i;return p?tU(a,o-n):a}function y(t){var i=t-f,a=t-d;return n===f||i>=r||i<0||p&&a>=o}function v(){var t=li();if(y(t))return w(t);h=sv(v,b(t))}function w(t){return(h=n,m&&a)?g(t):(a=s=n,u)}function x(){return n===h?u:w(li())}function k(){var t=li(),i=y(t);if(a=arguments,s=this,f=t,i){if(n===h)return _(f);if(p)return n7(h),h=sv(v,r),g(f)}return n===h&&(h=sv(v,r)),u}return r=um(r)||0,lJ(i)&&(c=!!i.leading,o=(p="maxWait"in i)?tD(um(i.maxWait)||0,r):o,m="trailing"in i?!!i.trailing:m),k.cancel=function(){n!==h&&n7(h),d=0,a=f=s=h=n},k.flush=x,k}var ld=nP(function(t,r){return iH(t,1,r)}),lc=nP(function(t,r,i){return iH(t,um(r)||0,i)});function lp(t){return aP(t,I)}function lm(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new e8(l);var i=function(){var n=arguments,a=r?r.apply(this,n):n[0],s=i.cache;if(s.has(a))return s.get(a);var o=t.apply(this,n);return i.cache=s.set(a,o)||s,o};return i.cache=new(lm.Cache||im),i}function lg(t){if("function"!=typeof t)throw new e8(l);return function(){var r=arguments;switch(r.length){case 0:return!t.call(this);case 1:return!t.call(this,r[0]);case 2:return!t.call(this,r[0],r[1]);case 3:return!t.call(this,r[0],r[1],r[2])}return!t.apply(this,r)}}function l_(t){return ls(2,t)}lm.Cache=im;var lb=n8(function(t,r){var i=(r=1==r.length&&lD(r[0])?t7(r[0],rv(aK())):t7(i0(r,1),rv(aK()))).length;return nP(function(n){for(var a=-1,s=tU(n.length,i);++a<s;)n[a]=r[a].call(this,n[a]);return t0(t,this,n)})}),ly=nP(function(t,r){var i=rO(r,aZ(ly));return aP(t,k,n,r,i)}),lv=nP(function(t,r){var i=rO(r,aZ(lv));return aP(t,E,n,r,i)}),lw=aG(function(t,r){return aP(t,$,n,n,n,r)});function lx(t,r){if("function"!=typeof t)throw new e8(l);return nP(t,r=n===r?r:uc(r))}function lk(t,r){if("function"!=typeof t)throw new e8(l);return r=null==r?0:tD(uc(r),0),nP(function(i){var n=i[r],a=n6(i,0,r);return n&&t9(a,n),t0(t,this,a)})}function lE(t,r,i){var n=!0,a=!0;if("function"!=typeof t)throw new e8(l);return lJ(i)&&(n="leading"in i?!!i.leading:n,a="trailing"in i?!!i.trailing:a),lf(t,r,{leading:n,maxWait:r,trailing:a})}function lS(t){return la(t,1)}function l$(t,r){return ly(n5(r),t)}function lI(){if(!arguments.length)return[];var t=arguments[0];return lD(t)?t:[t]}function lA(t){return iG(t,m)}function lM(t,r){return iG(t,m,r="function"==typeof r?r:n)}function lT(t){return iG(t,c|m)}function lC(t,r){return iG(t,c|m,r="function"==typeof r?r:n)}function lz(t,r){return null==r||iq(t,r,uj(r))}function lR(t,r){return t===r||t!=t&&r!=r}var lB=aC(i9),lO=aC(function(t,r){return t>=r}),lP=ns(function(){return arguments}())?ns:function(t){return l0(t)&&tr.call(t,"callee")&&!tm.call(t,"callee")},lD=i.isArray,lN=tZ?rv(tZ):no;function lL(t){return null!=t&&lQ(t.length)&&!lY(t)}function lU(t){return l0(t)&&lL(t)}function lj(t){return!0===t||!1===t||l0(t)&&i7(t)==H}var lF=tM||h3,lG=tK?rv(tK):nl;function lW(t){return l0(t)&&1===t.nodeType&&!l9(t)}function lq(t){if(null==t)return!0;if(lL(t)&&(lD(t)||"string"==typeof t||"function"==typeof t.splice||lF(t)||ua(t)||lP(t)))return!t.length;var r=a2(t);if(r==Q||r==ea)return!t.size;if(sl(t))return!nb(t).length;for(var i in t)if(tr.call(t,i))return!1;return!0}function lH(t,r){return nu(t,r)}function lV(t,r,i){var a=(i="function"==typeof i?i:n)?i(t,r):n;return n===a?nu(t,r,n,i):!!a}function lZ(t){if(!l0(t))return!1;var r=i7(t);return r==K||r==Z||"string"==typeof t.message&&"string"==typeof t.name&&!l9(t)}function lK(t){return"number"==typeof t&&tB(t)}function lY(t){if(!lJ(t))return!1;var r=i7(t);return r==Y||r==X||r==q||r==ei}function lX(t){return"number"==typeof t&&t==uc(t)}function lQ(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=P}function lJ(t){var r=typeof t;return null!=t&&("object"==r||"function"==r)}function l0(t){return null!=t&&"object"==typeof t}var l1=tY?rv(tY):nf;function l2(t,r){return t===r||nd(t,r,aX(r))}function l3(t,r,i){return i="function"==typeof i?i:n,nd(t,r,aX(r),i)}function l5(t){return l7(t)&&t!=+t}function l4(t){if(so(t))throw new eF(o);return nc(t)}function l8(t){return null===t}function l6(t){return null==t}function l7(t){return"number"==typeof t||l0(t)&&i7(t)==J}function l9(t){if(!l0(t)||i7(t)!=et)return!1;var r=tc(t);if(null===r)return!0;var i=tr.call(r,"constructor")&&r.constructor;return"function"==typeof i&&i instanceof i&&tt.call(i)==ts}var ue=tX?rv(tX):np;function ut(t){return lX(t)&&t>=-P&&t<=P}var ur=tQ?rv(tQ):nm;function ui(t){return"string"==typeof t||!lD(t)&&l0(t)&&i7(t)==es}function un(t){return"symbol"==typeof t||l0(t)&&i7(t)==eo}var ua=tJ?rv(tJ):ng;function us(t){return n===t}function uo(t){return l0(t)&&a2(t)==eu}function ul(t){return l0(t)&&i7(t)==eh}var uu=aC(nv),uh=aC(function(t,r){return t<=r});function uf(t){if(!t)return[];if(lL(t))return ui(t)?rj(t):au(t);if(tb&&t[tb])return rz(t[tb]());var r=a2(t);return(r==Q?rR:r==ea?rP:u8)(t)}function ud(t){return t?(t=um(t))===O||t===-O?(t<0?-1:1)*D:t==t?t:0:0===t?t:0}function uc(t){var r=ud(t),i=r%1;return r==r?i?r-i:r:0}function up(t){return t?iF(uc(t),0,L):0}function um(t){if("number"==typeof t)return t;if(un(t))return N;if(lJ(t)){var r="function"==typeof t.valueOf?t.valueOf():t;t=lJ(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=ry(t);var i=eZ.test(t);return i||eY.test(t)?tL(t.slice(2),i?2:8):eV.test(t)?N:+t}function ug(t){return ah(t,uF(t))}function u_(t){return t?iF(uc(t),-P,P):0===t?t:0}function ub(t){return null==t?"":nK(t)}var uy=ap(function(t,r){if(sl(r)||lL(r))return void ah(r,uj(r),t);for(var i in r)tr.call(r,i)&&iO(t,i,r[i])}),uv=ap(function(t,r){ah(r,uF(r),t)}),uw=ap(function(t,r,i,n){ah(r,uF(r),t,n)}),ux=ap(function(t,r,i,n){ah(r,uj(r),t,n)}),uk=aG(ij);function uE(t,r){var i=r5(t);return null==r?i:iN(i,r)}var uS=nP(function(t,r){t=e3(t);var i=-1,a=r.length,s=a>2?r[2]:n;for(s&&sr(r[0],r[1],s)&&(a=1);++i<a;)for(var o=r[i],l=uF(o),u=-1,h=l.length;++u<h;){var f=l[u],d=t[f];(n===d||lR(d,e9[f])&&!tr.call(t,f))&&(t[f]=o[f])}return t}),u$=nP(function(t){return t.push(n,aN),t0(uH,n,t)});function uI(t,r){return rs(t,aK(r,3),i3)}function uA(t,r){return rs(t,aK(r,3),i5)}function uM(t,r){return null==t?t:i1(t,aK(r,3),uF)}function uT(t,r){return null==t?t:i2(t,aK(r,3),uF)}function uC(t,r){return t&&i3(t,aK(r,3))}function uz(t,r){return t&&i5(t,aK(r,3))}function uR(t){return null==t?[]:i4(t,uj(t))}function uB(t){return null==t?[]:i4(t,uF(t))}function uO(t,r,i){var a=null==t?n:i8(t,r);return n===a?i:a}function uP(t,r){return null!=t&&a4(t,r,ne)}function uD(t,r){return null!=t&&a4(t,r,nt)}var uN=aS(function(t,r,i){null!=r&&"function"!=typeof r.toString&&(r=ta.call(r)),t[r]=i},hO(hL)),uL=aS(function(t,r,i){null!=r&&"function"!=typeof r.toString&&(r=ta.call(r)),tr.call(t,r)?t[r].push(i):t[r]=[i]},aK),uU=nP(na);function uj(t){return lL(t)?iT(t):nb(t)}function uF(t){return lL(t)?iT(t,!0):ny(t)}function uG(t,r){var i={};return r=aK(r,3),i3(t,function(t,n,a){iU(i,r(t,n,a),t)}),i}function uW(t,r){var i={};return r=aK(r,3),i3(t,function(t,n,a){iU(i,n,r(t,n,a))}),i}var uq=ap(function(t,r,i){nE(t,r,i)}),uH=ap(function(t,r,i,n){nE(t,r,i,n)}),uV=aG(function(t,r){var i={};if(null==t)return i;var n=!1;r=t7(r,function(r){return r=n4(r,t),n||(n=r.length>1),r}),ah(t,aq(t),i),n&&(i=iG(i,c|p|m,aL));for(var a=r.length;a--;)nX(i,r[a]);return i});function uZ(t,r){return uY(t,lg(aK(r)))}var uK=aG(function(t,r){return null==t?{}:nA(t,r)});function uY(t,r){if(null==t)return{};var i=t7(aq(t),function(t){return[t]});return r=aK(r),nM(t,i,function(t,i){return r(t,i[0])})}function uX(t,r,i){r=n4(r,t);var a=-1,s=r.length;for(s||(s=1,t=n);++a<s;){var o=null==t?n:t[s$(r[a])];n===o&&(a=s,o=i),t=lY(o)?o.call(t):o}return t}function uQ(t,r,i){return null==t?t:nL(t,r,i)}function uJ(t,r,i,a){return a="function"==typeof a?a:n,null==t?t:nL(t,r,i,a)}var u0=aO(uj),u1=aO(uF);function u2(t,r,i){var n=lD(t),a=n||lF(t)||ua(t);if(r=aK(r,4),null==i){var s=t&&t.constructor;i=a?n?new s:[]:lJ(t)&&lY(s)?r5(tc(t)):{}}return(a?t2:i3)(t,function(t,n,a){return r(i,t,n,a)}),i}function u3(t,r){return null==t||nX(t,r)}function u5(t,r,i){return null==t?t:nQ(t,r,n5(i))}function u4(t,r,i,a){return a="function"==typeof a?a:n,null==t?t:nQ(t,r,n5(i),a)}function u8(t){return null==t?[]:rw(t,uj(t))}function u6(t){return null==t?[]:rw(t,uF(t))}function u7(t,r,i){return n===i&&(i=r,r=n),n!==i&&(i=(i=um(i))==i?i:0),n!==r&&(r=(r=um(r))==r?r:0),iF(um(t),r,i)}function u9(t,r,i){return r=ud(r),n===i?(i=r,r=0):i=ud(i),nr(t=um(t),r,i)}function he(t,r,i){if(i&&"boolean"!=typeof i&&sr(t,r,i)&&(r=i=n),n===i&&("boolean"==typeof r?(i=r,r=n):"boolean"==typeof t&&(i=t,t=n)),n===t&&n===r?(t=0,r=1):(t=ud(t),n===r?(r=t,t=0):r=ud(r)),t>r){var a=t;t=r,r=a}if(i||t%1||r%1){var s=tW();return tU(t+s*(r-t+tN("1e-"+((s+"").length-1))),r)}return nR(t,r)}var ht=ay(function(t,r,i){return r=r.toLowerCase(),t+(i?hr(r):r)});function hr(t){return hM(ub(t).toLowerCase())}function hi(t){return(t=ub(t))&&t.replace(eQ,r$).replace(tS,"")}function hn(t,r,i){t=ub(t),r=nK(r);var a=t.length,s=i=n===i?a:iF(uc(i),0,a);return(i-=r.length)>=0&&t.slice(i,s)==r}function ha(t){return(t=ub(t))&&eA.test(t)?t.replace(e$,rI):t}function hs(t){return(t=ub(t))&&eP.test(t)?t.replace(eO,"\\$&"):t}var ho=ay(function(t,r,i){return t+(i?"-":"")+r.toLowerCase()}),hl=ay(function(t,r,i){return t+(i?" ":"")+r.toLowerCase()}),hu=ab("toLowerCase");function hh(t,r,i){t=ub(t);var n=(r=uc(r))?rU(t):0;if(!r||n>=r)return t;var a=(r-n)/2;return aA(tI(a),i)+t+aA(t$(a),i)}function hf(t,r,i){t=ub(t);var n=(r=uc(r))?rU(t):0;return r&&n<r?t+aA(r-n,i):t}function hd(t,r,i){t=ub(t);var n=(r=uc(r))?rU(t):0;return r&&n<r?aA(r-n,i)+t:t}function hc(t,r,i){return i||null==r?r=0:r&&(r*=1),tG(ub(t).replace(eD,""),r||0)}function hp(t,r,i){return r=(i?sr(t,r,i):n===r)?1:uc(r),nO(ub(t),r)}function hm(){var t=arguments,r=ub(t[0]);return t.length<3?r:r.replace(t[1],t[2])}var hg=ay(function(t,r,i){return t+(i?"_":"")+r.toLowerCase()});function h_(t,r,i){return(i&&"number"!=typeof i&&sr(t,r,i)&&(r=i=n),i=n===i?L:i>>>0)?(t=ub(t))&&("string"==typeof r||null!=r&&!ue(r))&&!(r=nK(r))&&rT(t)?n6(rj(t),0,i):t.split(r,i):[]}var hb=ay(function(t,r,i){return t+(i?" ":"")+hM(r)});function hy(t,r,i){return t=ub(t),i=null==i?0:iF(uc(i),0,t.length),r=nK(r),t.slice(i,i+r.length)==r}function hv(t,r,i){var a=r3.templateSettings;i&&sr(t,r,i)&&(r=n),t=ub(t),r=uw({},r,a,aD);var s,o,l=uw({},r.imports,a.imports,aD),h=uj(l),f=rw(l,h),d=0,c=r.interpolate||eJ,p="__p += '",m=e5((r.escape||eJ).source+"|"+c.source+"|"+(c===eC?eq:eJ).source+"|"+(r.evaluate||eJ).source+"|$","g"),g="//# sourceURL="+(tr.call(r,"sourceURL")?(r.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++tC+"]")+"\n";t.replace(m,function(r,i,n,a,l,u){return n||(n=a),p+=t.slice(d,u).replace(e0,rA),i&&(s=!0,p+="' +\n__e("+i+") +\n'"),l&&(o=!0,p+="';\n"+l+";\n__p += '"),n&&(p+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"),d=u+r.length,r}),p+="';\n";var _=tr.call(r,"variable")&&r.variable;if(_){if(eG.test(_))throw new eF(u)}else p="with (obj) {\n"+p+"\n}\n";p=(o?p.replace(ex,""):p).replace(ek,"$1").replace(eE,"$1;"),p="function("+(_||"obj")+") {\n"+(_?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var b=hC(function(){return e1(h,g+"return "+p).apply(n,f)});if(b.source=p,lZ(b))throw b;return b}function hw(t){return ub(t).toLowerCase()}function hx(t){return ub(t).toUpperCase()}function hk(t,r,i){if((t=ub(t))&&(i||n===r))return ry(t);if(!t||!(r=nK(r)))return t;var a=rj(t),s=rj(r),o=rk(a,s),l=rE(a,s)+1;return n6(a,o,l).join("")}function hE(t,r,i){if((t=ub(t))&&(i||n===r))return t.slice(0,rF(t)+1);if(!t||!(r=nK(r)))return t;var a=rj(t),s=rE(a,rj(r))+1;return n6(a,0,s).join("")}function hS(t,r,i){if((t=ub(t))&&(i||n===r))return t.replace(eD,"");if(!t||!(r=nK(r)))return t;var a=rj(t),s=rk(a,rj(r));return n6(a,s).join("")}function h$(t,r){var i=A,a=M;if(lJ(r)){var s="separator"in r?r.separator:s;i="length"in r?uc(r.length):i,a="omission"in r?nK(r.omission):a}var o=(t=ub(t)).length;if(rT(t)){var l=rj(t);o=l.length}if(i>=o)return t;var u=i-rU(a);if(u<1)return a;var h=l?n6(l,0,u).join(""):t.slice(0,u);if(n===s)return h+a;if(l&&(u+=h.length-u),ue(s)){if(t.slice(u).search(s)){var f,d=h;for(s.global||(s=e5(s.source,ub(eH.exec(s))+"g")),s.lastIndex=0;f=s.exec(d);)var c=f.index;h=h.slice(0,n===c?u:c)}}else if(t.indexOf(nK(s),u)!=u){var p=h.lastIndexOf(s);p>-1&&(h=h.slice(0,p))}return h+a}function hI(t){return(t=ub(t))&&eI.test(t)?t.replace(eS,rG):t}var hA=ay(function(t,r,i){return t+(i?" ":"")+r.toUpperCase()}),hM=ab("toUpperCase");function hT(t,r,i){return(t=ub(t),r=i?n:r,n===r)?rC(t)?rH(t):ra(t):t.match(r)||[]}var hC=nP(function(t,r){try{return t0(t,n,r)}catch(t){return lZ(t)?t:new eF(t)}}),hz=aG(function(t,r){return t2(r,function(r){iU(t,r=s$(r),lo(t[r],t))}),t});function hR(t){var r=null==t?0:t.length,i=aK();return t=r?t7(t,function(t){if("function"!=typeof t[1])throw new e8(l);return[i(t[0]),t[1]]}):[],nP(function(i){for(var n=-1;++n<r;){var a=t[n];if(t0(a[0],this,i))return t0(a[1],this,i)}})}function hB(t){return iW(iG(t,c))}function hO(t){return function(){return t}}function hP(t,r){return null==t||t!=t?r:t}var hD=ak(),hN=ak(!0);function hL(t){return t}function hU(t){return n_("function"==typeof t?t:iG(t,c))}function hj(t){return nx(iG(t,c))}function hF(t,r){return nk(t,iG(r,c))}var hG=nP(function(t,r){return function(i){return na(i,t,r)}}),hW=nP(function(t,r){return function(i){return na(t,i,r)}});function hq(t,r,i){var n=uj(r),a=i4(r,n);null!=i||lJ(r)&&(a.length||!n.length)||(i=r,r=t,t=this,a=i4(r,uj(r)));var s=!(lJ(i)&&"chain"in i)||!!i.chain,o=lY(t);return t2(a,function(i){var n=r[i];t[i]=n,o&&(t.prototype[i]=function(){var r=this.__chain__;if(s||r){var i=t(this.__wrapped__);return(i.__actions__=au(this.__actions__)).push({func:n,args:arguments,thisArg:t}),i.__chain__=r,i}return n.apply(t,t9([this.value()],arguments))})}),t}function hH(){return tF._===this&&(tF._=to),this}function hV(){}function hZ(t){return t=uc(t),nP(function(r){return n$(r,t)})}var hK=aI(t7),hY=aI(t5),hX=aI(rr);function hQ(t){return si(t)?rd(s$(t)):nT(t)}function hJ(t){return function(r){return null==t?n:i8(t,r)}}var h0=aT(),h1=aT(!0);function h2(){return[]}function h3(){return!1}function h5(){return{}}function h4(){return""}function h8(){return!0}function h6(t,r){if((t=uc(t))<1||t>P)return[];var i=L,n=tU(t,L);r=aK(r),t-=L;for(var a=r_(n,r);++i<t;)r(i);return a}function h7(t){return lD(t)?t7(t,s$):un(t)?[t]:au(sS(ub(t)))}function h9(t){var r=++ti;return ub(t)+r}var fe=a$(function(t,r){return t+r},0),ft=aR("ceil"),fr=a$(function(t,r){return t/r},1),fi=aR("floor");function fn(t){return t&&t.length?iX(t,hL,i9):n}function fa(t,r){return t&&t.length?iX(t,aK(r,2),i9):n}function fs(t){return rf(t,hL)}function fo(t,r){return rf(t,aK(r,2))}function fl(t){return t&&t.length?iX(t,hL,nv):n}function fu(t,r){return t&&t.length?iX(t,aK(r,2),nv):n}var fh=a$(function(t,r){return t*r},1),ff=aR("round"),fd=a$(function(t,r){return t-r},0);function fc(t){return t&&t.length?rg(t,hL):0}function fp(t,r){return t&&t.length?rg(t,aK(r,2)):0}return r3.after=ln,r3.ary=la,r3.assign=uy,r3.assignIn=uv,r3.assignInWith=uw,r3.assignWith=ux,r3.at=uk,r3.before=ls,r3.bind=lo,r3.bindAll=hz,r3.bindKey=ll,r3.castArray=lI,r3.chain=oT,r3.chunk=sT,r3.compact=sC,r3.concat=sz,r3.cond=hR,r3.conforms=hB,r3.constant=hO,r3.countBy=oj,r3.create=uE,r3.curry=lu,r3.curryRight=lh,r3.debounce=lf,r3.defaults=uS,r3.defaultsDeep=u$,r3.defer=ld,r3.delay=lc,r3.difference=sR,r3.differenceBy=sB,r3.differenceWith=sO,r3.drop=sP,r3.dropRight=sD,r3.dropRightWhile=sN,r3.dropWhile=sL,r3.fill=sU,r3.filter=oG,r3.flatMap=oH,r3.flatMapDeep=oV,r3.flatMapDepth=oZ,r3.flatten=sG,r3.flattenDeep=sW,r3.flattenDepth=sq,r3.flip=lp,r3.flow=hD,r3.flowRight=hN,r3.fromPairs=sH,r3.functions=uR,r3.functionsIn=uB,r3.groupBy=oX,r3.initial=sK,r3.intersection=sY,r3.intersectionBy=sX,r3.intersectionWith=sQ,r3.invert=uN,r3.invertBy=uL,r3.invokeMap=oJ,r3.iteratee=hU,r3.keyBy=o0,r3.keys=uj,r3.keysIn=uF,r3.map=o1,r3.mapKeys=uG,r3.mapValues=uW,r3.matches=hj,r3.matchesProperty=hF,r3.memoize=lm,r3.merge=uq,r3.mergeWith=uH,r3.method=hG,r3.methodOf=hW,r3.mixin=hq,r3.negate=lg,r3.nthArg=hZ,r3.omit=uV,r3.omitBy=uZ,r3.once=l_,r3.orderBy=o2,r3.over=hK,r3.overArgs=lb,r3.overEvery=hY,r3.overSome=hX,r3.partial=ly,r3.partialRight=lv,r3.partition=o3,r3.pick=uK,r3.pickBy=uY,r3.property=hQ,r3.propertyOf=hJ,r3.pull=s3,r3.pullAll=s5,r3.pullAllBy=s4,r3.pullAllWith=s8,r3.pullAt=s6,r3.range=h0,r3.rangeRight=h1,r3.rearg=lw,r3.reject=o8,r3.remove=s7,r3.rest=lx,r3.reverse=s9,r3.sampleSize=o7,r3.set=uQ,r3.setWith=uJ,r3.shuffle=o9,r3.slice=oe,r3.sortBy=lr,r3.sortedUniq=oo,r3.sortedUniqBy=ol,r3.split=h_,r3.spread=lk,r3.tail=ou,r3.take=oh,r3.takeRight=of,r3.takeRightWhile=od,r3.takeWhile=oc,r3.tap=oC,r3.throttle=lE,r3.thru=oz,r3.toArray=uf,r3.toPairs=u0,r3.toPairsIn=u1,r3.toPath=h7,r3.toPlainObject=ug,r3.transform=u2,r3.unary=lS,r3.union=op,r3.unionBy=om,r3.unionWith=og,r3.uniq=o_,r3.uniqBy=ob,r3.uniqWith=oy,r3.unset=u3,r3.unzip=ov,r3.unzipWith=ow,r3.update=u5,r3.updateWith=u4,r3.values=u8,r3.valuesIn=u6,r3.without=ox,r3.words=hT,r3.wrap=l$,r3.xor=ok,r3.xorBy=oE,r3.xorWith=oS,r3.zip=o$,r3.zipObject=oI,r3.zipObjectDeep=oA,r3.zipWith=oM,r3.entries=u0,r3.entriesIn=u1,r3.extend=uv,r3.extendWith=uw,hq(r3,r3),r3.add=fe,r3.attempt=hC,r3.camelCase=ht,r3.capitalize=hr,r3.ceil=ft,r3.clamp=u7,r3.clone=lA,r3.cloneDeep=lT,r3.cloneDeepWith=lC,r3.cloneWith=lM,r3.conformsTo=lz,r3.deburr=hi,r3.defaultTo=hP,r3.divide=fr,r3.endsWith=hn,r3.eq=lR,r3.escape=ha,r3.escapeRegExp=hs,r3.every=oF,r3.find=oW,r3.findIndex=sj,r3.findKey=uI,r3.findLast=oq,r3.findLastIndex=sF,r3.findLastKey=uA,r3.floor=fi,r3.forEach=oK,r3.forEachRight=oY,r3.forIn=uM,r3.forInRight=uT,r3.forOwn=uC,r3.forOwnRight=uz,r3.get=uO,r3.gt=lB,r3.gte=lO,r3.has=uP,r3.hasIn=uD,r3.head=sV,r3.identity=hL,r3.includes=oQ,r3.indexOf=sZ,r3.inRange=u9,r3.invoke=uU,r3.isArguments=lP,r3.isArray=lD,r3.isArrayBuffer=lN,r3.isArrayLike=lL,r3.isArrayLikeObject=lU,r3.isBoolean=lj,r3.isBuffer=lF,r3.isDate=lG,r3.isElement=lW,r3.isEmpty=lq,r3.isEqual=lH,r3.isEqualWith=lV,r3.isError=lZ,r3.isFinite=lK,r3.isFunction=lY,r3.isInteger=lX,r3.isLength=lQ,r3.isMap=l1,r3.isMatch=l2,r3.isMatchWith=l3,r3.isNaN=l5,r3.isNative=l4,r3.isNil=l6,r3.isNull=l8,r3.isNumber=l7,r3.isObject=lJ,r3.isObjectLike=l0,r3.isPlainObject=l9,r3.isRegExp=ue,r3.isSafeInteger=ut,r3.isSet=ur,r3.isString=ui,r3.isSymbol=un,r3.isTypedArray=ua,r3.isUndefined=us,r3.isWeakMap=uo,r3.isWeakSet=ul,r3.join=sJ,r3.kebabCase=ho,r3.last=s0,r3.lastIndexOf=s1,r3.lowerCase=hl,r3.lowerFirst=hu,r3.lt=uu,r3.lte=uh,r3.max=fn,r3.maxBy=fa,r3.mean=fs,r3.meanBy=fo,r3.min=fl,r3.minBy=fu,r3.stubArray=h2,r3.stubFalse=h3,r3.stubObject=h5,r3.stubString=h4,r3.stubTrue=h8,r3.multiply=fh,r3.nth=s2,r3.noConflict=hH,r3.noop=hV,r3.now=li,r3.pad=hh,r3.padEnd=hf,r3.padStart=hd,r3.parseInt=hc,r3.random=he,r3.reduce=o5,r3.reduceRight=o4,r3.repeat=hp,r3.replace=hm,r3.result=uX,r3.round=ff,r3.runInContext=t,r3.sample=o6,r3.size=le,r3.snakeCase=hg,r3.some=lt,r3.sortedIndex=ot,r3.sortedIndexBy=or,r3.sortedIndexOf=oi,r3.sortedLastIndex=on,r3.sortedLastIndexBy=oa,r3.sortedLastIndexOf=os,r3.startCase=hb,r3.startsWith=hy,r3.subtract=fd,r3.sum=fc,r3.sumBy=fp,r3.template=hv,r3.times=h6,r3.toFinite=ud,r3.toInteger=uc,r3.toLength=up,r3.toLower=hw,r3.toNumber=um,r3.toSafeInteger=u_,r3.toString=ub,r3.toUpper=hx,r3.trim=hk,r3.trimEnd=hE,r3.trimStart=hS,r3.truncate=h$,r3.unescape=hI,r3.uniqueId=h9,r3.upperCase=hA,r3.upperFirst=hM,r3.each=oK,r3.eachRight=oY,r3.first=sV,hq(r3,function(){var t={};return i3(r3,function(r,i){tr.call(r3.prototype,i)||(t[i]=r)}),t}(),{chain:!1}),r3.VERSION=a,t2(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){r3[t].placeholder=r3}),t2(["drop","take"],function(t,r){r6.prototype[t]=function(i){i=n===i?1:tD(uc(i),0);var a=this.__filtered__&&!r?new r6(this):this.clone();return a.__filtered__?a.__takeCount__=tU(i,a.__takeCount__):a.__views__.push({size:tU(i,L),type:t+(a.__dir__<0?"Right":"")}),a},r6.prototype[t+"Right"]=function(r){return this.reverse()[t](r).reverse()}}),t2(["filter","map","takeWhile"],function(t,r){var i=r+1,n=i==z||i==B;r6.prototype[t]=function(t){var r=this.clone();return r.__iteratees__.push({iteratee:aK(t,3),type:i}),r.__filtered__=r.__filtered__||n,r}}),t2(["head","last"],function(t,r){var i="take"+(r?"Right":"");r6.prototype[t]=function(){return this[i](1).value()[0]}}),t2(["initial","tail"],function(t,r){var i="drop"+(r?"":"Right");r6.prototype[t]=function(){return this.__filtered__?new r6(this):this[i](1)}}),r6.prototype.compact=function(){return this.filter(hL)},r6.prototype.find=function(t){return this.filter(t).head()},r6.prototype.findLast=function(t){return this.reverse().find(t)},r6.prototype.invokeMap=nP(function(t,r){return"function"==typeof t?new r6(this):this.map(function(i){return na(i,t,r)})}),r6.prototype.reject=function(t){return this.filter(lg(aK(t)))},r6.prototype.slice=function(t,r){t=uc(t);var i=this;return i.__filtered__&&(t>0||r<0)?new r6(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),n!==r&&(i=(r=uc(r))<0?i.dropRight(-r):i.take(r-t)),i)},r6.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},r6.prototype.toArray=function(){return this.take(L)},i3(r6.prototype,function(t,r){var i=/^(?:filter|find|map|reject)|While$/.test(r),a=/^(?:head|last)$/.test(r),s=r3[a?"take"+("last"==r?"Right":""):r],o=a||/^find/.test(r);s&&(r3.prototype[r]=function(){var r=this.__wrapped__,l=a?[1]:arguments,u=r instanceof r6,h=l[0],f=u||lD(r),d=function(t){var r=s.apply(r3,t9([t],l));return a&&c?r[0]:r};f&&i&&"function"==typeof h&&1!=h.length&&(u=f=!1);var c=this.__chain__,p=!!this.__actions__.length,m=o&&!c,g=u&&!p;if(!o&&f){r=g?r:new r6(this);var _=t.apply(r,l);return _.__actions__.push({func:oz,args:[d],thisArg:n}),new r8(_,c)}return m&&g?t.apply(this,l):(_=this.thru(d),m?a?_.value()[0]:_.value():_)})}),t2(["pop","push","shift","sort","splice","unshift"],function(t){var r=e6[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",n=/^(?:pop|shift)$/.test(t);r3.prototype[t]=function(){var t=arguments;if(n&&!this.__chain__){var a=this.value();return r.apply(lD(a)?a:[],t)}return this[i](function(i){return r.apply(lD(i)?i:[],t)})}}),i3(r6.prototype,function(t,r){var i=r3[r];if(i){var n=i.name+"";tr.call(rZ,n)||(rZ[n]=[]),rZ[n].push({name:r,func:i})}}),rZ[aE(n,y).name]=[{name:"wrapper",func:n}],r6.prototype.clone=r7,r6.prototype.reverse=r9,r6.prototype.value=ie,r3.prototype.at=oR,r3.prototype.chain=oB,r3.prototype.commit=oO,r3.prototype.next=oP,r3.prototype.plant=oN,r3.prototype.reverse=oL,r3.prototype.toJSON=r3.prototype.valueOf=r3.prototype.value=oU,r3.prototype.first=r3.prototype.head,tb&&(r3.prototype[tb]=oD),r3}();if("function"==typeof define&&"object"==typeof define.amd&&define.amd){let r;tF._=rV,t.r,n!==(r=rV)&&t.v(r)}else tW?((tW.exports=rV)._=rV,tG._=rV):tF._=rV}).call(t.e)},45418,t=>{t.v({card:"Home-module__g21JLG__card",code:"Home-module__g21JLG__code",container:"Home-module__g21JLG__container",description:"Home-module__g21JLG__description",footer:"Home-module__g21JLG__footer",grid:"Home-module__g21JLG__grid",logo:"Home-module__g21JLG__logo",main:"Home-module__g21JLG__main",title:"Home-module__g21JLG__title"})},44486,__turbopack_context__=>{"use strict";let emojiRegex,e1;var __TURBOPACK__imported__module__43476__=__turbopack_context__.i(43476),__TURBOPACK__imported__module__71645__=__turbopack_context__.i(71645);let IMAGE_URLS=[{text:"cat",value:"https://i.imgur.com/CzXTtJV.jpg"},{text:"dog",value:"https://i.imgur.com/OB0y6MR.jpg"},{text:"cheetah",value:"https://farm2.staticflickr.com/1533/26541536141_41abe98db3_z_d.jpg"},{text:"bird",value:"https://farm4.staticflickr.com/3075/3168662394_7d7103de7d_z_d.jpg"},{text:"lighthouse",value:"https://farm3.staticflickr.com/2220/1572613671_7311098b76_z_d.jpg"},{text:"sailboat",value:"https://farm7.staticflickr.com/6089/6115759179_86316c08ff_z_d.jpg"},{text:"cello",value:"https://farm2.staticflickr.com/1090/4595137268_0e3f2b9aa7_z_d.jpg"},{text:"piano",value:"https://farm4.staticflickr.com/3224/3081748027_0ee3d59fea_z_d.jpg"},{text:"apple",value:"https://farm8.staticflickr.com/7377/9359257263_81b080a039_z_d.jpg"},{text:"flower",value:"https://farm9.staticflickr.com/8295/8007075227_dc958c1fe6_z_d.jpg"}];var __TURBOPACK__imported__module__47167__=__turbopack_context__.i(47167),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:__turbopack_context__.g;function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function getAugmentedNamespace(t){if(t.__esModule)return t;var r=t.default;if("function"==typeof r){var i=function t(){return this instanceof t?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};i.prototype=r.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(i,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}),i}"undefined"==typeof self&&"object"==typeof commonjsGlobal&&(commonjsGlobal.self=commonjsGlobal);var global$1=__turbopack_context__.g,lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0;r<64;++r)lookup[r]=t[r],revLookup[t.charCodeAt(r)]=r;revLookup[45]=62,revLookup[95]=63}function toByteArray(t){inited||init();var r,i,n,a,s,o,l=t.length;if(l%4>0)throw Error("Invalid string. Length must be a multiple of 4");s="="===t[l-2]?2:+("="===t[l-1]),o=new Arr(3*l/4-s),n=s>0?l-4:l;var u=0;for(r=0,i=0;r<n;r+=4,i+=3)a=revLookup[t.charCodeAt(r)]<<18|revLookup[t.charCodeAt(r+1)]<<12|revLookup[t.charCodeAt(r+2)]<<6|revLookup[t.charCodeAt(r+3)],o[u++]=a>>16&255,o[u++]=a>>8&255,o[u++]=255&a;return 2===s?(a=revLookup[t.charCodeAt(r)]<<2|revLookup[t.charCodeAt(r+1)]>>4,o[u++]=255&a):1===s&&(a=revLookup[t.charCodeAt(r)]<<10|revLookup[t.charCodeAt(r+1)]<<4|revLookup[t.charCodeAt(r+2)]>>2,o[u++]=a>>8&255,o[u++]=255&a),o}function tripletToBase64(t){return lookup[t>>18&63]+lookup[t>>12&63]+lookup[t>>6&63]+lookup[63&t]}function encodeChunk(t,r,i){for(var n=[],a=r;a<i;a+=3)n.push(tripletToBase64((t[a]<<16)+(t[a+1]<<8)+t[a+2]));return n.join("")}function fromByteArray(t){var r;inited||init();for(var i=t.length,n=i%3,a="",s=[],o=16383,l=0,u=i-n;l<u;l+=o)s.push(encodeChunk(t,l,l+o>u?u:l+o));return 1===n?(a+=lookup[(r=t[i-1])>>2],a+=lookup[r<<4&63],a+="=="):2===n&&(a+=lookup[(r=(t[i-2]<<8)+t[i-1])>>10],a+=lookup[r>>4&63],a+=lookup[r<<2&63],a+="="),s.push(a),s.join("")}function read(t,r,i,n,a){var s,o,l=8*a-n-1,u=(1<<l)-1,h=u>>1,f=-7,d=i?a-1:0,c=i?-1:1,p=t[r+d];for(d+=c,s=p&(1<<-f)-1,p>>=-f,f+=l;f>0;s=256*s+t[r+d],d+=c,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=n;f>0;o=256*o+t[r+d],d+=c,f-=8);if(0===s)s=1-h;else{if(s===u)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=h}return(p?-1:1)*o*Math.pow(2,s-n)}function write(t,r,i,n,a,s){var o,l,u,h=8*s-a-1,f=(1<<h)-1,d=f>>1,c=5960464477539062e-23*(23===a),p=n?0:s-1,m=n?1:-1,g=+(r<0||0===r&&1/r<0);for(isNaN(r=Math.abs(r))||r===1/0?(l=+!!isNaN(r),o=f):(o=Math.floor(Math.log(r)/Math.LN2),r*(u=Math.pow(2,-o))<1&&(o--,u*=2),(r+=o+d>=1?c/u:c*Math.pow(2,1-d))*u>=2&&(o++,u/=2),o+d>=f?(l=0,o=f):o+d>=1?(l=(r*u-1)*Math.pow(2,a),o+=d):(l=r*Math.pow(2,d-1)*Math.pow(2,a),o=0));a>=8;t[i+p]=255&l,p+=m,l/=256,a-=8);for(o=o<<a|l,h+=a;h>0;t[i+p]=255&o,p+=m,o/=256,h-=8);t[i+p-m]|=128*g}var toString={}.toString,isArray=Array.isArray||function(t){return"[object Array]"==toString.call(t)},INSPECT_MAX_BYTES=50;function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?0x7fffffff:0x3fffffff}function createBuffer(t,r){if(kMaxLength()<r)throw RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(r)).__proto__=Buffer.prototype:(null===t&&(t=new Buffer(r)),t.length=r),t}function Buffer(t,r,i){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,r,i);if("number"==typeof t){if("string"==typeof r)throw Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,r,i)}function from(t,r,i,n){if("number"==typeof r)throw TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer?fromArrayBuffer(t,r,i,n):"string"==typeof r?fromString(t,r,i):fromObject(t,r)}function assertSize(t){if("number"!=typeof t)throw TypeError('"size" argument must be a number');if(t<0)throw RangeError('"size" argument must not be negative')}function alloc(t,r,i,n){return assertSize(r),r<=0?createBuffer(t,r):void 0!==i?"string"==typeof n?createBuffer(t,r).fill(i,n):createBuffer(t,r).fill(i):createBuffer(t,r)}function allocUnsafe(t,r){if(assertSize(r),t=createBuffer(t,r<0?0:0|checked(r)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<r;++i)t[i]=0;return t}function fromString(t,r,i){if("string"==typeof i&&""!==i||(i="utf8"),!Buffer.isEncoding(i))throw TypeError('"encoding" must be a valid string encoding');var n=0|byteLength(r,i),a=(t=createBuffer(t,n)).write(r,i);return a!==n&&(t=t.slice(0,a)),t}function fromArrayLike(t,r){var i=r.length<0?0:0|checked(r.length);t=createBuffer(t,i);for(var n=0;n<i;n+=1)t[n]=255&r[n];return t}function fromArrayBuffer(t,r,i,n){if(r.byteLength,i<0||r.byteLength<i)throw RangeError("'offset' is out of bounds");if(r.byteLength<i+(n||0))throw RangeError("'length' is out of bounds");return r=void 0===i&&void 0===n?new Uint8Array(r):void 0===n?new Uint8Array(r,i):new Uint8Array(r,i,n),Buffer.TYPED_ARRAY_SUPPORT?(t=r).__proto__=Buffer.prototype:t=fromArrayLike(t,r),t}function fromObject(t,r){if(internalIsBuffer(r)){var i=0|checked(r.length);return 0===(t=createBuffer(t,i)).length||r.copy(t,0,0,i),t}if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||isnan(r.length)?createBuffer(t,0):fromArrayLike(t,r);if("Buffer"===r.type&&isArray(r.data))return fromArrayLike(t,r.data)}throw TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(t){if(t>=kMaxLength())throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function internalIsBuffer(t){return!(null==t||!t._isBuffer)}function byteLength(t,r){if(internalIsBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(r){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return base64ToBytes(t).length;default:if(n)return utf8ToBytes(t).length;r=(""+r).toLowerCase(),n=!0}}function slowToString(t,r,i){var n=!1;if((void 0===r||r<0)&&(r=0),r>this.length||((void 0===i||i>this.length)&&(i=this.length),i<=0)||(i>>>=0)<=(r>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,r,i);case"utf8":case"utf-8":return utf8Slice(this,r,i);case"ascii":return asciiSlice(this,r,i);case"latin1":case"binary":return latin1Slice(this,r,i);case"base64":return base64Slice(this,r,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,r,i);default:if(n)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function swap(t,r,i){var n=t[r];t[r]=t[i],t[i]=n}function bidirectionalIndexOf(t,r,i,n,a){if(0===t.length)return -1;if("string"==typeof i?(n=i,i=0):i>0x7fffffff?i=0x7fffffff:i<-0x80000000&&(i=-0x80000000),isNaN(i*=1)&&(i=a?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(a)return -1;i=t.length-1}else if(i<0){if(!a)return -1;i=0}if("string"==typeof r&&(r=Buffer.from(r,n)),internalIsBuffer(r))return 0===r.length?-1:arrayIndexOf(t,r,i,n,a);if("number"==typeof r)return r&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(t,r,i):Uint8Array.prototype.lastIndexOf.call(t,r,i):arrayIndexOf(t,[r],i,n,a);throw TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,r,i,n,a){var s,o=1,l=t.length,u=r.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||r.length<2)return -1;o=2,l/=2,u/=2,i/=2}function h(t,r){return 1===o?t[r]:t.readUInt16BE(r*o)}if(a){var f=-1;for(s=i;s<l;s++)if(h(t,s)===h(r,-1===f?0:s-f)){if(-1===f&&(f=s),s-f+1===u)return f*o}else -1!==f&&(s-=s-f),f=-1}else for(i+u>l&&(i=l-u),s=i;s>=0;s--){for(var d=!0,c=0;c<u;c++)if(h(t,s+c)!==h(r,c)){d=!1;break}if(d)return s}return -1}function hexWrite(t,r,i,n){i=Number(i)||0;var a=t.length-i;n?(n=Number(n))>a&&(n=a):n=a;var s=r.length;if(s%2!=0)throw TypeError("Invalid hex string");n>s/2&&(n=s/2);for(var o=0;o<n;++o){var l=parseInt(r.substr(2*o,2),16);if(isNaN(l))break;t[i+o]=l}return o}function utf8Write(t,r,i,n){return blitBuffer(utf8ToBytes(r,t.length-i),t,i,n)}function asciiWrite(t,r,i,n){return blitBuffer(asciiToBytes(r),t,i,n)}function latin1Write(t,r,i,n){return asciiWrite(t,r,i,n)}function base64Write(t,r,i,n){return blitBuffer(base64ToBytes(r),t,i,n)}function ucs2Write(t,r,i,n){return blitBuffer(utf16leToBytes(r,t.length-i),t,i,n)}function base64Slice(t,r,i){return 0===r&&i===t.length?fromByteArray(t):fromByteArray(t.slice(r,i))}function utf8Slice(t,r,i){i=Math.min(t.length,i);for(var n=[],a=r;a<i;){var s,o,l,u,h=t[a],f=null,d=h>239?4:h>223?3:h>191?2:1;if(a+d<=i)switch(d){case 1:h<128&&(f=h);break;case 2:128==(192&(s=t[a+1]))&&(u=(31&h)<<6|63&s)>127&&(f=u);break;case 3:s=t[a+1],o=t[a+2],128==(192&s)&&128==(192&o)&&(u=(15&h)<<12|(63&s)<<6|63&o)>2047&&(u<55296||u>57343)&&(f=u);break;case 4:s=t[a+1],o=t[a+2],l=t[a+3],128==(192&s)&&128==(192&o)&&128==(192&l)&&(u=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&l)>65535&&u<1114112&&(f=u)}null===f?(f=65533,d=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),a+=d}return decodeCodePointsArray(n)}Buffer.TYPED_ARRAY_SUPPORT=void 0===global$1.TYPED_ARRAY_SUPPORT||global$1.TYPED_ARRAY_SUPPORT,kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,r,i){return from(null,t,r,i)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]),Buffer.alloc=function(t,r,i){return alloc(null,t,r,i)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=isBuffer,Buffer.compare=function(t,r){if(!internalIsBuffer(t)||!internalIsBuffer(r))throw TypeError("Arguments must be Buffers");if(t===r)return 0;for(var i=t.length,n=r.length,a=0,s=Math.min(i,n);a<s;++a)if(t[a]!==r[a]){i=t[a],n=r[a];break}return i<n?-1:+(n<i)},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(t,r){if(!isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);if(void 0===r)for(r=0,i=0;i<t.length;++i)r+=t[i].length;var i,n=Buffer.allocUnsafe(r),a=0;for(i=0;i<t.length;++i){var s=t[i];if(!internalIsBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,a),a+=s.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2)swap(this,r,r+1);return this},Buffer.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4)swap(this,r,r+3),swap(this,r+1,r+2);return this},Buffer.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8)swap(this,r,r+7),swap(this,r+1,r+6),swap(this,r+2,r+5),swap(this,r+3,r+4);return this},Buffer.prototype.toString=function(){var t=0|this.length;return 0===t?"":0==arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(t){if(!internalIsBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function(){var t="",r=INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function(t,r,i,n,a){if(!internalIsBuffer(t))throw TypeError("Argument must be a Buffer");if(void 0===r&&(r=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===a&&(a=this.length),r<0||i>t.length||n<0||a>this.length)throw RangeError("out of range index");if(n>=a&&r>=i)return 0;if(n>=a)return -1;if(r>=i)return 1;if(this===t)return 0;for(var s=(a>>>=0)-(n>>>=0),o=(i>>>=0)-(r>>>=0),l=Math.min(s,o),u=this.slice(n,a),h=t.slice(r,i),f=0;f<l;++f)if(u[f]!==h[f]){s=u[f],o=h[f];break}return s<o?-1:+(o<s)},Buffer.prototype.includes=function(t,r,i){return -1!==this.indexOf(t,r,i)},Buffer.prototype.indexOf=function(t,r,i){return bidirectionalIndexOf(this,t,r,i,!0)},Buffer.prototype.lastIndexOf=function(t,r,i){return bidirectionalIndexOf(this,t,r,i,!1)},Buffer.prototype.write=function(t,r,i,n){if(void 0===r)n="utf8",i=this.length,r=0;else if(void 0===i&&"string"==typeof r)n=r,i=this.length,r=0;else{if(!isFinite(r))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var a=this.length-r;if((void 0===i||i>a)&&(i=a),t.length>0&&(i<0||r<0)||r>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return hexWrite(this,t,r,i);case"utf8":case"utf-8":return utf8Write(this,t,r,i);case"ascii":return asciiWrite(this,t,r,i);case"latin1":case"binary":return latin1Write(this,t,r,i);case"base64":return base64Write(this,t,r,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,r,i);default:if(s)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(t){var r=t.length;if(r<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,t);for(var i="",n=0;n<r;)i+=String.fromCharCode.apply(String,t.slice(n,n+=MAX_ARGUMENTS_LENGTH));return i}function asciiSlice(t,r,i){var n="";i=Math.min(t.length,i);for(var a=r;a<i;++a)n+=String.fromCharCode(127&t[a]);return n}function latin1Slice(t,r,i){var n="";i=Math.min(t.length,i);for(var a=r;a<i;++a)n+=String.fromCharCode(t[a]);return n}function hexSlice(t,r,i){var n=t.length;(!r||r<0)&&(r=0),(!i||i<0||i>n)&&(i=n);for(var a="",s=r;s<i;++s)a+=toHex(t[s]);return a}function utf16leSlice(t,r,i){for(var n=t.slice(r,i),a="",s=0;s<n.length;s+=2)a+=String.fromCharCode(n[s]+256*n[s+1]);return a}function checkOffset(t,r,i){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+r>i)throw RangeError("Trying to access beyond buffer length")}function checkInt(t,r,i,n,a,s){if(!internalIsBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(r>a||r<s)throw RangeError('"value" argument is out of bounds');if(i+n>t.length)throw RangeError("Index out of range")}function objectWriteUInt16(t,r,i,n){r<0&&(r=65535+r+1);for(var a=0,s=Math.min(t.length-i,2);a<s;++a)t[i+a]=(r&255<<8*(n?a:1-a))>>>8*(n?a:1-a)}function objectWriteUInt32(t,r,i,n){r<0&&(r=0xffffffff+r+1);for(var a=0,s=Math.min(t.length-i,4);a<s;++a)t[i+a]=r>>>8*(n?a:3-a)&255}function checkIEEE754(t,r,i,n,a,s){if(i+n>t.length||i<0)throw RangeError("Index out of range")}function writeFloat(t,r,i,n,a){return a||checkIEEE754(t,r,i,4),write(t,r,i,n,23,4),i+4}function writeDouble(t,r,i,n,a){return a||checkIEEE754(t,r,i,8),write(t,r,i,n,52,8),i+8}Buffer.prototype.slice=function(t,r){var i,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t),Buffer.TYPED_ARRAY_SUPPORT)(i=this.subarray(t,r)).__proto__=Buffer.prototype;else{var a=r-t;i=new Buffer(a,void 0);for(var s=0;s<a;++s)i[s]=this[s+t]}return i},Buffer.prototype.readUIntLE=function(t,r,i){t|=0,r|=0,i||checkOffset(t,r,this.length);for(var n=this[t],a=1,s=0;++s<r&&(a*=256);)n+=this[t+s]*a;return n},Buffer.prototype.readUIntBE=function(t,r,i){t|=0,r|=0,i||checkOffset(t,r,this.length);for(var n=this[t+--r],a=1;r>0&&(a*=256);)n+=this[t+--r]*a;return n},Buffer.prototype.readUInt8=function(t,r){return r||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function(t,r){return r||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function(t,r){return r||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function(t,r){return r||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+0x1000000*this[t+3]},Buffer.prototype.readUInt32BE=function(t,r){return r||checkOffset(t,4,this.length),0x1000000*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function(t,r,i){t|=0,r|=0,i||checkOffset(t,r,this.length);for(var n=this[t],a=1,s=0;++s<r&&(a*=256);)n+=this[t+s]*a;return n>=(a*=128)&&(n-=Math.pow(2,8*r)),n},Buffer.prototype.readIntBE=function(t,r,i){t|=0,r|=0,i||checkOffset(t,r,this.length);for(var n=r,a=1,s=this[t+--n];n>0&&(a*=256);)s+=this[t+--n]*a;return s>=(a*=128)&&(s-=Math.pow(2,8*r)),s},Buffer.prototype.readInt8=function(t,r){return r||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function(t,r){r||checkOffset(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?0xffff0000|i:i},Buffer.prototype.readInt16BE=function(t,r){r||checkOffset(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?0xffff0000|i:i},Buffer.prototype.readInt32LE=function(t,r){return r||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function(t,r){return r||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function(t,r){return r||checkOffset(t,4,this.length),read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function(t,r){return r||checkOffset(t,4,this.length),read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function(t,r){return r||checkOffset(t,8,this.length),read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function(t,r){return r||checkOffset(t,8,this.length),read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function(t,r,i,n){t*=1,r|=0,i|=0,n||checkInt(this,t,r,i,Math.pow(2,8*i)-1,0);var a=1,s=0;for(this[r]=255&t;++s<i&&(a*=256);)this[r+s]=t/a&255;return r+i},Buffer.prototype.writeUIntBE=function(t,r,i,n){t*=1,r|=0,i|=0,n||checkInt(this,t,r,i,Math.pow(2,8*i)-1,0);var a=i-1,s=1;for(this[r+a]=255&t;--a>=0&&(s*=256);)this[r+a]=t/s&255;return r+i},Buffer.prototype.writeUInt8=function(t,r,i){return t*=1,r|=0,i||checkInt(this,t,r,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[r]=255&t,r+1},Buffer.prototype.writeUInt16LE=function(t,r,i){return t*=1,r|=0,i||checkInt(this,t,r,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):objectWriteUInt16(this,t,r,!0),r+2},Buffer.prototype.writeUInt16BE=function(t,r,i){return t*=1,r|=0,i||checkInt(this,t,r,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):objectWriteUInt16(this,t,r,!1),r+2},Buffer.prototype.writeUInt32LE=function(t,r,i){return t*=1,r|=0,i||checkInt(this,t,r,4,0xffffffff,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=255&t):objectWriteUInt32(this,t,r,!0),r+4},Buffer.prototype.writeUInt32BE=function(t,r,i){return t*=1,r|=0,i||checkInt(this,t,r,4,0xffffffff,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):objectWriteUInt32(this,t,r,!1),r+4},Buffer.prototype.writeIntLE=function(t,r,i,n){if(t*=1,r|=0,!n){var a=Math.pow(2,8*i-1);checkInt(this,t,r,i,a-1,-a)}var s=0,o=1,l=0;for(this[r]=255&t;++s<i&&(o*=256);)t<0&&0===l&&0!==this[r+s-1]&&(l=1),this[r+s]=(t/o|0)-l&255;return r+i},Buffer.prototype.writeIntBE=function(t,r,i,n){if(t*=1,r|=0,!n){var a=Math.pow(2,8*i-1);checkInt(this,t,r,i,a-1,-a)}var s=i-1,o=1,l=0;for(this[r+s]=255&t;--s>=0&&(o*=256);)t<0&&0===l&&0!==this[r+s+1]&&(l=1),this[r+s]=(t/o|0)-l&255;return r+i},Buffer.prototype.writeInt8=function(t,r,i){return t*=1,r|=0,i||checkInt(this,t,r,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[r]=255&t,r+1},Buffer.prototype.writeInt16LE=function(t,r,i){return t*=1,r|=0,i||checkInt(this,t,r,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):objectWriteUInt16(this,t,r,!0),r+2},Buffer.prototype.writeInt16BE=function(t,r,i){return t*=1,r|=0,i||checkInt(this,t,r,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):objectWriteUInt16(this,t,r,!1),r+2},Buffer.prototype.writeInt32LE=function(t,r,i){return t*=1,r|=0,i||checkInt(this,t,r,4,0x7fffffff,-0x80000000),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24):objectWriteUInt32(this,t,r,!0),r+4},Buffer.prototype.writeInt32BE=function(t,r,i){return t*=1,r|=0,i||checkInt(this,t,r,4,0x7fffffff,-0x80000000),t<0&&(t=0xffffffff+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):objectWriteUInt32(this,t,r,!1),r+4},Buffer.prototype.writeFloatLE=function(t,r,i){return writeFloat(this,t,r,!0,i)},Buffer.prototype.writeFloatBE=function(t,r,i){return writeFloat(this,t,r,!1,i)},Buffer.prototype.writeDoubleLE=function(t,r,i){return writeDouble(this,t,r,!0,i)},Buffer.prototype.writeDoubleBE=function(t,r,i){return writeDouble(this,t,r,!1,i)},Buffer.prototype.copy=function(t,r,i,n){if(i||(i=0),n||0===n||(n=this.length),r>=t.length&&(r=t.length),r||(r=0),n>0&&n<i&&(n=i),n===i||0===t.length||0===this.length)return 0;if(r<0)throw RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw RangeError("sourceStart out of bounds");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-r<n-i&&(n=t.length-r+i);var a,s=n-i;if(this===t&&i<r&&r<n)for(a=s-1;a>=0;--a)t[a+r]=this[a+i];else if(s<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(a=0;a<s;++a)t[a+r]=this[a+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+s),r);return s},Buffer.prototype.fill=function(t,r,i,n){if("string"==typeof t){if("string"==typeof r?(n=r,r=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===t.length){var a,s=t.charCodeAt(0);s<256&&(t=s)}if(void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<i)throw RangeError("Out of range index");if(i<=r)return this;if(r>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(a=r;a<i;++a)this[a]=t;else{var o=internalIsBuffer(t)?t:utf8ToBytes(new Buffer(t,n).toString()),l=o.length;for(a=0;a<i-r;++a)this[a+r]=o[a%l]}return this};var HeaderTypes,INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(t){if((t=stringtrim(t).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,r){var i;r=r||1/0;for(var n=t.length,a=null,s=[],o=0;o<n;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!a){if(i>56319||o+1===n){(r-=3)>-1&&s.push(239,191,189);continue}a=i;continue}if(i<56320){(r-=3)>-1&&s.push(239,191,189),a=i;continue}i=65536+(a-55296<<10|i-56320)}else a&&(r-=3)>-1&&s.push(239,191,189);if(a=null,i<128){if((r-=1)<0)break;s.push(i)}else if(i<2048){if((r-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((r-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw Error("Invalid code point");if((r-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function asciiToBytes(t){for(var r=[],i=0;i<t.length;++i)r.push(255&t.charCodeAt(i));return r}function utf16leToBytes(t,r){for(var i,n,a=[],s=0;s<t.length&&!((r-=2)<0);++s)n=(i=t.charCodeAt(s))>>8,a.push(i%256),a.push(n);return a}function base64ToBytes(t){return toByteArray(base64clean(t))}function blitBuffer(t,r,i,n){for(var a=0;a<n&&!(a+i>=r.length||a>=t.length);++a)r[a+i]=t[a];return a}function isnan(t){return t!=t}function isBuffer(t){return null!=t&&(!!t._isBuffer||isFastBuffer(t)||isSlowBuffer(t))}function isFastBuffer(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function isSlowBuffer(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&isFastBuffer(t.slice(0,0))}!function(t){t[t.BITMAP_INFO_HEADER=40]="BITMAP_INFO_HEADER",t[t.BITMAP_V2_INFO_HEADER=52]="BITMAP_V2_INFO_HEADER",t[t.BITMAP_V3_INFO_HEADER=56]="BITMAP_V3_INFO_HEADER",t[t.BITMAP_V4_HEADER=108]="BITMAP_V4_HEADER",t[t.BITMAP_V5_HEADER=124]="BITMAP_V5_HEADER"}(HeaderTypes||(HeaderTypes={}));var BmpCompression,HeaderTypes$1=HeaderTypes;function maskColor(t,r,i,n){let a=1+~t&t,s=1+~r&r,o=1+~i&i,l=1+~n&n,u=t/a+1,h=r/s+1,f=i/o+1,d=n/l+1;return{shiftRed:r=>(r&t)/a*256/u,shiftGreen:t=>(t&r)/s*256/h,shiftBlue:t=>(t&i)/o*256/f,shiftAlpha:0!==n?t=>(t&n)/l*256/d:()=>255}}!function(t){t[t.NONE=0]="NONE",t[t.BI_RLE8=1]="BI_RLE8",t[t.BI_RLE4=2]="BI_RLE4",t[t.BI_BIT_FIELDS=3]="BI_BIT_FIELDS",t[t.BI_ALPHA_BIT_FIELDS=6]="BI_ALPHA_BIT_FIELDS"}(BmpCompression||(BmpCompression={}));class BmpDecoder{flag;fileSize;reserved1;reserved2;offset;headerSize;width;height;planes;bitPP;compression;rawSize;hr;vr;colors;importantColors;palette;data;maskRed;maskGreen;maskBlue;maskAlpha;toRGBA;pos;bottomUp;buffer;locRed;locGreen;locBlue;locAlpha;shiftRed;shiftGreen;shiftBlue;shiftAlpha;constructor(t,{toRGBA:r}={toRGBA:!1}){if(this.buffer=t,this.toRGBA=!!r,this.pos=0,this.bottomUp=!0,this.flag=this.buffer.toString("utf-8",0,this.pos+=2),"BM"!==this.flag)throw Error("Invalid BMP File");this.locRed=3*!this.toRGBA,this.locGreen=this.toRGBA?1:2,this.locBlue=this.toRGBA?2:1,this.locAlpha=3*!!this.toRGBA,this.parseHeader(),this.parseRGBA()}parseHeader(){if(this.fileSize=this.readUInt32LE(),this.reserved1=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.reserved2=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.offset=this.readUInt32LE(),this.headerSize=this.readUInt32LE(),!(this.headerSize in HeaderTypes$1))throw Error(`Unsupported BMP header size ${this.headerSize}`);if(this.width=this.readUInt32LE(),this.height=this.readUInt32LE(),this.height=this.height>0x7fffffff?this.height-0x100000000:this.height,this.planes=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.bitPP=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.compression=this.readUInt32LE(),this.rawSize=this.readUInt32LE(),this.hr=this.readUInt32LE(),this.vr=this.readUInt32LE(),this.colors=this.readUInt32LE(),this.importantColors=this.readUInt32LE(),32===this.bitPP?(this.maskAlpha=0,this.maskRed=0xff0000,this.maskGreen=65280,this.maskBlue=255):16===this.bitPP&&(this.maskAlpha=0,this.maskRed=31744,this.maskGreen=992,this.maskBlue=31),(this.headerSize>HeaderTypes$1.BITMAP_INFO_HEADER||this.compression===BmpCompression.BI_BIT_FIELDS||this.compression===BmpCompression.BI_ALPHA_BIT_FIELDS)&&(this.maskRed=this.readUInt32LE(),this.maskGreen=this.readUInt32LE(),this.maskBlue=this.readUInt32LE()),(this.headerSize>HeaderTypes$1.BITMAP_V2_INFO_HEADER||this.compression===BmpCompression.BI_ALPHA_BIT_FIELDS)&&(this.maskAlpha=this.readUInt32LE()),this.headerSize>HeaderTypes$1.BITMAP_V3_INFO_HEADER&&(this.pos+=HeaderTypes$1.BITMAP_V4_HEADER-HeaderTypes$1.BITMAP_V3_INFO_HEADER),this.headerSize>HeaderTypes$1.BITMAP_V4_HEADER&&(this.pos+=HeaderTypes$1.BITMAP_V5_HEADER-HeaderTypes$1.BITMAP_V4_HEADER),this.bitPP<=8||this.colors>0){let t=0===this.colors?1<<this.bitPP:this.colors;this.palette=Array(t);for(let r=0;r<t;r++){let t=this.buffer.readUInt8(this.pos++),i=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++);this.palette[r]={red:n,green:i,blue:t,quad:a}}}this.height<0&&(this.height*=-1,this.bottomUp=!1);let t=maskColor(this.maskRed,this.maskGreen,this.maskBlue,this.maskAlpha);this.shiftRed=t.shiftRed,this.shiftGreen=t.shiftGreen,this.shiftBlue=t.shiftBlue,this.shiftAlpha=t.shiftAlpha}parseRGBA(){switch(this.data=Buffer.alloc(this.width*this.height*4),this.bitPP){case 1:this.bit1();break;case 4:this.bit4();break;case 8:this.bit8();break;case 16:this.bit16();break;case 24:this.bit24();break;default:this.bit32()}}bit1(){let t=Math.ceil(this.width/8),r=t%4,i=0!==r?4-r:0;this.scanImage(i,t,(t,r)=>{let i=this.buffer.readUInt8(this.pos++),n=r*this.width*4+8*t*4;for(let r=0;r<8&&8*t+r<this.width;r++){let t=this.palette[i>>7-r&1];this.data[n+r*this.locAlpha]=0,this.data[n+4*r+this.locBlue]=t.blue,this.data[n+4*r+this.locGreen]=t.green,this.data[n+4*r+this.locRed]=t.red}})}bit4(){if(this.compression===BmpCompression.BI_RLE4){this.data.fill(0);let t=!1,r=this.bottomUp?this.height-1:0,i=0;for(;i<this.data.length;){let n=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++);if(0===n){if(0===a){r+=this.bottomUp?-1:1,i=r*this.width*4,t=!1;continue}if(1===a)break;if(2===a){let t=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++);r+=this.bottomUp?-n:n,i+=n*this.width*4+4*t}else{let r=this.buffer.readUInt8(this.pos++);for(let n=0;n<a;n++)i=this.setPixelData(i,t?15&r:(240&r)>>4),1&n&&n+1<a&&(r=this.buffer.readUInt8(this.pos++)),t=!t;1==(a+1>>1&1)&&this.pos++}}else for(let r=0;r<n;r++)i=this.setPixelData(i,t?15&a:(240&a)>>4),t=!t}}else{let t=Math.ceil(this.width/2),r=t%4,i=0!==r?4-r:0;this.scanImage(i,t,(t,r)=>{let i=this.buffer.readUInt8(this.pos++),n=r*this.width*4+2*t*4,a=i>>4,s=this.palette[a];if(this.data[n]=0,this.data[n+1]=s.blue,this.data[n+2]=s.green,this.data[n+3]=s.red,2*t+1>=this.width)return!1;let o=15&i;s=this.palette[o],this.data[n+4]=0,this.data[n+4+1]=s.blue,this.data[n+4+2]=s.green,this.data[n+4+3]=s.red})}}bit8(){if(this.compression===BmpCompression.BI_RLE8){this.data.fill(0);let t=this.bottomUp?this.height-1:0,r=0;for(;r<this.data.length;){let i=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++);if(0===i){if(0===n){t+=this.bottomUp?-1:1,r=t*this.width*4;continue}if(1===n)break;if(2===n){let i=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++);t+=this.bottomUp?-n:n,r+=n*this.width*4+4*i}else{for(let t=0;t<n;t++){let t=this.buffer.readUInt8(this.pos++);r=this.setPixelData(r,t)}!0&n&&this.pos++}}else for(let t=0;t<i;t++)r=this.setPixelData(r,n)}}else{let t=this.width%4,r=0!==t?4-t:0;this.scanImage(r,this.width,(t,r)=>{let i=this.buffer.readUInt8(this.pos++),n=r*this.width*4+4*t;if(i<this.palette.length){let t=this.palette[i];this.data[n]=0,this.data[n+1]=t.blue,this.data[n+2]=t.green,this.data[n+3]=t.red}else this.data[n]=0,this.data[n+1]=255,this.data[n+2]=255,this.data[n+3]=255})}}bit16(){let t=this.width%2*2;this.scanImage(t,this.width,(t,r)=>{let i=r*this.width*4+4*t,n=this.buffer.readUInt16LE(this.pos);this.pos+=2,this.data[i+this.locRed]=this.shiftRed(n),this.data[i+this.locGreen]=this.shiftGreen(n),this.data[i+this.locBlue]=this.shiftBlue(n),this.data[i+this.locAlpha]=this.shiftAlpha(n)})}bit24(){let t=this.width%4;this.scanImage(t,this.width,(t,r)=>{let i=r*this.width*4+4*t,n=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++),s=this.buffer.readUInt8(this.pos++);this.data[i+this.locRed]=s,this.data[i+this.locGreen]=a,this.data[i+this.locBlue]=n,this.data[i+this.locAlpha]=0})}bit32(){this.scanImage(0,this.width,(t,r)=>{let i=r*this.width*4+4*t,n=this.readUInt32LE();this.data[i+this.locRed]=this.shiftRed(n),this.data[i+this.locGreen]=this.shiftGreen(n),this.data[i+this.locBlue]=this.shiftBlue(n),this.data[i+this.locAlpha]=this.shiftAlpha(n)})}scanImage(t=0,r=this.width,i){for(let n=this.height-1;n>=0;n--){let a=this.bottomUp?n:this.height-1-n;for(let t=0;t<r;t++)if(!1===i.call(this,t,a))return;this.pos+=t}}readUInt32LE(){let t=this.buffer.readUInt32LE(this.pos);return this.pos+=4,t}setPixelData(t,r){let{blue:i,green:n,red:a}=this.palette[r];return this.data[t+this.locAlpha]=0,this.data[t+1+this.locBlue]=i,this.data[t+2+this.locGreen]=n,this.data[t+3+this.locRed]=a,t+4}}function createInteger(t){return t.reduce((t,r)=>t<<1|r,0)}function createColor(t){return t.quad<<24|t.red<<16|t.green<<8|t.blue}class BmpEncoder{fileSize;reserved1;reserved2;offset;width;flag;height;planes;bitPP;compress;hr;vr;colors;importantColors;rawSize;headerSize;data;palette;extraBytes;buffer;bytesInColor;pos;constructor(t){switch(this.buffer=t.data,this.width=t.width,this.height=t.height,this.headerSize=HeaderTypes$1.BITMAP_INFO_HEADER,this.flag="BM",this.bitPP=t.bitPP||24,this.offset=54,this.reserved1=t.reserved1||0,this.reserved2=t.reserved2||0,this.planes=1,this.compress=0,this.hr=t.hr||0,this.vr=t.vr||0,this.importantColors=t.importantColors||0,this.colors=Math.min(2**(this.bitPP-1||1),t.colors||1/0),this.palette=t.palette||[],this.colors&&this.bitPP<16?this.offset+=4*this.colors:this.colors=0,this.bitPP){case 32:this.bytesInColor=4;break;case 16:this.bytesInColor=2;break;case 8:this.bytesInColor=1;break;case 4:this.bytesInColor=.5;break;case 1:this.bytesInColor=1/8;break;default:this.bytesInColor=3,this.bitPP=24}const r=this.width*this.bitPP/32,i=Math.ceil(r);this.extraBytes=4*(i-r),this.rawSize=this.height*i*4+2,this.fileSize=this.rawSize+this.offset,this.data=Buffer.alloc(this.fileSize,1),this.pos=0,this.encode()}encode(){switch(this.pos=0,this.writeHeader(),this.bitPP){case 32:this.bit32();break;case 16:this.bit16();break;case 8:this.bit8();break;case 4:this.bit4();break;case 1:this.bit1();break;default:this.bit24()}}writeHeader(){this.data.write(this.flag,this.pos,2),this.pos+=2,this.writeUInt32LE(this.fileSize),this.writeUInt32LE(this.reserved1<<16|this.reserved2),this.writeUInt32LE(this.offset),this.writeUInt32LE(this.headerSize),this.writeUInt32LE(this.width),this.writeUInt32LE(this.height),this.data.writeUInt16LE(this.planes,this.pos),this.pos+=2,this.data.writeUInt16LE(this.bitPP,this.pos),this.pos+=2,this.writeUInt32LE(this.compress),this.writeUInt32LE(this.rawSize),this.writeUInt32LE(this.hr),this.writeUInt32LE(this.vr),this.writeUInt32LE(this.colors),this.writeUInt32LE(this.importantColors)}bit1(){this.palette.length&&2===this.colors?this.initColors(1):(this.writeUInt32LE(0xffffff),this.writeUInt32LE(0)),this.pos+=1;let t=[];this.writeImage((r,i,n)=>{let a=i;a++;let s=this.buffer[a++],o=this.buffer[a++],l=.2126*this.buffer[a++]+.7152*o+.0722*s;return t.push(l>127?0:1),(n+1)%8==0?(this.data[r-1]=createInteger(t),t=[]):n===this.width-1&&t.length>0&&(this.data[r-1]=createInteger(t)<<4,t=[]),a})}bit4(){let t=this.initColors(4),r=[];this.writeImage((i,n,a)=>{let s=n,o=createColor({quad:this.buffer[s++],blue:this.buffer[s++],green:this.buffer[s++],red:this.buffer[s++]}),l=t.findIndex(t=>t===o);return -1!==l?r.push(l):r.push(0),(a+1)%2==0&&(this.data[i]=r[0]<<4|r[1],r=[]),s})}bit8(){let t=this.initColors(8);this.writeImage((r,i)=>{let n=i,a=createColor({quad:this.buffer[n++],blue:this.buffer[n++],green:this.buffer[n++],red:this.buffer[n++]}),s=t.findIndex(t=>t===a);return this.data[r]=-1!==s?s:0,n})}bit16(){this.writeImage((t,r)=>{let i=r+1,n=this.buffer[i++]/8,a=this.buffer[i++]/8,s=this.buffer[i++]/8<<10|a<<5|n;return this.data[t]=255&s,this.data[t+1]=(65280&s)>>8,i})}bit24(){this.writeImage((t,r)=>{let i=r+1;return this.data[t]=this.buffer[i++],this.data[t+1]=this.buffer[i++],this.data[t+2]=this.buffer[i++],i})}bit32(){this.writeImage((t,r)=>{let i=r;return this.data[t+3]=this.buffer[i++],this.data[t]=this.buffer[i++],this.data[t+1]=this.buffer[i++],this.data[t+2]=this.buffer[i++],i})}writeImage(t){let r=this.extraBytes+this.width*this.bytesInColor,i=0;for(let n=0;n<this.height;n++)for(let a=0;a<this.width;a++){let s=Math.floor(this.pos+(this.height-1-n)*r+a*this.bytesInColor);i=t.call(this,s,i,a,n)}}initColors(t){let r=[];if(!this.palette.length)throw Error(`To encode ${t}-bit BMPs a pallette is needed. Please choose up to ${this.colors} colors. Colors must be 32-bit integers.`);for(let t=0;t<this.colors;t++){let i=createColor(this.palette[t]);this.writeUInt32LE(i),r.push(i)}return r}writeUInt32LE(t){this.data.writeUInt32LE(t,this.pos),this.pos+=4}}function decode$2(t,r){return new BmpDecoder(t,r)}function encode$2(t){return new BmpEncoder(t)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(t,r){if(r=r||{},(t=t||"")instanceof tinycolor)return t;if(!(this instanceof tinycolor))return new tinycolor(t,r);var i=inputToRGB(t);this._originalInput=t,this._r=i.r,this._g=i.g,this._b=i.b,this._a=i.a,this._roundA=Math.round(100*this._a)/100,this._format=r.format||i.format,this._gradientType=r.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=i.ok}function inputToRGB(t){var r={r:0,g:0,b:0},i=1,n=null,a=null,s=null,o=!1,l=!1;return"string"==typeof t&&(t=stringInputToObject(t)),"object"==_typeof(t)&&(isValidCSSUnit(t.r)&&isValidCSSUnit(t.g)&&isValidCSSUnit(t.b)?(r=rgbToRgb(t.r,t.g,t.b),o=!0,l="%"===String(t.r).substr(-1)?"prgb":"rgb"):isValidCSSUnit(t.h)&&isValidCSSUnit(t.s)&&isValidCSSUnit(t.v)?(n=convertToPercentage(t.s),a=convertToPercentage(t.v),r=hsvToRgb(t.h,n,a),o=!0,l="hsv"):isValidCSSUnit(t.h)&&isValidCSSUnit(t.s)&&isValidCSSUnit(t.l)&&(n=convertToPercentage(t.s),s=convertToPercentage(t.l),r=hslToRgb(t.h,n,s),o=!0,l="hsl"),t.hasOwnProperty("a")&&(i=t.a)),i=boundAlpha(i),{ok:o,format:t.format||l,r:Math.min(255,Math.max(r.r,0)),g:Math.min(255,Math.max(r.g,0)),b:Math.min(255,Math.max(r.b,0)),a:i}}function rgbToRgb(t,r,i){return{r:255*bound01(t,255),g:255*bound01(r,255),b:255*bound01(i,255)}}function rgbToHsl(t,r,i){t=bound01(t,255);var n,a,s=Math.max(t,r=bound01(r,255),i=bound01(i,255)),o=Math.min(t,r,i),l=(s+o)/2;if(s==o)n=a=0;else{var u=s-o;switch(a=l>.5?u/(2-s-o):u/(s+o),s){case t:n=(r-i)/u+6*(r<i);break;case r:n=(i-t)/u+2;break;case i:n=(t-r)/u+4}n/=6}return{h:n,s:a,l:l}}function hslToRgb(t,r,i){var n,a,s;function o(t,r,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(r-t)*i:i<.5?r:i<2/3?t+(r-t)*(2/3-i)*6:t}if(t=bound01(t,360),r=bound01(r,100),i=bound01(i,100),0===r)n=a=s=i;else{var l=i<.5?i*(1+r):i+r-i*r,u=2*i-l;n=o(u,l,t+1/3),a=o(u,l,t),s=o(u,l,t-1/3)}return{r:255*n,g:255*a,b:255*s}}function rgbToHsv(t,r,i){t=bound01(t,255);var n,a,s=Math.max(t,r=bound01(r,255),i=bound01(i,255)),o=Math.min(t,r,i),l=s,u=s-o;if(a=0===s?0:u/s,s==o)n=0;else{switch(s){case t:n=(r-i)/u+6*(r<i);break;case r:n=(i-t)/u+2;break;case i:n=(t-r)/u+4}n/=6}return{h:n,s:a,v:l}}function hsvToRgb(t,r,i){t=6*bound01(t,360),r=bound01(r,100),i=bound01(i,100);var n=Math.floor(t),a=t-n,s=i*(1-r),o=i*(1-a*r),l=i*(1-(1-a)*r),u=n%6;return{r:255*[i,o,s,s,l,i][u],g:255*[l,i,i,o,s,s][u],b:255*[s,s,l,i,i,o][u]}}function rgbToHex(t,r,i,n){var a=[pad2(Math.round(t).toString(16)),pad2(Math.round(r).toString(16)),pad2(Math.round(i).toString(16))];return n&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function rgbaToHex(t,r,i,n,a){var s=[pad2(Math.round(t).toString(16)),pad2(Math.round(r).toString(16)),pad2(Math.round(i).toString(16)),pad2(convertDecimalToHex(n))];return a&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function rgbaToArgbHex(t,r,i,n){return[pad2(convertDecimalToHex(n)),pad2(Math.round(t).toString(16)),pad2(Math.round(r).toString(16)),pad2(Math.round(i).toString(16))].join("")}function _desaturate(t,r){r=0===r?0:r||10;var i=tinycolor(t).toHsl();return i.s-=r/100,i.s=clamp01(i.s),tinycolor(i)}function _saturate(t,r){r=0===r?0:r||10;var i=tinycolor(t).toHsl();return i.s+=r/100,i.s=clamp01(i.s),tinycolor(i)}function _greyscale(t){return tinycolor(t).desaturate(100)}function _lighten(t,r){r=0===r?0:r||10;var i=tinycolor(t).toHsl();return i.l+=r/100,i.l=clamp01(i.l),tinycolor(i)}function _brighten(t,r){r=0===r?0:r||10;var i=tinycolor(t).toRgb();return i.r=Math.max(0,Math.min(255,i.r-Math.round(-r/100*255))),i.g=Math.max(0,Math.min(255,i.g-Math.round(-r/100*255))),i.b=Math.max(0,Math.min(255,i.b-Math.round(-r/100*255))),tinycolor(i)}function _darken(t,r){r=0===r?0:r||10;var i=tinycolor(t).toHsl();return i.l-=r/100,i.l=clamp01(i.l),tinycolor(i)}function _spin(t,r){var i=tinycolor(t).toHsl(),n=(i.h+r)%360;return i.h=n<0?360+n:n,tinycolor(i)}function _complement(t){var r=tinycolor(t).toHsl();return r.h=(r.h+180)%360,tinycolor(r)}function polyad(t,r){if(isNaN(r)||r<=0)throw Error("Argument to polyad must be a positive number");for(var i=tinycolor(t).toHsl(),n=[tinycolor(t)],a=360/r,s=1;s<r;s++)n.push(tinycolor({h:(i.h+s*a)%360,s:i.s,l:i.l}));return n}function _splitcomplement(t){var r=tinycolor(t).toHsl(),i=r.h;return[tinycolor(t),tinycolor({h:(i+72)%360,s:r.s,l:r.l}),tinycolor({h:(i+216)%360,s:r.s,l:r.l})]}function _analogous(t,r,i){r=r||6,i=i||30;var n=tinycolor(t).toHsl(),a=360/i,s=[tinycolor(t)];for(n.h=(n.h-(a*r>>1)+720)%360;--r;)n.h=(n.h+a)%360,s.push(tinycolor(n));return s}function _monochromatic(t,r){r=r||6;for(var i=tinycolor(t).toHsv(),n=i.h,a=i.s,s=i.v,o=[],l=1/r;r--;)o.push(tinycolor({h:n,s:a,v:s})),s=(s+l)%1;return o}tinycolor.prototype={isDark:function(){return 128>this.getBrightness()},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},getLuminance:function(){var t,r,i,n=this.toRgb();return t=n.r/255,.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*((r=n.g/255)<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*((i=n.b/255)<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4))},setAlpha:function(t){return this._a=boundAlpha(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=rgbToHsv(this._r,this._g,this._b);return{h:360*t.h,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=rgbToHsv(this._r,this._g,this._b),r=Math.round(360*t.h),i=Math.round(100*t.s),n=Math.round(100*t.v);return 1==this._a?"hsv("+r+", "+i+"%, "+n+"%)":"hsva("+r+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var t=rgbToHsl(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=rgbToHsl(this._r,this._g,this._b),r=Math.round(360*t.h),i=Math.round(100*t.s),n=Math.round(100*t.l);return 1==this._a?"hsl("+r+", "+i+"%, "+n+"%)":"hsla("+r+", "+i+"%, "+n+"%, "+this._roundA+")"},toHex:function(t){return rgbToHex(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return rgbaToHex(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*bound01(this._r,255))+"%",g:Math.round(100*bound01(this._g,255))+"%",b:Math.round(100*bound01(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*bound01(this._r,255))+"%, "+Math.round(100*bound01(this._g,255))+"%, "+Math.round(100*bound01(this._b,255))+"%)":"rgba("+Math.round(100*bound01(this._r,255))+"%, "+Math.round(100*bound01(this._g,255))+"%, "+Math.round(100*bound01(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1)},toFilter:function(t){var r="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),i=r,n=this._gradientType?"GradientType = 1, ":"";if(t){var a=tinycolor(t);i="#"+rgbaToArgbHex(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+r+",endColorstr="+i+")"},toString:function(t){var r=!!t;t=t||this._format;var i=!1,n=this._a<1&&this._a>=0;return r||!n||"hex"!==t&&"hex6"!==t&&"hex3"!==t&&"hex4"!==t&&"hex8"!==t&&"name"!==t?("rgb"===t&&(i=this.toRgbString()),"prgb"===t&&(i=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(i=this.toHexString()),"hex3"===t&&(i=this.toHexString(!0)),"hex4"===t&&(i=this.toHex8String(!0)),"hex8"===t&&(i=this.toHex8String()),"name"===t&&(i=this.toName()),"hsl"===t&&(i=this.toHslString()),"hsv"===t&&(i=this.toHsvString()),i||this.toHexString()):"name"===t&&0===this._a?this.toName():this.toRgbString()},clone:function(){return tinycolor(this.toString())},_applyModification:function(t,r){var i=t.apply(null,[this].concat([].slice.call(r)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(_lighten,arguments)},brighten:function(){return this._applyModification(_brighten,arguments)},darken:function(){return this._applyModification(_darken,arguments)},desaturate:function(){return this._applyModification(_desaturate,arguments)},saturate:function(){return this._applyModification(_saturate,arguments)},greyscale:function(){return this._applyModification(_greyscale,arguments)},spin:function(){return this._applyModification(_spin,arguments)},_applyCombination:function(t,r){return t.apply(null,[this].concat([].slice.call(r)))},analogous:function(){return this._applyCombination(_analogous,arguments)},complement:function(){return this._applyCombination(_complement,arguments)},monochromatic:function(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(_splitcomplement,arguments)},triad:function(){return this._applyCombination(polyad,[3])},tetrad:function(){return this._applyCombination(polyad,[4])}},tinycolor.fromRatio=function(t,r){if("object"==_typeof(t)){var i={};for(var n in t)t.hasOwnProperty(n)&&(i[n]="a"===n?t[n]:convertToPercentage(t[n]));t=i}return tinycolor(t,r)},tinycolor.equals=function(t,r){return!(!t||!r)&&tinycolor(t).toRgbString()==tinycolor(r).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},tinycolor.mix=function(t,r,i){i=0===i?0:i||50;var n=tinycolor(t).toRgb(),a=tinycolor(r).toRgb(),s=i/100;return tinycolor({r:(a.r-n.r)*s+n.r,g:(a.g-n.g)*s+n.g,b:(a.b-n.b)*s+n.b,a:(a.a-n.a)*s+n.a})},tinycolor.readability=function(t,r){var i=tinycolor(t),n=tinycolor(r);return(Math.max(i.getLuminance(),n.getLuminance())+.05)/(Math.min(i.getLuminance(),n.getLuminance())+.05)},tinycolor.isReadable=function(t,r,i){var n,a,s=tinycolor.readability(t,r);switch(a=!1,(n=validateWCAG2Parms(i)).level+n.size){case"AAsmall":case"AAAlarge":a=s>=4.5;break;case"AAlarge":a=s>=3;break;case"AAAsmall":a=s>=7}return a},tinycolor.mostReadable=function(t,r,i){var n,a,s,o,l=null,u=0;a=(i=i||{}).includeFallbackColors,s=i.level,o=i.size;for(var h=0;h<r.length;h++)(n=tinycolor.readability(t,r[h]))>u&&(u=n,l=tinycolor(r[h]));return tinycolor.isReadable(t,l,{level:s,size:o})||!a?l:(i.includeFallbackColors=!1,tinycolor.mostReadable(t,["#fff","#000"],i))};var names$1=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names$1);function flip(t){var r={};for(var i in t)t.hasOwnProperty(i)&&(r[t[i]]=i);return r}function boundAlpha(t){return(isNaN(t=parseFloat(t))||t<0||t>1)&&(t=1),t}function bound01(t,r){isOnePointZero(t)&&(t="100%");var i=isPercentage(t);return t=Math.min(r,Math.max(0,parseFloat(t))),i&&(t=parseInt(t*r,10)/100),1e-6>Math.abs(t-r)?1:t%r/parseFloat(r)}function clamp01(t){return Math.min(1,Math.max(0,t))}function parseIntFromHex(t){return parseInt(t,16)}function isOnePointZero(t){return"string"==typeof t&&-1!=t.indexOf(".")&&1===parseFloat(t)}function isPercentage(t){return"string"==typeof t&&-1!=t.indexOf("%")}function pad2(t){return 1==t.length?"0"+t:""+t}function convertToPercentage(t){return t<=1&&(t=100*t+"%"),t}function convertDecimalToHex(t){return Math.round(255*parseFloat(t)).toString(16)}function convertHexToDecimal(t){return parseIntFromHex(t)/255}var CSS_UNIT,PERMISSIVE_MATCH3,PERMISSIVE_MATCH4,matchers=(CSS_UNIT="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?",{CSS_UNIT:new RegExp(CSS_UNIT),rgb:RegExp("rgb"+PERMISSIVE_MATCH3),rgba:RegExp("rgba"+PERMISSIVE_MATCH4),hsl:RegExp("hsl"+PERMISSIVE_MATCH3),hsla:RegExp("hsla"+PERMISSIVE_MATCH4),hsv:RegExp("hsv"+PERMISSIVE_MATCH3),hsva:RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function isValidCSSUnit(t){return!!matchers.CSS_UNIT.exec(t)}function stringInputToObject(t){t=t.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var r,i=!1;if(names$1[t])t=names$1[t],i=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};return(r=matchers.rgb.exec(t))?{r:r[1],g:r[2],b:r[3]}:(r=matchers.rgba.exec(t))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=matchers.hsl.exec(t))?{h:r[1],s:r[2],l:r[3]}:(r=matchers.hsla.exec(t))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=matchers.hsv.exec(t))?{h:r[1],s:r[2],v:r[3]}:(r=matchers.hsva.exec(t))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=matchers.hex8.exec(t))?{r:parseIntFromHex(r[1]),g:parseIntFromHex(r[2]),b:parseIntFromHex(r[3]),a:convertHexToDecimal(r[4]),format:i?"name":"hex8"}:(r=matchers.hex6.exec(t))?{r:parseIntFromHex(r[1]),g:parseIntFromHex(r[2]),b:parseIntFromHex(r[3]),format:i?"name":"hex"}:(r=matchers.hex4.exec(t))?{r:parseIntFromHex(r[1]+""+r[1]),g:parseIntFromHex(r[2]+""+r[2]),b:parseIntFromHex(r[3]+""+r[3]),a:convertHexToDecimal(r[4]+""+r[4]),format:i?"name":"hex8"}:!!(r=matchers.hex3.exec(t))&&{r:parseIntFromHex(r[1]+""+r[1]),g:parseIntFromHex(r[2]+""+r[2]),b:parseIntFromHex(r[3]+""+r[3]),format:i?"name":"hex"}}function validateWCAG2Parms(t){var r,i;return"AA"!==(r=((t=t||{level:"AA",size:"small"}).level||"AA").toUpperCase())&&"AAA"!==r&&(r="AA"),"small"!==(i=(t.size||"small").toLowerCase())&&"large"!==i&&(i="small"),{level:r,size:i}}function clone(t){let r={width:t.bitmap.width,height:t.bitmap.height,data:Buffer.from(t.bitmap.data)};return new t.constructor(r)}function scan(t,r,i,n,a,s){let o,l,u,h,f;if("function"==typeof r)f=r,o=0,l=0,u=t.bitmap.width,h=t.bitmap.height;else{if(o=r,"number"!=typeof i)throw Error("y must be a number");if(l=i,"number"!=typeof n)throw Error("w must be a number");if(u=n,"number"!=typeof a)throw Error("h must be a number");if(h=a,"function"!=typeof s)throw Error("cb must be a function");f=s}o=Math.round(o),l=Math.round(l),u=Math.round(u),h=Math.round(h);let d=f.bind(t);for(let r=l;r<l+h;r++)for(let i=o;i<o+u;i++)d(i,r,t.bitmap.width*r+i<<2);return t}function*scanIterator(t,r,i,n,a){r=Math.round(r),i=Math.round(i),n=Math.round(n),a=Math.round(a);for(let s=i;s<i+a;s++)for(let i=r;i<r+n;i++){let r=t.bitmap.width*s+i<<2;yield{x:i,y:s,idx:r,image:t}}}function intToRGBA$1(t){if("number"!=typeof t)throw Error("i must be a number");let r={r:0,g:0,b:0,a:0};return r.r=Math.floor(t/0x1000000),r.g=Math.floor((t-0x1000000*r.r)/65536),r.b=Math.floor((t-0x1000000*r.r-65536*r.g)/256),r.a=Math.floor((t-0x1000000*r.r-65536*r.g-256*r.b)/1),r}function rgbaToInt(t,r,i,n){if("number"!=typeof t||"number"!=typeof r||"number"!=typeof i||"number"!=typeof n)throw Error("r, g, b and a must be numbers");if(t<0||t>255)throw Error("r must be between 0 and 255");if(r<0||r>255)throw Error("g must be between 0 and 255");if(i<0||i>255)throw Error("b must be between 0 and 255");if(n<0||n>255)throw Error("a must be between 0 and 255");let a=255&t;return a<<=8,a|=255&r,a<<=8,a|=255&i,a<<=8,a|=255&n,a>>>=0}function colorDiff(t,r){let i=t=>Math.pow(t,2),{max:n}=Math,a="a"in t?t.a:255,s="a"in r?r.a:255;return(n(i(t.r-r.r),i(t.r-r.r-a+s))+n(i(t.g-r.g),i(t.g-r.g-a+s))+n(i(t.b-r.b),i(t.b-r.b-a+s)))/195075}function limit255(t){return Math.min(t=Math.max(t,0),255)}function cssColorToHex(t){return"number"==typeof t?t:parseInt(tinycolor(t).toHex8(),16)}function encode$1(t,r={}){return scan({bitmap:t},0,0,t.width,t.height,function(r,i,n){let a=t.data[n+0],s=t.data[n+1],o=t.data[n+2],l=t.data[n+3];t.data[n+0]=l,t.data[n+1]=o,t.data[n+2]=s,t.data[n+3]=a}),encode$2({...t,...r}).data}function decode$1(t,r){let i=decode$2(t,r);return scan({bitmap:i},0,0,i.width,i.height,function(t,r,n){let a=i.data[n+1],s=i.data[n+2],o=i.data[n+3];i.data[n+0]=o,i.data[n+1]=s,i.data[n+2]=a,i.data[n+3]=255}),i}function msBmp(){return{mime:"image/x-ms-bmp",encode:encode$1,decode:decode$1}}function bmp(){return{mime:"image/bmp",encode:encode$1,decode:decode$1}}var GifReader_1,GifWriter_1,omggif={};function GifWriter(t,r,i,n){var a=0,s=void 0===(n=void 0===n?{}:n).loop?null:n.loop,o=void 0===n.palette?null:n.palette;if(r<=0||i<=0||r>65535||i>65535)throw Error("Width/Height invalid.");function l(t){var r=t.length;if(r<2||r>256||r&r-1)throw Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return r}t[a++]=71,t[a++]=73,t[a++]=70,t[a++]=56,t[a++]=57,t[a++]=97;var u=0,h=0;if(null!==o){for(var f=l(o);f>>=1;)++u;if(f=1<<u,--u,void 0!==n.background){if((h=n.background)>=f)throw Error("Background index out of range.");if(0===h)throw Error("Background index explicitly passed as 0.")}}if(t[a++]=255&r,t[a++]=r>>8&255,t[a++]=255&i,t[a++]=i>>8&255,t[a++]=128*(null!==o)|u,t[a++]=h,t[a++]=0,null!==o)for(var d=0,c=o.length;d<c;++d){var p=o[d];t[a++]=p>>16&255,t[a++]=p>>8&255,t[a++]=255&p}if(null!==s){if(s<0||s>65535)throw Error("Loop count invalid.");t[a++]=33,t[a++]=255,t[a++]=11,t[a++]=78,t[a++]=69,t[a++]=84,t[a++]=83,t[a++]=67,t[a++]=65,t[a++]=80,t[a++]=69,t[a++]=50,t[a++]=46,t[a++]=48,t[a++]=3,t[a++]=1,t[a++]=255&s,t[a++]=s>>8&255,t[a++]=0}var m=!1;this.addFrame=function(r,i,n,s,u,h){if(!0===m&&(--a,m=!1),h=void 0===h?{}:h,r<0||i<0||r>65535||i>65535)throw Error("x/y invalid.");if(n<=0||s<=0||n>65535||s>65535)throw Error("Width/Height invalid.");if(u.length<n*s)throw Error("Not enough pixels for the frame size.");var f=!0,d=h.palette;if(null==d&&(f=!1,d=o),null==d)throw Error("Must supply either a local or global palette.");for(var c=l(d),p=0;c>>=1;)++p;c=1<<p;var g=void 0===h.delay?0:h.delay,_=void 0===h.disposal?0:h.disposal;if(_<0||_>3)throw Error("Disposal out of range.");var b=!1,y=0;if(void 0!==h.transparent&&null!==h.transparent&&(b=!0,(y=h.transparent)<0||y>=c))throw Error("Transparent color index.");if((0!==_||b||0!==g)&&(t[a++]=33,t[a++]=249,t[a++]=4,t[a++]=_<<2|!0===b,t[a++]=255&g,t[a++]=g>>8&255,t[a++]=y,t[a++]=0),t[a++]=44,t[a++]=255&r,t[a++]=r>>8&255,t[a++]=255&i,t[a++]=i>>8&255,t[a++]=255&n,t[a++]=n>>8&255,t[a++]=255&s,t[a++]=s>>8&255,t[a++]=!0===f?128|p-1:0,!0===f)for(var v=0,w=d.length;v<w;++v){var x=d[v];t[a++]=x>>16&255,t[a++]=x>>8&255,t[a++]=255&x}return a=GifWriterOutputLZWCodeStream(t,a,p<2?2:p,u)},this.end=function(){return!1===m&&(t[a++]=59,m=!0),a},this.getOutputBuffer=function(){return t},this.setOutputBuffer=function(r){t=r},this.getOutputBufferPosition=function(){return a},this.setOutputBufferPosition=function(t){a=t}}function GifWriterOutputLZWCodeStream(t,r,i,n){t[r++]=i;var a=r++,s=1<<i,o=s-1,l=s+1,u=l+1,h=i+1,f=0,d=0;function c(i){for(;f>=i;)t[r++]=255&d,d>>=8,f-=8,r===a+256&&(t[a]=255,a=r++)}function p(t){d|=t<<f,f+=h,c(8)}var m=n[0]&o,g={};p(s);for(var _=1,b=n.length;_<b;++_){var y=n[_]&o,v=m<<8|y,w=g[v];if(void 0===w){for(d|=m<<f,f+=h;f>=8;)t[r++]=255&d,d>>=8,f-=8,r===a+256&&(t[a]=255,a=r++);4096===u?(p(s),u=l+1,h=i+1,g={}):(u>=1<<h&&++h,g[v]=u++),m=y}else m=w}return p(m),p(l),c(1),a+1===r?t[a]=0:(t[a]=r-a-1,t[r++]=0),r}function GifReader(t){var r=0;if(71!==t[r++]||73!==t[r++]||70!==t[r++]||56!==t[r++]||56!=(t[r++]+1&253)||97!==t[r++])throw Error("Invalid GIF 87a/89a header.");var i=t[r++]|t[r++]<<8,n=t[r++]|t[r++]<<8,a=t[r++],s=a>>7,o=1<<(7&a)+1;t[r++],t[r++];var l=null,u=null;s&&(l=r,u=o,r+=3*o);var h=!0,f=[],d=0,c=null,p=0,m=null;for(this.width=i,this.height=n;h&&r<t.length;)switch(t[r++]){case 33:switch(t[r++]){case 255:if(11!==t[r]||78==t[r+1]&&69==t[r+2]&&84==t[r+3]&&83==t[r+4]&&67==t[r+5]&&65==t[r+6]&&80==t[r+7]&&69==t[r+8]&&50==t[r+9]&&46==t[r+10]&&48==t[r+11]&&3==t[r+12]&&1==t[r+13]&&0==t[r+16])r+=14,m=t[r++]|t[r++]<<8,r++;else for(r+=12;;){if(!((_=t[r++])>=0))throw Error("Invalid block size");if(0===_)break;r+=_}break;case 249:if(4!==t[r++]||0!==t[r+4])throw Error("Invalid graphics extension block.");var g=t[r++];d=t[r++]|t[r++]<<8,c=t[r++],1&g||(c=null),p=g>>2&7,r++;break;case 254:for(;;){if(!((_=t[r++])>=0))throw Error("Invalid block size");if(0===_)break;r+=_}break;default:throw Error("Unknown graphic control label: 0x"+t[r-1].toString(16))}break;case 44:var _,b=t[r++]|t[r++]<<8,y=t[r++]|t[r++]<<8,v=t[r++]|t[r++]<<8,w=t[r++]|t[r++]<<8,x=t[r++],k=x>>6&1,E=1<<(7&x)+1,S=l,$=u,I=!1;x>>7&&(I=!0,S=r,$=E,r+=3*E);var A=r;for(r++;;){if(!((_=t[r++])>=0))throw Error("Invalid block size");if(0===_)break;r+=_}f.push({x:b,y:y,width:v,height:w,has_local_palette:I,palette_offset:S,palette_size:$,data_offset:A,data_length:r-A,transparent_index:c,interlaced:!!k,delay:d,disposal:p});break;case 59:h=!1;break;default:throw Error("Unknown gif block: 0x"+t[r-1].toString(16))}this.numFrames=function(){return f.length},this.loopCount=function(){return m},this.frameInfo=function(t){if(t<0||t>=f.length)throw Error("Frame index out of range.");return f[t]},this.decodeAndBlitFrameBGRA=function(r,n){var a=this.frameInfo(r),s=a.width*a.height,o=new Uint8Array(s);GifReaderLZWOutputIndexStream(t,a.data_offset,o,s);var l=a.palette_offset,u=a.transparent_index;null===u&&(u=256);var h=a.width,f=i-h,d=h,c=4*(a.y*i+a.x),p=4*((a.y+a.height)*i+a.x),m=c,g=4*f;!0===a.interlaced&&(g+=4*i*7);for(var _=8,b=0,y=o.length;b<y;++b){var v=o[b];if(0===d&&(d=h,(m+=g)>=p&&(g=4*f+4*i*(_-1),m=c+(h+f)*(_<<1),_>>=1)),v===u)m+=4;else{var w=t[l+3*v],x=t[l+3*v+1],k=t[l+3*v+2];n[m++]=k,n[m++]=x,n[m++]=w,n[m++]=255}--d}},this.decodeAndBlitFrameRGBA=function(r,n){var a=this.frameInfo(r),s=a.width*a.height,o=new Uint8Array(s);GifReaderLZWOutputIndexStream(t,a.data_offset,o,s);var l=a.palette_offset,u=a.transparent_index;null===u&&(u=256);var h=a.width,f=i-h,d=h,c=4*(a.y*i+a.x),p=4*((a.y+a.height)*i+a.x),m=c,g=4*f;!0===a.interlaced&&(g+=4*i*7);for(var _=8,b=0,y=o.length;b<y;++b){var v=o[b];if(0===d&&(d=h,(m+=g)>=p&&(g=4*f+4*i*(_-1),m=c+(h+f)*(_<<1),_>>=1)),v===u)m+=4;else{var w=t[l+3*v],x=t[l+3*v+1],k=t[l+3*v+2];n[m++]=w,n[m++]=x,n[m++]=k,n[m++]=255}--d}}}function GifReaderLZWOutputIndexStream(t,r,i,n){for(var a=t[r++],s=1<<a,o=s+1,l=o+1,u=a+1,h=(1<<u)-1,f=0,d=0,c=0,p=t[r++],m=new Int32Array(4096),g=null;;){for(;f<16&&0!==p;)d|=t[r++]<<f,f+=8,1===p?p=t[r++]:--p;if(f<u)break;var _=d&h;if(d>>=u,f-=u,_!==s){if(_===o)break;for(var b=_<l?_:g,y=0,v=b;v>s;)v=m[v]>>8,++y;var w=v;if(c+y+ +(b!==_)>n)return void console.log("Warning, gif stream longer than expected.");i[c++]=w;var x=c+=y;for(b!==_&&(i[c++]=w),v=b;y--;)v=m[v],i[--x]=255&v,v>>=8;null!==g&&l<4096&&(m[l++]=g<<8|w,l>=h+1&&u<12&&(++u,h=h<<1|1)),g=_}else l=o+1,h=(1<<(u=a+1))-1,g=null}return c!==n&&console.log("Warning, gif stream shorter than expected."),i}try{GifWriter_1=omggif.GifWriter=GifWriter,GifReader_1=omggif.GifReader=GifReader}catch(e1){}let BitmapImage$2=class e1{constructor(...t){if(0===t.length)throw Error("constructor requires parameters");const r=t[0];if(null!==r&&"object"==typeof r)if(r instanceof e1){const t=r.bitmap;this.bitmap={width:t.width,height:t.height,data:new Buffer(t.width*t.height*4)},t.data.copy(this.bitmap.data)}else{if(!(r.width&&r.height&&r.data))throw Error("unrecognized constructor parameters");this.bitmap=r}else{if("number"!=typeof r||"number"!=typeof t[1])throw Error("unrecognized constructor parameters");{const i=r,n=t[1],a=t[2];this.bitmap={width:i,height:n},Buffer.isBuffer(a)?this.bitmap.data=a:(this.bitmap.data=new Buffer(i*n*4),"number"==typeof a&&this.fillRGBA(a))}}}blit(t,r,i,n,a,s,o){if(n+s>this.bitmap.width)throw Error("copy exceeds width of source bitmap");if(r+s>t.bitmap.width)throw Error("copy exceeds width of target bitmap");if(a+o>this.bitmap.height)throw Error("copy exceeds height of source bitmap");if(i+o>t.bitmap.height)throw new Erro("copy exceeds height of target bitmap");let l=this.bitmap.data,u=t.bitmap.data,h=4*this.bitmap.width,f=4*t.bitmap.width,d=4*s,c=a*h+4*n,p=i*f+4*r;for(;--o>=0;)l.copy(u,p,c,c+d),c+=h,p+=f;return this}fillRGBA(t){let r=this.bitmap.data,i=4*this.bitmap.height,n=0;for(;n<i;)r.writeUInt32BE(t,n),n+=4;for(;n<r.length;)r.copy(r,n,0,i),n+=i;return this}getRGBA(t,r){let i=4*(r*this.bitmap.width+t);return this.bitmap.data.readUInt32BE(i)}getRGBASet(){let t=new Set,r=this.bitmap.data;for(let i=0;i<r.length;i+=4)t.add(r.readUInt32BE(i,!0));return t}greyscale(){let t=this.bitmap.data;return this.scan(0,0,this.bitmap.width,this.bitmap.height,(r,i,n)=>{let a=Math.round(.299*t[n]+.587*t[n+1]+.114*t[n+2]);t[n]=a,t[n+1]=a,t[n+2]=a}),this}reframe(t,r,i,n,a){let s,o=t<0?0:t,l=r<0?0:r,u=i+o>this.bitmap.width?this.bitmap.width-o:i,h=n+l>this.bitmap.height?this.bitmap.height-l:n,f=t<0?-t:0,d=r<0?-r:0;if(void 0===a){if(o!==t||l!=r||u!==i||h!==n)throw new GifError("fillRGBA required for this reframing");s=new e1(i,n)}else s=new e1(i,n,a);return this.blit(s,f,d,o,l,u,h),this.bitmap=s.bitmap,this}scale(t){if(1===t)return;if(!Number.isInteger(t)||t<1)throw Error("the scale must be an integer >= 1");let r=this.bitmap.width,i=this.bitmap.height,n=r*t*4,a=this.bitmap.data,s=new Buffer(i*n*t),o,l=0,u=0;for(let h=0;h<i;++h){o=u;for(let i=0;i<r;++i){let r=a.readUInt32BE(l,!0);for(let i=0;i<t;++i)s.writeUInt32BE(r,u),u+=4;l+=4}for(let r=1;r<t;++r)s.copy(s,u,o,u),u+=n,o+=n}return this.bitmap={width:r*t,height:i*t,data:s},this}scanAllCoords(t){let r=this.bitmap.width,i=this.bitmap.data.length,n=0,a=0;for(let s=0;s<i;s+=4)t(n,a,s),++n===r&&(n=0,++a)}scanAllIndexes(t){let r=this.bitmap.data.length;for(let i=0;i<r;i+=4)t(i)}};var bitmapimage=BitmapImage$2,gif$1={};let Gif$1=class{constructor(t,r,i){this.width=i.width,this.height=i.height,this.loops=i.loops,this.usesTransparency=i.usesTransparency,this.colorScope=i.colorScope,this.frames=r,this.buffer=t}};Gif$1.GlobalColorsPreferred=0,Gif$1.GlobalColorsOnly=1,Gif$1.LocalColorsOnly=2;let GifError$2=class extends Error{constructor(t){super(t),t instanceof Error&&(this.stack="Gif"+t.stack)}};gif$1.Gif=Gif$1,gif$1.GifError=GifError$2;var gifcodec={},gifutil={},_polyfillNode_fs={},_polyfillNode_fs$1=Object.freeze({__proto__:null,default:_polyfillNode_fs}),require$$0=getAugmentedNamespace(_polyfillNode_fs$1),__defProp$3=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__defNormalProp$3=(t,r,i)=>r in t?__defProp$3(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i,__markAsModule=t=>__defProp$3(t,"__esModule",{value:!0}),__export$1=(t,r)=>{for(var i in r)__defProp$3(t,i,{get:r[i],enumerable:!0})},__reExport=(t,r,i,n)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let a of __getOwnPropNames(r))!__hasOwnProp.call(t,a)&&i&&__defProp$3(t,a,{get:()=>r[a],enumerable:!(n=__getOwnPropDesc(r,a))||n.enumerable});return t},__toCommonJS=(t=>(r,i)=>t&&t.get(r)||(i=__reExport(__markAsModule({}),r,1),t&&t.set(r,i),i))("undefined"!=typeof WeakMap?new WeakMap:0),__publicField$3=(t,r,i)=>(__defNormalProp$3(t,"symbol"!=typeof r?r+"":r,i),i),src_exports={};__export$1(src_exports,{applyPalette:()=>applyPalette,applyPaletteSync:()=>applyPaletteSync$1,buildPalette:()=>buildPalette,buildPaletteSync:()=>buildPaletteSync$1,constants:()=>constants_exports$1,conversion:()=>conversion_exports$1,distance:()=>distance_exports$1,image:()=>image_exports$1,palette:()=>palette_exports$1,quality:()=>quality_exports$1,utils:()=>utils_exports$1});var constants_exports$1={};__export$1(constants_exports$1,{bt709:()=>bt709_exports$1});var bt709_exports$1={};__export$1(bt709_exports$1,{Y:()=>Y$1,x:()=>x$2,y:()=>y$2});var Y$1=(t=>(t[t.RED=.2126]="RED",t[t.GREEN=.7152]="GREEN",t[t.BLUE=.0722]="BLUE",t[t.WHITE=1]="WHITE",t))(Y$1||{}),x$2=(t=>(t[t.RED=.64]="RED",t[t.GREEN=.3]="GREEN",t[t.BLUE=.15]="BLUE",t[t.WHITE=.3127]="WHITE",t))(x$2||{}),y$2=(t=>(t[t.RED=.33]="RED",t[t.GREEN=.6]="GREEN",t[t.BLUE=.06]="BLUE",t[t.WHITE=.329]="WHITE",t))(y$2||{}),conversion_exports$1={};function correctGamma$1(t){return t>.04045?((t+.055)/1.055)**2.4:t/12.92}function rgb2xyz$1(t,r,i){return{x:.4124*(t=correctGamma$1(t/255))+.3576*(r=correctGamma$1(r/255))+.1805*(i=correctGamma$1(i/255)),y:.2126*t+.7152*r+.0722*i,z:.0193*t+.1192*r+.9505*i}}__export$1(conversion_exports$1,{lab2rgb:()=>lab2rgb$1,lab2xyz:()=>lab2xyz$1,rgb2hsl:()=>rgb2hsl$1,rgb2lab:()=>rgb2lab$1,rgb2xyz:()=>rgb2xyz$1,xyz2lab:()=>xyz2lab$1,xyz2rgb:()=>xyz2rgb$1});var arithmetic_exports$1={};function degrees2radians$1(t){return Math.PI/180*t}function max3$1(t,r,i){let n=t;return n<r&&(n=r),n<i&&(n=i),n}function min3$1(t,r,i){let n=t;return n>r&&(n=r),n>i&&(n=i),n}function intInRange$1(t,r,i){return t>i&&(t=i),t<r&&(t=r),0|t}function inRange0to255Rounded$1(t){return(t=Math.round(t))>255?t=255:t<0&&(t=0),t}function inRange0to255$1(t){return t>255?t=255:t<0&&(t=0),t}function stableSort$1(t,r){let i,n=typeof t[0];if("number"===n||"string"===n){let n=Object.create(null);for(let r=0,i=t.length;r<i;r++){let i=t[r];n[i]||0===n[i]||(n[i]=r)}i=t.sort((t,i)=>r(t,i)||n[t]-n[i])}else{let n=t.slice(0);i=t.sort((t,i)=>r(t,i)||n.indexOf(t)-n.indexOf(i))}return i}function rgb2hsl$1(t,r,i){let n=min3$1(t,r,i),a=max3$1(t,r,i),s=a-n,o=(n+a)/510,l=0;o>0&&o<1&&(l=s/(o<.5?a+n:510-a-n));let u=0;return s>0&&(u=(a===t?(r-i)/s:a===r?2+(i-t)/s:4+(t-r)/s)*60)<0&&(u+=360),{h:u,s:l,l:o}}__export$1(arithmetic_exports$1,{degrees2radians:()=>degrees2radians$1,inRange0to255:()=>inRange0to255$1,inRange0to255Rounded:()=>inRange0to255Rounded$1,intInRange:()=>intInRange$1,max3:()=>max3$1,min3:()=>min3$1,stableSort:()=>stableSort$1});var refX$1=.95047,refY$1=1,refZ$1=1.08883;function pivot$1(t){return t>.008856?t**(1/3):7.787*t+16/116}function xyz2lab$1(t,r,i){if(t=pivot$1(t/refX$1),r=pivot$1(r/refY$1),i=pivot$1(i/refZ$1),116*r-16<0)throw Error("xxx");return{L:Math.max(0,116*r-16),a:500*(t-r),b:200*(r-i)}}function rgb2lab$1(t,r,i){let n=rgb2xyz$1(t,r,i);return xyz2lab$1(n.x,n.y,n.z)}var refX2$1=.95047,refY2$1=1,refZ2$1=1.08883;function pivot2$1(t){return t>.206893034?t**3:(t-16/116)/7.787}function lab2xyz$1(t,r,i){let n=(t+16)/116,a=n-i/200;return{x:refX2$1*pivot2$1(r/500+n),y:refY2$1*pivot2$1(n),z:refZ2$1*pivot2$1(a)}}function correctGamma2$1(t){return t>.0031308?1.055*t**(1/2.4)-.055:12.92*t}function xyz2rgb$1(t,r,i){let n=correctGamma2$1(3.2406*t+-1.5372*r+-.4986*i),a=correctGamma2$1(-.9689*t+1.8758*r+.0415*i),s=correctGamma2$1(.0557*t+-.204*r+1.057*i);return{r:inRange0to255Rounded$1(255*n),g:inRange0to255Rounded$1(255*a),b:inRange0to255Rounded$1(255*s)}}function lab2rgb$1(t,r,i){let n=lab2xyz$1(t,r,i);return xyz2rgb$1(n.x,n.y,n.z)}var distance_exports$1={};__export$1(distance_exports$1,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator$1,AbstractEuclidean:()=>AbstractEuclidean$1,AbstractManhattan:()=>AbstractManhattan$1,CIE94GraphicArts:()=>CIE94GraphicArts$1,CIE94Textiles:()=>CIE94Textiles$1,CIEDE2000:()=>CIEDE2000$1,CMetric:()=>CMetric$1,Euclidean:()=>Euclidean$1,EuclideanBT709:()=>EuclideanBT709$1,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha$1,Manhattan:()=>Manhattan$1,ManhattanBT709:()=>ManhattanBT709$1,ManhattanNommyde:()=>ManhattanNommyde$1,PNGQuant:()=>PNGQuant$1});var AbstractDistanceCalculator$1=class{constructor(){__publicField$3(this,"_maxDistance"),__publicField$3(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(t,r,i,n){this._whitePoint={r:t>0?255/t:0,g:r>0?255/r:0,b:i>0?255/i:0,a:n>0?255/n:0},this._maxDistance=this.calculateRaw(t,r,i,n,0,0,0,0)}calculateNormalized(t,r){return this.calculateRaw(t.r,t.g,t.b,t.a,r.r,r.g,r.b,r.a)/this._maxDistance}},AbstractCIE94$1=class extends AbstractDistanceCalculator$1{calculateRaw(t,r,i,n,a,s,o,l){let u=rgb2lab$1(inRange0to255$1(t*this._whitePoint.r),inRange0to255$1(r*this._whitePoint.g),inRange0to255$1(i*this._whitePoint.b)),h=rgb2lab$1(inRange0to255$1(a*this._whitePoint.r),inRange0to255$1(s*this._whitePoint.g),inRange0to255$1(o*this._whitePoint.b)),f=u.L-h.L,d=u.a-h.a,c=u.b-h.b,p=Math.sqrt(u.a*u.a+u.b*u.b),m=p-Math.sqrt(h.a*h.a+h.b*h.b),g=d*d+c*c-m*m;g=g<0?0:Math.sqrt(g);let _=(l-n)*this._whitePoint.a*this._kA;return Math.sqrt((f/this._Kl)**2+(m/(1+this._K1*p))**2+(g/(1+this._K2*p))**2+_**2)}},CIE94Textiles$1=class extends AbstractCIE94$1{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}},CIE94GraphicArts$1=class extends AbstractCIE94$1{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}},_CIEDE2000$1=class extends AbstractDistanceCalculator$1{_setDefaults(){}static _calculatehp(t,r){let i=Math.atan2(t,r);return i>=0?i:i+_CIEDE2000$1._deg360InRad}static _calculateRT(t,r){let i=r**7,n=2*Math.sqrt(i/(i+_CIEDE2000$1._pow25to7));return-Math.sin(2*(_CIEDE2000$1._deg30InRad*Math.exp(-(((t-_CIEDE2000$1._deg275InRad)/_CIEDE2000$1._deg25InRad)**2))))*n}static _calculateT(t){return 1-.17*Math.cos(t-_CIEDE2000$1._deg30InRad)+.24*Math.cos(2*t)+.32*Math.cos(3*t+_CIEDE2000$1._deg6InRad)-.2*Math.cos(4*t-_CIEDE2000$1._deg63InRad)}static _calculate_ahp(t,r,i,n){let a=i+n;return 0===t?a:r<=_CIEDE2000$1._deg180InRad?a/2:a<_CIEDE2000$1._deg360InRad?(a+_CIEDE2000$1._deg360InRad)/2:(a-_CIEDE2000$1._deg360InRad)/2}static _calculate_dHp(t,r,i,n){let a;return a=0===t?0:r<=_CIEDE2000$1._deg180InRad?i-n:i<=n?i-n+_CIEDE2000$1._deg360InRad:i-n-_CIEDE2000$1._deg360InRad,2*Math.sqrt(t)*Math.sin(a/2)}calculateRaw(t,r,i,n,a,s,o,l){let u=rgb2lab$1(inRange0to255$1(t*this._whitePoint.r),inRange0to255$1(r*this._whitePoint.g),inRange0to255$1(i*this._whitePoint.b)),h=rgb2lab$1(inRange0to255$1(a*this._whitePoint.r),inRange0to255$1(s*this._whitePoint.g),inRange0to255$1(o*this._whitePoint.b)),f=(l-n)*this._whitePoint.a*_CIEDE2000$1._kA;return Math.sqrt(this.calculateRawInLab(u,h)+f*f)}calculateRawInLab(t,r){let i=t.L,n=t.a,a=t.b,s=r.L,o=r.a,l=r.b,u=((Math.sqrt(n*n+a*a)+Math.sqrt(o*o+l*l))/2)**7,h=.5*(1-Math.sqrt(u/(u+_CIEDE2000$1._pow25to7))),f=(1+h)*n,d=(1+h)*o,c=Math.sqrt(f*f+a*a),p=Math.sqrt(d*d+l*l),m=c*p,g=_CIEDE2000$1._calculatehp(a,f),_=_CIEDE2000$1._calculatehp(l,d),b=Math.abs(g-_),y=s-i,v=p-c,w=_CIEDE2000$1._calculate_dHp(m,b,_,g),x=_CIEDE2000$1._calculate_ahp(m,b,g,_),k=(c+p)/2,E=((i+s)/2-50)**2,S=v/(1+.045*k),$=w/(1+.015*_CIEDE2000$1._calculateT(x)*k);return(y/(1+.015*E/Math.sqrt(20+E)))**2+S**2+$**2+_CIEDE2000$1._calculateRT(x,k)*S*$}},CIEDE2000$1=_CIEDE2000$1;__publicField$3(CIEDE2000$1,"_kA",25/255),__publicField$3(CIEDE2000$1,"_pow25to7",0x16bcc41e9),__publicField$3(CIEDE2000$1,"_deg360InRad",degrees2radians$1(360)),__publicField$3(CIEDE2000$1,"_deg180InRad",degrees2radians$1(180)),__publicField$3(CIEDE2000$1,"_deg30InRad",degrees2radians$1(30)),__publicField$3(CIEDE2000$1,"_deg6InRad",degrees2radians$1(6)),__publicField$3(CIEDE2000$1,"_deg63InRad",degrees2radians$1(63)),__publicField$3(CIEDE2000$1,"_deg275InRad",degrees2radians$1(275)),__publicField$3(CIEDE2000$1,"_deg25InRad",degrees2radians$1(25));var CMetric$1=class extends AbstractDistanceCalculator$1{calculateRaw(t,r,i,n,a,s,o,l){let u=(t+a)/2*this._whitePoint.r,h=(t-a)*this._whitePoint.r,f=(r-s)*this._whitePoint.g,d=(i-o)*this._whitePoint.b,c=((512+u)*h*h>>8)+4*f*f+((767-u)*d*d>>8),p=(l-n)*this._whitePoint.a;return Math.sqrt(c+p*p)}_setDefaults(){}},AbstractEuclidean$1=class extends AbstractDistanceCalculator$1{calculateRaw(t,r,i,n,a,s,o,l){let u=a-t,h=s-r,f=o-i,d=l-n;return Math.sqrt(this._kR*u*u+this._kG*h*h+this._kB*f*f+this._kA*d*d)}},Euclidean$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha$1=class extends AbstractEuclidean$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan$1=class extends AbstractDistanceCalculator$1{calculateRaw(t,r,i,n,a,s,o,l){let u=a-t,h=s-r,f=o-i,d=l-n;return u<0&&(u=0-u),h<0&&(h=0-h),f<0&&(f=0-f),d<0&&(d=0-d),this._kR*u+this._kG*h+this._kB*f+this._kA*d}},Manhattan$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709$1=class extends AbstractManhattan$1{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant$1=class extends AbstractDistanceCalculator$1{calculateRaw(t,r,i,n,a,s,o,l){let u=(l-n)*this._whitePoint.a;return this._colordifferenceCh(t*this._whitePoint.r,a*this._whitePoint.r,u)+this._colordifferenceCh(r*this._whitePoint.g,s*this._whitePoint.g,u)+this._colordifferenceCh(i*this._whitePoint.b,o*this._whitePoint.b,u)}_colordifferenceCh(t,r,i){let n=t-r,a=n+i;return n*n+a*a}_setDefaults(){}},palette_exports$1={};__export$1(palette_exports$1,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer$1,ColorHistogram:()=>ColorHistogram$1,NeuQuant:()=>NeuQuant$1,NeuQuantFloat:()=>NeuQuantFloat$1,RGBQuant:()=>RGBQuant$1,WuColorCube:()=>WuColorCube$1,WuQuant:()=>WuQuant$1});var AbstractPaletteQuantizer$1=class{quantizeSync(){for(let t of this.quantize())if(t.palette)return t.palette;throw Error("unreachable")}},Point$1=class{constructor(){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),__publicField$3(this,"uint32"),__publicField$3(this,"rgba"),this.uint32=0xffffffff,this.r=this.g=this.b=this.a=0,this.rgba=[,,,,],this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(t){let r=new Point$1;return r.r=0|t[0],r.g=0|t[1],r.b=0|t[2],r.a=0|t[3],r._loadUINT32(),r._loadQuadruplet(),r}static createByRGBA(t,r,i,n){let a=new Point$1;return a.r=0|t,a.g=0|r,a.b=0|i,a.a=0|n,a._loadUINT32(),a._loadQuadruplet(),a}static createByUint32(t){let r=new Point$1;return r.uint32=t>>>0,r._loadRGBA(),r._loadQuadruplet(),r}from(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.uint32=t.uint32,this.rgba[0]=t.r,this.rgba[1]=t.g,this.rgba[2]=t.b,this.rgba[3]=t.a}getLuminosity(t){let r=this.r,i=this.g,n=this.b;return t&&(r=Math.min(255,255-this.a+this.a*r/255),i=Math.min(255,255-this.a+this.a*i/255),n=Math.min(255,255-this.a+this.a*n/255)),.2126*r+.7152*i+.0722*n}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer$1=class{constructor(){__publicField$3(this,"_pointArray"),__publicField$3(this,"_width"),__publicField$3(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(t){this._width=t}setHeight(t){this._height=t}getPointArray(){return this._pointArray}clone(){let t=new PointContainer$1;t._width=this._width,t._height=this._height;for(let r=0,i=this._pointArray.length;r<i;r++)t._pointArray[r]=Point$1.createByUint32(0|this._pointArray[r].uint32);return t}toUint32Array(){let t=this._pointArray.length,r=new Uint32Array(t);for(let i=0;i<t;i++)r[i]=this._pointArray[i].uint32;return r}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(t){let r=t.naturalWidth,i=t.naturalHeight,n=document.createElement("canvas");return n.width=r,n.height=i,n.getContext("2d").drawImage(t,0,0,r,i,0,0,r,i),PointContainer$1.fromHTMLCanvasElement(n)}static fromHTMLCanvasElement(t){let r=t.width,i=t.height,n=t.getContext("2d").getImageData(0,0,r,i);return PointContainer$1.fromImageData(n)}static fromImageData(t){let r=t.width,i=t.height;return PointContainer$1.fromUint8Array(t.data,r,i)}static fromUint8Array(t,r,i){switch(Object.prototype.toString.call(t)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:t=new Uint8Array(t)}let n=new Uint32Array(t.buffer);return PointContainer$1.fromUint32Array(n,r,i)}static fromUint32Array(t,r,i){let n=new PointContainer$1;n._width=r,n._height=i;for(let r=0,i=t.length;r<i;r++)n._pointArray[r]=Point$1.createByUint32(0|t[r]);return n}static fromBuffer(t,r,i){let n=new Uint32Array(t.buffer,t.byteOffset,t.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer$1.fromUint32Array(n,r,i)}},hueGroups$1=10;function hueGroup$1(t,r){let i=360/r;for(let n=1,a=i-i/2;n<r;n++,a+=i)if(t>=a&&t<a+i)return n;return 0}var Palette$1=class{constructor(){__publicField$3(this,"_pointContainer"),__publicField$3(this,"_pointArray",[]),__publicField$3(this,"_i32idx",{}),this._pointContainer=new PointContainer$1,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(t){this._pointArray.push(t),this._pointContainer.setWidth(this._pointArray.length)}has(t){for(let r=this._pointArray.length-1;r>=0;r--)if(t.uint32===this._pointArray[r].uint32)return!0;return!1}getNearestColor(t,r){return this._pointArray[0|this._getNearestIndex(t,r)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(t){return"number"==typeof this._i32idx[t]?this._i32idx[t]:-1}_getNearestIndex(t,r){let i=this._nearestPointFromCache(""+r.uint32);if(i>=0)return i;let n=Number.MAX_VALUE;i=0;for(let a=0,s=this._pointArray.length;a<s;a++){let s=this._pointArray[a],o=t.calculateRaw(r.r,r.g,r.b,r.a,s.r,s.g,s.b,s.a);o<n&&(n=o,i=a)}return this._i32idx[r.uint32]=i,i}sort(){this._i32idx={},this._pointArray.sort((t,r)=>{let i=rgb2hsl$1(t.r,t.g,t.b),n=rgb2hsl$1(r.r,r.g,r.b),a=t.r===t.g&&t.g===t.b?0:1+hueGroup$1(i.h,hueGroups$1),s=(r.r===r.g&&r.g===r.b?0:1+hueGroup$1(n.h,hueGroups$1))-a;if(s)return-s;let o=t.getLuminosity(!0),l=r.getLuminosity(!0);if(l-o!=0)return l-o;let u=(100*n.s|0)-(100*i.s|0);return u?-u:0})}},utils_exports$1={};__export$1(utils_exports$1,{HueStatistics:()=>HueStatistics$1,Palette:()=>Palette$1,Point:()=>Point$1,PointContainer:()=>PointContainer$1,ProgressTracker:()=>ProgressTracker$1,arithmetic:()=>arithmetic_exports$1});var HueGroup$1=class{constructor(){__publicField$3(this,"num",0),__publicField$3(this,"cols",[])}},HueStatistics$1=class{constructor(t,r){__publicField$3(this,"_numGroups"),__publicField$3(this,"_minCols"),__publicField$3(this,"_stats"),__publicField$3(this,"_groupsFull"),this._numGroups=t,this._minCols=r,this._stats=[];for(let r=0;r<=t;r++)this._stats[r]=new HueGroup$1;this._groupsFull=0}check(t){this._groupsFull===this._numGroups+1&&(this.check=()=>{});let r=255&t,i=t>>>8&255,n=t>>>16&255,a=r===i&&i===n?0:1+hueGroup$1(rgb2hsl$1(r,i,n).h,this._numGroups),s=this._stats[a],o=this._minCols;s.num++,s.num>o||(s.num===o&&this._groupsFull++,s.num<=o&&this._stats[a].cols.push(t))}injectIntoDictionary(t){for(let r=0;r<=this._numGroups;r++)this._stats[r].num<=this._minCols&&this._stats[r].cols.forEach(r=>{t[r]?t[r]++:t[r]=1})}injectIntoArray(t){for(let r=0;r<=this._numGroups;r++)this._stats[r].num<=this._minCols&&this._stats[r].cols.forEach(r=>{-1===t.indexOf(r)&&t.push(r)})}},_ProgressTracker$1=class{constructor(t,r){__publicField$3(this,"progress"),__publicField$3(this,"_step"),__publicField$3(this,"_range"),__publicField$3(this,"_last"),__publicField$3(this,"_progressRange"),this._range=t,this._progressRange=r,this._step=Math.max(1,this._range/(_ProgressTracker$1.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(t){return t-this._last>=this._step&&(this._last=t,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}},ProgressTracker$1=_ProgressTracker$1;__publicField$3(ProgressTracker$1,"steps",100);var networkBiasShift$1=3,Neuron$1=class{constructor(t){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),this.r=this.g=this.b=this.a=t}toPoint(){return Point$1.createByRGBA(this.r>>networkBiasShift$1,this.g>>networkBiasShift$1,this.b>>networkBiasShift$1,this.a>>networkBiasShift$1)}subtract(t,r,i,n){this.r-=0|t,this.g-=0|r,this.b-=0|i,this.a-=0|n}},_NeuQuant$1=class extends AbstractPaletteQuantizer$1{constructor(t,r=256){super(),__publicField$3(this,"_pointArray"),__publicField$3(this,"_networkSize"),__publicField$3(this,"_network"),__publicField$3(this,"_sampleFactor"),__publicField$3(this,"_radPower"),__publicField$3(this,"_freq"),__publicField$3(this,"_bias"),__publicField$3(this,"_distance"),this._distance=t,this._pointArray=[],this._sampleFactor=1,this._networkSize=r,this._distance.setWhitePoint(255<<networkBiasShift$1,255<<networkBiasShift$1,255<<networkBiasShift$1,255<<networkBiasShift$1)}sample(t){this._pointArray=this._pointArray.concat(t.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let t=0;t<this._networkSize;t++)this._network[t]=new Neuron$1((t<<networkBiasShift$1+8)/this._networkSize|0),this._freq[t]=_NeuQuant$1._initialBias/this._networkSize|0,this._bias[t]=0}*_learn(){let t=this._sampleFactor,r=this._pointArray.length;r<_NeuQuant$1._minpicturebytes&&(t=1);let i=30+(t-1)/3|0,n=r/t|0,a,s=n/_NeuQuant$1._nCycles|0,o=_NeuQuant$1._initAlpha,l=(this._networkSize>>3)*_NeuQuant$1._radiusBias,u=l>>_NeuQuant$1._radiusBiasShift;u<=1&&(u=0);for(let t=0;t<u;t++)this._radPower[t]=o*((u*u-t*t)*_NeuQuant$1._radBias/(u*u))>>>0;a=r<_NeuQuant$1._minpicturebytes?1:r%_NeuQuant$1._prime1!=0?_NeuQuant$1._prime1:r%_NeuQuant$1._prime2!=0?_NeuQuant$1._prime2:r%_NeuQuant$1._prime3!=0?_NeuQuant$1._prime3:_NeuQuant$1._prime4;let h=new ProgressTracker$1(n,99);for(let t=0,f=0;t<n;){h.shouldNotify(t)&&(yield{progress:h.progress});let n=this._pointArray[f],d=n.b<<networkBiasShift$1,c=n.g<<networkBiasShift$1,p=n.r<<networkBiasShift$1,m=n.a<<networkBiasShift$1,g=this._contest(d,c,p,m);if(this._alterSingle(o,g,d,c,p,m),0!==u&&this._alterNeighbour(u,g,d,c,p,m),(f+=a)>=r&&(f-=r),0===s&&(s=1),++t%s==0){o-=o/i|0,l-=l/_NeuQuant$1._radiusDecrease|0,u=l>>_NeuQuant$1._radiusBiasShift,u<=1&&(u=0);for(let t=0;t<u;t++)this._radPower[t]=o*((u*u-t*t)*_NeuQuant$1._radBias/(u*u))>>>0}}}_buildPalette(){let t=new Palette$1;return this._network.forEach(r=>{t.add(r.toPoint())}),t.sort(),t}_alterNeighbour(t,r,i,n,a,s){let o=r-t;o<-1&&(o=-1);let l=r+t;l>this._networkSize&&(l=this._networkSize);let u=r+1,h=r-1,f=1;for(;u<l||h>o;){let t=this._radPower[f++]/_NeuQuant$1._alphaRadBias;if(u<l){let r=this._network[u++];r.subtract(t*(r.r-a),t*(r.g-n),t*(r.b-i),t*(r.a-s))}if(h>o){let r=this._network[h--];r.subtract(t*(r.r-a),t*(r.g-n),t*(r.b-i),t*(r.a-s))}}}_alterSingle(t,r,i,n,a,s){t/=_NeuQuant$1._initAlpha;let o=this._network[r];o.subtract(t*(o.r-a),t*(o.g-n),t*(o.b-i),t*(o.a-s))}_contest(t,r,i,n){let a=1020<<networkBiasShift$1,s=0x7fffffff,o=0x7fffffff,l=-1,u=-1;for(let h=0;h<this._networkSize;h++){let f=this._network[h],d=this._distance.calculateNormalized(f,{r:i,g:r,b:t,a:n})*a|0;d<s&&(s=d,l=h);let c=d-(this._bias[h]>>_NeuQuant$1._initialBiasShift-networkBiasShift$1);c<o&&(o=c,u=h);let p=this._freq[h]>>_NeuQuant$1._betaShift;this._freq[h]-=p,this._bias[h]+=p<<_NeuQuant$1._gammaShift}return this._freq[l]+=_NeuQuant$1._beta,this._bias[l]-=_NeuQuant$1._betaGamma,u}},NeuQuant$1=_NeuQuant$1;__publicField$3(NeuQuant$1,"_prime1",499),__publicField$3(NeuQuant$1,"_prime2",491),__publicField$3(NeuQuant$1,"_prime3",487),__publicField$3(NeuQuant$1,"_prime4",503),__publicField$3(NeuQuant$1,"_minpicturebytes",_NeuQuant$1._prime4),__publicField$3(NeuQuant$1,"_nCycles",100),__publicField$3(NeuQuant$1,"_initialBiasShift",16),__publicField$3(NeuQuant$1,"_initialBias",1<<_NeuQuant$1._initialBiasShift),__publicField$3(NeuQuant$1,"_gammaShift",10),__publicField$3(NeuQuant$1,"_betaShift",10),__publicField$3(NeuQuant$1,"_beta",_NeuQuant$1._initialBias>>_NeuQuant$1._betaShift),__publicField$3(NeuQuant$1,"_betaGamma",_NeuQuant$1._initialBias<<_NeuQuant$1._gammaShift-_NeuQuant$1._betaShift),__publicField$3(NeuQuant$1,"_radiusBiasShift",6),__publicField$3(NeuQuant$1,"_radiusBias",1<<_NeuQuant$1._radiusBiasShift),__publicField$3(NeuQuant$1,"_radiusDecrease",30),__publicField$3(NeuQuant$1,"_alphaBiasShift",10),__publicField$3(NeuQuant$1,"_initAlpha",1<<_NeuQuant$1._alphaBiasShift),__publicField$3(NeuQuant$1,"_radBiasShift",8),__publicField$3(NeuQuant$1,"_radBias",1<<_NeuQuant$1._radBiasShift),__publicField$3(NeuQuant$1,"_alphaRadBiasShift",_NeuQuant$1._alphaBiasShift+_NeuQuant$1._radBiasShift),__publicField$3(NeuQuant$1,"_alphaRadBias",1<<_NeuQuant$1._alphaRadBiasShift);var networkBiasShift2$1=3,NeuronFloat$1=class{constructor(t){__publicField$3(this,"r"),__publicField$3(this,"g"),__publicField$3(this,"b"),__publicField$3(this,"a"),this.r=this.g=this.b=this.a=t}toPoint(){return Point$1.createByRGBA(this.r>>networkBiasShift2$1,this.g>>networkBiasShift2$1,this.b>>networkBiasShift2$1,this.a>>networkBiasShift2$1)}subtract(t,r,i,n){this.r-=t,this.g-=r,this.b-=i,this.a-=n}},_NeuQuantFloat$1=class extends AbstractPaletteQuantizer$1{constructor(t,r=256){super(),__publicField$3(this,"_pointArray"),__publicField$3(this,"_networkSize"),__publicField$3(this,"_network"),__publicField$3(this,"_sampleFactor"),__publicField$3(this,"_radPower"),__publicField$3(this,"_freq"),__publicField$3(this,"_bias"),__publicField$3(this,"_distance"),this._distance=t,this._pointArray=[],this._sampleFactor=1,this._networkSize=r,this._distance.setWhitePoint(255<<networkBiasShift2$1,255<<networkBiasShift2$1,255<<networkBiasShift2$1,255<<networkBiasShift2$1)}sample(t){this._pointArray=this._pointArray.concat(t.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let t=0;t<this._networkSize;t++)this._network[t]=new NeuronFloat$1((t<<networkBiasShift2$1+8)/this._networkSize),this._freq[t]=_NeuQuantFloat$1._initialBias/this._networkSize,this._bias[t]=0}*_learn(){let t=this._sampleFactor,r=this._pointArray.length;r<_NeuQuantFloat$1._minpicturebytes&&(t=1);let i=30+(t-1)/3,n=r/t,a,s=n/_NeuQuantFloat$1._nCycles|0,o=_NeuQuantFloat$1._initAlpha,l=(this._networkSize>>3)*_NeuQuantFloat$1._radiusBias,u=l>>_NeuQuantFloat$1._radiusBiasShift;u<=1&&(u=0);for(let t=0;t<u;t++)this._radPower[t]=o*((u*u-t*t)*_NeuQuantFloat$1._radBias/(u*u));a=r<_NeuQuantFloat$1._minpicturebytes?1:r%_NeuQuantFloat$1._prime1!=0?_NeuQuantFloat$1._prime1:r%_NeuQuantFloat$1._prime2!=0?_NeuQuantFloat$1._prime2:r%_NeuQuantFloat$1._prime3!=0?_NeuQuantFloat$1._prime3:_NeuQuantFloat$1._prime4;let h=new ProgressTracker$1(n,99);for(let t=0,f=0;t<n;){h.shouldNotify(t)&&(yield{progress:h.progress});let n=this._pointArray[f],d=n.b<<networkBiasShift2$1,c=n.g<<networkBiasShift2$1,p=n.r<<networkBiasShift2$1,m=n.a<<networkBiasShift2$1,g=this._contest(d,c,p,m);if(this._alterSingle(o,g,d,c,p,m),0!==u&&this._alterNeighbour(u,g,d,c,p,m),(f+=a)>=r&&(f-=r),0===s&&(s=1),++t%s==0){o-=o/i,l-=l/_NeuQuantFloat$1._radiusDecrease,u=l>>_NeuQuantFloat$1._radiusBiasShift,u<=1&&(u=0);for(let t=0;t<u;t++)this._radPower[t]=o*((u*u-t*t)*_NeuQuantFloat$1._radBias/(u*u))}}}_buildPalette(){let t=new Palette$1;return this._network.forEach(r=>{t.add(r.toPoint())}),t.sort(),t}_alterNeighbour(t,r,i,n,a,s){let o=r-t;o<-1&&(o=-1);let l=r+t;l>this._networkSize&&(l=this._networkSize);let u=r+1,h=r-1,f=1;for(;u<l||h>o;){let t=this._radPower[f++]/_NeuQuantFloat$1._alphaRadBias;if(u<l){let r=this._network[u++];r.subtract(t*(r.r-a),t*(r.g-n),t*(r.b-i),t*(r.a-s))}if(h>o){let r=this._network[h--];r.subtract(t*(r.r-a),t*(r.g-n),t*(r.b-i),t*(r.a-s))}}}_alterSingle(t,r,i,n,a,s){t/=_NeuQuantFloat$1._initAlpha;let o=this._network[r];o.subtract(t*(o.r-a),t*(o.g-n),t*(o.b-i),t*(o.a-s))}_contest(t,r,i,n){let a=1020<<networkBiasShift2$1,s=0x7fffffff,o=0x7fffffff,l=-1,u=-1;for(let h=0;h<this._networkSize;h++){let f=this._network[h],d=this._distance.calculateNormalized(f,{r:i,g:r,b:t,a:n})*a;d<s&&(s=d,l=h);let c=d-(this._bias[h]>>_NeuQuantFloat$1._initialBiasShift-networkBiasShift2$1);c<o&&(o=c,u=h);let p=this._freq[h]>>_NeuQuantFloat$1._betaShift;this._freq[h]-=p,this._bias[h]+=p<<_NeuQuantFloat$1._gammaShift}return this._freq[l]+=_NeuQuantFloat$1._beta,this._bias[l]-=_NeuQuantFloat$1._betaGamma,u}},NeuQuantFloat$1=_NeuQuantFloat$1;__publicField$3(NeuQuantFloat$1,"_prime1",499),__publicField$3(NeuQuantFloat$1,"_prime2",491),__publicField$3(NeuQuantFloat$1,"_prime3",487),__publicField$3(NeuQuantFloat$1,"_prime4",503),__publicField$3(NeuQuantFloat$1,"_minpicturebytes",_NeuQuantFloat$1._prime4),__publicField$3(NeuQuantFloat$1,"_nCycles",100),__publicField$3(NeuQuantFloat$1,"_initialBiasShift",16),__publicField$3(NeuQuantFloat$1,"_initialBias",1<<_NeuQuantFloat$1._initialBiasShift),__publicField$3(NeuQuantFloat$1,"_gammaShift",10),__publicField$3(NeuQuantFloat$1,"_betaShift",10),__publicField$3(NeuQuantFloat$1,"_beta",_NeuQuantFloat$1._initialBias>>_NeuQuantFloat$1._betaShift),__publicField$3(NeuQuantFloat$1,"_betaGamma",_NeuQuantFloat$1._initialBias<<_NeuQuantFloat$1._gammaShift-_NeuQuantFloat$1._betaShift),__publicField$3(NeuQuantFloat$1,"_radiusBiasShift",6),__publicField$3(NeuQuantFloat$1,"_radiusBias",1<<_NeuQuantFloat$1._radiusBiasShift),__publicField$3(NeuQuantFloat$1,"_radiusDecrease",30),__publicField$3(NeuQuantFloat$1,"_alphaBiasShift",10),__publicField$3(NeuQuantFloat$1,"_initAlpha",1<<_NeuQuantFloat$1._alphaBiasShift),__publicField$3(NeuQuantFloat$1,"_radBiasShift",8),__publicField$3(NeuQuantFloat$1,"_radBias",1<<_NeuQuantFloat$1._radBiasShift),__publicField$3(NeuQuantFloat$1,"_alphaRadBiasShift",_NeuQuantFloat$1._alphaBiasShift+_NeuQuantFloat$1._radBiasShift),__publicField$3(NeuQuantFloat$1,"_alphaRadBias",1<<_NeuQuantFloat$1._alphaRadBiasShift);var _ColorHistogram$1=class{constructor(t,r){__publicField$3(this,"_method"),__publicField$3(this,"_hueStats"),__publicField$3(this,"_histogram"),__publicField$3(this,"_initColors"),__publicField$3(this,"_minHueCols"),this._method=t,this._minHueCols=r<<2,this._initColors=r<<2,this._hueStats=new HueStatistics$1(_ColorHistogram$1._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(t){switch(this._method){case 1:this._colorStats1D(t);break;case 2:this._colorStats2D(t)}}getImportanceSortedColorsIDXI32(){let t,r=stableSort$1(Object.keys(this._histogram),(t,r)=>this._histogram[r]-this._histogram[t]);if(0===r.length)return[];switch(this._method){case 1:let i=Math.min(r.length,this._initColors),n=r[i-1],a=this._histogram[n];t=r.slice(0,i);let s=i,o=r.length;for(;s<o&&this._histogram[r[s]]===a;)t.push(r[s++]);this._hueStats.injectIntoArray(t);break;case 2:t=r;break;default:throw Error("Incorrect method")}return t.map(t=>+t)}_colorStats1D(t){let r=this._histogram,i=t.getPointArray(),n=i.length;for(let t=0;t<n;t++){let n=i[t].uint32;this._hueStats.check(n),n in r?r[n]++:r[n]=1}}_colorStats2D(t){let r=t.getWidth(),i=t.getHeight(),n=t.getPointArray(),a=_ColorHistogram$1._boxSize[0],s=_ColorHistogram$1._boxSize[1],o=a*s,l=this._makeBoxes(r,i,a,s),u=this._histogram;l.forEach(t=>{let i=Math.round(t.w*t.h/o)*_ColorHistogram$1._boxPixels;i<2&&(i=2);let a={};this._iterateBox(t,r,t=>{let r=n[t].uint32;this._hueStats.check(r),r in u?u[r]++:r in a?++a[r]>=i&&(u[r]=a[r]):a[r]=1})}),this._hueStats.injectIntoDictionary(u)}_iterateBox(t,r,i){let n=t,a=n.y*r+n.x,s=(n.y+n.h-1)*r+(n.x+n.w-1),o=r-n.w+1,l=0,u=a;do i.call(this,u),u+=++l%n.w==0?o:1;while(u<=s)}_makeBoxes(t,r,i,n){let a=t%i,s=r%n,o=t-a,l=r-s,u=[];for(let h=0;h<r;h+=n)for(let r=0;r<t;r+=i)u.push({x:r,y:h,w:r===o?a:i,h:h===l?s:n});return u}},ColorHistogram$1=_ColorHistogram$1;__publicField$3(ColorHistogram$1,"_boxSize",[64,64]),__publicField$3(ColorHistogram$1,"_boxPixels",2),__publicField$3(ColorHistogram$1,"_hueGroups",10);var RemovedColor$1=class{constructor(t,r,i){__publicField$3(this,"index"),__publicField$3(this,"color"),__publicField$3(this,"distance"),this.index=t,this.color=r,this.distance=i}},RGBQuant$1=class extends AbstractPaletteQuantizer$1{constructor(t,r=256,i=2){super(),__publicField$3(this,"_colors"),__publicField$3(this,"_initialDistance"),__publicField$3(this,"_distanceIncrement"),__publicField$3(this,"_histogram"),__publicField$3(this,"_distance"),this._distance=t,this._colors=r,this._histogram=new ColorHistogram$1(i,r),this._initialDistance=.01,this._distanceIncrement=.005}sample(t){this._histogram.sample(t)}*quantize(){let t=this._histogram.getImportanceSortedColorsIDXI32();if(0===t.length)throw Error("No colors in image");yield*this._buildPalette(t)}*_buildPalette(t){let r=new Palette$1,i=r.getPointContainer().getPointArray(),n=Array(t.length);for(let r=0;r<t.length;r++)i.push(Point$1.createByUint32(t[r])),n[r]=1;let a=i.length,s=[],o=a,l=this._initialDistance,u=new ProgressTracker$1(o-this._colors,99);for(;o>this._colors;){s.length=0;for(let t=0;t<a;t++){if(u.shouldNotify(a-o)&&(yield{progress:u.progress}),0===n[t])continue;let r=i[t];for(let u=t+1;u<a;u++){if(0===n[u])continue;let t=i[u],a=this._distance.calculateNormalized(r,t);a<l&&(s.push(new RemovedColor$1(u,t,a)),n[u]=0,o--)}}l+=o>3*this._colors?this._initialDistance:this._distanceIncrement}if(o<this._colors){stableSort$1(s,(t,r)=>r.distance-t.distance);let t=0;for(;o<this._colors&&t<s.length;)n[s[t].index]=1,o++,t++}let h=i.length;for(let t=h-1;t>=0;t--)0===n[t]&&(t!==h-1&&(i[t]=i[h-1]),--h);i.length=h,r.sort(),yield{palette:r,progress:100}}};function createArray1D$1(t){let r=[];for(let i=0;i<t;i++)r[i]=0;return r}function createArray4D$1(t,r,i,n){let a=Array(t);for(let s=0;s<t;s++){a[s]=Array(r);for(let t=0;t<r;t++){a[s][t]=Array(i);for(let r=0;r<i;r++){a[s][t][r]=Array(n);for(let i=0;i<n;i++)a[s][t][r][i]=0}}}return a}function createArray3D$1(t,r,i){let n=Array(t);for(let a=0;a<t;a++){n[a]=Array(r);for(let t=0;t<r;t++){n[a][t]=Array(i);for(let r=0;r<i;r++)n[a][t][r]=0}}return n}function fillArray3D$1(t,r,i,n,a){for(let s=0;s<r;s++){t[s]=[];for(let r=0;r<i;r++){t[s][r]=[];for(let i=0;i<n;i++)t[s][r][i]=a}}}function fillArray1D$1(t,r,i){for(let n=0;n<r;n++)t[n]=i}var WuColorCube$1=class{constructor(){__publicField$3(this,"redMinimum"),__publicField$3(this,"redMaximum"),__publicField$3(this,"greenMinimum"),__publicField$3(this,"greenMaximum"),__publicField$3(this,"blueMinimum"),__publicField$3(this,"blueMaximum"),__publicField$3(this,"volume"),__publicField$3(this,"alphaMinimum"),__publicField$3(this,"alphaMaximum")}},_WuQuant$1=class extends AbstractPaletteQuantizer$1{constructor(t,r=256,i=5){super(),__publicField$3(this,"_reds"),__publicField$3(this,"_greens"),__publicField$3(this,"_blues"),__publicField$3(this,"_alphas"),__publicField$3(this,"_sums"),__publicField$3(this,"_weights"),__publicField$3(this,"_momentsRed"),__publicField$3(this,"_momentsGreen"),__publicField$3(this,"_momentsBlue"),__publicField$3(this,"_momentsAlpha"),__publicField$3(this,"_moments"),__publicField$3(this,"_table"),__publicField$3(this,"_pixels"),__publicField$3(this,"_cubes"),__publicField$3(this,"_colors"),__publicField$3(this,"_significantBitsPerChannel"),__publicField$3(this,"_maxSideIndex"),__publicField$3(this,"_alphaMaxSideIndex"),__publicField$3(this,"_sideSize"),__publicField$3(this,"_alphaSideSize"),__publicField$3(this,"_distance"),this._distance=t,this._setQuality(i),this._initialize(r)}sample(t){let r=t.getPointArray();for(let t=0,i=r.length;t<i;t++)this._addColor(r[t]);this._pixels=this._pixels.concat(r)}*quantize(){yield*this._preparePalette();let t=new Palette$1;for(let r=0;r<this._colors;r++)if(this._sums[r]>0){let i=this._sums[r],n=this._reds[r]/i,a=this._greens[r]/i,s=this._blues[r]/i,o=this._alphas[r]/i,l=Point$1.createByRGBA(0|n,0|a,0|s,0|o);t.add(l)}t.sort(),yield{palette:t,progress:100}}*_preparePalette(){yield*this._calculateMoments();let t=0,r=createArray1D$1(this._colors);for(let i=1;i<this._colors;++i){this._cut(this._cubes[t],this._cubes[i])?(r[t]=this._cubes[t].volume>1?this._calculateVariance(this._cubes[t]):0,r[i]=this._cubes[i].volume>1?this._calculateVariance(this._cubes[i]):0):(r[t]=0,i--),t=0;let n=r[0];for(let a=1;a<=i;++a)r[a]>n&&(n=r[a],t=a);if(n<=0){this._colors=i+1;break}}let i=[],n=[],a=[],s=[];for(let t=0;t<this._colors;++t){let r=_WuQuant$1._volume(this._cubes[t],this._weights);r>0?(i[t]=_WuQuant$1._volume(this._cubes[t],this._momentsRed)/r|0,n[t]=_WuQuant$1._volume(this._cubes[t],this._momentsGreen)/r|0,a[t]=_WuQuant$1._volume(this._cubes[t],this._momentsBlue)/r|0,s[t]=_WuQuant$1._volume(this._cubes[t],this._momentsAlpha)/r|0):(i[t]=0,n[t]=0,a[t]=0,s[t]=0)}this._reds=createArray1D$1(this._colors+1),this._greens=createArray1D$1(this._colors+1),this._blues=createArray1D$1(this._colors+1),this._alphas=createArray1D$1(this._colors+1),this._sums=createArray1D$1(this._colors+1);for(let t=0,r=this._pixels.length;t<r;t++){let r=this._pixels[t],o=-1,l=Number.MAX_VALUE;for(let t=0;t<this._colors;t++){let u=i[t],h=n[t],f=a[t],d=s[t],c=this._distance.calculateRaw(u,h,f,d,r.r,r.g,r.b,r.a);c<l&&(l=c,o=t)}this._reds[o]+=r.r,this._greens[o]+=r.g,this._blues[o]+=r.b,this._alphas[o]+=r.a,this._sums[o]++}}_addColor(t){let r=8-this._significantBitsPerChannel,i=1+(t.r>>r),n=1+(t.g>>r),a=1+(t.b>>r),s=1+(t.a>>r);this._weights[s][i][n][a]++,this._momentsRed[s][i][n][a]+=t.r,this._momentsGreen[s][i][n][a]+=t.g,this._momentsBlue[s][i][n][a]+=t.b,this._momentsAlpha[s][i][n][a]+=t.a,this._moments[s][i][n][a]+=this._table[t.r]+this._table[t.g]+this._table[t.b]+this._table[t.a]}*_calculateMoments(){let t=[],r=[],i=[],n=[],a=[],s=[],o=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),l=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),u=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),h=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),f=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),d=createArray3D$1(this._sideSize,this._sideSize,this._sideSize),c=0,p=new ProgressTracker$1(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let m=1;m<=this._alphaMaxSideIndex;++m){fillArray3D$1(o,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(l,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(u,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(h,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(f,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D$1(d,this._sideSize,this._sideSize,this._sideSize,0);for(let g=1;g<=this._maxSideIndex;++g,++c){p.shouldNotify(c)&&(yield{progress:p.progress}),fillArray1D$1(t,this._sideSize,0),fillArray1D$1(r,this._sideSize,0),fillArray1D$1(i,this._sideSize,0),fillArray1D$1(n,this._sideSize,0),fillArray1D$1(a,this._sideSize,0),fillArray1D$1(s,this._sideSize,0);for(let c=1;c<=this._maxSideIndex;++c){let p=0,_=0,b=0,y=0,v=0,w=0;for(let x=1;x<=this._maxSideIndex;++x)p+=this._weights[m][g][c][x],_+=this._momentsRed[m][g][c][x],b+=this._momentsGreen[m][g][c][x],y+=this._momentsBlue[m][g][c][x],v+=this._momentsAlpha[m][g][c][x],w+=this._moments[m][g][c][x],t[x]+=p,r[x]+=_,i[x]+=b,n[x]+=y,a[x]+=v,s[x]+=w,o[g][c][x]=o[g-1][c][x]+t[x],l[g][c][x]=l[g-1][c][x]+r[x],u[g][c][x]=u[g-1][c][x]+i[x],h[g][c][x]=h[g-1][c][x]+n[x],f[g][c][x]=f[g-1][c][x]+a[x],d[g][c][x]=d[g-1][c][x]+s[x],this._weights[m][g][c][x]=this._weights[m-1][g][c][x]+o[g][c][x],this._momentsRed[m][g][c][x]=this._momentsRed[m-1][g][c][x]+l[g][c][x],this._momentsGreen[m][g][c][x]=this._momentsGreen[m-1][g][c][x]+u[g][c][x],this._momentsBlue[m][g][c][x]=this._momentsBlue[m-1][g][c][x]+h[g][c][x],this._momentsAlpha[m][g][c][x]=this._momentsAlpha[m-1][g][c][x]+f[g][c][x],this._moments[m][g][c][x]=this._moments[m-1][g][c][x]+d[g][c][x]}}}}static _volumeFloat(t,r){return r[t.alphaMaximum][t.redMaximum][t.greenMaximum][t.blueMaximum]-r[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMaximum]-r[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMaximum]+r[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMaximum]-r[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMaximum]+r[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMaximum]+r[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMaximum]-r[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(r[t.alphaMaximum][t.redMaximum][t.greenMaximum][t.blueMinimum]-r[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMinimum]-r[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMinimum]+r[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]-r[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMinimum]+r[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]+r[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]-r[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum])}static _volume(t,r){return 0|_WuQuant$1._volumeFloat(t,r)}static _top(t,r,i,n){let a;switch(r){case _WuQuant$1._alpha:a=n[i][t.redMaximum][t.greenMaximum][t.blueMaximum]-n[i][t.redMaximum][t.greenMinimum][t.blueMaximum]-n[i][t.redMinimum][t.greenMaximum][t.blueMaximum]+n[i][t.redMinimum][t.greenMinimum][t.blueMaximum]-(n[i][t.redMaximum][t.greenMaximum][t.blueMinimum]-n[i][t.redMaximum][t.greenMinimum][t.blueMinimum]-n[i][t.redMinimum][t.greenMaximum][t.blueMinimum]+n[i][t.redMinimum][t.greenMinimum][t.blueMinimum]);break;case _WuQuant$1._red:a=n[t.alphaMaximum][i][t.greenMaximum][t.blueMaximum]-n[t.alphaMaximum][i][t.greenMinimum][t.blueMaximum]-n[t.alphaMinimum][i][t.greenMaximum][t.blueMaximum]+n[t.alphaMinimum][i][t.greenMinimum][t.blueMaximum]-(n[t.alphaMaximum][i][t.greenMaximum][t.blueMinimum]-n[t.alphaMaximum][i][t.greenMinimum][t.blueMinimum]-n[t.alphaMinimum][i][t.greenMaximum][t.blueMinimum]+n[t.alphaMinimum][i][t.greenMinimum][t.blueMinimum]);break;case _WuQuant$1._green:a=n[t.alphaMaximum][t.redMaximum][i][t.blueMaximum]-n[t.alphaMaximum][t.redMinimum][i][t.blueMaximum]-n[t.alphaMinimum][t.redMaximum][i][t.blueMaximum]+n[t.alphaMinimum][t.redMinimum][i][t.blueMaximum]-(n[t.alphaMaximum][t.redMaximum][i][t.blueMinimum]-n[t.alphaMaximum][t.redMinimum][i][t.blueMinimum]-n[t.alphaMinimum][t.redMaximum][i][t.blueMinimum]+n[t.alphaMinimum][t.redMinimum][i][t.blueMinimum]);break;case _WuQuant$1._blue:a=n[t.alphaMaximum][t.redMaximum][t.greenMaximum][i]-n[t.alphaMaximum][t.redMaximum][t.greenMinimum][i]-n[t.alphaMaximum][t.redMinimum][t.greenMaximum][i]+n[t.alphaMaximum][t.redMinimum][t.greenMinimum][i]-(n[t.alphaMinimum][t.redMaximum][t.greenMaximum][i]-n[t.alphaMinimum][t.redMaximum][t.greenMinimum][i]-n[t.alphaMinimum][t.redMinimum][t.greenMaximum][i]+n[t.alphaMinimum][t.redMinimum][t.greenMinimum][i]);break;default:throw Error("impossible")}return 0|a}static _bottom(t,r,i){switch(r){case _WuQuant$1._alpha:return-i[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMaximum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMaximum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMaximum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(-i[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMinimum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);case _WuQuant$1._red:return-i[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMaximum]+i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMaximum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMaximum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(-i[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMinimum]+i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);case _WuQuant$1._green:return-i[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMaximum]+i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMaximum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMaximum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(-i[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMinimum]+i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);case _WuQuant$1._blue:return-i[t.alphaMaximum][t.redMaximum][t.greenMaximum][t.blueMinimum]+i[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMinimum]+i[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMinimum]-i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]-(-i[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMinimum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);default:return 0}}_calculateVariance(t){let r=_WuQuant$1._volume(t,this._momentsRed),i=_WuQuant$1._volume(t,this._momentsGreen),n=_WuQuant$1._volume(t,this._momentsBlue),a=_WuQuant$1._volume(t,this._momentsAlpha);return _WuQuant$1._volumeFloat(t,this._moments)-(r*r+i*i+n*n+a*a)/_WuQuant$1._volume(t,this._weights)}_maximize(t,r,i,n,a,s,o,l,u){let h=0|_WuQuant$1._bottom(t,r,this._momentsRed),f=0|_WuQuant$1._bottom(t,r,this._momentsGreen),d=0|_WuQuant$1._bottom(t,r,this._momentsBlue),c=0|_WuQuant$1._bottom(t,r,this._momentsAlpha),p=0|_WuQuant$1._bottom(t,r,this._weights),m=0,g=-1;for(let _=i;_<n;++_){let i=h+_WuQuant$1._top(t,r,_,this._momentsRed),n=f+_WuQuant$1._top(t,r,_,this._momentsGreen),b=d+_WuQuant$1._top(t,r,_,this._momentsBlue),y=c+_WuQuant$1._top(t,r,_,this._momentsAlpha),v=p+_WuQuant$1._top(t,r,_,this._weights);if(0!==v){let t=i*i+n*n+b*b+y*y,r=t/v;i=a-i,n=s-n,b=o-b,y=l-y,0!=(v=u-v)&&(r+=(t=i*i+n*n+b*b+y*y)/v)>m&&(m=r,g=_)}}return{max:m,position:g}}_cut(t,r){let i,n=_WuQuant$1._volume(t,this._momentsRed),a=_WuQuant$1._volume(t,this._momentsGreen),s=_WuQuant$1._volume(t,this._momentsBlue),o=_WuQuant$1._volume(t,this._momentsAlpha),l=_WuQuant$1._volume(t,this._weights),u=this._maximize(t,_WuQuant$1._red,t.redMinimum+1,t.redMaximum,n,a,s,o,l),h=this._maximize(t,_WuQuant$1._green,t.greenMinimum+1,t.greenMaximum,n,a,s,o,l),f=this._maximize(t,_WuQuant$1._blue,t.blueMinimum+1,t.blueMaximum,n,a,s,o,l),d=this._maximize(t,_WuQuant$1._alpha,t.alphaMinimum+1,t.alphaMaximum,n,a,s,o,l);if(d.max>=u.max&&d.max>=h.max&&d.max>=f.max){if(i=_WuQuant$1._alpha,d.position<0)return!1}else i=u.max>=d.max&&u.max>=h.max&&u.max>=f.max?_WuQuant$1._red:h.max>=d.max&&h.max>=u.max&&h.max>=f.max?_WuQuant$1._green:_WuQuant$1._blue;switch(r.redMaximum=t.redMaximum,r.greenMaximum=t.greenMaximum,r.blueMaximum=t.blueMaximum,r.alphaMaximum=t.alphaMaximum,i){case _WuQuant$1._red:r.redMinimum=t.redMaximum=u.position,r.greenMinimum=t.greenMinimum,r.blueMinimum=t.blueMinimum,r.alphaMinimum=t.alphaMinimum;break;case _WuQuant$1._green:r.greenMinimum=t.greenMaximum=h.position,r.redMinimum=t.redMinimum,r.blueMinimum=t.blueMinimum,r.alphaMinimum=t.alphaMinimum;break;case _WuQuant$1._blue:r.blueMinimum=t.blueMaximum=f.position,r.redMinimum=t.redMinimum,r.greenMinimum=t.greenMinimum,r.alphaMinimum=t.alphaMinimum;break;case _WuQuant$1._alpha:r.alphaMinimum=t.alphaMaximum=d.position,r.blueMinimum=t.blueMinimum,r.redMinimum=t.redMinimum,r.greenMinimum=t.greenMinimum}return t.volume=(t.redMaximum-t.redMinimum)*(t.greenMaximum-t.greenMinimum)*(t.blueMaximum-t.blueMinimum)*(t.alphaMaximum-t.alphaMinimum),r.volume=(r.redMaximum-r.redMinimum)*(r.greenMaximum-r.greenMinimum)*(r.blueMaximum-r.blueMinimum)*(r.alphaMaximum-r.alphaMinimum),!0}_initialize(t){this._colors=t,this._cubes=[];for(let r=0;r<t;r++)this._cubes[r]=new WuColorCube$1;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D$1(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let t=0;t<256;++t)this._table[t]=t*t;this._pixels=[]}_setQuality(t=5){this._significantBitsPerChannel=t,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant$1=_WuQuant$1;__publicField$3(WuQuant$1,"_alpha",3),__publicField$3(WuQuant$1,"_red",2),__publicField$3(WuQuant$1,"_green",1),__publicField$3(WuQuant$1,"_blue",0);var image_exports$1={};__export$1(image_exports$1,{AbstractImageQuantizer:()=>AbstractImageQuantizer$1,ErrorDiffusionArray:()=>ErrorDiffusionArray$1,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel$1,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma$1,NearestColor:()=>NearestColor$1});var AbstractImageQuantizer$1=class{quantizeSync(t,r){for(let i of this.quantize(t,r))if(i.pointContainer)return i.pointContainer;throw Error("unreachable")}},NearestColor$1=class extends AbstractImageQuantizer$1{constructor(t){super(),__publicField$3(this,"_distance"),this._distance=t}*quantize(t,r){let i=t.getPointArray(),n=t.getWidth(),a=t.getHeight(),s=new ProgressTracker$1(a,99);for(let t=0;t<a;t++){s.shouldNotify(t)&&(yield{progress:s.progress});for(let a=0,s=t*n;a<n;a++,s++){let t=i[s];t.from(r.getNearestColor(this._distance,t))}}yield{pointContainer:t,progress:100}}},ErrorDiffusionArrayKernel$1=(t=>(t[t.FloydSteinberg=0]="FloydSteinberg",t[t.FalseFloydSteinberg=1]="FalseFloydSteinberg",t[t.Stucki=2]="Stucki",t[t.Atkinson=3]="Atkinson",t[t.Jarvis=4]="Jarvis",t[t.Burkes=5]="Burkes",t[t.Sierra=6]="Sierra",t[t.TwoSierra=7]="TwoSierra",t[t.SierraLite=8]="SierraLite",t))(ErrorDiffusionArrayKernel$1||{}),ErrorDiffusionArray$1=class extends AbstractImageQuantizer$1{constructor(t,r,i=!0,n=0,a=!1){super(),__publicField$3(this,"_minColorDistance"),__publicField$3(this,"_serpentine"),__publicField$3(this,"_kernel"),__publicField$3(this,"_calculateErrorLikeGIMP"),__publicField$3(this,"_distance"),this._setKernel(r),this._distance=t,this._minColorDistance=n,this._serpentine=i,this._calculateErrorLikeGIMP=a}*quantize(t,r){let i=t.getPointArray(),n=new Point$1,a=t.getWidth(),s=t.getHeight(),o=[],l=1,u=1;for(let t of this._kernel){let r=t[2]+1;u<r&&(u=r)}for(let t=0;t<u;t++)this._fillErrorLine(o[t]=[],a);let h=new ProgressTracker$1(s,99);for(let t=0;t<s;t++){h.shouldNotify(t)&&(yield{progress:h.progress}),this._serpentine&&(l*=-1);let u=t*a,f=1===l?0:a-1,d=1===l?a:-1;this._fillErrorLine(o[0],a),o.push(o.shift());let c=o[0];for(let h=f,p=u+f;h!==d;h+=l,p+=l){let u,f,d,m,g=i[p],_=c[h];n.from(g);let b=Point$1.createByRGBA(inRange0to255Rounded$1(g.r+_[0]),inRange0to255Rounded$1(g.g+_[1]),inRange0to255Rounded$1(g.b+_[2]),inRange0to255Rounded$1(g.a+_[3])),y=r.getNearestColor(this._distance,b);if(g.from(y),this._minColorDistance&&this._distance.calculateNormalized(n,y)<this._minColorDistance)continue;this._calculateErrorLikeGIMP?(u=b.r-y.r,f=b.g-y.g,d=b.b-y.b,m=b.a-y.a):(u=n.r-y.r,f=n.g-y.g,d=n.b-y.b,m=n.a-y.a);let v=1===l?0:this._kernel.length-1,w=1===l?this._kernel.length:-1;for(let r=v;r!==w;r+=l){let i=this._kernel[r][1]*l,n=this._kernel[r][2];if(i+h>=0&&i+h<a&&n+t>=0&&n+t<s){let t=this._kernel[r][0],a=o[n][i+h];a[0]+=u*t,a[1]+=f*t,a[2]+=d*t,a[3]+=m*t}}}}yield{pointContainer:t,progress:100}}_fillErrorLine(t,r){t.length>r&&(t.length=r);let i=t.length;for(let r=0;r<i;r++){let i=t[r];i[0]=i[1]=i[2]=i[3]=0}for(let n=i;n<r;n++)t[n]=[0,0,0,0]}_setKernel(t){switch(t){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[.25,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[.25,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[.5,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw Error(`ErrorDiffusionArray: unknown kernel = ${t}`)}}};function*hilbertCurve$1(t,r,i){let n=Math.max(t,r),a={width:t,height:r,level:Math.floor(Math.log(n)/Math.log(2)+1),callback:i,tracker:new ProgressTracker$1(t*r,99),index:0,x:0,y:0};yield*walkHilbert$1(a,1),visit$1(a,0)}function*walkHilbert$1(t,r){if(!(t.level<1)){switch(t.tracker.shouldNotify(t.index)&&(yield{progress:t.tracker.progress}),t.level--,r){case 2:yield*walkHilbert$1(t,1),visit$1(t,3),yield*walkHilbert$1(t,2),visit$1(t,4),yield*walkHilbert$1(t,2),visit$1(t,2),yield*walkHilbert$1(t,4);break;case 3:yield*walkHilbert$1(t,4),visit$1(t,2),yield*walkHilbert$1(t,3),visit$1(t,1),yield*walkHilbert$1(t,3),visit$1(t,3),yield*walkHilbert$1(t,1);break;case 1:yield*walkHilbert$1(t,2),visit$1(t,4),yield*walkHilbert$1(t,1),visit$1(t,3),yield*walkHilbert$1(t,1),visit$1(t,1),yield*walkHilbert$1(t,3);break;case 4:yield*walkHilbert$1(t,3),visit$1(t,1),yield*walkHilbert$1(t,4),visit$1(t,2),yield*walkHilbert$1(t,4),visit$1(t,4),yield*walkHilbert$1(t,2)}t.level++}}function visit$1(t,r){switch(t.x>=0&&t.x<t.width&&t.y>=0&&t.y<t.height&&(t.callback(t.x,t.y),t.index++),r){case 2:t.x--;break;case 3:t.x++;break;case 1:t.y--;break;case 4:t.y++}}var ErrorDiffusionRiemersma$1=class extends AbstractImageQuantizer$1{constructor(t,r=16,i=1){super(),__publicField$3(this,"_distance"),__publicField$3(this,"_weights"),__publicField$3(this,"_errorQueueSize"),this._distance=t,this._errorQueueSize=r,this._weights=ErrorDiffusionRiemersma$1._createWeights(i,r)}*quantize(t,r){let i=t.getPointArray(),n=t.getWidth(),a=t.getHeight(),s=[],o=0;for(let t=0;t<this._errorQueueSize;t++)s[t]={r:0,g:0,b:0,a:0};yield*hilbertCurve$1(n,a,(t,a)=>{let l=i[t+a*n],{r:u,g:h,b:f,a:d}=l;for(let t=0;t<this._errorQueueSize;t++){let r=this._weights[t],i=s[(t+o)%this._errorQueueSize];u+=i.r*r,h+=i.g*r,f+=i.b*r,d+=i.a*r}let c=Point$1.createByRGBA(inRange0to255Rounded$1(u),inRange0to255Rounded$1(h),inRange0to255Rounded$1(f),inRange0to255Rounded$1(d)),p=r.getNearestColor(this._distance,c),m=((o=(o+1)%this._errorQueueSize)+this._errorQueueSize-1)%this._errorQueueSize;s[m].r=l.r-p.r,s[m].g=l.g-p.g,s[m].b=l.b-p.b,s[m].a=l.a-p.a,l.from(p)}),yield{pointContainer:t,progress:100}}static _createWeights(t,r){let i=[],n=Math.exp(Math.log(r)/(r-1));for(let a=0,s=1;a<r;a++)i[a]=(s+.5|0)/r*t,s*=n;return i}},quality_exports$1={};__export$1(quality_exports$1,{ssim:()=>ssim$1});var K1$1=.01,K2$1=.03;function ssim$1(t,r){if(t.getHeight()!==r.getHeight()||t.getWidth()!==r.getWidth())throw Error("Images have different sizes!");let i=(255*K1$1)**2,n=(255*K2$1)**2,a=0,s=0;return iterate$1(t,r,(t,r,o,l)=>{let u=0,h=0,f=0;for(let i=0;i<t.length;i++)h+=(t[i]-o)**2,f+=(r[i]-l)**2,u+=(t[i]-o)*(r[i]-l);let d=t.length-1;h/=d,f/=d,u/=d,s+=(2*o*l+i)*(2*u+n)/((o**2+l**2+i)*(h+f+n)),a++}),s/a}function iterate$1(t,r,i){let n=t.getWidth(),a=t.getHeight();for(let s=0;s<a;s+=8)for(let o=0;o<n;o+=8){let l=Math.min(8,n-o),u=Math.min(8,a-s),h=calculateLumaValuesForWindow$1(t,o,s,l,u),f=calculateLumaValuesForWindow$1(r,o,s,l,u);i(h,f,calculateAverageLuma$1(h),calculateAverageLuma$1(f))}}function calculateLumaValuesForWindow$1(t,r,i,n,a){let s=t.getPointArray(),o=[],l=0;for(let u=i;u<i+a;u++){let i=u*t.getWidth();for(let t=r;t<r+n;t++){let r=s[i+t];o[l]=.2126*r.r+.7152*r.g+.0722*r.b,l++}}return o}function calculateAverageLuma$1(t){let r=0;for(let i of t)r+=i;return r/t.length}var setImmediateImpl="function"==typeof setImmediate?setImmediate:void 0!==__TURBOPACK__imported__module__47167__.default&&"function"==typeof(null==__TURBOPACK__imported__module__47167__.default?void 0:__TURBOPACK__imported__module__47167__.default.nextTick)?t=>__TURBOPACK__imported__module__47167__.default.nextTick(t):t=>setTimeout(t,0);function buildPaletteSync$1(t,{colorDistanceFormula:r,paletteQuantization:i,colors:n}={}){let a=paletteQuantizationToPaletteQuantizer$1(colorDistanceFormulaToColorDistance$1(r),i,n);return t.forEach(t=>a.sample(t)),a.quantizeSync()}async function buildPalette(t,{colorDistanceFormula:r,paletteQuantization:i,colors:n,onProgress:a}={}){return new Promise((s,o)=>{let l,u=paletteQuantizationToPaletteQuantizer$1(colorDistanceFormulaToColorDistance$1(r),i,n);t.forEach(t=>u.sample(t));let h=u.quantize(),f=()=>{try{let t=h.next();t.done?s(l):(t.value.palette&&(l=t.value.palette),a&&a(t.value.progress),setImmediateImpl(f))}catch(t){o(t)}};setImmediateImpl(f)})}function applyPaletteSync$1(t,r,{colorDistanceFormula:i,imageQuantization:n}={}){return imageQuantizationToImageQuantizer$1(colorDistanceFormulaToColorDistance$1(i),n).quantizeSync(t,r)}async function applyPalette(t,r,{colorDistanceFormula:i,imageQuantization:n,onProgress:a}={}){return new Promise((s,o)=>{let l,u=imageQuantizationToImageQuantizer$1(colorDistanceFormulaToColorDistance$1(i),n).quantize(t,r),h=()=>{try{let t=u.next();t.done?s(l):(t.value.pointContainer&&(l=t.value.pointContainer),a&&a(t.value.progress),setImmediateImpl(h))}catch(t){o(t)}};setImmediateImpl(h)})}function colorDistanceFormulaToColorDistance$1(t="euclidean-bt709"){switch(t){case"cie94-graphic-arts":return new CIE94GraphicArts$1;case"cie94-textiles":return new CIE94Textiles$1;case"ciede2000":return new CIEDE2000$1;case"color-metric":return new CMetric$1;case"euclidean":return new Euclidean$1;case"euclidean-bt709":return new EuclideanBT709$1;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha$1;case"manhattan":return new Manhattan$1;case"manhattan-bt709":return new ManhattanBT709$1;case"manhattan-nommyde":return new ManhattanNommyde$1;case"pngquant":return new PNGQuant$1;default:throw Error(`Unknown colorDistanceFormula ${t}`)}}function imageQuantizationToImageQuantizer$1(t,r="floyd-steinberg"){switch(r){case"nearest":return new NearestColor$1(t);case"riemersma":return new ErrorDiffusionRiemersma$1(t);case"floyd-steinberg":return new ErrorDiffusionArray$1(t,0);case"false-floyd-steinberg":return new ErrorDiffusionArray$1(t,1);case"stucki":return new ErrorDiffusionArray$1(t,2);case"atkinson":return new ErrorDiffusionArray$1(t,3);case"jarvis":return new ErrorDiffusionArray$1(t,4);case"burkes":return new ErrorDiffusionArray$1(t,5);case"sierra":return new ErrorDiffusionArray$1(t,6);case"two-sierra":return new ErrorDiffusionArray$1(t,7);case"sierra-lite":return new ErrorDiffusionArray$1(t,8);default:throw Error(`Unknown imageQuantization ${r}`)}}function paletteQuantizationToPaletteQuantizer$1(t,r="wuquant",i=256){switch(r){case"neuquant":return new NeuQuant$1(t,i);case"rgbquant":return new RGBQuant$1(t,i);case"wuquant":return new WuQuant$1(t,i);case"neuquant-float":return new NeuQuantFloat$1(t,i);default:throw Error(`Unknown paletteQuantization ${r}`)}}var imageQ=__toCommonJS(src_exports),gifframe={};let BitmapImage$1=bitmapimage,GifFrame$1=class e1 extends BitmapImage$1{constructor(...t){if(super(...t),t[0]instanceof e1){const r=t[0];this.xOffset=r.xOffset,this.yOffset=r.yOffset,this.disposalMethod=r.disposalMethod,this.delayCentisecs=r.delayCentisecs,this.interlaced=r.interlaced}else{const r=t[t.length-1];let i={};"object"!=typeof r||r instanceof BitmapImage$1||(i=r),this.xOffset=i.xOffset||0,this.yOffset=i.yOffset||0,this.disposalMethod=void 0!==i.disposalMethod?i.disposalMethod:e1.DisposeToBackgroundColor,this.delayCentisecs=i.delayCentisecs||8,this.interlaced=i.interlaced||!1}}getPalette(){let t=new Set,r=this.bitmap.data,i=0,n=!1;for(;i<r.length;){if(0===r[i+3])n=!0;else{let n=r.readUInt32BE(i,!0)>>8&0xffffff;t.add(n)}i+=4}let a=Array(t.size),s=t.values();for(i=0;i<a.length;++i)a[i]=s.next().value;a.sort((t,r)=>t-r);let o=a.length;return n&&++o,{colors:a,usesTransparency:n,indexCount:o}}};function requireGifutil(){return hasRequiredGifutil||(hasRequiredGifutil=1,function(t){let r=require$$0,i=imageQ,n=bitmapimage,{GifFrame:a}=gifframe,{GifError:s}=gif$1,{GifCodec:o}=requireGifcodec(),l=[".jpg",".jpeg",".png",".bmp"],u=new o;function h(t,r,n,a,s){let o,l=Array.isArray(t)?t:[t];if(s){if(0>["FloydSteinberg","FalseFloydSteinberg","Stucki","Atkinson","Jarvis","Burkes","Sierra","TwoSierra","SierraLite"].indexOf(s.ditherAlgorithm))throw Error(`Invalid ditherAlgorithm '${s.ditherAlgorithm}'`);void 0===s.serpentine&&(s.serpentine=!0),void 0===s.minimumColorDistanceToDither&&(s.minimumColorDistanceToDither=0),void 0===s.calculateErrorLikeGIMP&&(s.calculateErrorLikeGIMP=!1)}let u=new i.distance.Euclidean,h=new i.palette[r](u,n,a);o=s?new i.image.ErrorDiffusionArray(u,i.image.ErrorDiffusionArrayKernel[s.ditherAlgorithm],s.serpentine,s.minimumColorDistanceToDither,s.calculateErrorLikeGIMP):new i.image.NearestColor(u);let f=[];l.forEach(t=>{let r=t.bitmap.data,n=new Uint32Array(new ArrayBuffer(r.length));for(let t=0,i=0;t<r.length;t+=4,++i)n[i]=r.readUInt32LE(t,!0);let a=i.utils.PointContainer.fromUint32Array(n,t.bitmap.width,t.bitmap.height);h.sample(a),f.push(a)});let d=h.quantizeSync();for(let t=0;t<l.length;++t){let r=l[t].bitmap.data,i=o.quantizeSync(f[t],d).toUint32Array();for(let t=0,n=0;t<r.length;t+=4,++n)r.writeUInt32LE(i[n],t)}}t.cloneFrames=function(t){let r=[];return t.forEach(t=>{r.push(new a(t))}),r},t.getColorInfo=function(t,r){let i=!1,n=[];for(let r=0;r<t.length;++r){let a=t[r].getPalette();if(a.usesTransparency&&(i=!0),a.indexCount>256)throw new s(`Frame ${r} uses more than 256 color indexes`);n.push(a)}if(0===r)return{usesTransparency:i,palettes:n};let a=new Set;n.forEach(t=>{t.colors.forEach(t=>{a.add(t)})});let o=a.size;if(i&&++o,r&&o>r)return{usesTransparency:i,palettes:n};let l=Array(a.size),u=a.values();for(let t=0;t<l.length;++t)l[t]=u.next().value;return l.sort((t,r)=>t-r),{colors:l,indexCount:o,usesTransparency:i,palettes:n}},t.copyAsJimp=function(r,i){return t.shareAsJimp(r,new n(i))},t.getMaxDimensions=function(t){let r=0,i=0;return t.forEach(t=>{let n=t.xOffset+t.bitmap.width;n>r&&(r=n);let a=t.yOffset+t.bitmap.height;a>i&&(i=a)}),{maxWidth:r,maxHeight:i}},t.quantizeDekker=function(t,r,i){h(t,"NeuQuantFloat",r=r||256,0,i)},t.quantizeSorokin=function(t,r,i,n){let a;switch(r=r||256,i=i||"min-pop"){case"min-pop":a=2;break;case"top-pop":a=1;break;default:throw Error(`Invalid quantizeSorokin histogram '${i}'`)}h(t,"RGBQuant",r,a,n)},t.quantizeWu=function(t,r,i,n){if(r=r||256,(i=i||5)<1||i>8)throw Error("Invalid quantization quality");h(t,"WuQuant",r,i,n)},t.read=function(t,i){return i=i||u,Buffer.isBuffer(t)?i.decodeGif(t):(function(t){return new Promise((i,n)=>{r.readFile(t,(t,r)=>t?n(t):i(r))})})(t).then(t=>i.decodeGif(t))},t.shareAsJimp=function(t,r){let i=new t(r.bitmap.width,r.bitmap.height,0);return i.bitmap.data=r.bitmap.data,i},t.write=function(t,i,n,a){a=a||u;let s=t.match(/\.[a-zA-Z]+$/);if(null!==s&&l.includes(s[0].toLowerCase()))throw Error(`GIF '${t}' has an unexpected suffix`);return a.encodeGif(i,n).then(i=>(function(t,i){return new Promise((n,a)=>{r.writeFile(t,i,t=>t?a(t):n())})})(t,i.buffer).then(()=>i))}}(gifutil)),gifutil}function requireGifcodec(){if(hasRequiredGifcodec)return gifcodec;hasRequiredGifcodec=1;let t=omggif,{Gif:r,GifError:i}=gif$1;function n(){let t=requireGifutil();return n=function(){return t},t}let{GifFrame:a}=gifframe;function s(t,r){let i=t.indexOf(r);return -1===i?null:i}function o(t,r){for(var i,n=0,a=t.length-1;n<=a;)if(t[i=Math.floor((n+a)/2)]>r)a=i-1;else{if(!(t[i]<r))return i;n=i+1}return null}function l(t){let r=t.colors;t.usesTransparency&&r.push(0);let i=r.length,n=2;for(;i>n;)n<<=1;r.length=n,r.fill(0,i)}function u(t,r){let i=t.bitmap.width*t.bitmap.height;return i=Math.ceil(i*r/8),100+(i+=Math.ceil(i/255))+768}function h(t){let r=t.indexCount,i=0;for(--r;r;)++i,r>>=1;return i>0?i:1}function f(t,r,n,a,u){if(n.interlaced)throw new i("writing interlaced GIFs is not supported");let h=function(t,r,n){let a=n.colors,l=a.length<=8?s:o,u=r.bitmap.data,h=new Buffer(u.length/4),f=a.length,d=0,c=0;for(;d<u.length;){if(0!==u[d+3]){let t=u.readUInt32BE(d,!0)>>8&0xffffff;h[c]=l(a,t)}else h[c]=f;d+=4,++c}if(n.usesTransparency){if(256===f)throw new i(`Frame ${t} already has 256 colorsand so can't use transparency`)}else f=null;return{buffer:h,transparentIndex:f}}(r,n,a),f={delay:n.delayCentisecs,disposal:n.disposalMethod,transparent:h.transparentIndex};u&&(l(a),f.palette=a.colors);try{let r,i=t.getOutputBuffer(),a=t.getOutputBufferPosition(),s=!0;for(;s;)if(r=t.addFrame(n.xOffset,n.yOffset,n.bitmap.width,n.bitmap.height,h.buffer,f),s=!1,r>=i.length-1){let r=new Buffer(1.5*i.length);i.copy(r),t.setOutputBuffer(r),t.setOutputBufferPosition(a),i=r,s=!0}return i}catch(t){throw new i(t)}}return gifcodec.GifCodec=class{constructor(t={}){this._transparentRGB=null,"number"==typeof t.transparentRGB&&0!==t.transparentRGB&&(this._transparentRGBA=256*t.transparentRGB),this._testInitialBufferSize=0}decodeGif(n){try{let a;try{a=new t.GifReader(n)}catch(t){throw new i(t)}let s=a.numFrames(),o=[],l={width:a.width,height:a.height,loops:a.loopCount(),usesTransparency:!1};for(let t=0;t<s;++t){let r=this._decodeFrame(a,t,l.usesTransparency);o.push(r.frame),r.usesTransparency&&(l.usesTransparency=!0)}return Promise.resolve(new r(n,o,l))}catch(t){return Promise.reject(t)}}encodeGif(t,a={}){try{if(null===t||0===t.length)throw new i("there are no frames");let s=n().getMaxDimensions(t);return(a=Object.assign({},a)).width=s.maxWidth,a.height=s.maxHeight,void 0===a.loops&&(a.loops=0),a.colorScope=a.colorScope||r.GlobalColorsPreferred,Promise.resolve(this._encodeGif(t,a))}catch(t){return Promise.reject(t)}}_decodeFrame(t,r,n){let s,o;try{if(s=t.frameInfo(r),o=new Buffer(t.width*t.height*4),t.decodeAndBlitFrameRGBA(r,o),s.width!==t.width||s.height!==t.height){if(s.y&&(o=o.slice(s.y*t.width*4)),t.width>s.width)for(let r=0;r<s.height;++r)o.copy(o,r*s.width*4,4*(s.x+r*t.width),4*(s.x+r*t.width)+4*s.width);o=o.slice(0,s.width*s.height*4)}}catch(t){throw new i(t)}let l=!1;if(null===this._transparentRGBA){if(!n)for(let t=3;t<o.length;t+=4)0===o[t]&&(l=!0,t=o.length)}else for(let t=3;t<o.length;t+=4)0===o[t]&&(o.writeUInt32BE(this._transparentRGBA,t-3),l=!0);return{frame:new a(s.width,s.height,o,{xOffset:s.x,yOffset:s.y,disposalMethod:s.disposal,interlaced:s.interlaced,delayCentisecs:s.delay}),usesTransparency:l}}_encodeGif(a,s){let o;if(s.colorScope===r.LocalColorsOnly)o=n().getColorInfo(a,0);else if(!(o=n().getColorInfo(a,256)).colors){if(s.colorScope===r.GlobalColorsOnly)throw new i("Too many color indexes for global color table");s.colorScope=r.LocalColorsOnly}s.usesTransparency=o.usesTransparency;let u=o.palettes;return s.colorScope===r.LocalColorsOnly?function(n,a,s,o){let l={loop:a.loops},u,h=new Buffer(2e3);try{u=new t.GifWriter(h,a.width,a.height,l)}catch(t){throw new i(t)}for(let t=0;t<n.length;++t)h=f(u,t,n[t],o[t],!0);return new r(h.slice(0,u.end()),n,a)}(a,s,0,u):function(n,a,s,o){let u={colors:o.colors.slice(),usesTransparency:o.usesTransparency};l(u);let h={palette:u.colors,loop:a.loops},d,c=new Buffer(2e3);try{d=new t.GifWriter(c,a.width,a.height,h)}catch(t){throw new i(t)}for(let t=0;t<n.length;++t)c=f(d,t,n[t],o,!1);return new r(c.slice(0,d.end()),n,a)}(a,s,0,o)}_getSizeEstimateGlobal(t,r){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let i=968,n=h(t);return r.forEach(t=>{i+=u(t,n)}),i}_getSizeEstimateLocal(t,r){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let i=200;for(let n=0;n<r.length;++n){let a=h(t[n]);i+=u(r[n],a)}return i}},gifcodec}GifFrame$1.DisposeToAnything=0,GifFrame$1.DisposeNothing=1,GifFrame$1.DisposeToBackgroundColor=2,GifFrame$1.DisposeToPrevious=3,gifframe.GifFrame=GifFrame$1;let BitmapImage=bitmapimage,{Gif:Gif,GifError:GifError$1}=gif$1,{GifCodec:GifCodec}=requireGifcodec(),{GifFrame:GifFrame}=gifframe,GifUtil=requireGifutil();var src={BitmapImage:BitmapImage,GifCodec:GifCodec,GifFrame:GifFrame,GifUtil:GifUtil};function gif(){return{mime:"image/gif",encode:async t=>{let r=new src.BitmapImage(t);src.GifUtil.quantizeDekker(r,256);let i=new src.GifFrame(t),n=new src.GifCodec;return(await n.encodeGif([i],{})).buffer},decode:t=>{let r=new omggif.GifReader(t),i=Buffer.alloc(r.width*r.height*4);return r.decodeAndBlitFrameRGBA(0,i),{data:i,width:r.width,height:r.height}}}}var encoder={exports:{}};!function(t){function r(t){var r,i,n,a,s,o=Math.floor,l=Array(64),u=Array(64),h=Array(64),f=Array(64),d=Array(65535),c=Array(65535),p=Array(64),m=Array(64),g=[],_=0,b=7,y=Array(64),v=Array(64),w=Array(64),x=Array(256),k=Array(2048),E=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],$=[0,1,2,3,4,5,6,7,8,9,10,11],I=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],A=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],M=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,8,9,10,11],C=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],z=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function R(t,r){for(var i=0,n=0,a=[],s=1;s<=16;s++){for(var o=1;o<=t[s];o++)a[r[n]]=[],a[r[n]][0]=i,a[r[n]][1]=s,n++,i++;i*=2}return a}function B(t){for(var r=t[0],i=t[1]-1;i>=0;)r&1<<i&&(_|=1<<b),i--,--b<0&&(255==_?(O(255),O(0)):O(_),b=7,_=0)}function O(t){g.push(t)}function P(t){O(t>>8&255),O(255&t)}function D(t,r,i,n,a){for(var s,o=a[0],l=a[240],u=function(t,r){var i,n,a,s,o,l,u,h,f,d,c=0;for(f=0;f<8;++f){i=t[c],n=t[c+1],a=t[c+2],s=t[c+3],o=t[c+4],l=t[c+5],u=t[c+6];var m=i+(h=t[c+7]),g=i-h,_=n+u,b=n-u,y=a+l,v=a-l,w=s+o,x=s-o,k=m+w,E=m-w,S=_+y,$=_-y;t[c]=k+S,t[c+4]=k-S;var I=.707106781*($+E);t[c+2]=E+I,t[c+6]=E-I;var A=.382683433*((k=x+v)-($=b+g)),M=.5411961*k+A,T=1.306562965*$+A,C=.707106781*(S=v+b),z=g+C,R=g-C;t[c+5]=R+M,t[c+3]=R-M,t[c+1]=z+T,t[c+7]=z-T,c+=8}for(c=0,f=0;f<8;++f){i=t[c],n=t[c+8],a=t[c+16],s=t[c+24],o=t[c+32],l=t[c+40],u=t[c+48];var B=i+(h=t[c+56]),O=i-h,P=n+u,D=n-u,N=a+l,L=a-l,U=s+o,j=s-o,F=B+U,G=B-U,W=P+N,q=P-N;t[c]=F+W,t[c+32]=F-W;var H=.707106781*(q+G);t[c+16]=G+H,t[c+48]=G-H;var V=.382683433*((F=j+L)-(q=D+O)),Z=.5411961*F+V,K=1.306562965*q+V,Y=.707106781*(W=L+D),X=O+Y,Q=O-Y;t[c+40]=Q+Z,t[c+24]=Q-Z,t[c+8]=X+K,t[c+56]=X-K,c++}for(f=0;f<64;++f)d=t[f]*r[f],p[f]=d>0?d+.5|0:d-.5|0;return p}(t,r),h=0;h<64;++h)m[E[h]]=u[h];var f=m[0]-i;i=m[0],0==f?B(n[0]):(B(n[c[s=32767+f]]),B(d[s]));for(var g=63;g>0&&0==m[g];g--);if(0==g)return B(o),i;for(var _,b=1;b<=g;){for(var y=b;0==m[b]&&b<=g;++b);var v=b-y;if(v>=16){_=v>>4;for(var w=1;w<=_;++w)B(l);v&=15}B(a[(v<<4)+c[s=32767+m[b]]]),B(d[s]),b++}return 63!=g&&B(o),i}function N(t){t<=0&&(t=1),t>100&&(t=100),s!=t&&(function(t){for(var r=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],i=0;i<64;i++){var n=o((r[i]*t+50)/100);n<1?n=1:n>255&&(n=255),l[E[i]]=n}for(var a=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],s=0;s<64;s++){var d=o((a[s]*t+50)/100);d<1?d=1:d>255&&(d=255),u[E[s]]=d}for(var c=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],p=0,m=0;m<8;m++)for(var g=0;g<8;g++)h[p]=1/(l[E[p]]*c[m]*c[g]*8),f[p]=1/(u[E[p]]*c[m]*c[g]*8),p++}(t<50?Math.floor(5e3/t):Math.floor(200-2*t)),s=t)}this.encode=function(t,s){(new Date).getTime(),s&&N(s),g=[],_=0,b=7,P(65496),P(65504),P(16),O(74),O(70),O(73),O(70),O(0),O(1),O(1),O(0),P(1),P(1),O(0),O(0),void 0!==(p=t.comments)&&p.constructor===Array&&p.forEach(t=>{if("string"==typeof t){P(65534);var r,i=t.length;for(P(i+2),r=0;r<i;r++)O(t.charCodeAt(r))}}),function(t){if(t){P(65505),69===t[0]&&120===t[1]&&105===t[2]&&102===t[3]?P(t.length+2):(P(t.length+5+2),O(69),O(120),O(105),O(102),O(0));for(var r=0;r<t.length;r++)O(t[r])}}(t.exifBuffer),function(){P(65499),P(132),O(0);for(var t=0;t<64;t++)O(l[t]);O(1);for(var r=0;r<64;r++)O(u[r])}(),function(t,r){P(65472),P(17),O(8),P(r),P(t),O(3),O(1),O(17),O(0),O(2),O(17),O(1),O(3),O(17),O(1)}(t.width,t.height),function(){P(65476),P(418),O(0);for(var t=0;t<16;t++)O(S[t+1]);for(var r=0;r<=11;r++)O($[r]);O(16);for(var i=0;i<16;i++)O(I[i+1]);for(var n=0;n<=161;n++)O(A[n]);O(1);for(var a=0;a<16;a++)O(M[a+1]);for(var s=0;s<=11;s++)O(T[s]);O(17);for(var o=0;o<16;o++)O(C[o+1]);for(var l=0;l<=161;l++)O(z[l])}(),P(65498),P(12),O(3),O(1),O(0),O(2),O(17),O(3),O(17),O(0),O(63),O(0);var o=0,d=0,c=0;_=0,b=7,this.encode.displayName="_encode_";for(var p,m,x,E,R,L,U,j,F,G,W=t.data,q=t.width,H=t.height,V=4*q,Z=0;Z<H;){for(m=0;m<V;){for(U=L=V*Z+m,j=-1,F=0,G=0;G<64;G++)U=L+(F=G>>3)*V+(j=4*(7&G)),Z+F>=H&&(U-=V*(Z+1+F-H)),m+j>=V&&(U-=m+j-V+4),x=W[U++],E=W[U++],R=W[U++],y[G]=(k[x]+k[E+256|0]+k[R+512|0]>>16)-128,v[G]=(k[x+768|0]+k[E+1024|0]+k[R+1280|0]>>16)-128,w[G]=(k[x+1280|0]+k[E+1536|0]+k[R+1792|0]>>16)-128;o=D(y,h,o,r,n),d=D(v,f,d,i,a),c=D(w,f,c,i,a),m+=32}Z+=8}if(b>=0){var K=[];K[1]=b+1,K[0]=(1<<b+1)-1,B(K)}return P(65497),Buffer.from(g)},(new Date).getTime(),t||(t=50),function(){for(var t=String.fromCharCode,r=0;r<256;r++)x[r]=t(r)}(),r=R(S,$),i=R(M,T),n=R(I,A),a=R(C,z),function(){for(var t=1,r=2,i=1;i<=15;i++){for(var n=t;n<r;n++)c[32767+n]=i,d[32767+n]=[],d[32767+n][1]=i,d[32767+n][0]=n;for(var a=-(r-1);a<=-t;a++)c[32767+a]=i,d[32767+a]=[],d[32767+a][1]=i,d[32767+a][0]=r-1+a;t<<=1,r<<=1}}(),function(){for(var t=0;t<256;t++)k[t]=19595*t,k[t+256|0]=38470*t,k[t+512|0]=7471*t+32768,k[t+768|0]=-11059*t,k[t+1024|0]=-21709*t,k[t+1280|0]=32768*t+8421375,k[t+1536|0]=-27439*t,k[t+1792|0]=-5329*t}(),N(t),(new Date).getTime()}encoder.exports=function(t,i){return void 0===i&&(i=50),{data:new r(i).encode(t,i),width:t.width,height:t.height}}}();var hasRequiredGifutil,hasRequiredGifcodec,module,JpegImage,encoderExports=encoder.exports,decoder={exports:{}};module=decoder,JpegImage=function(){var t=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,i=799,n=3406,a=2276,s=1567,o=3784,l=5793,u=2896;function h(){}function f(t,r){for(var i,n,a=0,s=[],o=16;o>0&&!t[o-1];)o--;s.push({children:[],index:0});var l,u=s[0];for(i=0;i<o;i++){for(n=0;n<t[i];n++){for((u=s.pop()).children[u.index]=r[a];u.index>0;){if(0===s.length)throw Error("Could not recreate Huffman Table");u=s.pop()}for(u.index++,s.push(u);s.length<=i;)s.push(l={children:[],index:0}),u.children[u.index]=l.children,u=l;a++}i+1<o&&(s.push(l={children:[],index:0}),u.children[u.index]=l.children,u=l)}return s[0].children}function d(r,i,n,a,s,o,l,u,h,f){n.precision,n.samplesPerLine,n.scanLines;var d=n.mcusPerLine,c=n.progressive;n.maxH,n.maxV;var p=i,m=0,g=0;function _(){if(g>0)return g--,m>>g&1;if(255==(m=r[i++])){var t=r[i++];if(t)throw Error("unexpected marker: "+(m<<8|t).toString(16))}return g=7,m>>>7}function b(t){for(var r,i=t;null!==(r=_());){if("number"==typeof(i=i[r]))return i;if("object"!=typeof i)throw Error("invalid huffman sequence")}return null}function y(t){for(var r=0;t>0;){var i=_();if(null===i)return;r=r<<1|i,t--}return r}function v(t){var r=y(t);return r>=1<<t-1?r:r+(-1<<t)+1}var w,x=0,k=0;function E(t,r,i,n,a){var s=i%d,o=(i/d|0)*t.v+n,l=s*t.h+a;void 0===t.blocks[o]&&f.tolerantDecoding||r(t,t.blocks[o][l])}function S(t,r,i){var n=i/t.blocksPerLine|0,a=i%t.blocksPerLine;void 0===t.blocks[n]&&f.tolerantDecoding||r(t,t.blocks[n][a])}var $,I,A,M,T,C,z=a.length;C=c?0===o?0===u?function(t,r){var i=b(t.huffmanTableDC),n=0===i?0:v(i)<<h;r[0]=t.pred+=n}:function(t,r){r[0]|=_()<<h}:0===u?function(r,i){if(x>0)x--;else for(var n=o,a=l;n<=a;){var s=b(r.huffmanTableAC),u=15&s,f=s>>4;if(0!==u)i[t[n+=f]]=v(u)*(1<<h),n++;else{if(f<15){x=y(f)+(1<<f)-1;break}n+=16}}}:function(r,i){for(var n=o,a=l,s=0;n<=a;){var u=t[n],f=i[u]<0?-1:1;switch(k){case 0:var d=b(r.huffmanTableAC),c=15&d;if(s=d>>4,0===c)s<15?(x=y(s)+(1<<s),k=4):(s=16,k=1);else{if(1!==c)throw Error("invalid ACn encoding");w=v(c),k=s?2:3}continue;case 1:case 2:i[u]?i[u]+=(_()<<h)*f:0==--s&&(k=3*(2==k));break;case 3:i[u]?i[u]+=(_()<<h)*f:(i[u]=w<<h,k=0);break;case 4:i[u]&&(i[u]+=(_()<<h)*f)}n++}4===k&&0==--x&&(k=0)}:function(r,i){var n=b(r.huffmanTableDC),a=0===n?0:v(n);i[0]=r.pred+=a;for(var s=1;s<64;){var o=b(r.huffmanTableAC),l=15&o,u=o>>4;if(0!==l)i[t[s+=u]]=v(l),s++;else{if(u<15)break;s+=16}}};var R,B,O,P,D=0;for(B=1==z?a[0].blocksPerLine*a[0].blocksPerColumn:d*n.mcusPerColumn,s||(s=B);D<B;){for(I=0;I<z;I++)a[I].pred=0;if(x=0,1==z)for($=a[0],T=0;T<s;T++)S($,C,D),D++;else for(T=0;T<s;T++){for(I=0;I<z;I++)for(O=($=a[I]).h,P=$.v,A=0;A<P;A++)for(M=0;M<O;M++)E($,C,D,A,M);if(++D===B)break}if(D===B)do{if(255===r[i]&&0!==r[i+1])break;i+=1}while(i<r.length-2)if(g=0,(R=r[i]<<8|r[i+1])<65280)throw Error("marker was not found");if(!(R>=65488&&R<=65495))break;i+=2}return i-p}function c(t,h){var f,d,c=[],p=h.blocksPerLine,m=h.blocksPerColumn,g=p<<3,b=new Int32Array(64),y=new Uint8Array(64);function v(t,f,d){var c,p,m,g,_,b,y,v,w,x,k=h.quantizationTable,E=d;for(x=0;x<64;x++)E[x]=t[x]*k[x];for(x=0;x<8;++x){var S=8*x;0!=E[1+S]||0!=E[2+S]||0!=E[3+S]||0!=E[4+S]||0!=E[5+S]||0!=E[6+S]||0!=E[7+S]?(c=l*E[0+S]+128>>8,p=l*E[4+S]+128>>8,m=E[2+S],g=E[6+S],_=u*(E[1+S]-E[7+S])+128>>8,v=u*(E[1+S]+E[7+S])+128>>8,b=E[3+S]<<4,y=E[5+S]<<4,w=c-p+1>>1,c=c+p+1>>1,p=w,w=m*o+g*s+128>>8,m=m*s-g*o+128>>8,g=w,w=_-y+1>>1,_=_+y+1>>1,y=w,w=v+b+1>>1,b=v-b+1>>1,v=w,w=c-g+1>>1,c=c+g+1>>1,g=w,w=p-m+1>>1,p=p+m+1>>1,m=w,w=_*a+v*n+2048>>12,_=_*n-v*a+2048>>12,v=w,w=b*i+y*r+2048>>12,b=b*r-y*i+2048>>12,y=w,E[0+S]=c+v,E[7+S]=c-v,E[1+S]=p+y,E[6+S]=p-y,E[2+S]=m+b,E[5+S]=m-b,E[3+S]=g+_,E[4+S]=g-_):(w=l*E[0+S]+512>>10,E[0+S]=w,E[1+S]=w,E[2+S]=w,E[3+S]=w,E[4+S]=w,E[5+S]=w,E[6+S]=w,E[7+S]=w)}for(x=0;x<8;++x){var $=x;0!=E[8+$]||0!=E[16+$]||0!=E[24+$]||0!=E[32+$]||0!=E[40+$]||0!=E[48+$]||0!=E[56+$]?(c=l*E[0+$]+2048>>12,p=l*E[32+$]+2048>>12,m=E[16+$],g=E[48+$],_=u*(E[8+$]-E[56+$])+2048>>12,v=u*(E[8+$]+E[56+$])+2048>>12,b=E[24+$],y=E[40+$],w=c-p+1>>1,c=c+p+1>>1,p=w,w=m*o+g*s+2048>>12,m=m*s-g*o+2048>>12,g=w,w=_-y+1>>1,_=_+y+1>>1,y=w,w=v+b+1>>1,b=v-b+1>>1,v=w,w=c-g+1>>1,c=c+g+1>>1,g=w,w=p-m+1>>1,p=p+m+1>>1,m=w,w=_*a+v*n+2048>>12,_=_*n-v*a+2048>>12,v=w,w=b*i+y*r+2048>>12,b=b*r-y*i+2048>>12,y=w,E[0+$]=c+v,E[56+$]=c-v,E[8+$]=p+y,E[48+$]=p-y,E[16+$]=m+b,E[40+$]=m-b,E[24+$]=g+_,E[32+$]=g-_):(w=l*d[x+0]+8192>>14,E[0+$]=w,E[8+$]=w,E[16+$]=w,E[24+$]=w,E[32+$]=w,E[40+$]=w,E[48+$]=w,E[56+$]=w)}for(x=0;x<64;++x){var I=128+(E[x]+8>>4);f[x]=I<0?0:I>255?255:I}}_(g*m*8);for(var w=0;w<m;w++){var x=w<<3;for(f=0;f<8;f++)c.push(new Uint8Array(g));for(var k=0;k<p;k++){v(h.blocks[w][k],y,b);var E=0,S=k<<3;for(d=0;d<8;d++){var $=c[x+d];for(f=0;f<8;f++)$[S+f]=y[E++]}}}return c}function p(t){return t<0?0:t>255?255:t}h.prototype={load:function(t){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=(function(){var t=new Uint8Array(r.response||r.mozResponseArrayBuffer);this.parse(t),this.onload&&this.onload()}).bind(this),r.send(null)},parse:function(r){var i=1e3*this.opts.maxResolutionInMP*1e3,n=0;function a(){var t=r[n]<<8|r[n+1];return n+=2,t}function s(t){var r,i,n=1,a=1;for(i in t.components)t.components.hasOwnProperty(i)&&(n<(r=t.components[i]).h&&(n=r.h),a<r.v&&(a=r.v));var s=Math.ceil(t.samplesPerLine/8/n),o=Math.ceil(t.scanLines/8/a);for(i in t.components)if(t.components.hasOwnProperty(i)){r=t.components[i];var l=Math.ceil(Math.ceil(t.samplesPerLine/8)*r.h/n),u=Math.ceil(Math.ceil(t.scanLines/8)*r.v/a),h=s*r.h,f=o*r.v,d=[];_(f*h*256);for(var c=0;c<f;c++){for(var p=[],m=0;m<h;m++)p.push(new Int32Array(64));d.push(p)}r.blocksPerLine=l,r.blocksPerColumn=u,r.blocks=d}t.maxH=n,t.maxV=a,t.mcusPerLine=s,t.mcusPerColumn=o}r.length;var o,l,u,h,p=null,m=null,g=[],b=[],y=[],v=[],w=a(),x=-1;if(this.comments=[],65496!=w)throw Error("SOI not found");for(w=a();65497!=w;){switch(w){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var k=(u=void 0,h=void 0,u=a(),h=r.subarray(n,n+u-2),n+=h.length,h);if(65534===w){var E=String.fromCharCode.apply(null,k);this.comments.push(E)}65504===w&&74===k[0]&&70===k[1]&&73===k[2]&&70===k[3]&&0===k[4]&&(p={version:{major:k[5],minor:k[6]},densityUnits:k[7],xDensity:k[8]<<8|k[9],yDensity:k[10]<<8|k[11],thumbWidth:k[12],thumbHeight:k[13],thumbData:k.subarray(14,14+3*k[12]*k[13])}),65505===w&&69===k[0]&&120===k[1]&&105===k[2]&&102===k[3]&&0===k[4]&&(this.exifBuffer=k.subarray(5,k.length)),65518===w&&65===k[0]&&100===k[1]&&111===k[2]&&98===k[3]&&101===k[4]&&0===k[5]&&(m={version:k[6],flags0:k[7]<<8|k[8],flags1:k[9]<<8|k[10],transformCode:k[11]});break;case 65499:for(var S=a()+n-2;n<S;){var $=r[n++];_(256);var I=new Int32Array(64);if($>>4){if($>>4!=1)throw Error("DQT: invalid table spec");for(K=0;K<64;K++)I[t[K]]=a()}else for(K=0;K<64;K++)I[t[K]]=r[n++];g[15&$]=I}break;case 65472:case 65473:case 65474:a(),(o={}).extended=65473===w,o.progressive=65474===w,o.precision=r[n++],o.scanLines=a(),o.samplesPerLine=a(),o.components={},o.componentsOrder=[];var A=o.scanLines*o.samplesPerLine;if(A>i){var M=Math.ceil((A-i)/1e6);throw Error(`maxResolutionInMP limit exceeded by ${M}MP`)}var T,C=r[n++];for(V=0;V<C;V++){T=r[n];var z=r[n+1]>>4,R=15&r[n+1],B=r[n+2];if(z<=0||R<=0)throw Error("Invalid sampling factor, expected values above 0");o.componentsOrder.push(T),o.components[T]={h:z,v:R,quantizationIdx:B},n+=3}s(o),b.push(o);break;case 65476:var O=a();for(V=2;V<O;){var P=r[n++],D=new Uint8Array(16),N=0;for(K=0;K<16;K++,n++)N+=D[K]=r[n];_(16+N);var L=new Uint8Array(N);for(K=0;K<N;K++,n++)L[K]=r[n];V+=17+N,(P>>4?y:v)[15&P]=f(D,L)}break;case 65501:a(),l=a();break;case 65500:a(),a();break;case 65498:a();var U=r[n++],j=[];for(V=0;V<U;V++){Y=o.components[r[n++]];var F=r[n++];Y.huffmanTableDC=v[F>>4],Y.huffmanTableAC=y[15&F],j.push(Y)}var G=r[n++],W=r[n++],q=r[n++],H=d(r,n,o,j,l,G,W,q>>4,15&q,this.opts);n+=H;break;case 65535:255!==r[n]&&n--;break;default:if(255==r[n-3]&&r[n-2]>=192&&r[n-2]<=254){n-=3;break}if(224===w||225==w){if(-1!==x)throw Error(`first unknown JPEG marker at offset ${x.toString(16)}, second unknown JPEG marker ${w.toString(16)} at offset ${(n-1).toString(16)}`);x=n-1;let t=a();if(255===r[n+t-2]){n+=t-2;break}}throw Error("unknown JPEG marker "+w.toString(16))}w=a()}if(1!=b.length)throw Error("only single frame JPEGs supported");for(var V=0;V<b.length;V++){var Z=b[V].components;for(var K in Z)Z[K].quantizationTable=g[Z[K].quantizationIdx],delete Z[K].quantizationIdx}for(this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=p,this.adobe=m,this.components=[],V=0;V<o.componentsOrder.length;V++){var Y=o.components[o.componentsOrder[V]];this.components.push({lines:c(0,Y),scaleX:Y.h/o.maxH,scaleY:Y.v/o.maxV})}},getData:function(t,r){var i,n,a,s,o,l,u,h,f,d,c,m,g,b,y,v,w,x,k,E,S,$=this.width/t,I=this.height/r,A=0,M=t*r*this.components.length;_(M);var T=new Uint8Array(M);switch(this.components.length){case 1:for(i=this.components[0],d=0;d<r;d++)for(o=i.lines[0|d*i.scaleY*I],f=0;f<t;f++)c=o[0|f*i.scaleX*$],T[A++]=c;break;case 2:for(i=this.components[0],n=this.components[1],d=0;d<r;d++)for(o=i.lines[0|d*i.scaleY*I],l=n.lines[0|d*n.scaleY*I],f=0;f<t;f++)c=o[0|f*i.scaleX*$],T[A++]=c,c=l[0|f*n.scaleX*$],T[A++]=c;break;case 3:for(S=!0,this.adobe&&this.adobe.transformCode?S=!0:void 0!==this.opts.colorTransform&&(S=!!this.opts.colorTransform),i=this.components[0],n=this.components[1],a=this.components[2],d=0;d<r;d++)for(o=i.lines[0|d*i.scaleY*I],l=n.lines[0|d*n.scaleY*I],u=a.lines[0|d*a.scaleY*I],f=0;f<t;f++)S?(c=o[0|f*i.scaleX*$],m=l[0|f*n.scaleX*$],x=p(c+1.402*((g=u[0|f*a.scaleX*$])-128)),k=p(c-.3441363*(m-128)-.71413636*(g-128)),E=p(c+1.772*(m-128))):(x=o[0|f*i.scaleX*$],k=l[0|f*n.scaleX*$],E=u[0|f*a.scaleX*$]),T[A++]=x,T[A++]=k,T[A++]=E;break;case 4:if(!this.adobe)throw Error("Unsupported color mode (4 components)");for(S=!1,this.adobe&&this.adobe.transformCode?S=!0:void 0!==this.opts.colorTransform&&(S=!!this.opts.colorTransform),i=this.components[0],n=this.components[1],a=this.components[2],s=this.components[3],d=0;d<r;d++)for(o=i.lines[0|d*i.scaleY*I],l=n.lines[0|d*n.scaleY*I],u=a.lines[0|d*a.scaleY*I],h=s.lines[0|d*s.scaleY*I],f=0;f<t;f++)S?(c=o[0|f*i.scaleX*$],m=l[0|f*n.scaleX*$],g=u[0|f*a.scaleX*$],b=h[0|f*s.scaleX*$],y=255-p(c+1.402*(g-128)),v=255-p(c-.3441363*(m-128)-.71413636*(g-128)),w=255-p(c+1.772*(m-128))):(y=o[0|f*i.scaleX*$],v=l[0|f*n.scaleX*$],w=u[0|f*a.scaleX*$],b=h[0|f*s.scaleX*$]),T[A++]=255-y,T[A++]=255-v,T[A++]=255-w,T[A++]=255-b;break;default:throw Error("Unsupported color mode")}return T},copyToImageData:function(t,r){var i,n,a,s,o,l,u,h,f,d=t.width,c=t.height,m=t.data,g=this.getData(d,c),_=0,b=0;switch(this.components.length){case 1:for(n=0;n<c;n++)for(i=0;i<d;i++)a=g[_++],m[b++]=a,m[b++]=a,m[b++]=a,r&&(m[b++]=255);break;case 3:for(n=0;n<c;n++)for(i=0;i<d;i++)u=g[_++],h=g[_++],f=g[_++],m[b++]=u,m[b++]=h,m[b++]=f,r&&(m[b++]=255);break;case 4:for(n=0;n<c;n++)for(i=0;i<d;i++)o=g[_++],l=g[_++],a=g[_++],u=255-p(o*(1-(s=g[_++])/255)+s),h=255-p(l*(1-s/255)+s),f=255-p(a*(1-s/255)+s),m[b++]=u,m[b++]=h,m[b++]=f,r&&(m[b++]=255);break;default:throw Error("Unsupported color mode")}}};var m=0,g=0;function _(t=0){var r=m+t;if(r>g){var i=Math.ceil((r-g)/1024/1024);throw Error(`maxMemoryUsageInMB limit exceeded by at least ${i}MB`)}m=r}return h.resetMaxMemoryUsage=function(t){m=0,g=t},h.getBytesAllocated=function(){return m},h.requestMemoryAllocation=_,h}(),module.exports=function(t,r={}){var i={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512,...r},n=new Uint8Array(t),a=new JpegImage;a.opts=i,JpegImage.resetMaxMemoryUsage(1024*i.maxMemoryUsageInMB*1024),a.parse(n);var s=i.formatAsRGBA?4:3,o=a.width*a.height*s;try{JpegImage.requestMemoryAllocation(o);var l={width:a.width,height:a.height,exifBuffer:a.exifBuffer,data:i.useTArray?new Uint8Array(o):Buffer.alloc(o)};a.comments.length>0&&(l.comments=a.comments)}catch(t){if(t instanceof RangeError)throw Error("Could not allocate enough memory for the image. Required: "+o);if(t instanceof ReferenceError&&"Buffer is not defined"===t.message)throw Error("Buffer is not globally defined in this environment. Consider setting useTArray to true");throw t}return a.copyToImageData(l,i.formatAsRGBA),l};var decoderExports=decoder.exports,encode=encoderExports,decode=decoderExports,jpegJs={encode:encode,decode:decode},JPEG=getDefaultExportFromCjs(jpegJs);function jpeg$2(){return{mime:"image/jpeg",encode:(t,{quality:r=100}={})=>JPEG.encode(t,r).data,decode:(t,r)=>JPEG.decode(t,r)}}function commonjsRequire(t){throw Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var browser$1={exports:{}};browser$1.exports=(function(){function t(r,i,n){function a(o,l){if(!i[o]){if(!r[o]){var u=commonjsRequire;if(!l&&u)return u(o,!0);if(s)return s(o,!0);var h=Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var f=i[o]={exports:{}};r[o][0].call(f.exports,function(t){return a(r[o][1][t]||t)},f,f.exports,t,r,i,n)}return i[o].exports}for(var s=commonjsRequire,o=0;o<n.length;o++)a(n[o]);return a}return t})()({1:[function(t,r,i){(function(r){(function(){let n=t("./interlace"),a=[function(){},function(t,r,i,n){if(n===r.length)throw Error("Ran out of data");let a=r[n];t[i]=a,t[i+1]=a,t[i+2]=a,t[i+3]=255},function(t,r,i,n){if(n+1>=r.length)throw Error("Ran out of data");let a=r[n];t[i]=a,t[i+1]=a,t[i+2]=a,t[i+3]=r[n+1]},function(t,r,i,n){if(n+2>=r.length)throw Error("Ran out of data");t[i]=r[n],t[i+1]=r[n+1],t[i+2]=r[n+2],t[i+3]=255},function(t,r,i,n){if(n+3>=r.length)throw Error("Ran out of data");t[i]=r[n],t[i+1]=r[n+1],t[i+2]=r[n+2],t[i+3]=r[n+3]}],s=[function(){},function(t,r,i,n){let a=r[0];t[i]=a,t[i+1]=a,t[i+2]=a,t[i+3]=n},function(t,r,i){let n=r[0];t[i]=n,t[i+1]=n,t[i+2]=n,t[i+3]=r[1]},function(t,r,i,n){t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=n},function(t,r,i){t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3]}];function o(t,r){let i=[],n=0;function a(){if(n===t.length)throw Error("Ran out of data");let a,s,o,l,u,h,f,d,c=t[n];switch(n++,r){default:throw Error("unrecognised depth");case 16:f=t[n],n++,i.push((c<<8)+f);break;case 4:f=15&c,d=c>>4,i.push(d,f);break;case 2:u=3&c,h=c>>2&3,f=c>>4&3,d=c>>6&3,i.push(d,f,h,u);break;case 1:a=1&c,s=c>>1&1,o=c>>2&1,l=c>>3&1,u=c>>4&1,h=c>>5&1,f=c>>6&1,d=c>>7&1,i.push(d,f,h,u,l,o,s,a)}}return{get:function(t){for(;i.length<t;)a();let r=i.slice(0,t);return i=i.slice(t),r},resetAfterLine:function(){i.length=0},end:function(){if(n!==t.length)throw Error("extra data found")}}}function l(t,r,i,n,s,o){let l=t.width,u=t.height,h=t.index;for(let t=0;t<u;t++)for(let u=0;u<l;u++){let l=i(u,t,h);a[n](r,s,l,o),o+=n}return o}function u(t,r,i,n,a,o){let l=t.width,u=t.height,h=t.index;for(let t=0;t<u;t++){for(let u=0;u<l;u++){let l=a.get(n),f=i(u,t,h);s[n](r,l,f,o)}a.resetAfterLine()}}i.dataToBitMap=function(t,i){let a,s,h=i.width,f=i.height,d=i.depth,c=i.bpp,p=i.interlace;8!==d&&(a=o(t,d)),s=d<=8?r.alloc(h*f*4):new Uint16Array(h*f*4);let m,g,_=Math.pow(2,d)-1,b=0;if(p)m=n.getImagePasses(h,f),g=n.getInterlaceIterator(h,f);else{let t=0;g=function(){let r=t;return t+=4,r},m=[{width:h,height:f}]}for(let r=0;r<m.length;r++)8===d?b=l(m[r],s,g,c,t,b):u(m[r],s,g,c,a,_);if(8===d){if(b!==t.length)throw Error("extra data found")}else a.end();return s}}).call(this)}).call(this,t("buffer").Buffer)},{"./interlace":11,buffer:32}],2:[function(t,r,i){(function(i){(function(){let n=t("./constants");r.exports=function(t,r,a,s){let o=-1!==[n.COLORTYPE_COLOR_ALPHA,n.COLORTYPE_ALPHA].indexOf(s.colorType);if(s.colorType===s.inputColorType){let r=function(){let t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256!==new Int16Array(t)[0]}();if(8===s.bitDepth||16===s.bitDepth&&r)return t}let l=16!==s.bitDepth?t:new Uint16Array(t.buffer),u=255,h=n.COLORTYPE_TO_BPP_MAP[s.inputColorType];4!==h||s.inputHasAlpha||(h=3);let f=n.COLORTYPE_TO_BPP_MAP[s.colorType];16===s.bitDepth&&(u=65535,f*=2);let d=i.alloc(r*a*f),c=0,p=0,m=s.bgColor||{};function g(){let t,r,i,a=u;switch(s.inputColorType){case n.COLORTYPE_COLOR_ALPHA:a=l[c+3],t=l[c],r=l[c+1],i=l[c+2];break;case n.COLORTYPE_COLOR:t=l[c],r=l[c+1],i=l[c+2];break;case n.COLORTYPE_ALPHA:a=l[c+1],r=t=l[c],i=t;break;case n.COLORTYPE_GRAYSCALE:r=t=l[c],i=t;break;default:throw Error("input color type:"+s.inputColorType+" is not supported at present")}return s.inputHasAlpha&&(o||(a/=u,t=Math.min(Math.max(Math.round((1-a)*m.red+a*t),0),u),r=Math.min(Math.max(Math.round((1-a)*m.green+a*r),0),u),i=Math.min(Math.max(Math.round((1-a)*m.blue+a*i),0),u))),{red:t,green:r,blue:i,alpha:a}}void 0===m.red&&(m.red=u),void 0===m.green&&(m.green=u),void 0===m.blue&&(m.blue=u);for(let t=0;t<a;t++)for(let t=0;t<r;t++){let t=g();switch(s.colorType){case n.COLORTYPE_COLOR_ALPHA:case n.COLORTYPE_COLOR:8===s.bitDepth?(d[p]=t.red,d[p+1]=t.green,d[p+2]=t.blue,o&&(d[p+3]=t.alpha)):(d.writeUInt16BE(t.red,p),d.writeUInt16BE(t.green,p+2),d.writeUInt16BE(t.blue,p+4),o&&d.writeUInt16BE(t.alpha,p+6));break;case n.COLORTYPE_ALPHA:case n.COLORTYPE_GRAYSCALE:{let r=(t.red+t.green+t.blue)/3;8===s.bitDepth?(d[p]=r,o&&(d[p+1]=t.alpha)):(d.writeUInt16BE(r,p),o&&d.writeUInt16BE(t.alpha,p+2));break}default:throw Error("unrecognised color Type "+s.colorType)}c+=h,p+=f}return d}}).call(this)}).call(this,t("buffer").Buffer)},{"./constants":4,buffer:32}],3:[function(t,r,i){(function(i,n){(function(){let a=t("util"),s=t("stream"),o=r.exports=function(){s.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};a.inherits(o,s),o.prototype.read=function(t,r){this._reads.push({length:Math.abs(t),allowLess:t<0,func:r}),i.nextTick((function(){this._process(),this._paused&&this._reads&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}).bind(this))},o.prototype.write=function(t,r){let i;return this.writable?(i=n.isBuffer(t)?t:n.from(t,r||this._encoding),this._buffers.push(i),this._buffered+=i.length,this._process(),this._reads&&0===this._reads.length&&(this._paused=!0),this.writable&&!this._paused):(this.emit("error",Error("Stream not writable")),!1)},o.prototype.end=function(t,r){t&&this.write(t,r),this.writable=!1,this._buffers&&(0===this._buffers.length?this._end():(this._buffers.push(null),this._process()))},o.prototype.destroySoon=o.prototype.end,o.prototype._end=function(){this._reads.length>0&&this.emit("error",Error("Unexpected end of input")),this.destroy()},o.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},o.prototype._processReadAllowingLess=function(t){this._reads.shift();let r=this._buffers[0];r.length>t.length?(this._buffered-=t.length,this._buffers[0]=r.slice(t.length),t.func.call(this,r.slice(0,t.length))):(this._buffered-=r.length,this._buffers.shift(),t.func.call(this,r))},o.prototype._processRead=function(t){this._reads.shift();let r=0,i=0,a=n.alloc(t.length);for(;r<t.length;){let n=this._buffers[i++],s=Math.min(n.length,t.length-r);n.copy(a,r,0,s),r+=s,s!==n.length&&(this._buffers[--i]=n.slice(s))}i>0&&this._buffers.splice(0,i),this._buffered-=t.length,t.func.call(this,a)},o.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){let t=this._reads[0];if(t.allowLess)this._processReadAllowingLess(t);else{if(!(this._buffered>=t.length))break;this._processRead(t)}}this._buffers&&!this.writable&&this._end()}catch(t){this.emit("error",t)}}}).call(this)}).call(this,t("_process"),t("buffer").Buffer)},{_process:63,buffer:32,stream:65,util:84}],4:[function(t,r,i){r.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:0x49484452,TYPE_IEND:0x49454e44,TYPE_IDAT:0x49444154,TYPE_PLTE:0x504c5445,TYPE_tRNS:0x74524e53,TYPE_gAMA:0x67414d41,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],5:[function(t,r,i){let n=[];!function(){for(let t=0;t<256;t++){let r=t;for(let t=0;t<8;t++)1&r?r=0xedb88320^r>>>1:r>>>=1;n[t]=r}}();let a=r.exports=function(){this._crc=-1};a.prototype.write=function(t){for(let r=0;r<t.length;r++)this._crc=n[255&(this._crc^t[r])]^this._crc>>>8;return!0},a.prototype.crc32=function(){return~this._crc},a.crc32=function(t){let r=-1;for(let i=0;i<t.length;i++)r=n[255&(r^t[i])]^r>>>8;return~r}},{}],6:[function(t,r,i){(function(i){(function(){let n=t("./paeth-predictor"),a={0:function(t,r,i,n,a){for(let s=0;s<i;s++)n[a+s]=t[r+s]},1:function(t,r,i,n,a,s){for(let o=0;o<i;o++){let i=o>=s?t[r+o-s]:0,l=t[r+o]-i;n[a+o]=l}},2:function(t,r,i,n,a){for(let s=0;s<i;s++){let o=r>0?t[r+s-i]:0,l=t[r+s]-o;n[a+s]=l}},3:function(t,r,i,n,a,s){for(let o=0;o<i;o++){let l=o>=s?t[r+o-s]:0,u=r>0?t[r+o-i]:0,h=t[r+o]-(l+u>>1);n[a+o]=h}},4:function(t,r,i,a,s,o){for(let l=0;l<i;l++){let u=l>=o?t[r+l-o]:0,h=r>0?t[r+l-i]:0,f=r>0&&l>=o?t[r+l-(i+o)]:0,d=t[r+l]-n(u,h,f);a[s+l]=d}}},s={0:function(t,r,i){let n=0,a=r+i;for(let i=r;i<a;i++)n+=Math.abs(t[i]);return n},1:function(t,r,i,n){let a=0;for(let s=0;s<i;s++){let i=s>=n?t[r+s-n]:0;a+=Math.abs(t[r+s]-i)}return a},2:function(t,r,i){let n=0,a=r+i;for(let s=r;s<a;s++){let a=r>0?t[s-i]:0;n+=Math.abs(t[s]-a)}return n},3:function(t,r,i,n){let a=0;for(let s=0;s<i;s++){let o=s>=n?t[r+s-n]:0,l=r>0?t[r+s-i]:0;a+=Math.abs(t[r+s]-(o+l>>1))}return a},4:function(t,r,i,a){let s=0;for(let o=0;o<i;o++){let l=o>=a?t[r+o-a]:0,u=r>0?t[r+o-i]:0,h=r>0&&o>=a?t[r+o-(i+a)]:0;s+=Math.abs(t[r+o]-n(l,u,h))}return s}};r.exports=function(t,r,n,o,l){let u;if("filterType"in o&&-1!==o.filterType){if("number"!=typeof o.filterType)throw Error("unrecognised filter types");u=[o.filterType]}else u=[0,1,2,3,4];16===o.bitDepth&&(l*=2);let h=r*l,f=0,d=0,c=i.alloc((h+1)*n),p=u[0];for(let r=0;r<n;r++){if(u.length>1){let r=1/0;for(let i=0;i<u.length;i++){let n=s[u[i]](t,d,h,l);n<r&&(p=u[i],r=n)}}c[f]=p,f++,a[p](t,d,h,c,f,l),f+=h,d+=h}return c}}).call(this)}).call(this,t("buffer").Buffer)},{"./paeth-predictor":15,buffer:32}],7:[function(t,r,i){(function(i){(function(){let n=t("util"),a=t("./chunkstream"),s=t("./filter-parse"),o=r.exports=function(t){a.call(this);let r=[],n=this;this._filter=new s(t,{read:this.read.bind(this),write:function(t){r.push(t)},complete:function(){n.emit("complete",i.concat(r))}}),this._filter.start()};n.inherits(o,a)}).call(this)}).call(this,t("buffer").Buffer)},{"./chunkstream":3,"./filter-parse":9,buffer:32,util:84}],8:[function(t,r,i){(function(r){(function(){let n=t("./sync-reader"),a=t("./filter-parse");i.process=function(t,i){let s=[],o=new n(t);return new a(i,{read:o.read.bind(o),write:function(t){s.push(t)},complete:function(){}}).start(),o.process(),r.concat(s)}}).call(this)}).call(this,t("buffer").Buffer)},{"./filter-parse":9,"./sync-reader":22,buffer:32}],9:[function(t,r,i){(function(i){(function(){let n=t("./interlace"),a=t("./paeth-predictor");function s(t,r,i){let n=t*r;return 8!==i&&(n=Math.ceil(n/(8/i))),n}let o=r.exports=function(t,r){let i=t.width,a=t.height,o=t.interlace,l=t.bpp,u=t.depth;if(this.read=r.read,this.write=r.write,this.complete=r.complete,this._imageIndex=0,this._images=[],o){let t=n.getImagePasses(i,a);for(let r=0;r<t.length;r++)this._images.push({byteWidth:s(t[r].width,l,u),height:t[r].height,lineIndex:0})}else this._images.push({byteWidth:s(i,l,u),height:a,lineIndex:0});this._xComparison=8===u?l:16===u?2*l:1};o.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},o.prototype._unFilterType1=function(t,r,i){let n=this._xComparison,a=n-1;for(let s=0;s<i;s++){let i=t[1+s],o=s>a?r[s-n]:0;r[s]=i+o}},o.prototype._unFilterType2=function(t,r,i){let n=this._lastLine;for(let a=0;a<i;a++){let i=t[1+a],s=n?n[a]:0;r[a]=i+s}},o.prototype._unFilterType3=function(t,r,i){let n=this._xComparison,a=n-1,s=this._lastLine;for(let o=0;o<i;o++){let i=t[1+o],l=s?s[o]:0,u=Math.floor(((o>a?r[o-n]:0)+l)/2);r[o]=i+u}},o.prototype._unFilterType4=function(t,r,i){let n=this._xComparison,s=n-1,o=this._lastLine;for(let l=0;l<i;l++){let i=t[1+l],u=o?o[l]:0,h=a(l>s?r[l-n]:0,u,l>s&&o?o[l-n]:0);r[l]=i+h}},o.prototype._reverseFilterLine=function(t){let r,n=t[0],a=this._images[this._imageIndex],s=a.byteWidth;if(0===n)r=t.slice(1,s+1);else switch(r=i.alloc(s),n){case 1:this._unFilterType1(t,r,s);break;case 2:this._unFilterType2(t,r,s);break;case 3:this._unFilterType3(t,r,s);break;case 4:this._unFilterType4(t,r,s);break;default:throw Error("Unrecognised filter type - "+n)}this.write(r),a.lineIndex++,a.lineIndex>=a.height?(this._lastLine=null,this._imageIndex++,a=this._images[this._imageIndex]):this._lastLine=r,a?this.read(a.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}).call(this)}).call(this,t("buffer").Buffer)},{"./interlace":11,"./paeth-predictor":15,buffer:32}],10:[function(t,r,i){(function(t){(function(){function i(t,r,i,n,a){let s=0;for(let o=0;o<n;o++)for(let n=0;n<i;n++){let i=a[t[s]];if(!i)throw Error("index "+t[s]+" not in palette");for(let t=0;t<4;t++)r[s+t]=i[t];s+=4}}function n(t,r,i,n,a){let s=0;for(let o=0;o<n;o++)for(let n=0;n<i;n++){let i=!1;if(1===a.length?a[0]===t[s]&&(i=!0):a[0]===t[s]&&a[1]===t[s+1]&&a[2]===t[s+2]&&(i=!0),i)for(let t=0;t<4;t++)r[s+t]=0;s+=4}}function a(t,r,i,n,a){let s=255,o=Math.pow(2,a)-1,l=0;for(let a=0;a<n;a++)for(let n=0;n<i;n++){for(let i=0;i<4;i++)r[l+i]=Math.floor(t[l+i]*s/o+.5);l+=4}}r.exports=function(r,s,o=!1){let l=s.depth,u=s.width,h=s.height,f=s.colorType,d=s.transColor,c=s.palette,p=r;return 3===f?i(r,p,u,h,c):(d&&n(r,p,u,h,d),8===l||o||(16===l&&(p=t.alloc(u*h*4)),a(r,p,u,h,l))),p}}).call(this)}).call(this,t("buffer").Buffer)},{buffer:32}],11:[function(t,r,i){let n=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];i.getImagePasses=function(t,r){let i=[],a=t%8,s=r%8,o=(t-a)/8,l=(r-s)/8;for(let t=0;t<n.length;t++){let r=n[t],u=o*r.x.length,h=l*r.y.length;for(let t=0;t<r.x.length&&r.x[t]<a;t++)u++;for(let t=0;t<r.y.length&&r.y[t]<s;t++)h++;u>0&&h>0&&i.push({width:u,height:h,index:t})}return i},i.getInterlaceIterator=function(t){return function(r,i,a){let s=r%n[a].x.length,o=(r-s)/n[a].x.length*8+n[a].x[s],l=i%n[a].y.length;return 4*o+((i-l)/n[a].y.length*8+n[a].y[l])*t*4}}},{}],12:[function(t,r,i){(function(i){(function(){let n=t("util"),a=t("stream"),s=t("./constants"),o=t("./packer"),l=r.exports=function(t){a.call(this);let r=t||{};this._packer=new o(r),this._deflate=this._packer.createDeflate(),this.readable=!0};n.inherits(l,a),l.prototype.pack=function(t,r,n,a){this.emit("data",i.from(s.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(r,n)),a&&this.emit("data",this._packer.packGAMA(a));let o=this._packer.filterData(t,r,n);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",(function(t){this.emit("data",this._packer.packIDAT(t))}).bind(this)),this._deflate.on("end",(function(){this.emit("data",this._packer.packIEND()),this.emit("end")}).bind(this)),this._deflate.end(o)}}).call(this)}).call(this,t("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:32,stream:65,util:84}],13:[function(t,r,i){(function(i){(function(){let n=!0,a=t("zlib");a.deflateSync||(n=!1);let s=t("./constants"),o=t("./packer");r.exports=function(t,r){if(!n)throw Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let l=new o(r||{}),u=[];u.push(i.from(s.PNG_SIGNATURE)),u.push(l.packIHDR(t.width,t.height)),t.gamma&&u.push(l.packGAMA(t.gamma));let h=l.filterData(t.data,t.width,t.height),f=a.deflateSync(h,l.getDeflateOptions());if(h=null,!f||!f.length)throw Error("bad png - invalid compressed data response");return u.push(l.packIDAT(f)),u.push(l.packIEND()),i.concat(u)}}).call(this)}).call(this,t("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:32,zlib:31}],14:[function(t,r,i){(function(i){(function(){let n=t("./constants"),a=t("./crc"),s=t("./bitpacker"),o=t("./filter-pack"),l=t("zlib"),u=r.exports=function(t){if(this._options=t,t.deflateChunkSize=t.deflateChunkSize||32768,t.deflateLevel=null!=t.deflateLevel?t.deflateLevel:9,t.deflateStrategy=null!=t.deflateStrategy?t.deflateStrategy:3,t.inputHasAlpha=null==t.inputHasAlpha||t.inputHasAlpha,t.deflateFactory=t.deflateFactory||l.createDeflate,t.bitDepth=t.bitDepth||8,t.colorType="number"==typeof t.colorType?t.colorType:n.COLORTYPE_COLOR_ALPHA,t.inputColorType="number"==typeof t.inputColorType?t.inputColorType:n.COLORTYPE_COLOR_ALPHA,-1===[n.COLORTYPE_GRAYSCALE,n.COLORTYPE_COLOR,n.COLORTYPE_COLOR_ALPHA,n.COLORTYPE_ALPHA].indexOf(t.colorType))throw Error("option color type:"+t.colorType+" is not supported at present");if(-1===[n.COLORTYPE_GRAYSCALE,n.COLORTYPE_COLOR,n.COLORTYPE_COLOR_ALPHA,n.COLORTYPE_ALPHA].indexOf(t.inputColorType))throw Error("option input color type:"+t.inputColorType+" is not supported at present");if(8!==t.bitDepth&&16!==t.bitDepth)throw Error("option bit depth:"+t.bitDepth+" is not supported at present")};u.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},u.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},u.prototype.filterData=function(t,r,i){let a=s(t,r,i,this._options),l=n.COLORTYPE_TO_BPP_MAP[this._options.colorType];return o(a,r,i,this._options,l)},u.prototype._packChunk=function(t,r){let n=r?r.length:0,s=i.alloc(n+12);return s.writeUInt32BE(n,0),s.writeUInt32BE(t,4),r&&r.copy(s,8),s.writeInt32BE(a.crc32(s.slice(4,s.length-4)),s.length-4),s},u.prototype.packGAMA=function(t){let r=i.alloc(4);return r.writeUInt32BE(Math.floor(t*n.GAMMA_DIVISION),0),this._packChunk(n.TYPE_gAMA,r)},u.prototype.packIHDR=function(t,r){let a=i.alloc(13);return a.writeUInt32BE(t,0),a.writeUInt32BE(r,4),a[8]=this._options.bitDepth,a[9]=this._options.colorType,a[10]=0,a[11]=0,a[12]=0,this._packChunk(n.TYPE_IHDR,a)},u.prototype.packIDAT=function(t){return this._packChunk(n.TYPE_IDAT,t)},u.prototype.packIEND=function(){return this._packChunk(n.TYPE_IEND,null)}}).call(this)}).call(this,t("buffer").Buffer)},{"./bitpacker":2,"./constants":4,"./crc":5,"./filter-pack":6,buffer:32,zlib:31}],15:[function(t,r,i){r.exports=function(t,r,i){let n=t+r-i,a=Math.abs(n-t),s=Math.abs(n-r),o=Math.abs(n-i);return a<=s&&a<=o?t:s<=o?r:i}},{}],16:[function(t,r,i){let n=t("util"),a=t("zlib"),s=t("./chunkstream"),o=t("./filter-parse-async"),l=t("./parser"),u=t("./bitmapper"),h=t("./format-normaliser"),f=r.exports=function(t){s.call(this),this._parser=new l(t,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=t,this.writable=!0,this._parser.start()};n.inherits(f,s),f.prototype._handleError=function(t){this.emit("error",t),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",function(){})),this.errord=!0},f.prototype._inflateData=function(t){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=a.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{let t=(1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3))*this._bitmapInfo.height,r=Math.max(t,a.Z_MIN_CHUNK);this._inflate=a.createInflate({chunkSize:r});let i=t,n=this.emit.bind(this,"error");this._inflate.on("error",function(t){i&&n(t)}),this._filter.on("complete",this._complete.bind(this));let s=this._filter.write.bind(this._filter);this._inflate.on("data",function(t){i&&(t.length>i&&(t=t.slice(0,i)),i-=t.length,s(t))}),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(t)},f.prototype._handleMetaData=function(t){this._metaData=t,this._bitmapInfo=Object.create(t),this._filter=new o(this._bitmapInfo)},f.prototype._handleTransColor=function(t){this._bitmapInfo.transColor=t},f.prototype._handlePalette=function(t){this._bitmapInfo.palette=t},f.prototype._simpleTransparency=function(){this._metaData.alpha=!0},f.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},f.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"))},f.prototype._complete=function(t){let r;if(!this.errord){try{let i=u.dataToBitMap(t,this._bitmapInfo);r=h(i,this._bitmapInfo,this._options.skipRescale),i=null}catch(t){return void this._handleError(t)}this.emit("parsed",r)}}},{"./bitmapper":1,"./chunkstream":3,"./filter-parse-async":7,"./format-normaliser":10,"./parser":18,util:84,zlib:31}],17:[function(t,r,i){(function(i){(function(){let n=!0,a=t("zlib"),s=t("./sync-inflate");a.deflateSync||(n=!1);let o=t("./sync-reader"),l=t("./filter-parse-sync"),u=t("./parser"),h=t("./bitmapper"),f=t("./format-normaliser");r.exports=function(t,r){let d,c,p;if(!n)throw Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");function m(t){d=t}function g(t){c=t}function _(t){c.transColor=t}function b(t){c.palette=t}function y(){c.alpha=!0}function v(t){p=t}let w=[];function x(t){w.push(t)}let k=new o(t);if(new u(r,{read:k.read.bind(k),error:m,metadata:g,gamma:v,palette:b,transColor:_,inflateData:x,simpleTransparency:y}).start(),k.process(),d)throw d;let E,S=i.concat(w);if(w.length=0,c.interlace)E=a.inflateSync(S);else{let t=(1+(c.width*c.bpp*c.depth+7>>3))*c.height;E=s(S,{chunkSize:t,maxLength:t})}if(S=null,!E||!E.length)throw Error("bad png - invalid inflate data response");let $=l.process(E,c);S=null;let I=h.dataToBitMap($,c);$=null;let A=f(I,c,r.skipRescale);return c.data=A,c.gamma=p||0,c}}).call(this)}).call(this,t("buffer").Buffer)},{"./bitmapper":1,"./filter-parse-sync":8,"./format-normaliser":10,"./parser":18,"./sync-inflate":21,"./sync-reader":22,buffer:32,zlib:31}],18:[function(t,r,i){(function(i){(function(){let n=t("./constants"),a=t("./crc"),s=r.exports=function(t,r){this._options=t,t.checkCRC=!1!==t.checkCRC,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[n.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[n.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[n.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[n.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[n.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[n.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=r.read,this.error=r.error,this.metadata=r.metadata,this.gamma=r.gamma,this.transColor=r.transColor,this.palette=r.palette,this.parsed=r.parsed,this.inflateData=r.inflateData,this.finished=r.finished,this.simpleTransparency=r.simpleTransparency,this.headersFinished=r.headersFinished||function(){}};s.prototype.start=function(){this.read(n.PNG_SIGNATURE.length,this._parseSignature.bind(this))},s.prototype._parseSignature=function(t){let r=n.PNG_SIGNATURE;for(let i=0;i<r.length;i++)if(t[i]!==r[i])return void this.error(Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},s.prototype._parseChunkBegin=function(t){let r=t.readUInt32BE(0),s=t.readUInt32BE(4),o="";for(let r=4;r<8;r++)o+=String.fromCharCode(t[r]);let l=!!(32&t[4]);if(this._hasIHDR||s===n.TYPE_IHDR){if(this._crc=new a,this._crc.write(i.from(o)),this._chunks[s])return this._chunks[s](r);l?this.read(r+4,this._skipChunk.bind(this)):this.error(Error("Unsupported critical chunk type "+o))}else this.error(Error("Expected IHDR on beggining"))},s.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},s.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},s.prototype._parseChunkEnd=function(t){let r=t.readInt32BE(0),i=this._crc.crc32();this._options.checkCRC&&i!==r?this.error(Error("Crc error - "+r+" - "+i)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},s.prototype._handleIHDR=function(t){this.read(t,this._parseIHDR.bind(this))},s.prototype._parseIHDR=function(t){this._crc.write(t);let r=t.readUInt32BE(0),i=t.readUInt32BE(4),a=t[8],s=t[9],o=t[10],l=t[11],u=t[12];if(8!==a&&4!==a&&2!==a&&1!==a&&16!==a)return void this.error(Error("Unsupported bit depth "+a));if(!(s in n.COLORTYPE_TO_BPP_MAP))return void this.error(Error("Unsupported color type"));if(0!==o)return void this.error(Error("Unsupported compression method"));if(0!==l)return void this.error(Error("Unsupported filter method"));if(0!==u&&1!==u)return void this.error(Error("Unsupported interlace method"));this._colorType=s;let h=n.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:r,height:i,depth:a,interlace:!!u,palette:!!(s&n.COLORTYPE_PALETTE),color:!!(s&n.COLORTYPE_COLOR),alpha:!!(s&n.COLORTYPE_ALPHA),bpp:h,colorType:s}),this._handleChunkEnd()},s.prototype._handlePLTE=function(t){this.read(t,this._parsePLTE.bind(this))},s.prototype._parsePLTE=function(t){this._crc.write(t);let r=Math.floor(t.length/3);for(let i=0;i<r;i++)this._palette.push([t[3*i],t[3*i+1],t[3*i+2],255]);this.palette(this._palette),this._handleChunkEnd()},s.prototype._handleTRNS=function(t){this.simpleTransparency(),this.read(t,this._parseTRNS.bind(this))},s.prototype._parseTRNS=function(t){if(this._crc.write(t),this._colorType===n.COLORTYPE_PALETTE_COLOR){if(0===this._palette.length)return void this.error(Error("Transparency chunk must be after palette"));if(t.length>this._palette.length)return void this.error(Error("More transparent colors than palette size"));for(let r=0;r<t.length;r++)this._palette[r][3]=t[r];this.palette(this._palette)}this._colorType===n.COLORTYPE_GRAYSCALE&&this.transColor([t.readUInt16BE(0)]),this._colorType===n.COLORTYPE_COLOR&&this.transColor([t.readUInt16BE(0),t.readUInt16BE(2),t.readUInt16BE(4)]),this._handleChunkEnd()},s.prototype._handleGAMA=function(t){this.read(t,this._parseGAMA.bind(this))},s.prototype._parseGAMA=function(t){this._crc.write(t),this.gamma(t.readUInt32BE(0)/n.GAMMA_DIVISION),this._handleChunkEnd()},s.prototype._handleIDAT=function(t){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-t,this._parseIDAT.bind(this,t))},s.prototype._parseIDAT=function(t,r){if(this._crc.write(r),this._colorType===n.COLORTYPE_PALETTE_COLOR&&0===this._palette.length)throw Error("Expected palette not found");this.inflateData(r);let i=t-r.length;i>0?this._handleIDAT(i):this._handleChunkEnd()},s.prototype._handleIEND=function(t){this.read(t,this._parseIEND.bind(this))},s.prototype._parseIEND=function(t){this._crc.write(t),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}).call(this)}).call(this,t("buffer").Buffer)},{"./constants":4,"./crc":5,buffer:32}],19:[function(t,r,i){let n=t("./parser-sync"),a=t("./packer-sync");i.read=function(t,r){return n(t,r||{})},i.write=function(t,r){return a(t,r)}},{"./packer-sync":13,"./parser-sync":17}],20:[function(t,r,i){(function(r,n){(function(){let a=t("util"),s=t("stream"),o=t("./parser-async"),l=t("./packer-async"),u=t("./png-sync"),h=i.PNG=function(t){s.call(this),t=t||{},this.width=0|t.width,this.height=0|t.height,this.data=this.width>0&&this.height>0?n.alloc(4*this.width*this.height):null,t.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new o(t),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",(function(t){this.data=t,this.emit("parsed",t)}).bind(this)),this._packer=new l(t),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};a.inherits(h,s),h.sync=u,h.prototype.pack=function(){return this.data&&this.data.length?r.nextTick((function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}).bind(this)):this.emit("error","No data provided"),this},h.prototype.parse=function(t,r){if(r){let t,i;t=(function(t){this.removeListener("error",i),this.data=t,r(null,this)}).bind(this),i=(function(i){this.removeListener("parsed",t),r(i,null)}).bind(this),this.once("parsed",t),this.once("error",i)}return this.end(t),this},h.prototype.write=function(t){return this._parser.write(t),!0},h.prototype.end=function(t){this._parser.end(t)},h.prototype._metadata=function(t){this.width=t.width,this.height=t.height,this.emit("metadata",t)},h.prototype._gamma=function(t){this.gamma=t},h.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},h.bitblt=function(t,r,i,n,a,s,o,l){if(n|=0,a|=0,s|=0,o|=0,l|=0,(i|=0)>t.width||n>t.height||i+a>t.width||n+s>t.height)throw Error("bitblt reading outside image");if(o>r.width||l>r.height||o+a>r.width||l+s>r.height)throw Error("bitblt writing outside image");for(let u=0;u<s;u++)t.data.copy(r.data,(l+u)*r.width+o<<2,(n+u)*t.width+i<<2,(n+u)*t.width+i+a<<2)},h.prototype.bitblt=function(t,r,i,n,a,s,o){return h.bitblt(this,t,r,i,n,a,s,o),this},h.adjustGamma=function(t){if(t.gamma){for(let r=0;r<t.height;r++)for(let i=0;i<t.width;i++){let n=t.width*r+i<<2;for(let r=0;r<3;r++){let i=t.data[n+r]/255;i=Math.pow(i,1/2.2/t.gamma),t.data[n+r]=Math.round(255*i)}}t.gamma=0}},h.prototype.adjustGamma=function(){h.adjustGamma(this)}}).call(this)}).call(this,t("_process"),t("buffer").Buffer)},{"./packer-async":12,"./parser-async":16,"./png-sync":19,_process:63,buffer:32,stream:65,util:84}],21:[function(t,r,i){(function(n,a){(function(){let n=t("assert").ok,s=t("zlib"),o=t("util"),l=t("buffer").kMaxLength;function u(t){if(!(this instanceof u))return new u(t);t&&t.chunkSize<s.Z_MIN_CHUNK&&(t.chunkSize=s.Z_MIN_CHUNK),s.Inflate.call(this,t),this._offset=void 0===this._offset?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,t&&null!=t.maxLength&&(this._maxLength=t.maxLength)}function h(t){return new u(t)}function f(t,r){t._handle&&(t._handle.close(),t._handle=null)}function d(t,r){if("string"==typeof r&&(r=a.from(r)),!(r instanceof a))throw TypeError("Not a string or buffer");let i=t._finishFlushFlag;return null==i&&(i=s.Z_FINISH),t._processChunk(r,i)}function c(t,r){return d(new u(r),t)}u.prototype._processChunk=function(t,r,i){if("function"==typeof i)return s.Inflate._processChunk.call(this,t,r,i);let o,u,h=this,d=t&&t.length,c=this._chunkSize-this._offset,p=this._maxLength,m=0,g=[],_=0;function b(t,r){if(h._hadError)return;let i=c-r;if(n(i>=0,"have should not go down"),i>0){let t=h._buffer.slice(h._offset,h._offset+i);if(h._offset+=i,t.length>p&&(t=t.slice(0,p)),g.push(t),_+=t.length,0==(p-=t.length))return!1}return(0===r||h._offset>=h._chunkSize)&&(c=h._chunkSize,h._offset=0,h._buffer=a.allocUnsafe(h._chunkSize)),0===r&&(m+=d-t,d=t,!0)}this.on("error",function(t){o=t}),n(this._handle,"zlib binding closed");do u=(u=this._handle.writeSync(r,t,m,d,this._buffer,this._offset,c))||this._writeState;while(!this._hadError&&b(u[0],u[1]))if(this._hadError)throw o;if(_>=l)throw f(this),RangeError("Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes");let y=a.concat(g,_);return f(this),y},o.inherits(u,s.Inflate),r.exports=i=c,i.Inflate=u,i.createInflate=h,i.inflateSync=c}).call(this)}).call(this,t("_process"),t("buffer").Buffer)},{_process:63,assert:23,buffer:32,util:84,zlib:31}],22:[function(t,r,i){let n=r.exports=function(t){this._buffer=t,this._reads=[]};n.prototype.read=function(t,r){this._reads.push({length:Math.abs(t),allowLess:t<0,func:r})},n.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){let t=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=t.length||t.allowLess))break;{this._reads.shift();let r=this._buffer;this._buffer=r.slice(t.length),t.func.call(this,r.slice(0,t.length))}}if(this._reads.length>0)throw Error("There are some read requests waitng on finished stream");if(this._buffer.length>0)throw Error("unrecognised content at end of stream")}},{}],23:[function(t,r,i){(function(i){(function(){var n=t("object-assign");function a(t,r){if(t===r)return 0;for(var i=t.length,n=r.length,a=0,s=Math.min(i,n);a<s;++a)if(t[a]!==r[a]){i=t[a],n=r[a];break}return i<n?-1:+(n<i)}function s(t){return i.Buffer&&"function"==typeof i.Buffer.isBuffer?i.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var o=t("util/"),l=Object.prototype.hasOwnProperty,u=Array.prototype.slice,h="foo"===(function(){}).name;function f(t){return Object.prototype.toString.call(t)}function d(t){return!s(t)&&"function"==typeof i.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer)))}var c=r.exports=v,p=/\s*function\s+([^\(\s]*)\s*/;function m(t){if(o.isFunction(t)){if(h)return t.name;var r=t.toString().match(p);return r&&r[1]}}function g(t,r){return"string"==typeof t?t.length<r?t:t.slice(0,r):t}function _(t){if(h||!o.isFunction(t))return o.inspect(t);var r=m(t);return"[Function"+(r?": "+r:"")+"]"}function b(t){return g(_(t.actual),128)+" "+t.operator+" "+g(_(t.expected),128)}function y(t,r,i,n,a){throw new c.AssertionError({message:i,actual:t,expected:r,operator:n,stackStartFunction:a})}function v(t,r){t||y(t,!0,r,"==",c.ok)}function w(t,r,i,n){if(t===r)return!0;if(s(t)&&s(r))return 0===a(t,r);if(o.isDate(t)&&o.isDate(r))return t.getTime()===r.getTime();if(o.isRegExp(t)&&o.isRegExp(r))return t.source===r.source&&t.global===r.global&&t.multiline===r.multiline&&t.lastIndex===r.lastIndex&&t.ignoreCase===r.ignoreCase;if(null!==t&&"object"==typeof t||null!==r&&"object"==typeof r){if(d(t)&&d(r)&&f(t)===f(r)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===a(new Uint8Array(t.buffer),new Uint8Array(r.buffer));if(s(t)!==s(r))return!1;var l=(n=n||{actual:[],expected:[]}).actual.indexOf(t);return -1!==l&&l===n.expected.indexOf(r)||(n.actual.push(t),n.expected.push(r),k(t,r,i,n))}return i?t===r:t==r}function x(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function k(t,r,i,n){if(null==t||null==r)return!1;if(o.isPrimitive(t)||o.isPrimitive(r))return t===r;if(i&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(r))return!1;var a=x(t),s=x(r);if(a&&!s||!a&&s)return!1;if(a)return w(t=u.call(t),r=u.call(r),i);var l,h,f=M(t),d=M(r);if(f.length!==d.length)return!1;for(f.sort(),d.sort(),h=f.length-1;h>=0;h--)if(f[h]!==d[h])return!1;for(h=f.length-1;h>=0;h--)if(!w(t[l=f[h]],r[l],i,n))return!1;return!0}function E(t,r,i){w(t,r,!0)&&y(t,r,i,"notDeepStrictEqual",E)}function S(t,r){if(!t||!r)return!1;if("[object RegExp]"==Object.prototype.toString.call(r))return r.test(t);try{if(t instanceof r)return!0}catch(t){}return!Error.isPrototypeOf(r)&&!0===r.call({},t)}function $(t){var r;try{t()}catch(t){r=t}return r}function I(t,r,i,n){if("function"!=typeof r)throw TypeError('"block" argument must be a function');"string"==typeof i&&(n=i,i=null),a=$(r),n=(i&&i.name?" ("+i.name+").":".")+(n?" "+n:"."),t&&!a&&y(a,i,"Missing expected exception"+n);var a,s="string"==typeof n,l=!t&&a&&!i;if((!t&&o.isError(a)&&s&&S(a,i)||l)&&y(a,i,"Got unwanted exception"+n),t&&a&&i&&!S(a,i)||!t&&a)throw a}function A(t,r){t||y(t,!0,r,"==",A)}c.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=b(this),this.generatedMessage=!0);var r=t.stackStartFunction||y;if(Error.captureStackTrace)Error.captureStackTrace(this,r);else{var i=Error();if(i.stack){var n=i.stack,a=m(r),s=n.indexOf("\n"+a);if(s>=0){var o=n.indexOf("\n",s+1);n=n.substring(o+1)}this.stack=n}}},o.inherits(c.AssertionError,Error),c.fail=y,c.ok=v,c.equal=function(t,r,i){t!=r&&y(t,r,i,"==",c.equal)},c.notEqual=function(t,r,i){t==r&&y(t,r,i,"!=",c.notEqual)},c.deepEqual=function(t,r,i){w(t,r,!1)||y(t,r,i,"deepEqual",c.deepEqual)},c.deepStrictEqual=function(t,r,i){w(t,r,!0)||y(t,r,i,"deepStrictEqual",c.deepStrictEqual)},c.notDeepEqual=function(t,r,i){w(t,r,!1)&&y(t,r,i,"notDeepEqual",c.notDeepEqual)},c.notDeepStrictEqual=E,c.strictEqual=function(t,r,i){t!==r&&y(t,r,i,"===",c.strictEqual)},c.notStrictEqual=function(t,r,i){t===r&&y(t,r,i,"!==",c.notStrictEqual)},c.throws=function(t,r,i){I(!0,t,r,i)},c.doesNotThrow=function(t,r,i){I(!1,t,r,i)},c.ifError=function(t){if(t)throw t},c.strict=n(A,c,{equal:c.strictEqual,deepEqual:c.deepStrictEqual,notEqual:c.notStrictEqual,notDeepEqual:c.notDeepStrictEqual}),c.strict.strict=c.strict;var M=Object.keys||function(t){var r=[];for(var i in t)l.call(t,i)&&r.push(i);return r}}).call(this)}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"object-assign":51,"util/":26}],24:[function(t,r,i){"function"==typeof Object.create?r.exports=function(t,r){t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:r.exports=function(t,r){t.super_=r;var i=function(){};i.prototype=r.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],25:[function(t,r,i){r.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],26:[function(t,r,i){(function(r,n){(function(){var a=/%[sdj%]/g;i.format=function(t){if(!k(t)){for(var r=[],i=0;i<arguments.length;i++)r.push(l(arguments[i]));return r.join(" ")}i=1;for(var n=arguments,s=n.length,o=String(t).replace(a,function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}}),u=n[i];i<s;u=n[++i])v(u)||!I(u)?o+=" "+u:o+=" "+l(u);return o},i.deprecate=function(t,a){if(S(n.process))return function(){return i.deprecate(t,a).apply(this,arguments)};if(!0===r.noDeprecation)return t;var s=!1;return function(){if(!s){if(r.throwDeprecation)throw Error(a);r.traceDeprecation?console.trace(a):console.error(a),s=!0}return t.apply(this,arguments)}};var s,o={};function l(t,r){var n={seen:[],stylize:h};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(r)?n.showHidden=r:r&&i._extend(n,r),S(n.showHidden)&&(n.showHidden=!1),S(n.depth)&&(n.depth=2),S(n.colors)&&(n.colors=!1),S(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),d(n,t,n.depth)}function u(t,r){var i=l.styles[r];return i?"\x1b["+l.colors[i][0]+"m"+t+"\x1b["+l.colors[i][1]+"m":t}function h(t,r){return t}function f(t){var r={};return t.forEach(function(t,i){r[t]=!0}),r}function d(t,r,n){if(t.customInspect&&r&&T(r.inspect)&&r.inspect!==i.inspect&&(!r.constructor||r.constructor.prototype!==r)){var a=r.inspect(n,t);return k(a)||(a=d(t,a,n)),a}var s=c(t,r);if(s)return s;var o=Object.keys(r),l=f(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(r)),M(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return p(r);if(0===o.length){if(T(r)){var u=r.name?": "+r.name:"";return t.stylize("[Function"+u+"]","special")}if($(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(A(r))return t.stylize(Date.prototype.toString.call(r),"date");if(M(r))return p(r)}var h,y="",v=!1,w=["{","}"];return b(r)&&(v=!0,w=["[","]"]),T(r)&&(y=" [Function"+(r.name?": "+r.name:"")+"]"),$(r)&&(y=" "+RegExp.prototype.toString.call(r)),A(r)&&(y=" "+Date.prototype.toUTCString.call(r)),M(r)&&(y=" "+p(r)),0!==o.length||v&&0!=r.length?n<0?$(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),h=v?m(t,r,n,l,o):o.map(function(i){return g(t,r,n,l,i,v)}),t.seen.pop(),_(h,y,w)):w[0]+y+w[1]}function c(t,r){if(S(r))return t.stylize("undefined","undefined");if(k(r)){var i="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return x(r)?t.stylize(""+r,"number"):y(r)?t.stylize(""+r,"boolean"):v(r)?t.stylize("null","null"):void 0}function p(t){return"["+Error.prototype.toString.call(t)+"]"}function m(t,r,i,n,a){for(var s=[],o=0,l=r.length;o<l;++o)P(r,String(o))?s.push(g(t,r,i,n,String(o),!0)):s.push("");return a.forEach(function(a){a.match(/^\d+$/)||s.push(g(t,r,i,n,a,!0))}),s}function g(t,r,i,n,a,s){var o,l,u;if((u=Object.getOwnPropertyDescriptor(r,a)||{value:r[a]}).get?l=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(l=t.stylize("[Setter]","special")),P(n,a)||(o="["+a+"]"),l||(0>t.seen.indexOf(u.value)?(l=v(i)?d(t,u.value,null):d(t,u.value,i-1)).indexOf("\n")>-1&&(l=s?l.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+l.split("\n").map(function(t){return"   "+t}).join("\n")):l=t.stylize("[Circular]","special")),S(o)){if(s&&a.match(/^\d+$/))return l;(o=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+l}function _(t,r,i){return t.reduce(function(t,r){return r.indexOf("\n"),t+r.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?i[0]+(""===r?"":r+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+r+" "+t.join(", ")+" "+i[1]}function b(t){return Array.isArray(t)}function y(t){return"boolean"==typeof t}function v(t){return null===t}function w(t){return null==t}function x(t){return"number"==typeof t}function k(t){return"string"==typeof t}function E(t){return"symbol"==typeof t}function S(t){return void 0===t}function $(t){return I(t)&&"[object RegExp]"===z(t)}function I(t){return"object"==typeof t&&null!==t}function A(t){return I(t)&&"[object Date]"===z(t)}function M(t){return I(t)&&("[object Error]"===z(t)||t instanceof Error)}function T(t){return"function"==typeof t}function C(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function z(t){return Object.prototype.toString.call(t)}function R(t){return t<10?"0"+t.toString(10):t.toString(10)}i.debuglog=function(t){if(S(s)&&(s=r.env.NODE_DEBUG||""),!o[t=t.toUpperCase()])if(RegExp("\\b"+t+"\\b","i").test(s)){var n=r.pid;o[t]=function(){var r=i.format.apply(i,arguments);console.error("%s %d: %s",t,n,r)}}else o[t]=function(){};return o[t]},i.inspect=l,l.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.isArray=b,i.isBoolean=y,i.isNull=v,i.isNullOrUndefined=w,i.isNumber=x,i.isString=k,i.isSymbol=E,i.isUndefined=S,i.isRegExp=$,i.isObject=I,i.isDate=A,i.isError=M,i.isFunction=T,i.isPrimitive=C,i.isBuffer=t("./support/isBuffer");var B=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function O(){var t=new Date,r=[R(t.getHours()),R(t.getMinutes()),R(t.getSeconds())].join(":");return[t.getDate(),B[t.getMonth()],r].join(" ")}function P(t,r){return Object.prototype.hasOwnProperty.call(t,r)}i.log=function(){console.log("%s - %s",O(),i.format.apply(i,arguments))},i.inherits=t("inherits"),i._extend=function(t,r){if(!r||!I(r))return t;for(var i=Object.keys(r),n=i.length;n--;)t[i[n]]=r[i[n]];return t}}).call(this)}).call(this,t("_process"),void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":25,_process:63,inherits:24}],27:[function(t,r,i){(function(t){(function(){var i=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],n="undefined"==typeof globalThis?t:globalThis;r.exports=function(){for(var t=[],r=0;r<i.length;r++)"function"==typeof n[i[r]]&&(t[t.length]=i[r]);return t}}).call(this)}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(t,r,i){i.byteLength=f,i.toByteArray=c,i.fromByteArray=g;for(var n=[],a=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,u=o.length;l<u;++l)n[l]=o[l],a[o.charCodeAt(l)]=l;function h(t){var r=t.length;if(r%4>0)throw Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return -1===i&&(i=r),[i,i===r?0:4-i%4]}function f(t){var r=h(t),i=r[0],n=r[1];return 3*(i+n)/4-n}function d(t,r,i){return 3*(r+i)/4-i}function c(t){var r,i,n=h(t),o=n[0],l=n[1],u=new s(d(t,o,l)),f=0,c=l>0?o-4:o;for(i=0;i<c;i+=4)r=a[t.charCodeAt(i)]<<18|a[t.charCodeAt(i+1)]<<12|a[t.charCodeAt(i+2)]<<6|a[t.charCodeAt(i+3)],u[f++]=r>>16&255,u[f++]=r>>8&255,u[f++]=255&r;return 2===l&&(r=a[t.charCodeAt(i)]<<2|a[t.charCodeAt(i+1)]>>4,u[f++]=255&r),1===l&&(r=a[t.charCodeAt(i)]<<10|a[t.charCodeAt(i+1)]<<4|a[t.charCodeAt(i+2)]>>2,u[f++]=r>>8&255,u[f++]=255&r),u}function p(t){return n[t>>18&63]+n[t>>12&63]+n[t>>6&63]+n[63&t]}function m(t,r,i){for(var n=[],a=r;a<i;a+=3)n.push(p((t[a]<<16&0xff0000)+(t[a+1]<<8&65280)+(255&t[a+2])));return n.join("")}function g(t){for(var r,i=t.length,a=i%3,s=[],o=16383,l=0,u=i-a;l<u;l+=o)s.push(m(t,l,l+o>u?u:l+o));return 1===a?s.push(n[(r=t[i-1])>>2]+n[r<<4&63]+"=="):2===a&&s.push(n[(r=(t[i-2]<<8)+t[i-1])>>10]+n[r>>4&63]+n[r<<2&63]+"="),s.join("")}a[45]=62,a[95]=63},{}],29:[function(t,r,i){},{}],30:[function(t,r,i){(function(r,n){(function(){var a=t("assert"),s=t("pako/lib/zlib/zstream"),o=t("pako/lib/zlib/deflate.js"),l=t("pako/lib/zlib/inflate.js"),u=t("pako/lib/zlib/constants");for(var h in u)i[h]=u[h];i.NONE=0,i.DEFLATE=1,i.INFLATE=2,i.GZIP=3,i.GUNZIP=4,i.DEFLATERAW=5,i.INFLATERAW=6,i.UNZIP=7;var f=31,d=139;function c(t){if("number"!=typeof t||t<i.DEFLATE||t>i.UNZIP)throw TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=t,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}c.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,a(this.init_done,"close before init"),a(this.mode<=i.UNZIP),this.mode===i.DEFLATE||this.mode===i.GZIP||this.mode===i.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==i.INFLATE&&this.mode!==i.GUNZIP&&this.mode!==i.INFLATERAW&&this.mode!==i.UNZIP||l.inflateEnd(this.strm),this.mode=i.NONE,this.dictionary=null)},c.prototype.write=function(t,r,i,n,a,s,o){return this._write(!0,t,r,i,n,a,s,o)},c.prototype.writeSync=function(t,r,i,n,a,s,o){return this._write(!1,t,r,i,n,a,s,o)},c.prototype._write=function(t,s,o,l,u,h,f,d){if(a.equal(arguments.length,8),a(this.init_done,"write before init"),a(this.mode!==i.NONE,"already finalized"),a.equal(!1,this.write_in_progress,"write already in progress"),a.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,a.equal(!1,void 0===s,"must provide flush value"),this.write_in_progress=!0,s!==i.Z_NO_FLUSH&&s!==i.Z_PARTIAL_FLUSH&&s!==i.Z_SYNC_FLUSH&&s!==i.Z_FULL_FLUSH&&s!==i.Z_FINISH&&s!==i.Z_BLOCK)throw Error("Invalid flush value");if(null==o&&(o=n.alloc(0),u=0,l=0),this.strm.avail_in=u,this.strm.input=o,this.strm.next_in=l,this.strm.avail_out=d,this.strm.output=h,this.strm.next_out=f,this.flush=s,!t)return this._process(),this._checkError()?this._afterSync():void 0;var c=this;return r.nextTick(function(){c._process(),c._after()}),this},c.prototype._afterSync=function(){var t=this.strm.avail_out,r=this.strm.avail_in;return this.write_in_progress=!1,[r,t]},c.prototype._process=function(){var t=null;switch(this.mode){case i.DEFLATE:case i.GZIP:case i.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case i.UNZIP:switch(this.strm.avail_in>0&&(t=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===t)break;if(this.strm.input[t]!==f){this.mode=i.INFLATE;break}if(this.gzip_id_bytes_read=1,t++,1===this.strm.avail_in)break;case 1:if(null===t)break;this.strm.input[t]===d?(this.gzip_id_bytes_read=2,this.mode=i.GUNZIP):this.mode=i.INFLATE;break;default:throw Error("invalid number of gzip magic number bytes read")}case i.INFLATE:case i.GUNZIP:case i.INFLATERAW:for(this.err=l.inflate(this.strm,this.flush),this.err===i.Z_NEED_DICT&&this.dictionary&&(this.err=l.inflateSetDictionary(this.strm,this.dictionary),this.err===i.Z_OK?this.err=l.inflate(this.strm,this.flush):this.err===i.Z_DATA_ERROR&&(this.err=i.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===i.GUNZIP&&this.err===i.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=l.inflate(this.strm,this.flush);break;default:throw Error("Unknown mode "+this.mode)}},c.prototype._checkError=function(){switch(this.err){case i.Z_OK:case i.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===i.Z_FINISH)return this._error("unexpected end of file"),!1;break;case i.Z_STREAM_END:break;case i.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},c.prototype._after=function(){if(this._checkError()){var t=this.strm.avail_out,r=this.strm.avail_in;this.write_in_progress=!1,this.callback(r,t),this.pending_close&&this.close()}},c.prototype._error=function(t){this.strm.msg&&(t=this.strm.msg),this.onerror(t,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},c.prototype.init=function(t,r,n,s,o){a(4==arguments.length||5==arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),a(t>=8&&t<=15,"invalid windowBits"),a(r>=-1&&r<=9,"invalid compression level"),a(n>=1&&n<=9,"invalid memlevel"),a(s===i.Z_FILTERED||s===i.Z_HUFFMAN_ONLY||s===i.Z_RLE||s===i.Z_FIXED||s===i.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(r,t,n,s,o),this._setDictionary()},c.prototype.params=function(){throw Error("deflateParams Not supported")},c.prototype.reset=function(){this._reset(),this._setDictionary()},c.prototype._init=function(t,r,n,a,u){switch(this.level=t,this.windowBits=r,this.memLevel=n,this.strategy=a,this.flush=i.Z_NO_FLUSH,this.err=i.Z_OK,this.mode!==i.GZIP&&this.mode!==i.GUNZIP||(this.windowBits+=16),this.mode===i.UNZIP&&(this.windowBits+=32),this.mode!==i.DEFLATERAW&&this.mode!==i.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new s,this.mode){case i.DEFLATE:case i.GZIP:case i.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,i.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case i.INFLATE:case i.GUNZIP:case i.INFLATERAW:case i.UNZIP:this.err=l.inflateInit2(this.strm,this.windowBits);break;default:throw Error("Unknown mode "+this.mode)}this.err!==i.Z_OK&&this._error("Init error"),this.dictionary=u,this.write_in_progress=!1,this.init_done=!0},c.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=i.Z_OK,this.mode){case i.DEFLATE:case i.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary)}this.err!==i.Z_OK&&this._error("Failed to set dictionary")}},c.prototype._reset=function(){switch(this.err=i.Z_OK,this.mode){case i.DEFLATE:case i.DEFLATERAW:case i.GZIP:this.err=o.deflateReset(this.strm);break;case i.INFLATE:case i.INFLATERAW:case i.GUNZIP:this.err=l.inflateReset(this.strm)}this.err!==i.Z_OK&&this._error("Failed to reset stream")},i.Zlib=c}).call(this)}).call(this,t("_process"),t("buffer").Buffer)},{_process:63,assert:23,buffer:32,"pako/lib/zlib/constants":54,"pako/lib/zlib/deflate.js":56,"pako/lib/zlib/inflate.js":58,"pako/lib/zlib/zstream":62}],31:[function(t,r,i){(function(r){(function(){var n=t("buffer").Buffer,a=t("stream").Transform,s=t("./binding"),o=t("util"),l=t("assert").ok,u=t("buffer").kMaxLength,h="Cannot create final Buffer. It would be larger than 0x"+u.toString(16)+" bytes";s.Z_MIN_WINDOWBITS=8,s.Z_MAX_WINDOWBITS=15,s.Z_DEFAULT_WINDOWBITS=15,s.Z_MIN_CHUNK=64,s.Z_MAX_CHUNK=1/0,s.Z_DEFAULT_CHUNK=16384,s.Z_MIN_MEMLEVEL=1,s.Z_MAX_MEMLEVEL=9,s.Z_DEFAULT_MEMLEVEL=8,s.Z_MIN_LEVEL=-1,s.Z_MAX_LEVEL=9,s.Z_DEFAULT_LEVEL=s.Z_DEFAULT_COMPRESSION;for(var f=Object.keys(s),d=0;d<f.length;d++){var c=f[d];c.match(/^Z/)&&Object.defineProperty(i,c,{enumerable:!0,value:s[c],writable:!1})}for(var p={Z_OK:s.Z_OK,Z_STREAM_END:s.Z_STREAM_END,Z_NEED_DICT:s.Z_NEED_DICT,Z_ERRNO:s.Z_ERRNO,Z_STREAM_ERROR:s.Z_STREAM_ERROR,Z_DATA_ERROR:s.Z_DATA_ERROR,Z_MEM_ERROR:s.Z_MEM_ERROR,Z_BUF_ERROR:s.Z_BUF_ERROR,Z_VERSION_ERROR:s.Z_VERSION_ERROR},m=Object.keys(p),g=0;g<m.length;g++){var _=m[g];p[p[_]]=_}function b(t,r,i){var a=[],s=0;function o(){for(var r;null!==(r=t.read());)a.push(r),s+=r.length;t.once("readable",o)}function l(r){t.removeListener("end",f),t.removeListener("readable",o),i(r)}function f(){var r,o=null;s>=u?o=RangeError(h):r=n.concat(a,s),a=[],t.close(),i(o,r)}t.on("error",l),t.on("end",f),t.end(r),o()}function y(t,r){if("string"==typeof r&&(r=n.from(r)),!n.isBuffer(r))throw TypeError("Not a string or buffer");var i=t._finishFlushFlag;return t._processChunk(r,i)}function v(t){if(!(this instanceof v))return new v(t);A.call(this,t,s.DEFLATE)}function w(t){if(!(this instanceof w))return new w(t);A.call(this,t,s.INFLATE)}function x(t){if(!(this instanceof x))return new x(t);A.call(this,t,s.GZIP)}function k(t){if(!(this instanceof k))return new k(t);A.call(this,t,s.GUNZIP)}function E(t){if(!(this instanceof E))return new E(t);A.call(this,t,s.DEFLATERAW)}function S(t){if(!(this instanceof S))return new S(t);A.call(this,t,s.INFLATERAW)}function $(t){if(!(this instanceof $))return new $(t);A.call(this,t,s.UNZIP)}function I(t){return t===s.Z_NO_FLUSH||t===s.Z_PARTIAL_FLUSH||t===s.Z_SYNC_FLUSH||t===s.Z_FULL_FLUSH||t===s.Z_FINISH||t===s.Z_BLOCK}function A(t,r){var o=this;if(this._opts=t=t||{},this._chunkSize=t.chunkSize||i.Z_DEFAULT_CHUNK,a.call(this,t),t.flush&&!I(t.flush))throw Error("Invalid flush flag: "+t.flush);if(t.finishFlush&&!I(t.finishFlush))throw Error("Invalid flush flag: "+t.finishFlush);if(this._flushFlag=t.flush||s.Z_NO_FLUSH,this._finishFlushFlag=void 0!==t.finishFlush?t.finishFlush:s.Z_FINISH,t.chunkSize&&(t.chunkSize<i.Z_MIN_CHUNK||t.chunkSize>i.Z_MAX_CHUNK))throw Error("Invalid chunk size: "+t.chunkSize);if(t.windowBits&&(t.windowBits<i.Z_MIN_WINDOWBITS||t.windowBits>i.Z_MAX_WINDOWBITS))throw Error("Invalid windowBits: "+t.windowBits);if(t.level&&(t.level<i.Z_MIN_LEVEL||t.level>i.Z_MAX_LEVEL))throw Error("Invalid compression level: "+t.level);if(t.memLevel&&(t.memLevel<i.Z_MIN_MEMLEVEL||t.memLevel>i.Z_MAX_MEMLEVEL))throw Error("Invalid memLevel: "+t.memLevel);if(t.strategy&&t.strategy!=i.Z_FILTERED&&t.strategy!=i.Z_HUFFMAN_ONLY&&t.strategy!=i.Z_RLE&&t.strategy!=i.Z_FIXED&&t.strategy!=i.Z_DEFAULT_STRATEGY)throw Error("Invalid strategy: "+t.strategy);if(t.dictionary&&!n.isBuffer(t.dictionary))throw Error("Invalid dictionary: it should be a Buffer instance");this._handle=new s.Zlib(r);var l=this;this._hadError=!1,this._handle.onerror=function(t,r){M(l),l._hadError=!0;var n=Error(t);n.errno=r,n.code=i.codes[r],l.emit("error",n)};var u=i.Z_DEFAULT_COMPRESSION;"number"==typeof t.level&&(u=t.level);var h=i.Z_DEFAULT_STRATEGY;"number"==typeof t.strategy&&(h=t.strategy),this._handle.init(t.windowBits||i.Z_DEFAULT_WINDOWBITS,u,t.memLevel||i.Z_DEFAULT_MEMLEVEL,h,t.dictionary),this._buffer=n.allocUnsafe(this._chunkSize),this._offset=0,this._level=u,this._strategy=h,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!o._handle},configurable:!0,enumerable:!0})}function M(t,i){i&&r.nextTick(i),t._handle&&(t._handle.close(),t._handle=null)}function T(t){t.emit("close")}Object.defineProperty(i,"codes",{enumerable:!0,value:Object.freeze(p),writable:!1}),i.Deflate=v,i.Inflate=w,i.Gzip=x,i.Gunzip=k,i.DeflateRaw=E,i.InflateRaw=S,i.Unzip=$,i.createDeflate=function(t){return new v(t)},i.createInflate=function(t){return new w(t)},i.createDeflateRaw=function(t){return new E(t)},i.createInflateRaw=function(t){return new S(t)},i.createGzip=function(t){return new x(t)},i.createGunzip=function(t){return new k(t)},i.createUnzip=function(t){return new $(t)},i.deflate=function(t,r,i){return"function"==typeof r&&(i=r,r={}),b(new v(r),t,i)},i.deflateSync=function(t,r){return y(new v(r),t)},i.gzip=function(t,r,i){return"function"==typeof r&&(i=r,r={}),b(new x(r),t,i)},i.gzipSync=function(t,r){return y(new x(r),t)},i.deflateRaw=function(t,r,i){return"function"==typeof r&&(i=r,r={}),b(new E(r),t,i)},i.deflateRawSync=function(t,r){return y(new E(r),t)},i.unzip=function(t,r,i){return"function"==typeof r&&(i=r,r={}),b(new $(r),t,i)},i.unzipSync=function(t,r){return y(new $(r),t)},i.inflate=function(t,r,i){return"function"==typeof r&&(i=r,r={}),b(new w(r),t,i)},i.inflateSync=function(t,r){return y(new w(r),t)},i.gunzip=function(t,r,i){return"function"==typeof r&&(i=r,r={}),b(new k(r),t,i)},i.gunzipSync=function(t,r){return y(new k(r),t)},i.inflateRaw=function(t,r,i){return"function"==typeof r&&(i=r,r={}),b(new S(r),t,i)},i.inflateRawSync=function(t,r){return y(new S(r),t)},o.inherits(A,a),A.prototype.params=function(t,n,a){if(t<i.Z_MIN_LEVEL||t>i.Z_MAX_LEVEL)throw RangeError("Invalid compression level: "+t);if(n!=i.Z_FILTERED&&n!=i.Z_HUFFMAN_ONLY&&n!=i.Z_RLE&&n!=i.Z_FIXED&&n!=i.Z_DEFAULT_STRATEGY)throw TypeError("Invalid strategy: "+n);if(this._level!==t||this._strategy!==n){var o=this;this.flush(s.Z_SYNC_FLUSH,function(){l(o._handle,"zlib binding closed"),o._handle.params(t,n),o._hadError||(o._level=t,o._strategy=n,a&&a())})}else r.nextTick(a)},A.prototype.reset=function(){return l(this._handle,"zlib binding closed"),this._handle.reset()},A.prototype._flush=function(t){this._transform(n.alloc(0),"",t)},A.prototype.flush=function(t,i){var a=this,o=this._writableState;"function"!=typeof t&&(void 0!==t||i)||(i=t,t=s.Z_FULL_FLUSH),o.ended?i&&r.nextTick(i):o.ending?i&&this.once("end",i):o.needDrain?i&&this.once("drain",function(){return a.flush(t,i)}):(this._flushFlag=t,this.write(n.alloc(0),"",i))},A.prototype.close=function(t){M(this,t),r.nextTick(T,this)},A.prototype._transform=function(t,r,i){var a,o=this._writableState,l=(o.ending||o.ended)&&(!t||o.length===t.length);return null===t||n.isBuffer(t)?this._handle?(l?a=this._finishFlushFlag:(a=this._flushFlag,t.length>=o.length&&(this._flushFlag=this._opts.flush||s.Z_NO_FLUSH)),void this._processChunk(t,a,i)):i(Error("zlib binding closed")):i(Error("invalid input"))},A.prototype._processChunk=function(t,r,i){var a=t&&t.length,s=this._chunkSize-this._offset,o=0,f=this,d="function"==typeof i;if(!d){var c,p=[],m=0;this.on("error",function(t){c=t}),l(this._handle,"zlib binding closed");do var g=this._handle.writeSync(r,t,o,a,this._buffer,this._offset,s);while(!this._hadError&&y(g[0],g[1]))if(this._hadError)throw c;if(m>=u)throw M(this),RangeError(h);var _=n.concat(p,m);return M(this),_}l(this._handle,"zlib binding closed");var b=this._handle.write(r,t,o,a,this._buffer,this._offset,s);function y(u,h){if(this&&(this.buffer=null,this.callback=null),!f._hadError){var c=s-h;if(l(c>=0,"have should not go down"),c>0){var g=f._buffer.slice(f._offset,f._offset+c);f._offset+=c,d?f.push(g):(p.push(g),m+=g.length)}if((0===h||f._offset>=f._chunkSize)&&(s=f._chunkSize,f._offset=0,f._buffer=n.allocUnsafe(f._chunkSize)),0===h){if(o+=a-u,a=u,!d)return!0;var _=f._handle.write(r,t,o,a,f._buffer,f._offset,f._chunkSize);return _.callback=y,void(_.buffer=t)}if(!d)return!1;i()}}b.buffer=t,b.callback=y},o.inherits(v,A),o.inherits(w,A),o.inherits(x,A),o.inherits(k,A),o.inherits(E,A),o.inherits(S,A),o.inherits($,A)}).call(this)}).call(this,t("_process"))},{"./binding":30,_process:63,assert:23,buffer:32,stream:65,util:84}],32:[function(t,r,i){(function(r){(function(){var r=t("base64-js"),n=t("ieee754");i.Buffer=l,i.SlowBuffer=b,i.INSPECT_MAX_BYTES=50;var a=0x7fffffff;function s(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}function o(t){if(t>a)throw RangeError('The value "'+t+'" is invalid for option "size"');var r=new Uint8Array(t);return r.__proto__=l.prototype,r}function l(t,r,i){if("number"==typeof t){if("string"==typeof r)throw TypeError('The "string" argument must be of type string. Received type number');return d(t)}return u(t,r,i)}function u(t,r,i){if("string"==typeof t)return c(t,r);if(ArrayBuffer.isView(t))return p(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(X(t,ArrayBuffer)||t&&X(t.buffer,ArrayBuffer))return m(t,r,i);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return l.from(n,r,i);var a=g(t);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return l.from(t[Symbol.toPrimitive]("string"),r,i);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function h(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function f(t,r,i){return h(t),t<=0?o(t):void 0!==r?"string"==typeof i?o(t).fill(r,i):o(t).fill(r):o(t)}function d(t){return h(t),o(t<0?0:0|_(t))}function c(t,r){if("string"==typeof r&&""!==r||(r="utf8"),!l.isEncoding(r))throw TypeError("Unknown encoding: "+r);var i=0|y(t,r),n=o(i),a=n.write(t,r);return a!==i&&(n=n.slice(0,a)),n}function p(t){for(var r=t.length<0?0:0|_(t.length),i=o(r),n=0;n<r;n+=1)i[n]=255&t[n];return i}function m(t,r,i){var n;if(r<0||t.byteLength<r)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<r+(i||0))throw RangeError('"length" is outside of buffer bounds');return(n=void 0===r&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,r):new Uint8Array(t,r,i)).__proto__=l.prototype,n}function g(t){if(l.isBuffer(t)){var r=0|_(t.length),i=o(r);return 0===i.length||t.copy(i,0,0,r),i}return void 0!==t.length?"number"!=typeof t.length||Q(t.length)?o(0):p(t):"Buffer"===t.type&&Array.isArray(t.data)?p(t.data):void 0}function _(t){if(t>=a)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return 0|t}function b(t){return+t!=t&&(t=0),l.alloc(+t)}function y(t,r){if(l.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||X(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var i=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===i)return 0;for(var a=!1;;)switch(r){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return H(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return K(t).length;default:if(a)return n?-1:H(t).length;r=(""+r).toLowerCase(),a=!0}}function v(t,r,i){var n=!1;if((void 0===r||r<0)&&(r=0),r>this.length||((void 0===i||i>this.length)&&(i=this.length),i<=0)||(i>>>=0)<=(r>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return P(this,r,i);case"utf8":case"utf-8":return C(this,r,i);case"ascii":return B(this,r,i);case"latin1":case"binary":return O(this,r,i);case"base64":return T(this,r,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,r,i);default:if(n)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function w(t,r,i){var n=t[r];t[r]=t[i],t[i]=n}function x(t,r,i,n,a){if(0===t.length)return -1;if("string"==typeof i?(n=i,i=0):i>0x7fffffff?i=0x7fffffff:i<-0x80000000&&(i=-0x80000000),Q(i*=1)&&(i=a?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(a)return -1;i=t.length-1}else if(i<0){if(!a)return -1;i=0}if("string"==typeof r&&(r=l.from(r,n)),l.isBuffer(r))return 0===r.length?-1:k(t,r,i,n,a);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(t,r,i):Uint8Array.prototype.lastIndexOf.call(t,r,i):k(t,[r],i,n,a);throw TypeError("val must be string, number or Buffer")}function k(t,r,i,n,a){var s,o=1,l=t.length,u=r.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||r.length<2)return -1;o=2,l/=2,u/=2,i/=2}function h(t,r){return 1===o?t[r]:t.readUInt16BE(r*o)}if(a){var f=-1;for(s=i;s<l;s++)if(h(t,s)===h(r,-1===f?0:s-f)){if(-1===f&&(f=s),s-f+1===u)return f*o}else -1!==f&&(s-=s-f),f=-1}else for(i+u>l&&(i=l-u),s=i;s>=0;s--){for(var d=!0,c=0;c<u;c++)if(h(t,s+c)!==h(r,c)){d=!1;break}if(d)return s}return -1}function E(t,r,i,n){i=Number(i)||0;var a=t.length-i;n?(n=Number(n))>a&&(n=a):n=a;var s=r.length;n>s/2&&(n=s/2);for(var o=0;o<n;++o){var l=parseInt(r.substr(2*o,2),16);if(Q(l))break;t[i+o]=l}return o}function S(t,r,i,n){return Y(H(r,t.length-i),t,i,n)}function $(t,r,i,n){return Y(V(r),t,i,n)}function I(t,r,i,n){return $(t,r,i,n)}function A(t,r,i,n){return Y(K(r),t,i,n)}function M(t,r,i,n){return Y(Z(r,t.length-i),t,i,n)}function T(t,i,n){return 0===i&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(i,n))}function C(t,r,i){i=Math.min(t.length,i);for(var n=[],a=r;a<i;){var s,o,l,u,h=t[a],f=null,d=h>239?4:h>223?3:h>191?2:1;if(a+d<=i)switch(d){case 1:h<128&&(f=h);break;case 2:128==(192&(s=t[a+1]))&&(u=(31&h)<<6|63&s)>127&&(f=u);break;case 3:s=t[a+1],o=t[a+2],128==(192&s)&&128==(192&o)&&(u=(15&h)<<12|(63&s)<<6|63&o)>2047&&(u<55296||u>57343)&&(f=u);break;case 4:s=t[a+1],o=t[a+2],l=t[a+3],128==(192&s)&&128==(192&o)&&128==(192&l)&&(u=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&l)>65535&&u<1114112&&(f=u)}null===f?(f=65533,d=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),a+=d}return R(n)}i.kMaxLength=0x7fffffff,l.TYPED_ARRAY_SUPPORT=s(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),l.poolSize=8192,l.from=function(t,r,i){return u(t,r,i)},l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,l.alloc=function(t,r,i){return f(t,r,i)},l.allocUnsafe=function(t){return d(t)},l.allocUnsafeSlow=function(t){return d(t)},l.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==l.prototype},l.compare=function(t,r){if(X(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),X(r,Uint8Array)&&(r=l.from(r,r.offset,r.byteLength)),!l.isBuffer(t)||!l.isBuffer(r))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;for(var i=t.length,n=r.length,a=0,s=Math.min(i,n);a<s;++a)if(t[a]!==r[a]){i=t[a],n=r[a];break}return i<n?-1:+(n<i)},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,r){if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);if(void 0===r)for(r=0,i=0;i<t.length;++i)r+=t[i].length;var i,n=l.allocUnsafe(r),a=0;for(i=0;i<t.length;++i){var s=t[i];if(X(s,Uint8Array)&&(s=l.from(s)),!l.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(n,a),a+=s.length}return n},l.byteLength=y,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2)w(this,r,r+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4)w(this,r,r+3),w(this,r+1,r+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8)w(this,r,r+7),w(this,r+1,r+6),w(this,r+2,r+5),w(this,r+3,r+4);return this},l.prototype.toString=function(){var t=this.length;return 0===t?"":0==arguments.length?C(this,0,t):v.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(t){if(!l.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",r=i.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},l.prototype.compare=function(t,r,i,n,a){if(X(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===r&&(r=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===a&&(a=this.length),r<0||i>t.length||n<0||a>this.length)throw RangeError("out of range index");if(n>=a&&r>=i)return 0;if(n>=a)return -1;if(r>=i)return 1;if(this===t)return 0;for(var s=(a>>>=0)-(n>>>=0),o=(i>>>=0)-(r>>>=0),u=Math.min(s,o),h=this.slice(n,a),f=t.slice(r,i),d=0;d<u;++d)if(h[d]!==f[d]){s=h[d],o=f[d];break}return s<o?-1:+(o<s)},l.prototype.includes=function(t,r,i){return -1!==this.indexOf(t,r,i)},l.prototype.indexOf=function(t,r,i){return x(this,t,r,i,!0)},l.prototype.lastIndexOf=function(t,r,i){return x(this,t,r,i,!1)},l.prototype.write=function(t,r,i,n){if(void 0===r)n="utf8",i=this.length,r=0;else if(void 0===i&&"string"==typeof r)n=r,i=this.length,r=0;else{if(!isFinite(r))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r>>>=0,isFinite(i)?(i>>>=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var a=this.length-r;if((void 0===i||i>a)&&(i=a),t.length>0&&(i<0||r<0)||r>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return E(this,t,r,i);case"utf8":case"utf-8":return S(this,t,r,i);case"ascii":return $(this,t,r,i);case"latin1":case"binary":return I(this,t,r,i);case"base64":return A(this,t,r,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,r,i);default:if(s)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var z=4096;function R(t){var r=t.length;if(r<=z)return String.fromCharCode.apply(String,t);for(var i="",n=0;n<r;)i+=String.fromCharCode.apply(String,t.slice(n,n+=z));return i}function B(t,r,i){var n="";i=Math.min(t.length,i);for(var a=r;a<i;++a)n+=String.fromCharCode(127&t[a]);return n}function O(t,r,i){var n="";i=Math.min(t.length,i);for(var a=r;a<i;++a)n+=String.fromCharCode(t[a]);return n}function P(t,r,i){var n=t.length;(!r||r<0)&&(r=0),(!i||i<0||i>n)&&(i=n);for(var a="",s=r;s<i;++s)a+=q(t[s]);return a}function D(t,r,i){for(var n=t.slice(r,i),a="",s=0;s<n.length;s+=2)a+=String.fromCharCode(n[s]+256*n[s+1]);return a}function N(t,r,i){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+r>i)throw RangeError("Trying to access beyond buffer length")}function L(t,r,i,n,a,s){if(!l.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(r>a||r<s)throw RangeError('"value" argument is out of bounds');if(i+n>t.length)throw RangeError("Index out of range")}function U(t,r,i,n,a,s){if(i+n>t.length||i<0)throw RangeError("Index out of range")}function j(t,r,i,a,s){return r*=1,i>>>=0,s||U(t,r,i,4),n.write(t,r,i,a,23,4),i+4}function F(t,r,i,a,s){return r*=1,i>>>=0,s||U(t,r,i,8),n.write(t,r,i,a,52,8),i+8}l.prototype.slice=function(t,r){var i=this.length;(t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(r=void 0===r?i:~~r)<0?(r+=i)<0&&(r=0):r>i&&(r=i),r<t&&(r=t);var n=this.subarray(t,r);return n.__proto__=l.prototype,n},l.prototype.readUIntLE=function(t,r,i){t>>>=0,r>>>=0,i||N(t,r,this.length);for(var n=this[t],a=1,s=0;++s<r&&(a*=256);)n+=this[t+s]*a;return n},l.prototype.readUIntBE=function(t,r,i){t>>>=0,r>>>=0,i||N(t,r,this.length);for(var n=this[t+--r],a=1;r>0&&(a*=256);)n+=this[t+--r]*a;return n},l.prototype.readUInt8=function(t,r){return t>>>=0,r||N(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,r){return t>>>=0,r||N(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,r){return t>>>=0,r||N(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,r){return t>>>=0,r||N(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+0x1000000*this[t+3]},l.prototype.readUInt32BE=function(t,r){return t>>>=0,r||N(t,4,this.length),0x1000000*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,r,i){t>>>=0,r>>>=0,i||N(t,r,this.length);for(var n=this[t],a=1,s=0;++s<r&&(a*=256);)n+=this[t+s]*a;return n>=(a*=128)&&(n-=Math.pow(2,8*r)),n},l.prototype.readIntBE=function(t,r,i){t>>>=0,r>>>=0,i||N(t,r,this.length);for(var n=r,a=1,s=this[t+--n];n>0&&(a*=256);)s+=this[t+--n]*a;return s>=(a*=128)&&(s-=Math.pow(2,8*r)),s},l.prototype.readInt8=function(t,r){return t>>>=0,r||N(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,r){t>>>=0,r||N(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?0xffff0000|i:i},l.prototype.readInt16BE=function(t,r){t>>>=0,r||N(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?0xffff0000|i:i},l.prototype.readInt32LE=function(t,r){return t>>>=0,r||N(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,r){return t>>>=0,r||N(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,r){return t>>>=0,r||N(t,4,this.length),n.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,r){return t>>>=0,r||N(t,4,this.length),n.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,r){return t>>>=0,r||N(t,8,this.length),n.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,r){return t>>>=0,r||N(t,8,this.length),n.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,r,i,n){t*=1,r>>>=0,i>>>=0,n||L(this,t,r,i,Math.pow(2,8*i)-1,0);var a=1,s=0;for(this[r]=255&t;++s<i&&(a*=256);)this[r+s]=t/a&255;return r+i},l.prototype.writeUIntBE=function(t,r,i,n){t*=1,r>>>=0,i>>>=0,n||L(this,t,r,i,Math.pow(2,8*i)-1,0);var a=i-1,s=1;for(this[r+a]=255&t;--a>=0&&(s*=256);)this[r+a]=t/s&255;return r+i},l.prototype.writeUInt8=function(t,r,i){return t*=1,r>>>=0,i||L(this,t,r,1,255,0),this[r]=255&t,r+1},l.prototype.writeUInt16LE=function(t,r,i){return t*=1,r>>>=0,i||L(this,t,r,2,65535,0),this[r]=255&t,this[r+1]=t>>>8,r+2},l.prototype.writeUInt16BE=function(t,r,i){return t*=1,r>>>=0,i||L(this,t,r,2,65535,0),this[r]=t>>>8,this[r+1]=255&t,r+2},l.prototype.writeUInt32LE=function(t,r,i){return t*=1,r>>>=0,i||L(this,t,r,4,0xffffffff,0),this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=255&t,r+4},l.prototype.writeUInt32BE=function(t,r,i){return t*=1,r>>>=0,i||L(this,t,r,4,0xffffffff,0),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t,r+4},l.prototype.writeIntLE=function(t,r,i,n){if(t*=1,r>>>=0,!n){var a=Math.pow(2,8*i-1);L(this,t,r,i,a-1,-a)}var s=0,o=1,l=0;for(this[r]=255&t;++s<i&&(o*=256);)t<0&&0===l&&0!==this[r+s-1]&&(l=1),this[r+s]=(t/o|0)-l&255;return r+i},l.prototype.writeIntBE=function(t,r,i,n){if(t*=1,r>>>=0,!n){var a=Math.pow(2,8*i-1);L(this,t,r,i,a-1,-a)}var s=i-1,o=1,l=0;for(this[r+s]=255&t;--s>=0&&(o*=256);)t<0&&0===l&&0!==this[r+s+1]&&(l=1),this[r+s]=(t/o|0)-l&255;return r+i},l.prototype.writeInt8=function(t,r,i){return t*=1,r>>>=0,i||L(this,t,r,1,127,-128),t<0&&(t=255+t+1),this[r]=255&t,r+1},l.prototype.writeInt16LE=function(t,r,i){return t*=1,r>>>=0,i||L(this,t,r,2,32767,-32768),this[r]=255&t,this[r+1]=t>>>8,r+2},l.prototype.writeInt16BE=function(t,r,i){return t*=1,r>>>=0,i||L(this,t,r,2,32767,-32768),this[r]=t>>>8,this[r+1]=255&t,r+2},l.prototype.writeInt32LE=function(t,r,i){return t*=1,r>>>=0,i||L(this,t,r,4,0x7fffffff,-0x80000000),this[r]=255&t,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24,r+4},l.prototype.writeInt32BE=function(t,r,i){return t*=1,r>>>=0,i||L(this,t,r,4,0x7fffffff,-0x80000000),t<0&&(t=0xffffffff+t+1),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t,r+4},l.prototype.writeFloatLE=function(t,r,i){return j(this,t,r,!0,i)},l.prototype.writeFloatBE=function(t,r,i){return j(this,t,r,!1,i)},l.prototype.writeDoubleLE=function(t,r,i){return F(this,t,r,!0,i)},l.prototype.writeDoubleBE=function(t,r,i){return F(this,t,r,!1,i)},l.prototype.copy=function(t,r,i,n){if(!l.isBuffer(t))throw TypeError("argument should be a Buffer");if(i||(i=0),n||0===n||(n=this.length),r>=t.length&&(r=t.length),r||(r=0),n>0&&n<i&&(n=i),n===i||0===t.length||0===this.length)return 0;if(r<0)throw RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-r<n-i&&(n=t.length-r+i);var a=n-i;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,i,n);else if(this===t&&i<r&&r<n)for(var s=a-1;s>=0;--s)t[s+r]=this[s+i];else Uint8Array.prototype.set.call(t,this.subarray(i,n),r);return a},l.prototype.fill=function(t,r,i,n){if("string"==typeof t){if("string"==typeof r?(n=r,r=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===t.length){var a,s=t.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(t=s)}}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<i)throw RangeError("Out of range index");if(i<=r)return this;if(r>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(a=r;a<i;++a)this[a]=t;else{var o=l.isBuffer(t)?t:l.from(t,n),u=o.length;if(0===u)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(a=0;a<i-r;++a)this[a+r]=o[a%u]}return this};var G=/[^+/0-9A-Za-z-_]/g;function W(t){if((t=(t=t.split("=")[0]).trim().replace(G,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function q(t){return t<16?"0"+t.toString(16):t.toString(16)}function H(t,r){var i;r=r||1/0;for(var n=t.length,a=null,s=[],o=0;o<n;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!a){if(i>56319||o+1===n){(r-=3)>-1&&s.push(239,191,189);continue}a=i;continue}if(i<56320){(r-=3)>-1&&s.push(239,191,189),a=i;continue}i=65536+(a-55296<<10|i-56320)}else a&&(r-=3)>-1&&s.push(239,191,189);if(a=null,i<128){if((r-=1)<0)break;s.push(i)}else if(i<2048){if((r-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((r-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw Error("Invalid code point");if((r-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function V(t){for(var r=[],i=0;i<t.length;++i)r.push(255&t.charCodeAt(i));return r}function Z(t,r){for(var i,n,a=[],s=0;s<t.length&&!((r-=2)<0);++s)n=(i=t.charCodeAt(s))>>8,a.push(i%256),a.push(n);return a}function K(t){return r.toByteArray(W(t))}function Y(t,r,i,n){for(var a=0;a<n&&!(a+i>=r.length||a>=t.length);++a)r[a+i]=t[a];return a}function X(t,r){return t instanceof r||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===r.name}function Q(t){return t!=t}}).call(this)}).call(this,t("buffer").Buffer)},{"base64-js":28,buffer:32,ieee754:45}],33:[function(t,r,i){var n=t("get-intrinsic"),a=t("./"),s=a(n("String.prototype.indexOf"));r.exports=function(t,r){var i=n(t,!!r);return"function"==typeof i&&s(t,".prototype.")>-1?a(i):i}},{"./":34,"get-intrinsic":39}],34:[function(t,r,i){var n=t("function-bind"),a=t("get-intrinsic"),s=a("%Function.prototype.apply%"),o=a("%Function.prototype.call%"),l=a("%Reflect.apply%",!0)||n.call(o,s),u=a("%Object.getOwnPropertyDescriptor%",!0),h=a("%Object.defineProperty%",!0),f=a("%Math.max%");if(h)try{h({},"a",{value:1})}catch(t){h=null}r.exports=function(t){var r=l(n,o,arguments);return u&&h&&u(r,"length").configurable&&h(r,"length",{value:1+f(0,t.length-(arguments.length-1))}),r};var d=function(){return l(n,s,arguments)};h?h(r.exports,"apply",{value:d}):r.exports.apply=d},{"function-bind":38,"get-intrinsic":39}],35:[function(t,r,i){var n,a="object"==typeof Reflect?Reflect:null,s=a&&"function"==typeof a.apply?a.apply:function(t,r,i){return Function.prototype.apply.call(t,r,i)};function o(t){console&&console.warn&&console.warn(t)}n=a&&"function"==typeof a.ownKeys?a.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var l=Number.isNaN||function(t){return t!=t};function u(){u.init.call(this)}r.exports=u,r.exports.once=w,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var h=10;function f(t){if("function"!=typeof t)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function d(t){return void 0===t._maxListeners?u.defaultMaxListeners:t._maxListeners}function c(t,r,i,n){var a,s,l;if(f(i),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",r,i.listener?i.listener:i),s=t._events),l=s[r]),void 0===l)l=s[r]=i,++t._eventsCount;else if("function"==typeof l?l=s[r]=n?[i,l]:[l,i]:n?l.unshift(i):l.push(i),(a=d(t))>0&&l.length>a&&!l.warned){l.warned=!0;var u=Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=r,u.count=l.length,o(u)}return t}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(t,r,i){var n={fired:!1,wrapFn:void 0,target:t,type:r,listener:i},a=p.bind(n);return a.listener=i,n.wrapFn=a,a}function g(t,r,i){var n=t._events;if(void 0===n)return[];var a=n[r];return void 0===a?[]:"function"==typeof a?i?[a.listener||a]:[a]:i?v(a):b(a,a.length)}function _(t){var r=this._events;if(void 0!==r){var i=r[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function b(t,r){for(var i=Array(r),n=0;n<r;++n)i[n]=t[n];return i}function y(t,r){for(;r+1<t.length;r++)t[r]=t[r+1];t.pop()}function v(t){for(var r=Array(t.length),i=0;i<r.length;++i)r[i]=t[i].listener||t[i];return r}function w(t,r){return new Promise(function(i,n){function a(i){t.removeListener(r,s),n(i)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",a),i([].slice.call(arguments))}k(t,r,s,{once:!0}),"error"!==r&&x(t,a,{once:!0})})}function x(t,r,i){"function"==typeof t.on&&k(t,"error",r,i)}function k(t,r,i,n){if("function"==typeof t.on)n.once?t.once(r,i):t.on(r,i);else{if("function"!=typeof t.addEventListener)throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(r,function a(s){n.once&&t.removeEventListener(r,a),i(s)})}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||l(t))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");h=t}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||l(t))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},u.prototype.getMaxListeners=function(){return d(this)},u.prototype.emit=function(t){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n="error"===t,a=this._events;if(void 0!==a)n=n&&void 0===a.error;else if(!n)return!1;if(n){if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var o,l=Error("Unhandled error."+(o?" ("+o.message+")":""));throw l.context=o,l}var u=a[t];if(void 0===u)return!1;if("function"==typeof u)s(u,this,r);else{var h=u.length,f=b(u,h);for(i=0;i<h;++i)s(f[i],this,r)}return!0},u.prototype.addListener=function(t,r){return c(this,t,r,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(t,r){return c(this,t,r,!0)},u.prototype.once=function(t,r){return f(r),this.on(t,m(this,t,r)),this},u.prototype.prependOnceListener=function(t,r){return f(r),this.prependListener(t,m(this,t,r)),this},u.prototype.removeListener=function(t,r){var i,n,a,s,o;if(f(r),void 0===(n=this._events)||void 0===(i=n[t]))return this;if(i===r||i.listener===r)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||r));else if("function"!=typeof i){for(a=-1,s=i.length-1;s>=0;s--)if(i[s]===r||i[s].listener===r){o=i[s].listener,a=s;break}if(a<0)return this;0===a?i.shift():y(i,a),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,o||r)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(t){var r,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0==arguments.length){var a,s=Object.keys(i);for(n=0;n<s.length;++n)"removeListener"!==(a=s[n])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(r=i[t]))this.removeListener(t,r);else if(void 0!==r)for(n=r.length-1;n>=0;n--)this.removeListener(t,r[n]);return this},u.prototype.listeners=function(t){return g(this,t,!0)},u.prototype.rawListeners=function(t){return g(this,t,!1)},u.listenerCount=function(t,r){return"function"==typeof t.listenerCount?t.listenerCount(r):_.call(t,r)},u.prototype.listenerCount=_,u.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},{}],36:[function(t,r,i){var n=t("is-callable"),a=Object.prototype.toString,s=Object.prototype.hasOwnProperty,o=function(t,r,i){for(var n=0,a=t.length;n<a;n++)s.call(t,n)&&(null==i?r(t[n],n,t):r.call(i,t[n],n,t))},l=function(t,r,i){for(var n=0,a=t.length;n<a;n++)null==i?r(t.charAt(n),n,t):r.call(i,t.charAt(n),n,t)},u=function(t,r,i){for(var n in t)s.call(t,n)&&(null==i?r(t[n],n,t):r.call(i,t[n],n,t))};r.exports=function(t,r,i){var s;if(!n(r))throw TypeError("iterator must be a function");arguments.length>=3&&(s=i),"[object Array]"===a.call(t)?o(t,r,s):"string"==typeof t?l(t,r,s):u(t,r,s)}},{"is-callable":48}],37:[function(t,r,i){var n="Function.prototype.bind called on incompatible ",a=Array.prototype.slice,s=Object.prototype.toString,o="[object Function]";r.exports=function(t){var r=this;if("function"!=typeof r||s.call(r)!==o)throw TypeError(n+r);for(var i,l=a.call(arguments,1),u=function(){if(this instanceof i){var n=r.apply(this,l.concat(a.call(arguments)));return Object(n)===n?n:this}return r.apply(t,l.concat(a.call(arguments)))},h=Math.max(0,r.length-l.length),f=[],d=0;d<h;d++)f.push("$"+d);if(i=Function("binder","return function ("+f.join(",")+"){ return binder.apply(this,arguments); }")(u),r.prototype){var c=function(){};c.prototype=r.prototype,i.prototype=new c,c.prototype=null}return i}},{}],38:[function(t,r,i){var n=t("./implementation");r.exports=Function.prototype.bind||n},{"./implementation":37}],39:[function(t,r,i){var n,a=SyntaxError,s=Function,o=TypeError,l=function(t){try{return s('"use strict"; return ('+t+").constructor;")()}catch(t){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(t){u=null}var h=function(){throw new o},f=u?function(){try{return h}catch(t){try{return u(arguments,"callee").get}catch(t){return h}}}():h,d=t("has-symbols")(),c=Object.getPrototypeOf||function(t){return t.__proto__},p={},m="undefined"==typeof Uint8Array?n:c(Uint8Array),g={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":d?c([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d?c(c([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d?c((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d?c((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d?c(""[Symbol.iterator]()):n,"%Symbol%":d?Symbol:n,"%SyntaxError%":a,"%ThrowTypeError%":f,"%TypedArray%":m,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};try{null.error}catch(t){var _=c(c(t));g["%Error.prototype%"]=_}var b=function t(r){var i;if("%AsyncFunction%"===r)i=l("async function () {}");else if("%GeneratorFunction%"===r)i=l("function* () {}");else if("%AsyncGeneratorFunction%"===r)i=l("async function* () {}");else if("%AsyncGenerator%"===r){var n=t("%AsyncGeneratorFunction%");n&&(i=n.prototype)}else if("%AsyncIteratorPrototype%"===r){var a=t("%AsyncGenerator%");a&&(i=c(a.prototype))}return g[r]=i,i},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},v=t("function-bind"),w=t("has"),x=v.call(Function.call,Array.prototype.concat),k=v.call(Function.apply,Array.prototype.splice),E=v.call(Function.call,String.prototype.replace),S=v.call(Function.call,String.prototype.slice),$=v.call(Function.call,RegExp.prototype.exec),I=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,A=/\\(\\)?/g,M=function(t){var r=S(t,0,1),i=S(t,-1);if("%"===r&&"%"!==i)throw new a("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==r)throw new a("invalid intrinsic syntax, expected opening `%`");var n=[];return E(t,I,function(t,r,i,a){n[n.length]=i?E(a,A,"$1"):r||t}),n},T=function(t,r){var i,n=t;if(w(y,n)&&(n="%"+(i=y[n])[0]+"%"),w(g,n)){var s=g[n];if(s===p&&(s=b(n)),void 0===s&&!r)throw new o("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:s}}throw new a("intrinsic "+t+" does not exist!")};r.exports=function(t,r){if("string"!=typeof t||0===t.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof r)throw new o('"allowMissing" argument must be a boolean');if(null===$(/^%?[^%]*%?$/,t))throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=M(t),n=i.length>0?i[0]:"",s=T("%"+n+"%",r),l=s.name,h=s.value,f=!1,d=s.alias;d&&(n=d[0],k(i,x([0,1],d)));for(var c=1,p=!0;c<i.length;c+=1){var m=i[c],_=S(m,0,1),b=S(m,-1);if(('"'===_||"'"===_||"`"===_||'"'===b||"'"===b||"`"===b)&&_!==b)throw new a("property names with quotes must have matching quotes");if("constructor"!==m&&p||(f=!0),w(g,l="%"+(n+="."+m)+"%"))h=g[l];else if(null!=h){if(!(m in h)){if(!r)throw new o("base intrinsic for "+t+" exists, but the property is not available.");return}if(u&&c+1>=i.length){var y=u(h,m);h=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:h[m]}else p=w(h,m),h=h[m];p&&!f&&(g[l]=h)}}return h}},{"function-bind":38,has:44,"has-symbols":41}],40:[function(t,r,i){var n=t("get-intrinsic")("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(t){n=null}r.exports=n},{"get-intrinsic":39}],41:[function(t,r,i){var n="undefined"!=typeof Symbol&&Symbol,a=t("./shams");r.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&a()}},{"./shams":42}],42:[function(t,r,i){r.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},r=Symbol("test"),i=Object(r);if("string"==typeof r||"[object Symbol]"!==Object.prototype.toString.call(r)||"[object Symbol]"!==Object.prototype.toString.call(i))return!1;var n=42;for(r in t[r]=n,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var a=Object.getOwnPropertySymbols(t);if(1!==a.length||a[0]!==r||!Object.prototype.propertyIsEnumerable.call(t,r))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(t,r);if(s.value!==n||!0!==s.enumerable)return!1}return!0}},{}],43:[function(t,r,i){var n=t("has-symbols/shams");r.exports=function(){return n()&&!!Symbol.toStringTag}},{"has-symbols/shams":42}],44:[function(t,r,i){r.exports=t("function-bind").call(Function.call,Object.prototype.hasOwnProperty)},{"function-bind":38}],45:[function(t,r,i){i.read=function(t,r,i,n,a){var s,o,l=8*a-n-1,u=(1<<l)-1,h=u>>1,f=-7,d=i?a-1:0,c=i?-1:1,p=t[r+d];for(d+=c,s=p&(1<<-f)-1,p>>=-f,f+=l;f>0;s=256*s+t[r+d],d+=c,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=n;f>0;o=256*o+t[r+d],d+=c,f-=8);if(0===s)s=1-h;else{if(s===u)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=h}return(p?-1:1)*o*Math.pow(2,s-n)},i.write=function(t,r,i,n,a,s){var o,l,u,h=8*s-a-1,f=(1<<h)-1,d=f>>1,c=5960464477539062e-23*(23===a),p=n?0:s-1,m=n?1:-1,g=+(r<0||0===r&&1/r<0);for(isNaN(r=Math.abs(r))||r===1/0?(l=+!!isNaN(r),o=f):(o=Math.floor(Math.log(r)/Math.LN2),r*(u=Math.pow(2,-o))<1&&(o--,u*=2),(r+=o+d>=1?c/u:c*Math.pow(2,1-d))*u>=2&&(o++,u/=2),o+d>=f?(l=0,o=f):o+d>=1?(l=(r*u-1)*Math.pow(2,a),o+=d):(l=r*Math.pow(2,d-1)*Math.pow(2,a),o=0));a>=8;t[i+p]=255&l,p+=m,l/=256,a-=8);for(o=o<<a|l,h+=a;h>0;t[i+p]=255&o,p+=m,o/=256,h-=8);t[i+p-m]|=128*g}},{}],46:[function(t,r,i){"function"==typeof Object.create?r.exports=function(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:r.exports=function(t,r){if(r){t.super_=r;var i=function(){};i.prototype=r.prototype,t.prototype=new i,t.prototype.constructor=t}}},{}],47:[function(t,r,i){var n=t("has-tostringtag/shams")(),a=t("call-bind/callBound")("Object.prototype.toString"),s=function(t){return!(n&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===a(t)},o=function(t){return!!s(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==a(t)&&"[object Function]"===a(t.callee)},l=function(){return s(arguments)}();s.isLegacyArguments=o,r.exports=l?s:o},{"call-bind/callBound":33,"has-tostringtag/shams":43}],48:[function(t,r,i){var n,a,s=Function.prototype.toString,o="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof o&&"function"==typeof Object.defineProperty)try{n=Object.defineProperty({},"length",{get:function(){throw a}}),a={},o(function(){throw 42},null,n)}catch(t){t!==a&&(o=null)}else o=null;var l=/^\s*class\b/,u=function(t){try{var r=s.call(t);return l.test(r)}catch(t){return!1}},h=function(t){try{return!u(t)&&(s.call(t),!0)}catch(t){return!1}},f=Object.prototype.toString,d="[object Object]",c="[object Function]",p="[object GeneratorFunction]",m="[object HTMLAllCollection]",g="[object HTML document.all class]",_="[object HTMLCollection]",b="function"==typeof Symbol&&!!Symbol.toStringTag,y=!(0 in[,]),v=function(){return!1};if("object"==typeof document){var w=document.all;f.call(w)===f.call(document.all)&&(v=function(t){if((y||!t)&&(void 0===t||"object"==typeof t))try{var r=f.call(t);return(r===m||r===g||r===_||r===d)&&null==t("")}catch(t){}return!1})}r.exports=o?function(t){if(v(t))return!0;if(!t||"function"!=typeof t&&"object"!=typeof t)return!1;try{o(t,null,n)}catch(t){if(t!==a)return!1}return!u(t)&&h(t)}:function(t){if(v(t))return!0;if(!t||"function"!=typeof t&&"object"!=typeof t)return!1;if(b)return h(t);if(u(t))return!1;var r=f.call(t);return!(r!==c&&r!==p&&!/^\[object HTML/.test(r))&&h(t)}},{}],49:[function(t,r,i){var n,a=Object.prototype.toString,s=Function.prototype.toString,o=/^\s*(?:function)?\*/,l=t("has-tostringtag/shams")(),u=Object.getPrototypeOf,h=function(){if(!l)return!1;try{return Function("return function*() {}")()}catch(t){}};r.exports=function(t){if("function"!=typeof t)return!1;if(o.test(s.call(t)))return!0;if(!l)return"[object GeneratorFunction]"===a.call(t);if(!u)return!1;if(void 0===n){var r=h();n=!!r&&u(r)}return u(t)===n}},{"has-tostringtag/shams":43}],50:[function(t,r,i){(function(i){(function(){var n=t("for-each"),a=t("available-typed-arrays"),s=t("call-bind/callBound"),o=s("Object.prototype.toString"),l=t("has-tostringtag/shams")(),u=t("gopd"),h="undefined"==typeof globalThis?i:globalThis,f=a(),d=s("Array.prototype.indexOf",!0)||function(t,r){for(var i=0;i<t.length;i+=1)if(t[i]===r)return i;return -1},c=s("String.prototype.slice"),p={},m=Object.getPrototypeOf;l&&u&&m&&n(f,function(t){var r=new h[t];if(Symbol.toStringTag in r){var i=m(r),n=u(i,Symbol.toStringTag);n||(n=u(m(i),Symbol.toStringTag)),p[t]=n.get}});var g=function(t){var r=!1;return n(p,function(i,n){if(!r)try{r=i.call(t)===n}catch(t){}}),r};r.exports=function(t){return!!t&&"object"==typeof t&&(l&&Symbol.toStringTag in t?!!u&&g(t):d(f,c(o(t),8,-1))>-1)}}).call(this)}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"available-typed-arrays":27,"call-bind/callBound":33,"for-each":36,gopd:40,"has-tostringtag/shams":43}],51:[function(t,r,i){var n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function o(t){if(null==t)throw TypeError("Object.assign cannot be called with null or undefined");return Object(t)}r.exports=!function(){try{var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var r={},i=0;i<10;i++)r["_"+String.fromCharCode(i)]=i;var n=Object.getOwnPropertyNames(r).map(function(t){return r[t]});if("0123456789"!==n.join(""))return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach(function(t){a[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},a)).join("")}catch(t){return!1}}()?function(t,r){for(var i,l,u=o(t),h=1;h<arguments.length;h++){for(var f in i=Object(arguments[h]))a.call(i,f)&&(u[f]=i[f]);if(n){l=n(i);for(var d=0;d<l.length;d++)s.call(i,l[d])&&(u[l[d]]=i[l[d]])}}return u}:Object.assign},{}],52:[function(t,r,i){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function a(t,r){return Object.prototype.hasOwnProperty.call(t,r)}i.assign=function(t){for(var r=Array.prototype.slice.call(arguments,1);r.length;){var i=r.shift();if(i){if("object"!=typeof i)throw TypeError(i+"must be non-object");for(var n in i)a(i,n)&&(t[n]=i[n])}}return t},i.shrinkBuf=function(t,r){return t.length===r?t:t.subarray?t.subarray(0,r):(t.length=r,t)};var s={arraySet:function(t,r,i,n,a){if(r.subarray&&t.subarray)t.set(r.subarray(i,i+n),a);else for(var s=0;s<n;s++)t[a+s]=r[i+s]},flattenChunks:function(t){var r,i,n,a,s,o;for(n=0,r=0,i=t.length;r<i;r++)n+=t[r].length;for(o=new Uint8Array(n),a=0,r=0,i=t.length;r<i;r++)s=t[r],o.set(s,a),a+=s.length;return o}},o={arraySet:function(t,r,i,n,a){for(var s=0;s<n;s++)t[a+s]=r[i+s]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,s)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(n)},{}],53:[function(t,r,i){r.exports=function(t,r,i,n){for(var a=65535&t,s=t>>>16&65535,o=0;0!==i;){i-=o=i>2e3?2e3:i;do s=s+(a=a+r[n++]|0)|0;while(--o)a%=65521,s%=65521}return a|s<<16}},{}],54:[function(t,r,i){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],55:[function(t,r,i){var n=function(){for(var t,r=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?0xedb88320^t>>>1:t>>>1;r[i]=t}return r}();r.exports=function(t,r,i,a){var s=n,o=a+i;t^=-1;for(var l=a;l<o;l++)t=t>>>8^s[255&(t^r[l])];return~t}},{}],56:[function(t,r,i){var n,a=t("../utils/common"),s=t("./trees"),o=t("./adler32"),l=t("./crc32"),u=t("./messages"),h=0,f=1,d=3,c=4,p=5,m=0,g=1,_=-2,b=-3,y=-5,v=-1,w=1,x=2,k=3,E=4,S=0,$=2,I=8,A=9,M=15,T=8,C=286,z=30,R=19,B=573,O=15,P=3,D=258,N=262,L=32,U=42,j=69,F=73,G=91,W=103,q=113,H=666,V=1,Z=2,K=3,Y=4,X=3;function Q(t,r){return t.msg=u[r],r}function J(t){return(t<<1)-9*(t>4)}function ee(t){for(var r=t.length;--r>=0;)t[r]=0}function et(t){var r=t.state,i=r.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(a.arraySet(t.output,r.pending_buf,r.pending_out,i,t.next_out),t.next_out+=i,r.pending_out+=i,t.total_out+=i,t.avail_out-=i,r.pending-=i,0===r.pending&&(r.pending_out=0))}function er(t,r){s._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,et(t.strm)}function ei(t,r){t.pending_buf[t.pending++]=r}function en(t,r){t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r}function ea(t,r,i,n){var s=t.avail_in;return s>n&&(s=n),0===s?0:(t.avail_in-=s,a.arraySet(r,t.input,t.next_in,s,i),1===t.state.wrap?t.adler=o(t.adler,r,s,i):2===t.state.wrap&&(t.adler=l(t.adler,r,s,i)),t.next_in+=s,t.total_in+=s,s)}function es(t,r){var i,n,a=t.max_chain_length,s=t.strstart,o=t.prev_length,l=t.nice_match,u=t.strstart>t.w_size-N?t.strstart-(t.w_size-N):0,h=t.window,f=t.w_mask,d=t.prev,c=t.strstart+D,p=h[s+o-1],m=h[s+o];t.prev_length>=t.good_match&&(a>>=2),l>t.lookahead&&(l=t.lookahead);do if(h[(i=r)+o]===m&&h[i+o-1]===p&&h[i]===h[s]&&h[++i]===h[s+1]){s+=2,i++;do;while(h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&s<c)if(n=D-(c-s),s=c-D,n>o){if(t.match_start=r,o=n,n>=l)break;p=h[s+o-1],m=h[s+o]}}while((r=d[r&f])>u&&0!=--a)return o<=t.lookahead?o:t.lookahead}function eo(t){var r,i,n,s,o,l=t.w_size;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=l+(l-N)){a.arraySet(t.window,t.window,l,l,0),t.match_start-=l,t.strstart-=l,t.block_start-=l,r=i=t.hash_size;do n=t.head[--r],t.head[r]=n>=l?n-l:0;while(--i)r=i=l;do n=t.prev[--r],t.prev[r]=n>=l?n-l:0;while(--i)s+=l}if(0===t.strm.avail_in)break;if(i=ea(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=i,t.lookahead+t.insert>=P)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+P-1])&t.hash_mask,t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<P)););}while(t.lookahead<N&&0!==t.strm.avail_in)}function el(t,r){for(var i,n;;){if(t.lookahead<N){if(eo(t),t.lookahead<N&&r===h)return V;if(0===t.lookahead)break}if(i=0,t.lookahead>=P&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+P-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-N&&(t.match_length=es(t,i)),t.match_length>=P)if(n=s._tr_tally(t,t.strstart-t.match_start,t.match_length-P),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=P){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+P-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(0!=--t.match_length)t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(er(t,!1),0===t.strm.avail_out))return V}return t.insert=t.strstart<P-1?t.strstart:P-1,r===c?(er(t,!0),0===t.strm.avail_out?K:Y):t.last_lit&&(er(t,!1),0===t.strm.avail_out)?V:Z}function eu(t,r){for(var i,n,a;;){if(t.lookahead<N){if(eo(t),t.lookahead<N&&r===h)return V;if(0===t.lookahead)break}if(i=0,t.lookahead>=P&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+P-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=P-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-N&&(t.match_length=es(t,i),t.match_length<=5&&(t.strategy===w||t.match_length===P&&t.strstart-t.match_start>4096)&&(t.match_length=P-1)),t.prev_length>=P&&t.match_length<=t.prev_length){a=t.strstart+t.lookahead-P,n=s._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-P),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=a&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+P-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(0!=--t.prev_length)if(t.match_available=0,t.match_length=P-1,t.strstart++,n&&(er(t,!1),0===t.strm.avail_out))return V}else if(t.match_available){if((n=s._tr_tally(t,0,t.window[t.strstart-1]))&&er(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return V}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=s._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<P-1?t.strstart:P-1,r===c?(er(t,!0),0===t.strm.avail_out?K:Y):t.last_lit&&(er(t,!1),0===t.strm.avail_out)?V:Z}function eh(t,r){for(var i,n,a,o,l=t.window;;){if(t.lookahead<=D){if(eo(t),t.lookahead<=D&&r===h)return V;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=P&&t.strstart>0&&(n=l[a=t.strstart-1])===l[++a]&&n===l[++a]&&n===l[++a]){o=t.strstart+D;do;while(n===l[++a]&&n===l[++a]&&n===l[++a]&&n===l[++a]&&n===l[++a]&&n===l[++a]&&n===l[++a]&&n===l[++a]&&a<o)t.match_length=D-(o-a),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=P?(i=s._tr_tally(t,1,t.match_length-P),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(er(t,!1),0===t.strm.avail_out))return V}return t.insert=0,r===c?(er(t,!0),0===t.strm.avail_out?K:Y):t.last_lit&&(er(t,!1),0===t.strm.avail_out)?V:Z}function ef(t,r){for(var i;;){if(0===t.lookahead&&(eo(t),0===t.lookahead)){if(r===h)return V;break}if(t.match_length=0,i=s._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(er(t,!1),0===t.strm.avail_out))return V}return t.insert=0,r===c?(er(t,!0),0===t.strm.avail_out?K:Y):t.last_lit&&(er(t,!1),0===t.strm.avail_out)?V:Z}function ed(t,r,i,n,a){this.good_length=t,this.max_lazy=r,this.nice_length=i,this.max_chain=n,this.func=a}function ec(t){t.window_size=2*t.w_size,ee(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=P-1,t.match_available=0,t.ins_h=0}function ep(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*B),this.dyn_dtree=new a.Buf16(2*(2*z+1)),this.bl_tree=new a.Buf16(2*(2*R+1)),ee(this.dyn_ltree),ee(this.dyn_dtree),ee(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(O+1),this.heap=new a.Buf16(2*C+1),ee(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*C+1),ee(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function em(t){var r;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=$,(r=t.state).pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap?U:q,t.adler=+(2!==r.wrap),r.last_flush=h,s._tr_init(r),m):Q(t,_)}function eg(t){var r=em(t);return r===m&&ec(t.state),r}function e_(t,r){return t&&t.state?2!==t.state.wrap?_:(t.state.gzhead=r,m):_}function eb(t,r,i,n,s,o){if(!t)return _;var l=1;if(r===v&&(r=6),n<0?(l=0,n=-n):n>15&&(l=2,n-=16),s<1||s>A||i!==I||n<8||n>15||r<0||r>9||o<0||o>E)return Q(t,_);8===n&&(n=9);var u=new ep;return t.state=u,u.strm=t,u.wrap=l,u.gzhead=null,u.w_bits=n,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=s+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+P-1)/P),u.window=new a.Buf8(2*u.w_size),u.head=new a.Buf16(u.hash_size),u.prev=new a.Buf16(u.w_size),u.lit_bufsize=1<<s+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new a.Buf8(u.pending_buf_size),u.d_buf=+u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=r,u.strategy=o,u.method=i,eg(t)}function ey(t,r){return eb(t,r,I,M,T,S)}function ev(t,r){var i,a,o,u;if(!t||!t.state||r>p||r<0)return t?Q(t,_):_;if(a=t.state,!t.output||!t.input&&0!==t.avail_in||a.status===H&&r!==c)return Q(t,0===t.avail_out?y:_);if(a.strm=t,i=a.last_flush,a.last_flush=r,a.status===U)if(2===a.wrap)t.adler=0,ei(a,31),ei(a,139),ei(a,8),a.gzhead?(ei(a,+!!a.gzhead.text+2*!!a.gzhead.hcrc+4*!!a.gzhead.extra+8*!!a.gzhead.name+16*!!a.gzhead.comment),ei(a,255&a.gzhead.time),ei(a,a.gzhead.time>>8&255),ei(a,a.gzhead.time>>16&255),ei(a,a.gzhead.time>>24&255),ei(a,9===a.level?2:4*(a.strategy>=x||a.level<2)),ei(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(ei(a,255&a.gzhead.extra.length),ei(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=l(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=j):(ei(a,0),ei(a,0),ei(a,0),ei(a,0),ei(a,0),ei(a,9===a.level?2:4*(a.strategy>=x||a.level<2)),ei(a,X),a.status=q);else{var b=I+(a.w_bits-8<<4)<<8;b|=(a.strategy>=x||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(b|=L),b+=31-b%31,a.status=q,en(a,b),0!==a.strstart&&(en(a,t.adler>>>16),en(a,65535&t.adler)),t.adler=1}if(a.status===j)if(a.gzhead.extra){for(o=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>o&&(t.adler=l(t.adler,a.pending_buf,a.pending-o,o)),et(t),o=a.pending,a.pending!==a.pending_buf_size));)ei(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>o&&(t.adler=l(t.adler,a.pending_buf,a.pending-o,o)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=F)}else a.status=F;if(a.status===F)if(a.gzhead.name){o=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>o&&(t.adler=l(t.adler,a.pending_buf,a.pending-o,o)),et(t),o=a.pending,a.pending===a.pending_buf_size)){u=1;break}u=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,ei(a,u)}while(0!==u)a.gzhead.hcrc&&a.pending>o&&(t.adler=l(t.adler,a.pending_buf,a.pending-o,o)),0===u&&(a.gzindex=0,a.status=G)}else a.status=G;if(a.status===G)if(a.gzhead.comment){o=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>o&&(t.adler=l(t.adler,a.pending_buf,a.pending-o,o)),et(t),o=a.pending,a.pending===a.pending_buf_size)){u=1;break}u=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,ei(a,u)}while(0!==u)a.gzhead.hcrc&&a.pending>o&&(t.adler=l(t.adler,a.pending_buf,a.pending-o,o)),0===u&&(a.status=W)}else a.status=W;if(a.status===W&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&et(t),a.pending+2<=a.pending_buf_size&&(ei(a,255&t.adler),ei(a,t.adler>>8&255),t.adler=0,a.status=q)):a.status=q),0!==a.pending){if(et(t),0===t.avail_out)return a.last_flush=-1,m}else if(0===t.avail_in&&J(r)<=J(i)&&r!==c)return Q(t,y);if(a.status===H&&0!==t.avail_in)return Q(t,y);if(0!==t.avail_in||0!==a.lookahead||r!==h&&a.status!==H){var v=a.strategy===x?ef(a,r):a.strategy===k?eh(a,r):n[a.level].func(a,r);if(v!==K&&v!==Y||(a.status=H),v===V||v===K)return 0===t.avail_out&&(a.last_flush=-1),m;if(v===Z&&(r===f?s._tr_align(a):r!==p&&(s._tr_stored_block(a,0,0,!1),r===d&&(ee(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),et(t),0===t.avail_out))return a.last_flush=-1,m}return r!==c?m:a.wrap<=0?g:(2===a.wrap?(ei(a,255&t.adler),ei(a,t.adler>>8&255),ei(a,t.adler>>16&255),ei(a,t.adler>>24&255),ei(a,255&t.total_in),ei(a,t.total_in>>8&255),ei(a,t.total_in>>16&255),ei(a,t.total_in>>24&255)):(en(a,t.adler>>>16),en(a,65535&t.adler)),et(t),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?m:g)}function ew(t){var r;return t&&t.state?(r=t.state.status)!==U&&r!==j&&r!==F&&r!==G&&r!==W&&r!==q&&r!==H?Q(t,_):(t.state=null,r===q?Q(t,b):m):_}function ex(t,r){var i,n,s,l,u,h,f,d,c=r.length;if(!t||!t.state||2===(l=(i=t.state).wrap)||1===l&&i.status!==U||i.lookahead)return _;for(1===l&&(t.adler=o(t.adler,r,c,0)),i.wrap=0,c>=i.w_size&&(0===l&&(ee(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new a.Buf8(i.w_size),a.arraySet(d,r,c-i.w_size,i.w_size,0),r=d,c=i.w_size),u=t.avail_in,h=t.next_in,f=t.input,t.avail_in=c,t.next_in=0,t.input=r,eo(i);i.lookahead>=P;){n=i.strstart,s=i.lookahead-(P-1);do i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+P-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++;while(--s)i.strstart=n,i.lookahead=P-1,eo(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=P-1,i.match_available=0,t.next_in=h,t.input=f,t.avail_in=u,i.wrap=l,m}n=[new ed(0,0,0,0,function(t,r){var i=65535;for(65535>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(eo(t),0===t.lookahead&&r===h)return V;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,er(t,!1),0===t.strm.avail_out)||t.strstart-t.block_start>=t.w_size-N&&(er(t,!1),0===t.strm.avail_out))return V}return t.insert=0,r===c?(er(t,!0),0===t.strm.avail_out?K:Y):(t.strstart>t.block_start&&(er(t,!1),t.strm.avail_out),V)}),new ed(4,4,8,4,el),new ed(4,5,16,8,el),new ed(4,6,32,32,el),new ed(4,4,16,16,eu),new ed(8,16,32,32,eu),new ed(8,16,128,128,eu),new ed(8,32,128,256,eu),new ed(32,128,258,1024,eu),new ed(32,258,258,4096,eu)],i.deflateInit=ey,i.deflateInit2=eb,i.deflateReset=eg,i.deflateResetKeep=em,i.deflateSetHeader=e_,i.deflate=ev,i.deflateEnd=ew,i.deflateSetDictionary=ex,i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":52,"./adler32":53,"./crc32":55,"./messages":60,"./trees":61}],57:[function(t,r,i){var n=30,a=12;r.exports=function(t,r){var i,s,o,l,u,h,f,d,c,p,m,g,_,b,y,v,w,x,k,E,S,$,I,A,M;i=t.state,s=t.next_in,A=t.input,o=s+(t.avail_in-5),l=t.next_out,M=t.output,u=l-(r-t.avail_out),h=l+(t.avail_out-257),f=i.dmax,d=i.wsize,c=i.whave,p=i.wnext,m=i.window,g=i.hold,_=i.bits,b=i.lencode,y=i.distcode,v=(1<<i.lenbits)-1,w=(1<<i.distbits)-1;t:do for(_<15&&(g+=A[s++]<<_,_+=8,g+=A[s++]<<_,_+=8),x=b[g&v];;){if(g>>>=k=x>>>24,_-=k,0==(k=x>>>16&255))M[l++]=65535&x;else{if(!(16&k)){if(64&k){if(32&k){i.mode=a;break t}t.msg="invalid literal/length code",i.mode=n;break t}x=b[(65535&x)+(g&(1<<k)-1)];continue}for(E=65535&x,(k&=15)&&(_<k&&(g+=A[s++]<<_,_+=8),E+=g&(1<<k)-1,g>>>=k,_-=k),_<15&&(g+=A[s++]<<_,_+=8,g+=A[s++]<<_,_+=8),x=y[g&w];;){if(g>>>=k=x>>>24,_-=k,16&(k=x>>>16&255)){if(S=65535&x,_<(k&=15)&&(g+=A[s++]<<_,(_+=8)<k&&(g+=A[s++]<<_,_+=8)),(S+=g&(1<<k)-1)>f){t.msg="invalid distance too far back",i.mode=n;break t}if(g>>>=k,_-=k,S>(k=l-u)){if((k=S-k)>c&&i.sane){t.msg="invalid distance too far back",i.mode=n;break t}if($=0,I=m,0===p){if($+=d-k,k<E){E-=k;do M[l++]=m[$++];while(--k)$=l-S,I=M}}else if(p<k){if($+=d+p-k,(k-=p)<E){E-=k;do M[l++]=m[$++];while(--k)if($=0,p<E){E-=k=p;do M[l++]=m[$++];while(--k)$=l-S,I=M}}}else if($+=p-k,k<E){E-=k;do M[l++]=m[$++];while(--k)$=l-S,I=M}for(;E>2;)M[l++]=I[$++],M[l++]=I[$++],M[l++]=I[$++],E-=3;E&&(M[l++]=I[$++],E>1&&(M[l++]=I[$++]))}else{$=l-S;do M[l++]=M[$++],M[l++]=M[$++],M[l++]=M[$++],E-=3;while(E>2)E&&(M[l++]=M[$++],E>1&&(M[l++]=M[$++]))}break}if(64&k){t.msg="invalid distance code",i.mode=n;break t}x=y[(65535&x)+(g&(1<<k)-1)]}}break}while(s<o&&l<h)s-=E=_>>3,g&=(1<<(_-=E<<3))-1,t.next_in=s,t.next_out=l,t.avail_in=s<o?o-s+5:5-(s-o),t.avail_out=l<h?h-l+257:257-(l-h),i.hold=g,i.bits=_}},{}],58:[function(t,r,i){var n=t("../utils/common"),a=t("./adler32"),s=t("./crc32"),o=t("./inffast"),l=t("./inftrees"),u=0,h=1,f=2,d=4,c=5,p=6,m=0,g=1,_=2,b=-2,y=-3,v=-4,w=-5,x=8,k=1,E=2,S=3,$=4,I=5,A=6,M=7,T=8,C=9,z=10,R=11,B=12,O=13,P=14,D=15,N=16,L=17,U=18,j=19,F=20,G=21,W=22,q=23,H=24,V=25,Z=26,K=27,Y=28,X=29,Q=30,J=31,ee=852,et=592,er=15;function ei(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function en(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ea(t){var r;return t&&t.state?(r=t.state,t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=k,r.last=0,r.havedict=0,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new n.Buf32(ee),r.distcode=r.distdyn=new n.Buf32(et),r.sane=1,r.back=-1,m):b}function es(t){var r;return t&&t.state?((r=t.state).wsize=0,r.whave=0,r.wnext=0,ea(t)):b}function eo(t,r){var i,n;return t&&t.state?(n=t.state,r<0?(i=0,r=-r):(i=1+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?b:(null!==n.window&&n.wbits!==r&&(n.window=null),n.wrap=i,n.wbits=r,es(t))):b}function el(t,r){var i,n;return t?(t.state=n=new en,n.window=null,(i=eo(t,r))!==m&&(t.state=null),i):b}function eu(t){return el(t,er)}var eh,ef,ed=!0;function ec(t){if(ed){var r;for(eh=new n.Buf32(512),ef=new n.Buf32(32),r=0;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(l(h,t.lens,0,288,eh,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;l(f,t.lens,0,32,ef,0,t.work,{bits:5}),ed=!1}t.lencode=eh,t.lenbits=9,t.distcode=ef,t.distbits=5}function ep(t,r,i,a){var s,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),a>=o.wsize?(n.arraySet(o.window,r,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((s=o.wsize-o.wnext)>a&&(s=a),n.arraySet(o.window,r,i-a,s,o.wnext),(a-=s)?(n.arraySet(o.window,r,i-a,a,0),o.wnext=a,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}function em(t,r){var i,ee,et,er,en,ea,es,eo,el,eu,eh,ef,ed,em,eg,e_,eb,ey,ev,ew,ex,ek,eE,eS,e$=0,eI=new n.Buf8(4),eA=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return b;(i=t.state).mode===B&&(i.mode=O),en=t.next_out,et=t.output,es=t.avail_out,er=t.next_in,ee=t.input,ea=t.avail_in,eo=i.hold,el=i.bits,eu=ea,eh=es,ek=m;t:for(;;)switch(i.mode){case k:if(0===i.wrap){i.mode=O;break}for(;el<16;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}if(2&i.wrap&&35615===eo){i.check=0,eI[0]=255&eo,eI[1]=eo>>>8&255,i.check=s(i.check,eI,2,0),eo=0,el=0,i.mode=E;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&eo)<<8)+(eo>>8))%31){t.msg="incorrect header check",i.mode=Q;break}if((15&eo)!==x){t.msg="unknown compression method",i.mode=Q;break}if(el-=4,ex=8+(15&(eo>>>=4)),0===i.wbits)i.wbits=ex;else if(ex>i.wbits){t.msg="invalid window size",i.mode=Q;break}i.dmax=1<<ex,t.adler=i.check=1,i.mode=512&eo?z:B,eo=0,el=0;break;case E:for(;el<16;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}if(i.flags=eo,(255&i.flags)!==x){t.msg="unknown compression method",i.mode=Q;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=Q;break}i.head&&(i.head.text=eo>>8&1),512&i.flags&&(eI[0]=255&eo,eI[1]=eo>>>8&255,i.check=s(i.check,eI,2,0)),eo=0,el=0,i.mode=S;case S:for(;el<32;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}i.head&&(i.head.time=eo),512&i.flags&&(eI[0]=255&eo,eI[1]=eo>>>8&255,eI[2]=eo>>>16&255,eI[3]=eo>>>24&255,i.check=s(i.check,eI,4,0)),eo=0,el=0,i.mode=$;case $:for(;el<16;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}i.head&&(i.head.xflags=255&eo,i.head.os=eo>>8),512&i.flags&&(eI[0]=255&eo,eI[1]=eo>>>8&255,i.check=s(i.check,eI,2,0)),eo=0,el=0,i.mode=I;case I:if(1024&i.flags){for(;el<16;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}i.length=eo,i.head&&(i.head.extra_len=eo),512&i.flags&&(eI[0]=255&eo,eI[1]=eo>>>8&255,i.check=s(i.check,eI,2,0)),eo=0,el=0}else i.head&&(i.head.extra=null);i.mode=A;case A:if(1024&i.flags&&((ef=i.length)>ea&&(ef=ea),ef&&(i.head&&(ex=i.head.extra_len-i.length,i.head.extra||(i.head.extra=Array(i.head.extra_len)),n.arraySet(i.head.extra,ee,er,ef,ex)),512&i.flags&&(i.check=s(i.check,ee,ef,er)),ea-=ef,er+=ef,i.length-=ef),i.length))break t;i.length=0,i.mode=M;case M:if(2048&i.flags){if(0===ea)break t;ef=0;do ex=ee[er+ef++],i.head&&ex&&i.length<65536&&(i.head.name+=String.fromCharCode(ex));while(ex&&ef<ea)if(512&i.flags&&(i.check=s(i.check,ee,ef,er)),ea-=ef,er+=ef,ex)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=T;case T:if(4096&i.flags){if(0===ea)break t;ef=0;do ex=ee[er+ef++],i.head&&ex&&i.length<65536&&(i.head.comment+=String.fromCharCode(ex));while(ex&&ef<ea)if(512&i.flags&&(i.check=s(i.check,ee,ef,er)),ea-=ef,er+=ef,ex)break t}else i.head&&(i.head.comment=null);i.mode=C;case C:if(512&i.flags){for(;el<16;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}if(eo!==(65535&i.check)){t.msg="header crc mismatch",i.mode=Q;break}eo=0,el=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=B;break;case z:for(;el<32;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}t.adler=i.check=ei(eo),eo=0,el=0,i.mode=R;case R:if(0===i.havedict)return t.next_out=en,t.avail_out=es,t.next_in=er,t.avail_in=ea,i.hold=eo,i.bits=el,_;t.adler=i.check=1,i.mode=B;case B:if(r===c||r===p)break t;case O:if(i.last){eo>>>=7&el,el-=7&el,i.mode=K;break}for(;el<3;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}switch(i.last=1&eo,el-=1,3&(eo>>>=1)){case 0:i.mode=P;break;case 1:if(ec(i),i.mode=F,r===p){eo>>>=2,el-=2;break t}break;case 2:i.mode=L;break;case 3:t.msg="invalid block type",i.mode=Q}eo>>>=2,el-=2;break;case P:for(eo>>>=7&el,el-=7&el;el<32;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}if((65535&eo)!=(eo>>>16^65535)){t.msg="invalid stored block lengths",i.mode=Q;break}if(i.length=65535&eo,eo=0,el=0,i.mode=D,r===p)break t;case D:i.mode=N;case N:if(ef=i.length){if(ef>ea&&(ef=ea),ef>es&&(ef=es),0===ef)break t;n.arraySet(et,ee,er,ef,en),ea-=ef,er+=ef,es-=ef,en+=ef,i.length-=ef;break}i.mode=B;break;case L:for(;el<14;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}if(i.nlen=257+(31&eo),el-=5,i.ndist=1+(31&(eo>>>=5)),el-=5,i.ncode=4+(15&(eo>>>=5)),eo>>>=4,el-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=Q;break}i.have=0,i.mode=U;case U:for(;i.have<i.ncode;){for(;el<3;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}i.lens[eA[i.have++]]=7&eo,eo>>>=3,el-=3}for(;i.have<19;)i.lens[eA[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,eE={bits:i.lenbits},ek=l(u,i.lens,0,19,i.lencode,0,i.work,eE),i.lenbits=eE.bits,ek){t.msg="invalid code lengths set",i.mode=Q;break}i.have=0,i.mode=j;case j:for(;i.have<i.nlen+i.ndist;){for(;e_=(e$=i.lencode[eo&(1<<i.lenbits)-1])>>>16&255,eb=65535&e$,!((eg=e$>>>24)<=el);){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}if(eb<16)eo>>>=eg,el-=eg,i.lens[i.have++]=eb;else{if(16===eb){for(eS=eg+2;el<eS;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}if(eo>>>=eg,el-=eg,0===i.have){t.msg="invalid bit length repeat",i.mode=Q;break}ex=i.lens[i.have-1],ef=3+(3&eo),eo>>>=2,el-=2}else if(17===eb){for(eS=eg+3;el<eS;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}el-=eg,ex=0,ef=3+(7&(eo>>>=eg)),eo>>>=3,el-=3}else{for(eS=eg+7;el<eS;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}el-=eg,ex=0,ef=11+(127&(eo>>>=eg)),eo>>>=7,el-=7}if(i.have+ef>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=Q;break}for(;ef--;)i.lens[i.have++]=ex}}if(i.mode===Q)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=Q;break}if(i.lenbits=9,eE={bits:i.lenbits},ek=l(h,i.lens,0,i.nlen,i.lencode,0,i.work,eE),i.lenbits=eE.bits,ek){t.msg="invalid literal/lengths set",i.mode=Q;break}if(i.distbits=6,i.distcode=i.distdyn,eE={bits:i.distbits},ek=l(f,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,eE),i.distbits=eE.bits,ek){t.msg="invalid distances set",i.mode=Q;break}if(i.mode=F,r===p)break t;case F:i.mode=G;case G:if(ea>=6&&es>=258){t.next_out=en,t.avail_out=es,t.next_in=er,t.avail_in=ea,i.hold=eo,i.bits=el,o(t,eh),en=t.next_out,et=t.output,es=t.avail_out,er=t.next_in,ee=t.input,ea=t.avail_in,eo=i.hold,el=i.bits,i.mode===B&&(i.back=-1);break}for(i.back=0;e_=(e$=i.lencode[eo&(1<<i.lenbits)-1])>>>16&255,eb=65535&e$,!((eg=e$>>>24)<=el);){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}if(e_&&!(240&e_)){for(ey=eg,ev=e_,ew=eb;e_=(e$=i.lencode[ew+((eo&(1<<ey+ev)-1)>>ey)])>>>16&255,eb=65535&e$,!(ey+(eg=e$>>>24)<=el);){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}eo>>>=ey,el-=ey,i.back+=ey}if(eo>>>=eg,el-=eg,i.back+=eg,i.length=eb,0===e_){i.mode=Z;break}if(32&e_){i.back=-1,i.mode=B;break}if(64&e_){t.msg="invalid literal/length code",i.mode=Q;break}i.extra=15&e_,i.mode=W;case W:if(i.extra){for(eS=i.extra;el<eS;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}i.length+=eo&(1<<i.extra)-1,eo>>>=i.extra,el-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=q;case q:for(;e_=(e$=i.distcode[eo&(1<<i.distbits)-1])>>>16&255,eb=65535&e$,!((eg=e$>>>24)<=el);){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}if(!(240&e_)){for(ey=eg,ev=e_,ew=eb;e_=(e$=i.distcode[ew+((eo&(1<<ey+ev)-1)>>ey)])>>>16&255,eb=65535&e$,!(ey+(eg=e$>>>24)<=el);){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}eo>>>=ey,el-=ey,i.back+=ey}if(eo>>>=eg,el-=eg,i.back+=eg,64&e_){t.msg="invalid distance code",i.mode=Q;break}i.offset=eb,i.extra=15&e_,i.mode=H;case H:if(i.extra){for(eS=i.extra;el<eS;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}i.offset+=eo&(1<<i.extra)-1,eo>>>=i.extra,el-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=Q;break}i.mode=V;case V:if(0===es)break t;if(ef=eh-es,i.offset>ef){if((ef=i.offset-ef)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=Q;break}ef>i.wnext?(ef-=i.wnext,ed=i.wsize-ef):ed=i.wnext-ef,ef>i.length&&(ef=i.length),em=i.window}else em=et,ed=en-i.offset,ef=i.length;ef>es&&(ef=es),es-=ef,i.length-=ef;do et[en++]=em[ed++];while(--ef)0===i.length&&(i.mode=G);break;case Z:if(0===es)break t;et[en++]=i.length,es--,i.mode=G;break;case K:if(i.wrap){for(;el<32;){if(0===ea)break t;ea--,eo|=ee[er++]<<el,el+=8}if(eh-=es,t.total_out+=eh,i.total+=eh,eh&&(t.adler=i.check=i.flags?s(i.check,et,eh,en-eh):a(i.check,et,eh,en-eh)),eh=es,(i.flags?eo:ei(eo))!==i.check){t.msg="incorrect data check",i.mode=Q;break}eo=0,el=0}i.mode=Y;case Y:if(i.wrap&&i.flags){for(;el<32;){if(0===ea)break t;ea--,eo+=ee[er++]<<el,el+=8}if(eo!==(0|i.total)){t.msg="incorrect length check",i.mode=Q;break}eo=0,el=0}i.mode=X;case X:ek=g;break t;case Q:ek=y;break t;case J:return v;default:return b}return t.next_out=en,t.avail_out=es,t.next_in=er,t.avail_in=ea,i.hold=eo,i.bits=el,(i.wsize||eh!==t.avail_out&&i.mode<Q&&(i.mode<K||r!==d))&&ep(t,t.output,t.next_out,eh-t.avail_out),eu-=t.avail_in,eh-=t.avail_out,t.total_in+=eu,t.total_out+=eh,i.total+=eh,i.wrap&&eh&&(t.adler=i.check=i.flags?s(i.check,et,eh,t.next_out-eh):a(i.check,et,eh,t.next_out-eh)),t.data_type=i.bits+64*!!i.last+128*(i.mode===B)+256*(i.mode===F||i.mode===D),(0===eu&&0===eh||r===d)&&ek===m&&(ek=w),ek}function eg(t){if(!t||!t.state)return b;var r=t.state;return r.window&&(r.window=null),t.state=null,m}function e_(t,r){var i;return t&&t.state&&2&(i=t.state).wrap?(i.head=r,r.done=!1,m):b}function eb(t,r){var i,n=r.length;return t&&t.state?0!==(i=t.state).wrap&&i.mode!==R?b:i.mode===R&&a(1,r,n,0)!==i.check?y:ep(t,r,n,n)?(i.mode=J,v):(i.havedict=1,m):b}i.inflateReset=es,i.inflateReset2=eo,i.inflateResetKeep=ea,i.inflateInit=eu,i.inflateInit2=el,i.inflate=em,i.inflateEnd=eg,i.inflateGetHeader=e_,i.inflateSetDictionary=eb,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":52,"./adler32":53,"./crc32":55,"./inffast":57,"./inftrees":59}],59:[function(t,r,i){var n=t("../utils/common"),a=15,s=852,o=592,l=0,u=1,h=2,f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(t,r,i,m,g,_,b,y){var v,w,x,k,E,S,$,I,A,M=y.bits,T=0,C=0,z=0,R=0,B=0,O=0,P=0,D=0,N=0,L=0,U=null,j=0,F=new n.Buf16(a+1),G=new n.Buf16(a+1),W=null,q=0;for(T=0;T<=a;T++)F[T]=0;for(C=0;C<m;C++)F[r[i+C]]++;for(B=M,R=a;R>=1&&0===F[R];R--);if(B>R&&(B=R),0===R)return g[_++]=0x1400000,g[_++]=0x1400000,y.bits=1,0;for(z=1;z<R&&0===F[z];z++);for(B<z&&(B=z),D=1,T=1;T<=a;T++)if(D<<=1,(D-=F[T])<0)return -1;if(D>0&&(t===l||1!==R))return -1;for(G[1]=0,T=1;T<a;T++)G[T+1]=G[T]+F[T];for(C=0;C<m;C++)0!==r[i+C]&&(b[G[r[i+C]]++]=C);if(t===l?(U=W=b,S=19):t===u?(U=f,j-=257,W=d,q-=257,S=256):(U=c,W=p,S=-1),L=0,C=0,T=z,E=_,O=B,P=0,x=-1,k=(N=1<<B)-1,t===u&&N>s||t===h&&N>o)return 1;for(;;){$=T-P,b[C]<S?(I=0,A=b[C]):b[C]>S?(I=W[q+b[C]],A=U[j+b[C]]):(I=96,A=0),v=1<<T-P,z=w=1<<O;do g[E+(L>>P)+(w-=v)]=$<<24|I<<16|A;while(0!==w)for(v=1<<T-1;L&v;)v>>=1;if(0!==v?(L&=v-1,L+=v):L=0,C++,0==--F[T]){if(T===R)break;T=r[i+b[C]]}if(T>B&&(L&k)!==x){for(0===P&&(P=B),E+=z,D=1<<(O=T-P);O+P<R&&!((D-=F[O+P])<=0);)O++,D<<=1;if(N+=1<<O,t===u&&N>s||t===h&&N>o)return 1;g[x=L&k]=B<<24|O<<16|E-_}}return 0!==L&&(g[E+L]=T-P<<24|4194304),y.bits=B,0}},{"../utils/common":52}],60:[function(t,r,i){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],61:[function(t,r,i){var n=t("../utils/common"),a=4,s=0,o=1,l=2;function u(t){for(var r=t.length;--r>=0;)t[r]=0}var h=0,f=1,d=2,c=3,p=258,m=29,g=256,_=286,b=30,y=19,v=573,w=15,x=16,k=7,E=256,S=16,$=17,I=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=512,R=Array(576);u(R);var B=Array(2*b);u(B);var O=Array(z);u(O);var P=Array(p-c+1);u(P);var D=Array(m);u(D);var N,L,U,j=Array(b);function F(t,r,i,n,a){this.static_tree=t,this.extra_bits=r,this.extra_base=i,this.elems=n,this.max_length=a,this.has_stree=t&&t.length}function G(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}function W(t){return t<256?O[t]:O[256+(t>>>7)]}function q(t,r){t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255}function H(t,r,i){t.bi_valid>x-i?(t.bi_buf|=r<<t.bi_valid&65535,q(t,t.bi_buf),t.bi_buf=r>>x-t.bi_valid,t.bi_valid+=i-x):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=i)}function V(t,r,i){H(t,i[2*r],i[2*r+1])}function Z(t,r){var i=0;do i|=1&t,t>>>=1,i<<=1;while(--r>0)return i>>>1}function K(t){16===t.bi_valid?(q(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function Y(t,r){var i,n,a,s,o,l,u=r.dyn_tree,h=r.max_code,f=r.stat_desc.static_tree,d=r.stat_desc.has_stree,c=r.stat_desc.extra_bits,p=r.stat_desc.extra_base,m=r.stat_desc.max_length,g=0;for(s=0;s<=w;s++)t.bl_count[s]=0;for(u[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<v;i++)(s=u[2*u[2*(n=t.heap[i])+1]+1]+1)>m&&(s=m,g++),u[2*n+1]=s,n>h||(t.bl_count[s]++,o=0,n>=p&&(o=c[n-p]),l=u[2*n],t.opt_len+=l*(s+o),d&&(t.static_len+=l*(f[2*n+1]+o)));if(0!==g){do{for(s=m-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[m]--,g-=2}while(g>0)for(s=m;0!==s;s--)for(n=t.bl_count[s];0!==n;)(a=t.heap[--i])>h||(u[2*a+1]!==s&&(t.opt_len+=(s-u[2*a+1])*u[2*a],u[2*a+1]=s),n--)}}function X(t,r,i){var n,a,s=Array(w+1),o=0;for(n=1;n<=w;n++)s[n]=o=o+i[n-1]<<1;for(a=0;a<=r;a++){var l=t[2*a+1];0!==l&&(t[2*a]=Z(s[l]++,l))}}function Q(){var t,r,i,n,a,s=Array(w+1);for(i=0,n=0;n<m-1;n++)for(D[n]=i,t=0;t<1<<A[n];t++)P[i++]=n;for(P[i-1]=n,a=0,n=0;n<16;n++)for(j[n]=a,t=0;t<1<<M[n];t++)O[a++]=n;for(a>>=7;n<b;n++)for(j[n]=a<<7,t=0;t<1<<M[n]-7;t++)O[256+a++]=n;for(r=0;r<=w;r++)s[r]=0;for(t=0;t<=143;)R[2*t+1]=8,t++,s[8]++;for(;t<=255;)R[2*t+1]=9,t++,s[9]++;for(;t<=279;)R[2*t+1]=7,t++,s[7]++;for(;t<=287;)R[2*t+1]=8,t++,s[8]++;for(X(R,_+1,s),t=0;t<b;t++)B[2*t+1]=5,B[2*t]=Z(t,5);N=new F(R,A,g+1,_,w),L=new F(B,M,0,b,w),U=new F([],T,0,y,k)}function J(t){var r;for(r=0;r<_;r++)t.dyn_ltree[2*r]=0;for(r=0;r<b;r++)t.dyn_dtree[2*r]=0;for(r=0;r<y;r++)t.bl_tree[2*r]=0;t.dyn_ltree[2*E]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function ee(t){t.bi_valid>8?q(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function et(t,r,i,a){ee(t),q(t,i),q(t,~i),n.arraySet(t.pending_buf,t.window,r,i,t.pending),t.pending+=i}function er(t,r,i,n){var a=2*r,s=2*i;return t[a]<t[s]||t[a]===t[s]&&n[r]<=n[i]}function ei(t,r,i){for(var n=t.heap[i],a=i<<1;a<=t.heap_len&&(a<t.heap_len&&er(r,t.heap[a+1],t.heap[a],t.depth)&&a++,!er(r,n,t.heap[a],t.depth));)t.heap[i]=t.heap[a],i=a,a<<=1;t.heap[i]=n}function en(t,r,i){var n,a,s,o,l=0;if(0!==t.last_lit)do n=t.pending_buf[t.d_buf+2*l]<<8|t.pending_buf[t.d_buf+2*l+1],a=t.pending_buf[t.l_buf+l],l++,0===n?V(t,a,r):(V(t,(s=P[a])+g+1,r),0!==(o=A[s])&&H(t,a-=D[s],o),V(t,s=W(--n),i),0!==(o=M[s])&&H(t,n-=j[s],o));while(l<t.last_lit)V(t,E,r)}function ea(t,r){var i,n,a,s=r.dyn_tree,o=r.stat_desc.static_tree,l=r.stat_desc.has_stree,u=r.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=v,i=0;i<u;i++)0!==s[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):s[2*i+1]=0;for(;t.heap_len<2;)s[2*(a=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[a]=0,t.opt_len--,l&&(t.static_len-=o[2*a+1]);for(r.max_code=h,i=t.heap_len>>1;i>=1;i--)ei(t,s,i);a=u;do i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],ei(t,s,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,s[2*a]=s[2*i]+s[2*n],t.depth[a]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,s[2*i+1]=s[2*n+1]=a,t.heap[1]=a++,ei(t,s,1);while(t.heap_len>=2)t.heap[--t.heap_max]=t.heap[1],Y(t,r),X(s,h,t.bl_count)}function es(t,r,i){var n,a,s=-1,o=r[1],l=0,u=7,h=4;for(0===o&&(u=138,h=3),r[2*(i+1)+1]=65535,n=0;n<=i;n++)a=o,o=r[2*(n+1)+1],++l<u&&a===o||(l<h?t.bl_tree[2*a]+=l:0!==a?(a!==s&&t.bl_tree[2*a]++,t.bl_tree[2*S]++):l<=10?t.bl_tree[2*$]++:t.bl_tree[2*I]++,l=0,s=a,0===o?(u=138,h=3):a===o?(u=6,h=3):(u=7,h=4))}function eo(t,r,i){var n,a,s=-1,o=r[1],l=0,u=7,h=4;for(0===o&&(u=138,h=3),n=0;n<=i;n++)if(a=o,o=r[2*(n+1)+1],!(++l<u&&a===o)){if(l<h)do V(t,a,t.bl_tree);while(0!=--l)else 0!==a?(a!==s&&(V(t,a,t.bl_tree),l--),V(t,S,t.bl_tree),H(t,l-3,2)):l<=10?(V(t,$,t.bl_tree),H(t,l-3,3)):(V(t,I,t.bl_tree),H(t,l-11,7));l=0,s=a,0===o?(u=138,h=3):a===o?(u=6,h=3):(u=7,h=4)}}function el(t){var r;for(es(t,t.dyn_ltree,t.l_desc.max_code),es(t,t.dyn_dtree,t.d_desc.max_code),ea(t,t.bl_desc),r=y-1;r>=3&&0===t.bl_tree[2*C[r]+1];r--);return t.opt_len+=3*(r+1)+5+5+4,r}function eu(t,r,i,n){var a;for(H(t,r-257,5),H(t,i-1,5),H(t,n-4,4),a=0;a<n;a++)H(t,t.bl_tree[2*C[a]+1],3);eo(t,t.dyn_ltree,r-1),eo(t,t.dyn_dtree,i-1)}function eh(t){var r,i=0xf3ffc07f;for(r=0;r<=31;r++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*r])return s;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return o;for(r=32;r<g;r++)if(0!==t.dyn_ltree[2*r])return o;return s}u(j);var ef=!1;function ed(t,r,i,n){H(t,(h<<1)+ +!!n,3),et(t,r,i)}function ec(t){H(t,f<<1,3),V(t,E,R),K(t)}function ep(t,r,i,n){var s,o,u=0;t.level>0?(t.strm.data_type===l&&(t.strm.data_type=eh(t)),ea(t,t.l_desc),ea(t,t.d_desc),u=el(t),s=t.opt_len+3+7>>>3,(o=t.static_len+3+7>>>3)<=s&&(s=o)):s=o=i+5,i+4<=s&&-1!==r?ed(t,r,i,n):t.strategy===a||o===s?(H(t,(f<<1)+ +!!n,3),en(t,R,B)):(H(t,(d<<1)+ +!!n,3),eu(t,t.l_desc.max_code+1,t.d_desc.max_code+1,u+1),en(t,t.dyn_ltree,t.dyn_dtree)),J(t),n&&ee(t)}function em(t,r,i){return t.pending_buf[t.d_buf+2*t.last_lit]=r>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&r,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===r?t.dyn_ltree[2*i]++:(t.matches++,r--,t.dyn_ltree[2*(P[i]+g+1)]++,t.dyn_dtree[2*W(r)]++),t.last_lit===t.lit_bufsize-1}i._tr_init=function(t){ef||(Q(),ef=!0),t.l_desc=new G(t.dyn_ltree,N),t.d_desc=new G(t.dyn_dtree,L),t.bl_desc=new G(t.bl_tree,U),t.bi_buf=0,t.bi_valid=0,J(t)},i._tr_stored_block=ed,i._tr_flush_block=ep,i._tr_tally=em,i._tr_align=ec},{"../utils/common":52}],62:[function(t,r,i){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],63:[function(t,r,i){var n,a,s=r.exports={};function o(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function u(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(r){try{return n.call(null,t,0)}catch(r){return n.call(this,t,0)}}}function h(t){if(a===clearTimeout)return clearTimeout(t);if((a===l||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(t);try{return a(t)}catch(r){try{return a.call(null,t)}catch(r){return a.call(this,t)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{a="function"==typeof clearTimeout?clearTimeout:l}catch(t){a=l}}();var f,d=[],c=!1,p=-1;function m(){c&&f&&(c=!1,f.length?d=f.concat(d):p=-1,d.length&&g())}function g(){if(!c){var t=u(m);c=!0;for(var r=d.length;r;){for(f=d,d=[];++p<r;)f&&f[p].run();p=-1,r=d.length}f=null,c=!1,h(t)}}function _(t,r){this.fun=t,this.array=r}function b(){}s.nextTick=function(t){var r=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)r[i-1]=arguments[i];d.push(new _(t,r)),1!==d.length||c||u(g)},_.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=b,s.addListener=b,s.once=b,s.off=b,s.removeListener=b,s.removeAllListeners=b,s.emit=b,s.prependListener=b,s.prependOnceListener=b,s.listeners=function(t){return[]},s.binding=function(t){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],64:[function(t,r,i){var n=t("buffer"),a=n.Buffer;function s(t,r){for(var i in t)r[i]=t[i]}function o(t,r,i){return a(t,r,i)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?r.exports=n:(s(n,i),i.Buffer=o),o.prototype=Object.create(a.prototype),s(a,o),o.from=function(t,r,i){if("number"==typeof t)throw TypeError("Argument must not be a number");return a(t,r,i)},o.alloc=function(t,r,i){if("number"!=typeof t)throw TypeError("Argument must be a number");var n=a(t);return void 0!==r?"string"==typeof i?n.fill(r,i):n.fill(r):n.fill(0),n},o.allocUnsafe=function(t){if("number"!=typeof t)throw TypeError("Argument must be a number");return a(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw TypeError("Argument must be a number");return n.SlowBuffer(t)}},{buffer:32}],65:[function(t,r,i){r.exports=a;var n=t("events").EventEmitter;function a(){n.call(this)}t("inherits")(a,n),a.Readable=t("readable-stream/lib/_stream_readable.js"),a.Writable=t("readable-stream/lib/_stream_writable.js"),a.Duplex=t("readable-stream/lib/_stream_duplex.js"),a.Transform=t("readable-stream/lib/_stream_transform.js"),a.PassThrough=t("readable-stream/lib/_stream_passthrough.js"),a.finished=t("readable-stream/lib/internal/streams/end-of-stream.js"),a.pipeline=t("readable-stream/lib/internal/streams/pipeline.js"),a.Stream=a,a.prototype.pipe=function(t,r){var i=this;function a(r){t.writable&&!1===t.write(r)&&i.pause&&i.pause()}function s(){i.readable&&i.resume&&i.resume()}i.on("data",a),t.on("drain",s),t._isStdio||r&&!1===r.end||(i.on("end",l),i.on("close",u));var o=!1;function l(){o||(o=!0,t.end())}function u(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function h(t){if(f(),0===n.listenerCount(this,"error"))throw t}function f(){i.removeListener("data",a),t.removeListener("drain",s),i.removeListener("end",l),i.removeListener("close",u),i.removeListener("error",h),t.removeListener("error",h),i.removeListener("end",f),i.removeListener("close",f),t.removeListener("close",f)}return i.on("error",h),t.on("error",h),i.on("end",f),i.on("close",f),t.on("close",f),t.emit("pipe",i),t}},{events:35,inherits:46,"readable-stream/lib/_stream_duplex.js":67,"readable-stream/lib/_stream_passthrough.js":68,"readable-stream/lib/_stream_readable.js":69,"readable-stream/lib/_stream_transform.js":70,"readable-stream/lib/_stream_writable.js":71,"readable-stream/lib/internal/streams/end-of-stream.js":75,"readable-stream/lib/internal/streams/pipeline.js":77}],66:[function(t,r,i){function n(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r}var a={};function s(t,r,i){function s(t,i,n){return"string"==typeof r?r:r(t,i,n)}i||(i=Error);var o=function(t){function r(r,i,n){return t.call(this,s(r,i,n))||this}return n(r,t),r}(i);o.prototype.name=i.name,o.prototype.code=t,a[t]=o}function o(t,r){if(Array.isArray(t)){var i=t.length;return t=t.map(function(t){return String(t)}),i>2?"one of ".concat(r," ").concat(t.slice(0,i-1).join(", "),", or ")+t[i-1]:2===i?"one of ".concat(r," ").concat(t[0]," or ").concat(t[1]):"of ".concat(r," ").concat(t[0])}return"of ".concat(r," ").concat(String(t))}function l(t,r,i){return t.substr(0,r.length)===r}function u(t,r,i){return(void 0===i||i>t.length)&&(i=t.length),t.substring(i-r.length,i)===r}function h(t,r,i){return"number"!=typeof i&&(i=0),!(i+r.length>t.length)&&-1!==t.indexOf(r,i)}s("ERR_INVALID_OPT_VALUE",function(t,r){return'The value "'+r+'" is invalid for option "'+t+'"'},TypeError),s("ERR_INVALID_ARG_TYPE",function(t,r,i){var n,a;if("string"==typeof r&&l(r,"not ")?(n="must not be",r=r.replace(/^not /,"")):n="must be",u(t," argument"))a="The ".concat(t," ").concat(n," ").concat(o(r,"type"));else{var s=h(t,".")?"property":"argument";a='The "'.concat(t,'" ').concat(s," ").concat(n," ").concat(o(r,"type"))}return a+". Received type ".concat(typeof i)},TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",function(t){return"The "+t+" method is not implemented"}),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",function(t){return"Cannot call "+t+" after a stream was destroyed"}),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",function(t){return"Unknown encoding: "+t},TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),r.exports.codes=a},{}],67:[function(t,r,i){(function(i){(function(){var n=Object.keys||function(t){var r=[];for(var i in t)r.push(i);return r};r.exports=h;var a=t("./_stream_readable"),s=t("./_stream_writable");t("inherits")(h,a);for(var o=n(s.prototype),l=0;l<o.length;l++){var u=o[l];h.prototype[u]||(h.prototype[u]=s.prototype[u])}function h(t){if(!(this instanceof h))return new h(t);a.call(this,t),s.call(this,t),this.allowHalfOpen=!0,t&&(!1===t.readable&&(this.readable=!1),!1===t.writable&&(this.writable=!1),!1===t.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",f)))}function f(){this._writableState.ended||i.nextTick(d,this)}function d(t){t.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(h.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(h.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}})}).call(this)}).call(this,t("_process"))},{"./_stream_readable":69,"./_stream_writable":71,_process:63,inherits:46}],68:[function(t,r,i){r.exports=a;var n=t("./_stream_transform");function a(t){if(!(this instanceof a))return new a(t);n.call(this,t)}t("inherits")(a,n),a.prototype._transform=function(t,r,i){i(null,t)}},{"./_stream_transform":70,inherits:46}],69:[function(t,r,i){(function(i,n){(function(){r.exports=M,M.ReadableState=A,t("events").EventEmitter;var a=function(t,r){return t.listeners(r).length},s=t("./internal/streams/stream"),o=t("buffer").Buffer,l=n.Uint8Array||function(){};function u(t){return o.from(t)}function h(t){return o.isBuffer(t)||t instanceof l}var f,d,c=t("util");d=c&&c.debuglog?c.debuglog("stream"):function(){};var p,m,g,_=t("./internal/streams/buffer_list"),b=t("./internal/streams/destroy"),y=t("./internal/streams/state").getHighWaterMark,v=t("../errors").codes,w=v.ERR_INVALID_ARG_TYPE,x=v.ERR_STREAM_PUSH_AFTER_EOF,k=v.ERR_METHOD_NOT_IMPLEMENTED,E=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;t("inherits")(M,s);var S=b.errorOrDestroy,$=["error","close","destroy","pause","resume"];function I(t,r,i){if("function"==typeof t.prependListener)return t.prependListener(r,i);t._events&&t._events[r]?Array.isArray(t._events[r])?t._events[r].unshift(i):t._events[r]=[i,t._events[r]]:t.on(r,i)}function A(r,i,n){f=f||t("./_stream_duplex"),r=r||{},"boolean"!=typeof n&&(n=i instanceof f),this.objectMode=!!r.objectMode,n&&(this.objectMode=this.objectMode||!!r.readableObjectMode),this.highWaterMark=y(this,r,"readableHighWaterMark",n),this.buffer=new _,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==r.emitClose,this.autoDestroy=!!r.autoDestroy,this.destroyed=!1,this.defaultEncoding=r.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,r.encoding&&(p||(p=t("string_decoder/").StringDecoder),this.decoder=new p(r.encoding),this.encoding=r.encoding)}function M(r){if(f=f||t("./_stream_duplex"),!(this instanceof M))return new M(r);var i=this instanceof f;this._readableState=new A(r,this,i),this.readable=!0,r&&("function"==typeof r.read&&(this._read=r.read),"function"==typeof r.destroy&&(this._destroy=r.destroy)),s.call(this)}function T(t,r,i,n,a){d("readableAddChunk",r);var s,l=t._readableState;if(null===r)l.reading=!1,P(t,l);else if(a||(s=z(l,r)),s)S(t,s);else if(l.objectMode||r&&r.length>0)if("string"==typeof r||l.objectMode||Object.getPrototypeOf(r)===o.prototype||(r=u(r)),n)l.endEmitted?S(t,new E):C(t,l,r,!0);else if(l.ended)S(t,new x);else{if(l.destroyed)return!1;l.reading=!1,l.decoder&&!i?(r=l.decoder.write(r),l.objectMode||0!==r.length?C(t,l,r,!1):L(t,l)):C(t,l,r,!1)}else n||(l.reading=!1,L(t,l));return!l.ended&&(l.length<l.highWaterMark||0===l.length)}function C(t,r,i,n){r.flowing&&0===r.length&&!r.sync?(r.awaitDrain=0,t.emit("data",i)):(r.length+=r.objectMode?1:i.length,n?r.buffer.unshift(i):r.buffer.push(i),r.needReadable&&D(t)),L(t,r)}function z(t,r){var i;return h(r)||"string"==typeof r||void 0===r||t.objectMode||(i=new w("chunk",["string","Buffer","Uint8Array"],r)),i}Object.defineProperty(M.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),M.prototype.destroy=b.destroy,M.prototype._undestroy=b.undestroy,M.prototype._destroy=function(t,r){r(t)},M.prototype.push=function(t,r){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof t&&((r=r||n.defaultEncoding)!==n.encoding&&(t=o.from(t,r),r=""),i=!0),T(this,t,r,!1,i)},M.prototype.unshift=function(t){return T(this,t,null,!0,!1)},M.prototype.isPaused=function(){return!1===this._readableState.flowing},M.prototype.setEncoding=function(r){p||(p=t("string_decoder/").StringDecoder);var i=new p(r);this._readableState.decoder=i,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,a="";null!==n;)a+=i.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==a&&this._readableState.buffer.push(a),this._readableState.length=a.length,this};var R=0x40000000;function B(t){return t>=R?t=R:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function O(t,r){return t<=0||0===r.length&&r.ended?0:r.objectMode?1:t!=t?r.flowing&&r.length?r.buffer.head.data.length:r.length:(t>r.highWaterMark&&(r.highWaterMark=B(t)),t<=r.length?t:r.ended?r.length:(r.needReadable=!0,0))}function P(t,r){if(d("onEofChunk"),!r.ended){if(r.decoder){var i=r.decoder.end();i&&i.length&&(r.buffer.push(i),r.length+=r.objectMode?1:i.length)}r.ended=!0,r.sync?D(t):(r.needReadable=!1,r.emittedReadable||(r.emittedReadable=!0,N(t)))}}function D(t){var r=t._readableState;d("emitReadable",r.needReadable,r.emittedReadable),r.needReadable=!1,r.emittedReadable||(d("emitReadable",r.flowing),r.emittedReadable=!0,i.nextTick(N,t))}function N(t){var r=t._readableState;d("emitReadable_",r.destroyed,r.length,r.ended),!r.destroyed&&(r.length||r.ended)&&(t.emit("readable"),r.emittedReadable=!1),r.needReadable=!r.flowing&&!r.ended&&r.length<=r.highWaterMark,H(t)}function L(t,r){r.readingMore||(r.readingMore=!0,i.nextTick(U,t,r))}function U(t,r){for(;!r.reading&&!r.ended&&(r.length<r.highWaterMark||r.flowing&&0===r.length);){var i=r.length;if(d("maybeReadMore read 0"),t.read(0),i===r.length)break}r.readingMore=!1}function j(t){return function(){var r=t._readableState;d("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,0===r.awaitDrain&&a(t,"data")&&(r.flowing=!0,H(t))}}function F(t){var r=t._readableState;r.readableListening=t.listenerCount("readable")>0,r.resumeScheduled&&!r.paused?r.flowing=!0:t.listenerCount("data")>0&&t.resume()}function G(t){d("readable nexttick read 0"),t.read(0)}function W(t,r){r.resumeScheduled||(r.resumeScheduled=!0,i.nextTick(q,t,r))}function q(t,r){d("resume",r.reading),r.reading||t.read(0),r.resumeScheduled=!1,t.emit("resume"),H(t),r.flowing&&!r.reading&&t.read(0)}function H(t){var r=t._readableState;for(d("flow",r.flowing);r.flowing&&null!==t.read(););}function V(t,r){var i;return 0===r.length?null:(r.objectMode?i=r.buffer.shift():!t||t>=r.length?(i=r.decoder?r.buffer.join(""):1===r.buffer.length?r.buffer.first():r.buffer.concat(r.length),r.buffer.clear()):i=r.buffer.consume(t,r.decoder),i)}function Z(t){var r=t._readableState;d("endReadable",r.endEmitted),r.endEmitted||(r.ended=!0,i.nextTick(K,r,t))}function K(t,r){if(d("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&0===t.length&&(t.endEmitted=!0,r.readable=!1,r.emit("end"),t.autoDestroy)){var i=r._writableState;(!i||i.autoDestroy&&i.finished)&&r.destroy()}}function Y(t,r){for(var i=0,n=t.length;i<n;i++)if(t[i]===r)return i;return -1}M.prototype.read=function(t){d("read",t),t=parseInt(t,10);var r=this._readableState,i=t;if(0!==t&&(r.emittedReadable=!1),0===t&&r.needReadable&&((0!==r.highWaterMark?r.length>=r.highWaterMark:r.length>0)||r.ended))return d("read: emitReadable",r.length,r.ended),0===r.length&&r.ended?Z(this):D(this),null;if(0===(t=O(t,r))&&r.ended)return 0===r.length&&Z(this),null;var n,a=r.needReadable;return d("need readable",a),(0===r.length||r.length-t<r.highWaterMark)&&d("length less than watermark",a=!0),r.ended||r.reading?d("reading or ended",a=!1):a&&(d("do read"),r.reading=!0,r.sync=!0,0===r.length&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,r.reading||(t=O(i,r))),null===(n=t>0?V(t,r):null)?(r.needReadable=r.length<=r.highWaterMark,t=0):(r.length-=t,r.awaitDrain=0),0===r.length&&(r.ended||(r.needReadable=!0),i!==t&&r.ended&&Z(this)),null!==n&&this.emit("data",n),n},M.prototype._read=function(t){S(this,new k("_read()"))},M.prototype.pipe=function(t,r){var n=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t)}s.pipesCount+=1,d("pipe count=%d opts=%j",s.pipesCount,r);var o=r&&!1===r.end||t===i.stdout||t===i.stderr?b:u;function l(t,r){d("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,c())}function u(){d("onend"),t.end()}s.endEmitted?i.nextTick(o):n.once("end",o),t.on("unpipe",l);var h=j(n);t.on("drain",h);var f=!1;function c(){d("cleanup"),t.removeListener("close",g),t.removeListener("finish",_),t.removeListener("drain",h),t.removeListener("error",m),t.removeListener("unpipe",l),n.removeListener("end",u),n.removeListener("end",b),n.removeListener("data",p),f=!0,s.awaitDrain&&(!t._writableState||t._writableState.needDrain)&&h()}function p(r){d("ondata");var i=t.write(r);d("dest.write",i),!1===i&&((1===s.pipesCount&&s.pipes===t||s.pipesCount>1&&-1!==Y(s.pipes,t))&&!f&&(d("false write response, pause",s.awaitDrain),s.awaitDrain++),n.pause())}function m(r){d("onerror",r),b(),t.removeListener("error",m),0===a(t,"error")&&S(t,r)}function g(){t.removeListener("finish",_),b()}function _(){d("onfinish"),t.removeListener("close",g),b()}function b(){d("unpipe"),n.unpipe(t)}return n.on("data",p),I(t,"error",m),t.once("close",g),t.once("finish",_),t.emit("pipe",n),s.flowing||(d("pipe resume"),n.resume()),t},M.prototype.unpipe=function(t){var r=this._readableState,i={hasUnpiped:!1};if(0===r.pipesCount)return this;if(1===r.pipesCount)return t&&t!==r.pipes||(t||(t=r.pipes),r.pipes=null,r.pipesCount=0,r.flowing=!1,t&&t.emit("unpipe",this,i)),this;if(!t){var n=r.pipes,a=r.pipesCount;r.pipes=null,r.pipesCount=0,r.flowing=!1;for(var s=0;s<a;s++)n[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=Y(r.pipes,t);return -1===o||(r.pipes.splice(o,1),r.pipesCount-=1,1===r.pipesCount&&(r.pipes=r.pipes[0]),t.emit("unpipe",this,i)),this},M.prototype.on=function(t,r){var n=s.prototype.on.call(this,t,r),a=this._readableState;return"data"===t?(a.readableListening=this.listenerCount("readable")>0,!1!==a.flowing&&this.resume()):"readable"===t&&(a.endEmitted||a.readableListening||(a.readableListening=a.needReadable=!0,a.flowing=!1,a.emittedReadable=!1,d("on readable",a.length,a.reading),a.length?D(this):a.reading||i.nextTick(G,this))),n},M.prototype.addListener=M.prototype.on,M.prototype.removeListener=function(t,r){var n=s.prototype.removeListener.call(this,t,r);return"readable"===t&&i.nextTick(F,this),n},M.prototype.removeAllListeners=function(t){var r=s.prototype.removeAllListeners.apply(this,arguments);return"readable"!==t&&void 0!==t||i.nextTick(F,this),r},M.prototype.resume=function(){var t=this._readableState;return t.flowing||(d("resume"),t.flowing=!t.readableListening,W(this,t)),t.paused=!1,this},M.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},M.prototype.wrap=function(t){var r=this,i=this._readableState,n=!1;for(var a in t.on("end",function(){if(d("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&r.push(t)}r.push(null)}),t.on("data",function(a){d("wrapped data"),i.decoder&&(a=i.decoder.write(a)),i.objectMode&&null==a||(i.objectMode||a&&a.length)&&(r.push(a)||(n=!0,t.pause()))}),t)void 0===this[a]&&"function"==typeof t[a]&&(this[a]=function(r){return function(){return t[r].apply(t,arguments)}}(a));for(var s=0;s<$.length;s++)t.on($[s],this.emit.bind(this,$[s]));return this._read=function(r){d("wrapped _read",r),n&&(n=!1,t.resume())},this},"function"==typeof Symbol&&(M.prototype[Symbol.asyncIterator]=function(){return void 0===m&&(m=t("./internal/streams/async_iterator")),m(this)}),Object.defineProperty(M.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(M.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(M.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}}),M._fromList=V,Object.defineProperty(M.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(M.from=function(r,i){return void 0===g&&(g=t("./internal/streams/from")),g(M,r,i)})}).call(this)}).call(this,t("_process"),void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":66,"./_stream_duplex":67,"./internal/streams/async_iterator":72,"./internal/streams/buffer_list":73,"./internal/streams/destroy":74,"./internal/streams/from":76,"./internal/streams/state":78,"./internal/streams/stream":79,_process:63,buffer:32,events:35,inherits:46,"string_decoder/":80,util:29}],70:[function(t,r,i){r.exports=f;var n=t("../errors").codes,a=n.ERR_METHOD_NOT_IMPLEMENTED,s=n.ERR_MULTIPLE_CALLBACK,o=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,l=n.ERR_TRANSFORM_WITH_LENGTH_0,u=t("./_stream_duplex");function h(t,r){var i=this._transformState;i.transforming=!1;var n=i.writecb;if(null===n)return this.emit("error",new s);i.writechunk=null,i.writecb=null,null!=r&&this.push(r),n(t);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function f(t){if(!(this instanceof f))return new f(t);u.call(this,t),this._transformState={afterTransform:h.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",d)}function d(){var t=this;"function"!=typeof this._flush||this._readableState.destroyed?c(this,null,null):this._flush(function(r,i){c(t,r,i)})}function c(t,r,i){if(r)return t.emit("error",r);if(null!=i&&t.push(i),t._writableState.length)throw new l;if(t._transformState.transforming)throw new o;return t.push(null)}t("inherits")(f,u),f.prototype.push=function(t,r){return this._transformState.needTransform=!1,u.prototype.push.call(this,t,r)},f.prototype._transform=function(t,r,i){i(new a("_transform()"))},f.prototype._write=function(t,r,i){var n=this._transformState;if(n.writecb=i,n.writechunk=t,n.writeencoding=r,!n.transforming){var a=this._readableState;(n.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},f.prototype._read=function(t){var r=this._transformState;null===r.writechunk||r.transforming?r.needTransform=!0:(r.transforming=!0,this._transform(r.writechunk,r.writeencoding,r.afterTransform))},f.prototype._destroy=function(t,r){u.prototype._destroy.call(this,t,function(t){r(t)})}},{"../errors":66,"./_stream_duplex":67,inherits:46}],71:[function(t,r,i){(function(i,n){(function(){function a(t){var r=this;this.next=null,this.entry=null,this.finish=function(){q(r,t)}}r.exports=A,A.WritableState=I;var s={deprecate:t("util-deprecate")},o=t("./internal/streams/stream"),l=t("buffer").Buffer,u=n.Uint8Array||function(){};function h(t){return l.from(t)}function f(t){return l.isBuffer(t)||t instanceof u}var d,c,p=t("./internal/streams/destroy"),m=t("./internal/streams/state").getHighWaterMark,g=t("../errors").codes,_=g.ERR_INVALID_ARG_TYPE,b=g.ERR_METHOD_NOT_IMPLEMENTED,y=g.ERR_MULTIPLE_CALLBACK,v=g.ERR_STREAM_CANNOT_PIPE,w=g.ERR_STREAM_DESTROYED,x=g.ERR_STREAM_NULL_VALUES,k=g.ERR_STREAM_WRITE_AFTER_END,E=g.ERR_UNKNOWN_ENCODING,S=p.errorOrDestroy;function $(){}function I(r,i,n){d=d||t("./_stream_duplex"),r=r||{},"boolean"!=typeof n&&(n=i instanceof d),this.objectMode=!!r.objectMode,n&&(this.objectMode=this.objectMode||!!r.writableObjectMode),this.highWaterMark=m(this,r,"writableHighWaterMark",n),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var s=!1===r.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=r.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){P(i,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==r.emitClose,this.autoDestroy=!!r.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function A(r){var i=this instanceof(d=d||t("./_stream_duplex"));if(!i&&!c.call(A,this))return new A(r);this._writableState=new I(r,this,i),this.writable=!0,r&&("function"==typeof r.write&&(this._write=r.write),"function"==typeof r.writev&&(this._writev=r.writev),"function"==typeof r.destroy&&(this._destroy=r.destroy),"function"==typeof r.final&&(this._final=r.final)),o.call(this)}function M(t,r){var n=new k;S(t,n),i.nextTick(r,n)}function T(t,r,n,a){var s;return null===n?s=new x:"string"==typeof n||r.objectMode||(s=new _("chunk",["string","Buffer"],n)),!s||(S(t,s),i.nextTick(a,s),!1)}function C(t,r,i){return t.objectMode||!1===t.decodeStrings||"string"!=typeof r||(r=l.from(r,i)),r}function z(t,r,i,n,a,s){if(!i){var o=C(r,n,a);n!==o&&(i=!0,a="buffer",n=o)}var l=r.objectMode?1:n.length;r.length+=l;var u=r.length<r.highWaterMark;if(u||(r.needDrain=!0),r.writing||r.corked){var h=r.lastBufferedRequest;r.lastBufferedRequest={chunk:n,encoding:a,isBuf:i,callback:s,next:null},h?h.next=r.lastBufferedRequest:r.bufferedRequest=r.lastBufferedRequest,r.bufferedRequestCount+=1}else R(t,r,!1,l,n,a,s);return u}function R(t,r,i,n,a,s,o){r.writelen=n,r.writecb=o,r.writing=!0,r.sync=!0,r.destroyed?r.onwrite(new w("write")):i?t._writev(a,r.onwrite):t._write(a,s,r.onwrite),r.sync=!1}function B(t,r,n,a,s){--r.pendingcb,n?(i.nextTick(s,a),i.nextTick(G,t,r),t._writableState.errorEmitted=!0,S(t,a)):(s(a),t._writableState.errorEmitted=!0,S(t,a),G(t,r))}function O(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function P(t,r){var n=t._writableState,a=n.sync,s=n.writecb;if("function"!=typeof s)throw new y;if(O(n),r)B(t,n,a,r,s);else{var o=U(n)||t.destroyed;o||n.corked||n.bufferProcessing||!n.bufferedRequest||L(t,n),a?i.nextTick(D,t,n,o,s):D(t,n,o,s)}}function D(t,r,i,n){i||N(t,r),r.pendingcb--,n(),G(t,r)}function N(t,r){0===r.length&&r.needDrain&&(r.needDrain=!1,t.emit("drain"))}function L(t,r){r.bufferProcessing=!0;var i=r.bufferedRequest;if(t._writev&&i&&i.next){var n=Array(r.bufferedRequestCount),s=r.corkedRequestsFree;s.entry=i;for(var o=0,l=!0;i;)n[o]=i,i.isBuf||(l=!1),i=i.next,o+=1;n.allBuffers=l,R(t,r,!0,r.length,n,"",s.finish),r.pendingcb++,r.lastBufferedRequest=null,s.next?(r.corkedRequestsFree=s.next,s.next=null):r.corkedRequestsFree=new a(r),r.bufferedRequestCount=0}else{for(;i;){var u=i.chunk,h=i.encoding,f=i.callback;if(R(t,r,!1,r.objectMode?1:u.length,u,h,f),i=i.next,r.bufferedRequestCount--,r.writing)break}null===i&&(r.lastBufferedRequest=null)}r.bufferedRequest=i,r.bufferProcessing=!1}function U(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function j(t,r){t._final(function(i){r.pendingcb--,i&&S(t,i),r.prefinished=!0,t.emit("prefinish"),G(t,r)})}function F(t,r){r.prefinished||r.finalCalled||("function"!=typeof t._final||r.destroyed?(r.prefinished=!0,t.emit("prefinish")):(r.pendingcb++,r.finalCalled=!0,i.nextTick(j,t,r)))}function G(t,r){var i=U(r);if(i&&(F(t,r),0===r.pendingcb&&(r.finished=!0,t.emit("finish"),r.autoDestroy))){var n=t._readableState;(!n||n.autoDestroy&&n.endEmitted)&&t.destroy()}return i}function W(t,r,n){r.ending=!0,G(t,r),n&&(r.finished?i.nextTick(n):t.once("finish",n)),r.ended=!0,t.writable=!1}function q(t,r,i){var n=t.entry;for(t.entry=null;n;){var a=n.callback;r.pendingcb--,a(i),n=n.next}r.corkedRequestsFree.next=t}t("inherits")(A,o),I.prototype.getBuffer=function(){for(var t=this.bufferedRequest,r=[];t;)r.push(t),t=t.next;return r},function(){try{Object.defineProperty(I.prototype,"buffer",{get:s.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(A,Symbol.hasInstance,{value:function(t){return!!c.call(this,t)||this===A&&t&&t._writableState instanceof I}})):c=function(t){return t instanceof this},A.prototype.pipe=function(){S(this,new v)},A.prototype.write=function(t,r,i){var n=this._writableState,a=!1,s=!n.objectMode&&f(t);return s&&!l.isBuffer(t)&&(t=h(t)),"function"==typeof r&&(i=r,r=null),s?r="buffer":r||(r=n.defaultEncoding),"function"!=typeof i&&(i=$),n.ending?M(this,i):(s||T(this,n,t,i))&&(n.pendingcb++,a=z(this,n,s,t,r,i)),a},A.prototype.cork=function(){this._writableState.corked++},A.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.bufferProcessing||!t.bufferedRequest||L(this,t))},A.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new E(t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(A.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(A.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),A.prototype._write=function(t,r,i){i(new b("_write()"))},A.prototype._writev=null,A.prototype.end=function(t,r,i){var n=this._writableState;return"function"==typeof t?(i=t,t=null,r=null):"function"==typeof r&&(i=r,r=null),null!=t&&this.write(t,r),n.corked&&(n.corked=1,this.uncork()),n.ending||W(this,n,i),this},Object.defineProperty(A.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(A.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),A.prototype.destroy=p.destroy,A.prototype._undestroy=p.undestroy,A.prototype._destroy=function(t,r){r(t)}}).call(this)}).call(this,t("_process"),void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":66,"./_stream_duplex":67,"./internal/streams/destroy":74,"./internal/streams/state":78,"./internal/streams/stream":79,_process:63,buffer:32,inherits:46,"util-deprecate":81}],72:[function(t,r,i){(function(i){(function(){function n(t,r,i){return r in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}var a,s=t("./end-of-stream"),o=Symbol("lastResolve"),l=Symbol("lastReject"),u=Symbol("error"),h=Symbol("ended"),f=Symbol("lastPromise"),d=Symbol("handlePromise"),c=Symbol("stream");function p(t,r){return{value:t,done:r}}function m(t){var r=t[o];if(null!==r){var i=t[c].read();null!==i&&(t[f]=null,t[o]=null,t[l]=null,r(p(i,!1)))}}function g(t){i.nextTick(m,t)}function _(t,r){return function(i,n){t.then(function(){r[h]?i(p(void 0,!0)):r[d](i,n)},n)}}var b=Object.getPrototypeOf(function(){}),y=Object.setPrototypeOf((n(a={get stream(){return this[c]},next:function(){var t=this,r=this[u];if(null!==r)return Promise.reject(r);if(this[h])return Promise.resolve(p(void 0,!0));if(this[c].destroyed)return new Promise(function(r,n){i.nextTick(function(){t[u]?n(t[u]):r(p(void 0,!0))})});var n,a=this[f];if(a)n=new Promise(_(a,this));else{var s=this[c].read();if(null!==s)return Promise.resolve(p(s,!1));n=new Promise(this[d])}return this[f]=n,n}},Symbol.asyncIterator,function(){return this}),n(a,"return",function(){var t=this;return new Promise(function(r,i){t[c].destroy(null,function(t){t?i(t):r(p(void 0,!0))})})}),a),b);r.exports=function(t){var r,i=Object.create(y,(n(r={},c,{value:t,writable:!0}),n(r,o,{value:null,writable:!0}),n(r,l,{value:null,writable:!0}),n(r,u,{value:null,writable:!0}),n(r,h,{value:t._readableState.endEmitted,writable:!0}),n(r,d,{value:function(t,r){var n=i[c].read();n?(i[f]=null,i[o]=null,i[l]=null,t(p(n,!1))):(i[o]=t,i[l]=r)},writable:!0}),r));return i[f]=null,s(t,function(t){if(t&&"ERR_STREAM_PREMATURE_CLOSE"!==t.code){var r=i[l];return null!==r&&(i[f]=null,i[o]=null,i[l]=null,r(t)),void(i[u]=t)}var n=i[o];null!==n&&(i[f]=null,i[o]=null,i[l]=null,n(p(void 0,!0))),i[h]=!0}),t.on("readable",g.bind(null,i)),i}}).call(this)}).call(this,t("_process"))},{"./end-of-stream":75,_process:63}],73:[function(t,r,i){function n(t,r){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,n)}return i}function a(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?n(Object(i),!0).forEach(function(r){s(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}function s(t,r,i){return r in t?Object.defineProperty(t,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[r]=i,t}function o(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}function l(t,r){for(var i=0;i<r.length;i++){var n=r[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,r,i){return r&&l(t.prototype,r),t}var h=t("buffer").Buffer,f=t("util").inspect,d=f&&f.custom||"inspect";function c(t,r,i){h.prototype.copy.call(t,r,i)}r.exports=function(){function t(){o(this,t),this.head=null,this.tail=null,this.length=0}return u(t,[{key:"push",value:function(t){var r={data:t,next:null};this.length>0?this.tail.next=r:this.head=r,this.tail=r,++this.length}},{key:"unshift",value:function(t){var r={data:t,next:this.head};0===this.length&&(this.tail=r),this.head=r,++this.length}},{key:"shift",value:function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(t){if(0===this.length)return"";for(var r=this.head,i=""+r.data;r=r.next;)i+=t+r.data;return i}},{key:"concat",value:function(t){if(0===this.length)return h.alloc(0);for(var r=h.allocUnsafe(t>>>0),i=this.head,n=0;i;)c(i.data,r,n),n+=i.data.length,i=i.next;return r}},{key:"consume",value:function(t,r){var i;return t<this.head.data.length?(i=this.head.data.slice(0,t),this.head.data=this.head.data.slice(t)):i=t===this.head.data.length?this.shift():r?this._getString(t):this._getBuffer(t),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(t){var r=this.head,i=1,n=r.data;for(t-=n.length;r=r.next;){var a=r.data,s=t>a.length?a.length:t;if(s===a.length?n+=a:n+=a.slice(0,t),0==(t-=s)){s===a.length?(++i,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=a.slice(s));break}++i}return this.length-=i,n}},{key:"_getBuffer",value:function(t){var r=h.allocUnsafe(t),i=this.head,n=1;for(i.data.copy(r),t-=i.data.length;i=i.next;){var a=i.data,s=t>a.length?a.length:t;if(a.copy(r,r.length-t,0,s),0==(t-=s)){s===a.length?(++n,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=a.slice(s));break}++n}return this.length-=n,r}},{key:d,value:function(t,r){return f(this,a({},r,{depth:0,customInspect:!1}))}}]),t}()},{buffer:32,util:29}],74:[function(t,r,i){(function(t){(function(){function i(t,r){a(t,r),n(t)}function n(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function a(t,r){t.emit("error",r)}r.exports={destroy:function(r,s){var o=this,l=this._readableState&&this._readableState.destroyed,u=this._writableState&&this._writableState.destroyed;return l||u?s?s(r):r&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,t.nextTick(a,this,r)):t.nextTick(a,this,r)):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(r||null,function(r){!s&&r?o._writableState?o._writableState.errorEmitted?t.nextTick(n,o):(o._writableState.errorEmitted=!0,t.nextTick(i,o,r)):t.nextTick(i,o,r):s?(t.nextTick(n,o),s(r)):t.nextTick(n,o)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(t,r){var i=t._readableState,n=t._writableState;i&&i.autoDestroy||n&&n.autoDestroy?t.destroy(r):t.emit("error",r)}}}).call(this)}).call(this,t("_process"))},{_process:63}],75:[function(t,r,i){var n=t("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function a(t){var r=!1;return function(){if(!r){r=!0;for(var i=arguments.length,n=Array(i),a=0;a<i;a++)n[a]=arguments[a];t.apply(this,n)}}}function s(){}function o(t){return t.setHeader&&"function"==typeof t.abort}function l(t,r,i){if("function"==typeof r)return l(t,null,r);r||(r={}),i=a(i||s);var u=r.readable||!1!==r.readable&&t.readable,h=r.writable||!1!==r.writable&&t.writable,f=function(){t.writable||c()},d=t._writableState&&t._writableState.finished,c=function(){h=!1,d=!0,u||i.call(t)},p=t._readableState&&t._readableState.endEmitted,m=function(){u=!1,p=!0,h||i.call(t)},g=function(r){i.call(t,r)},_=function(){var r;return u&&!p?(t._readableState&&t._readableState.ended||(r=new n),i.call(t,r)):h&&!d?(t._writableState&&t._writableState.ended||(r=new n),i.call(t,r)):void 0},b=function(){t.req.on("finish",c)};return o(t)?(t.on("complete",c),t.on("abort",_),t.req?b():t.on("request",b)):h&&!t._writableState&&(t.on("end",f),t.on("close",f)),t.on("end",m),t.on("finish",c),!1!==r.error&&t.on("error",g),t.on("close",_),function(){t.removeListener("complete",c),t.removeListener("abort",_),t.removeListener("request",b),t.req&&t.req.removeListener("finish",c),t.removeListener("end",f),t.removeListener("close",f),t.removeListener("finish",c),t.removeListener("end",m),t.removeListener("error",g),t.removeListener("close",_)}}r.exports=l},{"../../../errors":66}],76:[function(t,r,i){r.exports=function(){throw Error("Readable.from is not available in the browser")}},{}],77:[function(t,r,i){function n(t){var r=!1;return function(){r||(r=!0,t.apply(void 0,arguments))}}var a,s=t("../../../errors").codes,o=s.ERR_MISSING_ARGS,l=s.ERR_STREAM_DESTROYED;function u(t){if(t)throw t}function h(t){return t.setHeader&&"function"==typeof t.abort}function f(r,i,s,o){o=n(o);var u=!1;r.on("close",function(){u=!0}),void 0===a&&(a=t("./end-of-stream")),a(r,{readable:i,writable:s},function(t){if(t)return o(t);u=!0,o()});var f=!1;return function(t){if(!u&&!f)return f=!0,h(r)?r.abort():"function"==typeof r.destroy?r.destroy():void o(t||new l("pipe"))}}function d(t){t()}function c(t,r){return t.pipe(r)}function p(t){return t.length?"function"!=typeof t[t.length-1]?u:t.pop():u}r.exports=function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];var n,a=p(r);if(Array.isArray(r[0])&&(r=r[0]),r.length<2)throw new o("streams");var s=r.map(function(t,i){var o=i<r.length-1;return f(t,o,i>0,function(t){n||(n=t),t&&s.forEach(d),o||(s.forEach(d),a(n))})});return r.reduce(c)}},{"../../../errors":66,"./end-of-stream":75}],78:[function(t,r,i){var n=t("../../../errors").codes.ERR_INVALID_OPT_VALUE;function a(t,r,i){return null!=t.highWaterMark?t.highWaterMark:r?t[i]:null}r.exports={getHighWaterMark:function(t,r,i,s){var o=a(r,s,i);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new n(s?i:"highWaterMark",o);return Math.floor(o)}return t.objectMode?16:16384}}},{"../../../errors":66}],79:[function(t,r,i){r.exports=t("events").EventEmitter},{events:35}],80:[function(t,r,i){var n=t("safe-buffer").Buffer,a=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){if(!t)return"utf8";for(var r;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(r)return;t=(""+t).toLowerCase(),r=!0}}function o(t){var r=s(t);if("string"!=typeof r&&(n.isEncoding===a||!a(t)))throw Error("Unknown encoding: "+t);return r||t}function l(t){var r;switch(this.encoding=o(t),this.encoding){case"utf16le":this.text=m,this.end=g,r=4;break;case"utf8":this.fillLast=d,r=4;break;case"base64":this.text=_,this.end=b,r=3;break;default:return this.write=y,void(this.end=v)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(r)}function u(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function h(t,r,i){var n=r.length-1;if(n<i)return 0;var a=u(r[n]);return a>=0?(a>0&&(t.lastNeed=a-1),a):--n<i||-2===a?0:(a=u(r[n]))>=0?(a>0&&(t.lastNeed=a-2),a):--n<i||-2===a?0:(a=u(r[n]))>=0?(a>0&&(2===a?a=0:t.lastNeed=a-3),a):0}function f(t,r,i){if(128!=(192&r[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&r.length>1){if(128!=(192&r[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&r.length>2&&128!=(192&r[2]))return t.lastNeed=2,"�"}}function d(t){var r=this.lastTotal-this.lastNeed,i=f(this,t);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,r,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,r,0,t.length),void(this.lastNeed-=t.length))}function c(t,r){var i=h(this,t,r);if(!this.lastNeed)return t.toString("utf8",r);this.lastTotal=i;var n=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",r,n)}function p(t){var r=t&&t.length?this.write(t):"";return this.lastNeed?r+"�":r}function m(t,r){if((t.length-r)%2==0){var i=t.toString("utf16le",r);if(i){var n=i.charCodeAt(i.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",r,t.length-1)}function g(t){var r=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,i)}return r}function _(t,r){var i=(t.length-r)%3;return 0===i?t.toString("base64",r):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",r,t.length-i))}function b(t){var r=t&&t.length?this.write(t):"";return this.lastNeed?r+this.lastChar.toString("base64",0,3-this.lastNeed):r}function y(t){return t.toString(this.encoding)}function v(t){return t&&t.length?this.write(t):""}i.StringDecoder=l,l.prototype.write=function(t){var r,i;if(0===t.length)return"";if(this.lastNeed){if(void 0===(r=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?r?r+this.text(t,i):this.text(t,i):r||""},l.prototype.end=p,l.prototype.text=c,l.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},{"safe-buffer":64}],81:[function(t,r,i){(function(t){(function(){function i(r){try{if(!t.localStorage)return!1}catch(t){return!1}var i=t.localStorage[r];return null!=i&&"true"===String(i).toLowerCase()}r.exports=function(t,r){if(i("noDeprecation"))return t;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw Error(r);i("traceDeprecation")?console.trace(r):console.warn(r),n=!0}return t.apply(this,arguments)}}}).call(this)}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],82:[function(t,r,i){arguments[4][25][0].apply(i,arguments)},{dup:25}],83:[function(t,r,i){var n=t("is-arguments"),a=t("is-generator-function"),s=t("which-typed-array"),o=t("is-typed-array");function l(t){return t.call.bind(t)}var u="undefined"!=typeof BigInt,h="undefined"!=typeof Symbol,f=l(Object.prototype.toString),d=l(Number.prototype.valueOf),c=l(String.prototype.valueOf),p=l(Boolean.prototype.valueOf);if(u)var m=l(BigInt.prototype.valueOf);if(h)var g=l(Symbol.prototype.valueOf);function _(t,r){if("object"!=typeof t)return!1;try{return r(t),!0}catch(t){return!1}}function b(t){return"undefined"!=typeof Promise&&t instanceof Promise||null!==t&&"object"==typeof t&&"function"==typeof t.then&&"function"==typeof t.catch}function y(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):o(t)||F(t)}function v(t){return"Uint8Array"===s(t)}function w(t){return"Uint8ClampedArray"===s(t)}function x(t){return"Uint16Array"===s(t)}function k(t){return"Uint32Array"===s(t)}function E(t){return"Int8Array"===s(t)}function S(t){return"Int16Array"===s(t)}function $(t){return"Int32Array"===s(t)}function I(t){return"Float32Array"===s(t)}function A(t){return"Float64Array"===s(t)}function M(t){return"BigInt64Array"===s(t)}function T(t){return"BigUint64Array"===s(t)}function C(t){return"[object Map]"===f(t)}function z(t){return"undefined"!=typeof Map&&(C.working?C(t):t instanceof Map)}function R(t){return"[object Set]"===f(t)}function B(t){return"undefined"!=typeof Set&&(R.working?R(t):t instanceof Set)}function O(t){return"[object WeakMap]"===f(t)}function P(t){return"undefined"!=typeof WeakMap&&(O.working?O(t):t instanceof WeakMap)}function D(t){return"[object WeakSet]"===f(t)}function N(t){return D(t)}function L(t){return"[object ArrayBuffer]"===f(t)}function U(t){return"undefined"!=typeof ArrayBuffer&&(L.working?L(t):t instanceof ArrayBuffer)}function j(t){return"[object DataView]"===f(t)}function F(t){return"undefined"!=typeof DataView&&(j.working?j(t):t instanceof DataView)}i.isArgumentsObject=n,i.isGeneratorFunction=a,i.isTypedArray=o,i.isPromise=b,i.isArrayBufferView=y,i.isUint8Array=v,i.isUint8ClampedArray=w,i.isUint16Array=x,i.isUint32Array=k,i.isInt8Array=E,i.isInt16Array=S,i.isInt32Array=$,i.isFloat32Array=I,i.isFloat64Array=A,i.isBigInt64Array=M,i.isBigUint64Array=T,C.working="undefined"!=typeof Map&&C(new Map),i.isMap=z,R.working="undefined"!=typeof Set&&R(new Set),i.isSet=B,O.working="undefined"!=typeof WeakMap&&O(new WeakMap),i.isWeakMap=P,D.working="undefined"!=typeof WeakSet&&D(new WeakSet),i.isWeakSet=N,L.working="undefined"!=typeof ArrayBuffer&&L(new ArrayBuffer),i.isArrayBuffer=U,j.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&j(new DataView(new ArrayBuffer(1),0,1)),i.isDataView=F;var G="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function W(t){return"[object SharedArrayBuffer]"===f(t)}function q(t){return void 0!==G&&(void 0===W.working&&(W.working=W(new G)),W.working?W(t):t instanceof G)}function H(t){return"[object AsyncFunction]"===f(t)}function V(t){return"[object Map Iterator]"===f(t)}function Z(t){return"[object Set Iterator]"===f(t)}function K(t){return"[object Generator]"===f(t)}function Y(t){return"[object WebAssembly.Module]"===f(t)}function X(t){return _(t,d)}function Q(t){return _(t,c)}function J(t){return _(t,p)}function ee(t){return u&&_(t,m)}function et(t){return h&&_(t,g)}function er(t){return X(t)||Q(t)||J(t)||ee(t)||et(t)}function ei(t){return"undefined"!=typeof Uint8Array&&(U(t)||q(t))}i.isSharedArrayBuffer=q,i.isAsyncFunction=H,i.isMapIterator=V,i.isSetIterator=Z,i.isGeneratorObject=K,i.isWebAssemblyCompiledModule=Y,i.isNumberObject=X,i.isStringObject=Q,i.isBooleanObject=J,i.isBigIntObject=ee,i.isSymbolObject=et,i.isBoxedPrimitive=er,i.isAnyArrayBuffer=ei,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(t){Object.defineProperty(i,t,{enumerable:!1,value:function(){throw Error(t+" is not supported in userland")}})})},{"is-arguments":47,"is-generator-function":49,"is-typed-array":50,"which-typed-array":85}],84:[function(t,r,i){(function(r){(function(){var n=Object.getOwnPropertyDescriptors||function(t){for(var r=Object.keys(t),i={},n=0;n<r.length;n++)i[r[n]]=Object.getOwnPropertyDescriptor(t,r[n]);return i},a=/%[sdj%]/g;i.format=function(t){if(!E(t)){for(var r=[],i=0;i<arguments.length;i++)r.push(u(arguments[i]));return r.join(" ")}i=1;for(var n=arguments,s=n.length,o=String(t).replace(a,function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}}),l=n[i];i<s;l=n[++i])w(l)||!A(l)?o+=" "+l:o+=" "+u(l);return o},i.deprecate=function(t,n){if(void 0!==r&&!0===r.noDeprecation)return t;if(void 0===r)return function(){return i.deprecate(t,n).apply(this,arguments)};var a=!1;return function(){if(!a){if(r.throwDeprecation)throw Error(n);r.traceDeprecation?console.trace(n):console.error(n),a=!0}return t.apply(this,arguments)}};var s={},o=/^$/;if(r.env.NODE_DEBUG){var l=r.env.NODE_DEBUG;o=RegExp("^"+(l=l.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase())+"$","i")}function u(t,r){var n={seen:[],stylize:f};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),v(r)?n.showHidden=r:r&&i._extend(n,r),$(n.showHidden)&&(n.showHidden=!1),$(n.depth)&&(n.depth=2),$(n.colors)&&(n.colors=!1),$(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=h),c(n,t,n.depth)}function h(t,r){var i=u.styles[r];return i?"\x1b["+u.colors[i][0]+"m"+t+"\x1b["+u.colors[i][1]+"m":t}function f(t,r){return t}function d(t){var r={};return t.forEach(function(t,i){r[t]=!0}),r}function c(t,r,n){if(t.customInspect&&r&&C(r.inspect)&&r.inspect!==i.inspect&&(!r.constructor||r.constructor.prototype!==r)){var a=r.inspect(n,t);return E(a)||(a=c(t,a,n)),a}var s=p(t,r);if(s)return s;var o=Object.keys(r),l=d(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(r)),T(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return m(r);if(0===o.length){if(C(r)){var u=r.name?": "+r.name:"";return t.stylize("[Function"+u+"]","special")}if(I(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(M(r))return t.stylize(Date.prototype.toString.call(r),"date");if(T(r))return m(r)}var h,f="",v=!1,w=["{","}"];return y(r)&&(v=!0,w=["[","]"]),C(r)&&(f=" [Function"+(r.name?": "+r.name:"")+"]"),I(r)&&(f=" "+RegExp.prototype.toString.call(r)),M(r)&&(f=" "+Date.prototype.toUTCString.call(r)),T(r)&&(f=" "+m(r)),0!==o.length||v&&0!=r.length?n<0?I(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),h=v?g(t,r,n,l,o):o.map(function(i){return _(t,r,n,l,i,v)}),t.seen.pop(),b(h,f,w)):w[0]+f+w[1]}function p(t,r){if($(r))return t.stylize("undefined","undefined");if(E(r)){var i="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return k(r)?t.stylize(""+r,"number"):v(r)?t.stylize(""+r,"boolean"):w(r)?t.stylize("null","null"):void 0}function m(t){return"["+Error.prototype.toString.call(t)+"]"}function g(t,r,i,n,a){for(var s=[],o=0,l=r.length;o<l;++o)D(r,String(o))?s.push(_(t,r,i,n,String(o),!0)):s.push("");return a.forEach(function(a){a.match(/^\d+$/)||s.push(_(t,r,i,n,a,!0))}),s}function _(t,r,i,n,a,s){var o,l,u;if((u=Object.getOwnPropertyDescriptor(r,a)||{value:r[a]}).get?l=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(l=t.stylize("[Setter]","special")),D(n,a)||(o="["+a+"]"),l||(0>t.seen.indexOf(u.value)?(l=w(i)?c(t,u.value,null):c(t,u.value,i-1)).indexOf("\n")>-1&&(l=s?l.split("\n").map(function(t){return"  "+t}).join("\n").slice(2):"\n"+l.split("\n").map(function(t){return"   "+t}).join("\n")):l=t.stylize("[Circular]","special")),$(o)){if(s&&a.match(/^\d+$/))return l;(o=JSON.stringify(""+a)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.slice(1,-1),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+l}function b(t,r,i){return t.reduce(function(t,r){return r.indexOf("\n"),t+r.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?i[0]+(""===r?"":r+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+r+" "+t.join(", ")+" "+i[1]}function y(t){return Array.isArray(t)}function v(t){return"boolean"==typeof t}function w(t){return null===t}function x(t){return null==t}function k(t){return"number"==typeof t}function E(t){return"string"==typeof t}function S(t){return"symbol"==typeof t}function $(t){return void 0===t}function I(t){return A(t)&&"[object RegExp]"===R(t)}function A(t){return"object"==typeof t&&null!==t}function M(t){return A(t)&&"[object Date]"===R(t)}function T(t){return A(t)&&("[object Error]"===R(t)||t instanceof Error)}function C(t){return"function"==typeof t}function z(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function R(t){return Object.prototype.toString.call(t)}function B(t){return t<10?"0"+t.toString(10):t.toString(10)}i.debuglog=function(t){if(!s[t=t.toUpperCase()])if(o.test(t)){var n=r.pid;s[t]=function(){var r=i.format.apply(i,arguments);console.error("%s %d: %s",t,n,r)}}else s[t]=function(){};return s[t]},i.inspect=u,u.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},u.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.types=t("./support/types"),i.isArray=y,i.isBoolean=v,i.isNull=w,i.isNullOrUndefined=x,i.isNumber=k,i.isString=E,i.isSymbol=S,i.isUndefined=$,i.isRegExp=I,i.types.isRegExp=I,i.isObject=A,i.isDate=M,i.types.isDate=M,i.isError=T,i.types.isNativeError=T,i.isFunction=C,i.isPrimitive=z,i.isBuffer=t("./support/isBuffer");var O=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(){var t=new Date,r=[B(t.getHours()),B(t.getMinutes()),B(t.getSeconds())].join(":");return[t.getDate(),O[t.getMonth()],r].join(" ")}function D(t,r){return Object.prototype.hasOwnProperty.call(t,r)}i.log=function(){console.log("%s - %s",P(),i.format.apply(i,arguments))},i.inherits=t("inherits"),i._extend=function(t,r){if(!r||!A(r))return t;for(var i=Object.keys(r),n=i.length;n--;)t[i[n]]=r[i[n]];return t};var N="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function L(t,r){if(!t){var i=Error("Promise was rejected with a falsy value");i.reason=t,t=i}return r(t)}function U(t){if("function"!=typeof t)throw TypeError('The "original" argument must be of type Function');function i(){for(var i=[],n=0;n<arguments.length;n++)i.push(arguments[n]);var a=i.pop();if("function"!=typeof a)throw TypeError("The last argument must be of type Function");var s=this,o=function(){return a.apply(s,arguments)};t.apply(this,i).then(function(t){r.nextTick(o.bind(null,null,t))},function(t){r.nextTick(L.bind(null,t,o))})}return Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.defineProperties(i,n(t)),i}i.promisify=function(t){if("function"!=typeof t)throw TypeError('The "original" argument must be of type Function');if(N&&t[N]){var r;if("function"!=typeof(r=t[N]))throw TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(r,N,{value:r,enumerable:!1,writable:!1,configurable:!0}),r}function r(){for(var r,i,n=new Promise(function(t,n){r=t,i=n}),a=[],s=0;s<arguments.length;s++)a.push(arguments[s]);a.push(function(t,n){t?i(t):r(n)});try{t.apply(this,a)}catch(t){i(t)}return n}return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),N&&Object.defineProperty(r,N,{value:r,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(r,n(t))},i.promisify.custom=N,i.callbackify=U}).call(this)}).call(this,t("_process"))},{"./support/isBuffer":82,"./support/types":83,_process:63,inherits:46}],85:[function(t,r,i){(function(i){(function(){var n=t("for-each"),a=t("available-typed-arrays"),s=t("call-bind/callBound"),o=t("gopd"),l=s("Object.prototype.toString"),u=t("has-tostringtag/shams")(),h="undefined"==typeof globalThis?i:globalThis,f=a(),d=s("String.prototype.slice"),c={},p=Object.getPrototypeOf;u&&o&&p&&n(f,function(t){if("function"==typeof h[t]){var r=new h[t];if(Symbol.toStringTag in r){var i=p(r),n=o(i,Symbol.toStringTag);n||(n=o(p(i),Symbol.toStringTag)),c[t]=n.get}}});var m=function(t){var r=!1;return n(c,function(i,n){if(!r)try{var a=i.call(t);a===n&&(r=a)}catch(t){}}),r},g=t("is-typed-array");r.exports=function(t){return!!g(t)&&(u&&Symbol.toStringTag in t?m(t):d(l(t),8,-1))}}).call(this)}).call(this,void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"available-typed-arrays":27,"call-bind/callBound":33,"for-each":36,gopd:40,"has-tostringtag/shams":43,"is-typed-array":50}]},{},[20])(20);var PNGFilterType,PNGFilterType2,PNGColorType,PNGColorType2,browserExports=browser$1.exports;function png(){return{mime:"image/png",hasAlpha:!0,encode:(t,{deflateLevel:r=9,deflateStrategy:i=3,filterType:n=PNGFilterType.AUTO,colorType:a,inputHasAlpha:s=!0,...o}={})=>{let l=new browserExports.PNG({width:t.width,height:t.height});return l.data=t.data,browserExports.PNG.sync.write(l,{...o,deflateLevel:r,deflateStrategy:i,filterType:n,colorType:void 0!==a?a:s?PNGColorType.COLOR_ALPHA:PNGColorType.COLOR,inputHasAlpha:s})},decode:(t,r)=>{let i=browserExports.PNG.sync.read(t,r);return{data:i.data,width:i.width,height:i.height}}}}PNGFilterType2=PNGFilterType||(PNGFilterType={}),PNGFilterType2[PNGFilterType2.AUTO=-1]="AUTO",PNGFilterType2[PNGFilterType2.NONE=0]="NONE",PNGFilterType2[PNGFilterType2.SUB=1]="SUB",PNGFilterType2[PNGFilterType2.UP=2]="UP",PNGFilterType2[PNGFilterType2.AVERAGE=3]="AVERAGE",PNGFilterType2[PNGFilterType2.PATH=4]="PATH",PNGColorType2=PNGColorType||(PNGColorType={}),PNGColorType2[PNGColorType2.GRAYSCALE=0]="GRAYSCALE",PNGColorType2[PNGColorType2.COLOR=2]="COLOR",PNGColorType2[PNGColorType2.GRAYSCALE_ALPHA=4]="GRAYSCALE_ALPHA",PNGColorType2[PNGColorType2.COLOR_ALPHA=6]="COLOR_ALPHA";var hasRequiredCommon,UTIF={exports:{}},common={};function requireCommon(){return hasRequiredCommon||(hasRequiredCommon=1,function(t){var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,r){return Object.prototype.hasOwnProperty.call(t,r)}t.assign=function(t){for(var r=Array.prototype.slice.call(arguments,1);r.length;){var n=r.shift();if(n){if("object"!=typeof n)throw TypeError(n+"must be non-object");for(var a in n)i(n,a)&&(t[a]=n[a])}}return t},t.shrinkBuf=function(t,r){return t.length===r?t:t.subarray?t.subarray(0,r):(t.length=r,t)};var n={arraySet:function(t,r,i,n,a){if(r.subarray&&t.subarray)t.set(r.subarray(i,i+n),a);else for(var s=0;s<n;s++)t[a+s]=r[i+s]},flattenChunks:function(t){var r,i,n,a,s,o;for(n=0,r=0,i=t.length;r<i;r++)n+=t[r].length;for(o=new Uint8Array(n),a=0,r=0,i=t.length;r<i;r++)s=t[r],o.set(s,a),a+=s.length;return o}},a={arraySet:function(t,r,i,n,a){for(var s=0;s<n;s++)t[a+s]=r[i+s]},flattenChunks:function(t){return[].concat.apply([],t)}};t.setTyped=function(r){r?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,n)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(r)}(common)),common}var hasRequiredTrees,adler32_1,hasRequiredAdler32,crc32_1,hasRequiredCrc32,messages,hasRequiredMessages,hasRequiredDeflate$1,deflate$1={},deflate={},trees={};function requireTrees(){if(hasRequiredTrees)return trees;hasRequiredTrees=1;var t=requireCommon(),r=0,i=1;function n(t){for(var r=t.length;--r>=0;)t[r]=0}var a=0,s=29,o=256,l=286,u=30,h=19,f=573,d=15,c=16,p=7,m=256,g=16,_=17,b=18,y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],v=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],w=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=Array(576);n(k);var E=Array(2*u);n(E);var S=Array(512);n(S);var $=Array(256);n($);var I=Array(s);n(I);var A,M,T,C=Array(u);function z(t,r,i,n,a){this.static_tree=t,this.extra_bits=r,this.extra_base=i,this.elems=n,this.max_length=a,this.has_stree=t&&t.length}function R(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}function B(t){return t<256?S[t]:S[256+(t>>>7)]}function O(t,r){t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255}function P(t,r,i){t.bi_valid>c-i?(t.bi_buf|=r<<t.bi_valid&65535,O(t,t.bi_buf),t.bi_buf=r>>c-t.bi_valid,t.bi_valid+=i-c):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=i)}function D(t,r,i){P(t,i[2*r],i[2*r+1])}function N(t,r){var i=0;do i|=1&t,t>>>=1,i<<=1;while(--r>0)return i>>>1}function L(t,r,i){var n,a,s=Array(d+1),o=0;for(n=1;n<=d;n++)s[n]=o=o+i[n-1]<<1;for(a=0;a<=r;a++){var l=t[2*a+1];0!==l&&(t[2*a]=N(s[l]++,l))}}function U(t){var r;for(r=0;r<l;r++)t.dyn_ltree[2*r]=0;for(r=0;r<u;r++)t.dyn_dtree[2*r]=0;for(r=0;r<h;r++)t.bl_tree[2*r]=0;t.dyn_ltree[2*m]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function j(t){t.bi_valid>8?O(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function F(t,r,i,n){var a=2*r,s=2*i;return t[a]<t[s]||t[a]===t[s]&&n[r]<=n[i]}function G(t,r,i){for(var n=t.heap[i],a=i<<1;a<=t.heap_len&&(a<t.heap_len&&F(r,t.heap[a+1],t.heap[a],t.depth)&&a++,!F(r,n,t.heap[a],t.depth));)t.heap[i]=t.heap[a],i=a,a<<=1;t.heap[i]=n}function W(t,r,i){var n,a,s,l,u=0;if(0!==t.last_lit)do n=t.pending_buf[t.d_buf+2*u]<<8|t.pending_buf[t.d_buf+2*u+1],a=t.pending_buf[t.l_buf+u],u++,0===n?D(t,a,r):(D(t,(s=$[a])+o+1,r),0!==(l=y[s])&&P(t,a-=I[s],l),D(t,s=B(--n),i),0!==(l=v[s])&&P(t,n-=C[s],l));while(u<t.last_lit)D(t,m,r)}function q(t,r){var i,n,a,s=r.dyn_tree,o=r.stat_desc.static_tree,l=r.stat_desc.has_stree,u=r.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=f,i=0;i<u;i++)0!==s[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):s[2*i+1]=0;for(;t.heap_len<2;)s[2*(a=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[a]=0,t.opt_len--,l&&(t.static_len-=o[2*a+1]);for(r.max_code=h,i=t.heap_len>>1;i>=1;i--)G(t,s,i);a=u;do i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],G(t,s,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,s[2*a]=s[2*i]+s[2*n],t.depth[a]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,s[2*i+1]=s[2*n+1]=a,t.heap[1]=a++,G(t,s,1);while(t.heap_len>=2)t.heap[--t.heap_max]=t.heap[1],function(t,r){var i,n,a,s,o,l,u=r.dyn_tree,h=r.max_code,c=r.stat_desc.static_tree,p=r.stat_desc.has_stree,m=r.stat_desc.extra_bits,g=r.stat_desc.extra_base,_=r.stat_desc.max_length,b=0;for(s=0;s<=d;s++)t.bl_count[s]=0;for(u[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<f;i++)(s=u[2*u[2*(n=t.heap[i])+1]+1]+1)>_&&(s=_,b++),u[2*n+1]=s,n>h||(t.bl_count[s]++,o=0,n>=g&&(o=m[n-g]),l=u[2*n],t.opt_len+=l*(s+o),p&&(t.static_len+=l*(c[2*n+1]+o)));if(0!==b){do{for(s=_-1;0===t.bl_count[s];)s--;t.bl_count[s]--,t.bl_count[s+1]+=2,t.bl_count[_]--,b-=2}while(b>0)for(s=_;0!==s;s--)for(n=t.bl_count[s];0!==n;)(a=t.heap[--i])>h||(u[2*a+1]!==s&&(t.opt_len+=(s-u[2*a+1])*u[2*a],u[2*a+1]=s),n--)}}(t,r),L(s,h,t.bl_count)}function H(t,r,i){var n,a,s=-1,o=r[1],l=0,u=7,h=4;for(0===o&&(u=138,h=3),r[2*(i+1)+1]=65535,n=0;n<=i;n++)a=o,o=r[2*(n+1)+1],++l<u&&a===o||(l<h?t.bl_tree[2*a]+=l:0!==a?(a!==s&&t.bl_tree[2*a]++,t.bl_tree[2*g]++):l<=10?t.bl_tree[2*_]++:t.bl_tree[2*b]++,l=0,s=a,0===o?(u=138,h=3):a===o?(u=6,h=3):(u=7,h=4))}function V(t,r,i){var n,a,s=-1,o=r[1],l=0,u=7,h=4;for(0===o&&(u=138,h=3),n=0;n<=i;n++)if(a=o,o=r[2*(n+1)+1],!(++l<u&&a===o)){if(l<h)do D(t,a,t.bl_tree);while(0!=--l)else 0!==a?(a!==s&&(D(t,a,t.bl_tree),l--),D(t,g,t.bl_tree),P(t,l-3,2)):l<=10?(D(t,_,t.bl_tree),P(t,l-3,3)):(D(t,b,t.bl_tree),P(t,l-11,7));l=0,s=a,0===o?(u=138,h=3):a===o?(u=6,h=3):(u=7,h=4)}}n(C);var Z=!1;function K(r,i,n,s){P(r,(a<<1)+ +!!s,3),function(r,i,n,a){j(r),O(r,n),O(r,~n),t.arraySet(r.pending_buf,r.window,i,n,r.pending),r.pending+=n}(r,i,n)}return trees._tr_init=function(t){Z||(!function(){var t,r,i,n,a,f=Array(d+1);for(i=0,n=0;n<s-1;n++)for(I[n]=i,t=0;t<1<<y[n];t++)$[i++]=n;for($[i-1]=n,a=0,n=0;n<16;n++)for(C[n]=a,t=0;t<1<<v[n];t++)S[a++]=n;for(a>>=7;n<u;n++)for(C[n]=a<<7,t=0;t<1<<v[n]-7;t++)S[256+a++]=n;for(r=0;r<=d;r++)f[r]=0;for(t=0;t<=143;)k[2*t+1]=8,t++,f[8]++;for(;t<=255;)k[2*t+1]=9,t++,f[9]++;for(;t<=279;)k[2*t+1]=7,t++,f[7]++;for(;t<=287;)k[2*t+1]=8,t++,f[8]++;for(L(k,l+1,f),t=0;t<u;t++)E[2*t+1]=5,E[2*t]=N(t,5);A=new z(k,y,o+1,l,d),M=new z(E,v,0,u,d),T=new z([],w,0,h,p)}(),Z=!0),t.l_desc=new R(t.dyn_ltree,A),t.d_desc=new R(t.dyn_dtree,M),t.bl_desc=new R(t.bl_tree,T),t.bi_buf=0,t.bi_valid=0,U(t)},trees._tr_stored_block=K,trees._tr_flush_block=function(t,n,a,s){var l,u,f=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var n,a=0xf3ffc07f;for(n=0;n<=31;n++,a>>>=1)if(1&a&&0!==t.dyn_ltree[2*n])return r;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return i;for(n=32;n<o;n++)if(0!==t.dyn_ltree[2*n])return i;return r}(t)),q(t,t.l_desc),q(t,t.d_desc),f=function(t){var r;for(H(t,t.dyn_ltree,t.l_desc.max_code),H(t,t.dyn_dtree,t.d_desc.max_code),q(t,t.bl_desc),r=h-1;r>=3&&0===t.bl_tree[2*x[r]+1];r--);return t.opt_len+=3*(r+1)+5+5+4,r}(t),l=t.opt_len+3+7>>>3,(u=t.static_len+3+7>>>3)<=l&&(l=u)):l=u=a+5,a+4<=l&&-1!==n?K(t,n,a,s):4===t.strategy||u===l?(P(t,2+ +!!s,3),W(t,k,E)):(P(t,4+ +!!s,3),function(t,r,i,n){var a;for(P(t,r-257,5),P(t,i-1,5),P(t,n-4,4),a=0;a<n;a++)P(t,t.bl_tree[2*x[a]+1],3);V(t,t.dyn_ltree,r-1),V(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,f+1),W(t,t.dyn_ltree,t.dyn_dtree)),U(t),s&&j(t)},trees._tr_tally=function(t,r,i){return t.pending_buf[t.d_buf+2*t.last_lit]=r>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&r,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===r?t.dyn_ltree[2*i]++:(t.matches++,r--,t.dyn_ltree[2*($[i]+o+1)]++,t.dyn_dtree[2*B(r)]++),t.last_lit===t.lit_bufsize-1},trees._tr_align=function(t){P(t,2,3),D(t,m,k),function(t){16===t.bi_valid?(O(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)},trees}function requireAdler32(){return hasRequiredAdler32?adler32_1:(hasRequiredAdler32=1,adler32_1=function(t,r,i,n){for(var a=65535&t,s=t>>>16&65535,o=0;0!==i;){i-=o=i>2e3?2e3:i;do s=s+(a=a+r[n++]|0)|0;while(--o)a%=65521,s%=65521}return a|s<<16})}function requireCrc32(){if(hasRequiredCrc32)return crc32_1;hasRequiredCrc32=1;var t=function(){for(var t,r=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?0xedb88320^t>>>1:t>>>1;r[i]=t}return r}();return crc32_1=function(r,i,n,a){var s=t,o=a+n;r^=-1;for(var l=a;l<o;l++)r=r>>>8^s[255&(r^i[l])];return~r}}function requireMessages(){return hasRequiredMessages?messages:(hasRequiredMessages=1,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"})}function requireDeflate$1(){if(hasRequiredDeflate$1)return deflate;hasRequiredDeflate$1=1;var t,r=requireCommon(),i=requireTrees(),n=requireAdler32(),a=requireCrc32(),s=requireMessages(),o=0,l=4,u=0,h=-2,f=-1,d=4,c=2,p=8,m=9,g=286,_=30,b=19,y=573,v=15,w=3,x=258,k=262,E=42,S=103,$=113,I=666,A=1,M=2,T=3,C=4;function z(t,r){return t.msg=s[r],r}function R(t){return(t<<1)-9*(t>4)}function B(t){for(var r=t.length;--r>=0;)t[r]=0}function O(t){var i=t.state,n=i.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(r.arraySet(t.output,i.pending_buf,i.pending_out,n,t.next_out),t.next_out+=n,i.pending_out+=n,t.total_out+=n,t.avail_out-=n,i.pending-=n,0===i.pending&&(i.pending_out=0))}function P(t,r){i._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,O(t.strm)}function D(t,r){t.pending_buf[t.pending++]=r}function N(t,r){t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r}function L(t,r){var i,n,a=t.max_chain_length,s=t.strstart,o=t.prev_length,l=t.nice_match,u=t.strstart>t.w_size-k?t.strstart-(t.w_size-k):0,h=t.window,f=t.w_mask,d=t.prev,c=t.strstart+x,p=h[s+o-1],m=h[s+o];t.prev_length>=t.good_match&&(a>>=2),l>t.lookahead&&(l=t.lookahead);do if(h[(i=r)+o]===m&&h[i+o-1]===p&&h[i]===h[s]&&h[++i]===h[s+1]){s+=2,i++;do;while(h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&s<c)if(n=x-(c-s),s=c-x,n>o){if(t.match_start=r,o=n,n>=l)break;p=h[s+o-1],m=h[s+o]}}while((r=d[r&f])>u&&0!=--a)return o<=t.lookahead?o:t.lookahead}function U(t){var i,s,o,l,u,h,f,d,c,p,m=t.w_size;do{if(l=t.window_size-t.lookahead-t.strstart,t.strstart>=m+(m-k)){r.arraySet(t.window,t.window,m,m,0),t.match_start-=m,t.strstart-=m,t.block_start-=m,i=s=t.hash_size;do o=t.head[--i],t.head[i]=o>=m?o-m:0;while(--s)i=s=m;do o=t.prev[--i],t.prev[i]=o>=m?o-m:0;while(--s)l+=m}if(0===t.strm.avail_in)break;if(h=t.strm,f=t.window,d=t.strstart+t.lookahead,c=l,p=void 0,(p=h.avail_in)>c&&(p=c),s=0===p?0:(h.avail_in-=p,r.arraySet(f,h.input,h.next_in,p,d),1===h.state.wrap?h.adler=n(h.adler,f,p,d):2===h.state.wrap&&(h.adler=a(h.adler,f,p,d)),h.next_in+=p,h.total_in+=p,p),t.lookahead+=s,t.lookahead+t.insert>=w)for(u=t.strstart-t.insert,t.ins_h=t.window[u],t.ins_h=(t.ins_h<<t.hash_shift^t.window[u+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[u+w-1])&t.hash_mask,t.prev[u&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=u,u++,t.insert--,!(t.lookahead+t.insert<w)););}while(t.lookahead<k&&0!==t.strm.avail_in)}function j(t,r){for(var n,a;;){if(t.lookahead<k){if(U(t),t.lookahead<k&&r===o)return A;if(0===t.lookahead)break}if(n=0,t.lookahead>=w&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+w-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-k&&(t.match_length=L(t,n)),t.match_length>=w)if(a=i._tr_tally(t,t.strstart-t.match_start,t.match_length-w),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=w){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+w-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(0!=--t.match_length)t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else a=i._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(P(t,!1),0===t.strm.avail_out))return A}return t.insert=t.strstart<w-1?t.strstart:w-1,r===l?(P(t,!0),0===t.strm.avail_out?T:C):t.last_lit&&(P(t,!1),0===t.strm.avail_out)?A:M}function F(t,r){for(var n,a,s;;){if(t.lookahead<k){if(U(t),t.lookahead<k&&r===o)return A;if(0===t.lookahead)break}if(n=0,t.lookahead>=w&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+w-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=w-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-k&&(t.match_length=L(t,n),t.match_length<=5&&(1===t.strategy||t.match_length===w&&t.strstart-t.match_start>4096)&&(t.match_length=w-1)),t.prev_length>=w&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-w,a=i._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-w),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=s&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+w-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(0!=--t.prev_length)if(t.match_available=0,t.match_length=w-1,t.strstart++,a&&(P(t,!1),0===t.strm.avail_out))return A}else if(t.match_available){if((a=i._tr_tally(t,0,t.window[t.strstart-1]))&&P(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return A}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=i._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<w-1?t.strstart:w-1,r===l?(P(t,!0),0===t.strm.avail_out?T:C):t.last_lit&&(P(t,!1),0===t.strm.avail_out)?A:M}function G(t,r,i,n,a){this.good_length=t,this.max_lazy=r,this.nice_length=i,this.max_chain=n,this.func=a}function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=p,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*y),this.dyn_dtree=new r.Buf16(2*(2*_+1)),this.bl_tree=new r.Buf16(2*(2*b+1)),B(this.dyn_ltree),B(this.dyn_dtree),B(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(v+1),this.heap=new r.Buf16(2*g+1),B(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*g+1),B(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function q(t){var r;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=c,(r=t.state).pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap?E:$,t.adler=+(2!==r.wrap),r.last_flush=o,i._tr_init(r),u):z(t,h)}function H(r){var i=q(r);return i===u&&function(r){r.window_size=2*r.w_size,B(r.head),r.max_lazy_match=t[r.level].max_lazy,r.good_match=t[r.level].good_length,r.nice_match=t[r.level].nice_length,r.max_chain_length=t[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=w-1,r.match_available=0,r.ins_h=0}(r.state),i}function V(t,i,n,a,s,o){if(!t)return h;var l=1;if(i===f&&(i=6),a<0?(l=0,a=-a):a>15&&(l=2,a-=16),s<1||s>m||n!==p||a<8||a>15||i<0||i>9||o<0||o>d)return z(t,h);8===a&&(a=9);var u=new W;return t.state=u,u.strm=t,u.wrap=l,u.gzhead=null,u.w_bits=a,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=s+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+w-1)/w),u.window=new r.Buf8(2*u.w_size),u.head=new r.Buf16(u.hash_size),u.prev=new r.Buf16(u.w_size),u.lit_bufsize=1<<s+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new r.Buf8(u.pending_buf_size),u.d_buf=+u.lit_bufsize,u.l_buf=3*u.lit_bufsize,u.level=i,u.strategy=o,u.method=n,H(t)}return t=[new G(0,0,0,0,function(t,r){var i=65535;for(65535>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(U(t),0===t.lookahead&&r===o)return A;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,P(t,!1),0===t.strm.avail_out)||t.strstart-t.block_start>=t.w_size-k&&(P(t,!1),0===t.strm.avail_out))return A}return t.insert=0,r===l?(P(t,!0),0===t.strm.avail_out?T:C):(t.strstart>t.block_start&&(P(t,!1),t.strm.avail_out),A)}),new G(4,4,8,4,j),new G(4,5,16,8,j),new G(4,6,32,32,j),new G(4,4,16,16,F),new G(8,16,32,32,F),new G(8,16,128,128,F),new G(8,32,128,256,F),new G(32,128,258,1024,F),new G(32,258,258,4096,F)],deflate.deflateInit=function(t,r){return V(t,r,p,15,8,0)},deflate.deflateInit2=V,deflate.deflateReset=H,deflate.deflateResetKeep=q,deflate.deflateSetHeader=function(t,r){return t&&t.state?2!==t.state.wrap?h:(t.state.gzhead=r,u):h},deflate.deflate=function(r,n){var s,f,d,c;if(!r||!r.state||n>5||n<0)return r?z(r,h):h;if(f=r.state,!r.output||!r.input&&0!==r.avail_in||f.status===I&&n!==l)return z(r,0===r.avail_out?-5:h);if(f.strm=r,s=f.last_flush,f.last_flush=n,f.status===E)if(2===f.wrap)r.adler=0,D(f,31),D(f,139),D(f,8),f.gzhead?(D(f,+!!f.gzhead.text+2*!!f.gzhead.hcrc+4*!!f.gzhead.extra+8*!!f.gzhead.name+16*!!f.gzhead.comment),D(f,255&f.gzhead.time),D(f,f.gzhead.time>>8&255),D(f,f.gzhead.time>>16&255),D(f,f.gzhead.time>>24&255),D(f,9===f.level?2:4*(f.strategy>=2||f.level<2)),D(f,255&f.gzhead.os),f.gzhead.extra&&f.gzhead.extra.length&&(D(f,255&f.gzhead.extra.length),D(f,f.gzhead.extra.length>>8&255)),f.gzhead.hcrc&&(r.adler=a(r.adler,f.pending_buf,f.pending,0)),f.gzindex=0,f.status=69):(D(f,0),D(f,0),D(f,0),D(f,0),D(f,0),D(f,9===f.level?2:4*(f.strategy>=2||f.level<2)),D(f,3),f.status=$);else{var m=p+(f.w_bits-8<<4)<<8;m|=(f.strategy>=2||f.level<2?0:f.level<6?1:6===f.level?2:3)<<6,0!==f.strstart&&(m|=32),m+=31-m%31,f.status=$,N(f,m),0!==f.strstart&&(N(f,r.adler>>>16),N(f,65535&r.adler)),r.adler=1}if(69===f.status)if(f.gzhead.extra){for(d=f.pending;f.gzindex<(65535&f.gzhead.extra.length)&&(f.pending!==f.pending_buf_size||(f.gzhead.hcrc&&f.pending>d&&(r.adler=a(r.adler,f.pending_buf,f.pending-d,d)),O(r),d=f.pending,f.pending!==f.pending_buf_size));)D(f,255&f.gzhead.extra[f.gzindex]),f.gzindex++;f.gzhead.hcrc&&f.pending>d&&(r.adler=a(r.adler,f.pending_buf,f.pending-d,d)),f.gzindex===f.gzhead.extra.length&&(f.gzindex=0,f.status=73)}else f.status=73;if(73===f.status)if(f.gzhead.name){d=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>d&&(r.adler=a(r.adler,f.pending_buf,f.pending-d,d)),O(r),d=f.pending,f.pending===f.pending_buf_size)){c=1;break}c=f.gzindex<f.gzhead.name.length?255&f.gzhead.name.charCodeAt(f.gzindex++):0,D(f,c)}while(0!==c)f.gzhead.hcrc&&f.pending>d&&(r.adler=a(r.adler,f.pending_buf,f.pending-d,d)),0===c&&(f.gzindex=0,f.status=91)}else f.status=91;if(91===f.status)if(f.gzhead.comment){d=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>d&&(r.adler=a(r.adler,f.pending_buf,f.pending-d,d)),O(r),d=f.pending,f.pending===f.pending_buf_size)){c=1;break}c=f.gzindex<f.gzhead.comment.length?255&f.gzhead.comment.charCodeAt(f.gzindex++):0,D(f,c)}while(0!==c)f.gzhead.hcrc&&f.pending>d&&(r.adler=a(r.adler,f.pending_buf,f.pending-d,d)),0===c&&(f.status=S)}else f.status=S;if(f.status===S&&(f.gzhead.hcrc?(f.pending+2>f.pending_buf_size&&O(r),f.pending+2<=f.pending_buf_size&&(D(f,255&r.adler),D(f,r.adler>>8&255),r.adler=0,f.status=$)):f.status=$),0!==f.pending){if(O(r),0===r.avail_out)return f.last_flush=-1,u}else if(0===r.avail_in&&R(n)<=R(s)&&n!==l)return z(r,-5);if(f.status===I&&0!==r.avail_in)return z(r,-5);if(0!==r.avail_in||0!==f.lookahead||n!==o&&f.status!==I){var g=2===f.strategy?function(t,r){for(var n;;){if(0===t.lookahead&&(U(t),0===t.lookahead)){if(r===o)return A;break}if(t.match_length=0,n=i._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(P(t,!1),0===t.strm.avail_out))return A}return t.insert=0,r===l?(P(t,!0),0===t.strm.avail_out?T:C):t.last_lit&&(P(t,!1),0===t.strm.avail_out)?A:M}(f,n):3===f.strategy?function(t,r){for(var n,a,s,u,h=t.window;;){if(t.lookahead<=x){if(U(t),t.lookahead<=x&&r===o)return A;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=w&&t.strstart>0&&(a=h[s=t.strstart-1])===h[++s]&&a===h[++s]&&a===h[++s]){u=t.strstart+x;do;while(a===h[++s]&&a===h[++s]&&a===h[++s]&&a===h[++s]&&a===h[++s]&&a===h[++s]&&a===h[++s]&&a===h[++s]&&s<u)t.match_length=x-(u-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=w?(n=i._tr_tally(t,1,t.match_length-w),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=i._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(P(t,!1),0===t.strm.avail_out))return A}return t.insert=0,r===l?(P(t,!0),0===t.strm.avail_out?T:C):t.last_lit&&(P(t,!1),0===t.strm.avail_out)?A:M}(f,n):t[f.level].func(f,n);if(g!==T&&g!==C||(f.status=I),g===A||g===T)return 0===r.avail_out&&(f.last_flush=-1),u;if(g===M&&(1===n?i._tr_align(f):5!==n&&(i._tr_stored_block(f,0,0,!1),3===n&&(B(f.head),0===f.lookahead&&(f.strstart=0,f.block_start=0,f.insert=0))),O(r),0===r.avail_out))return f.last_flush=-1,u}return n!==l?u:f.wrap<=0?1:(2===f.wrap?(D(f,255&r.adler),D(f,r.adler>>8&255),D(f,r.adler>>16&255),D(f,r.adler>>24&255),D(f,255&r.total_in),D(f,r.total_in>>8&255),D(f,r.total_in>>16&255),D(f,r.total_in>>24&255)):(N(f,r.adler>>>16),N(f,65535&r.adler)),O(r),f.wrap>0&&(f.wrap=-f.wrap),0!==f.pending?u:1)},deflate.deflateEnd=function(t){var r;return t&&t.state?(r=t.state.status)!==E&&69!==r&&73!==r&&91!==r&&r!==S&&r!==$&&r!==I?z(t,h):(t.state=null,r===$?z(t,-3):u):h},deflate.deflateSetDictionary=function(t,i){var a,s,o,l,f,d,c,p,m=i.length;if(!t||!t.state||2===(l=(a=t.state).wrap)||1===l&&a.status!==E||a.lookahead)return h;for(1===l&&(t.adler=n(t.adler,i,m,0)),a.wrap=0,m>=a.w_size&&(0===l&&(B(a.head),a.strstart=0,a.block_start=0,a.insert=0),p=new r.Buf8(a.w_size),r.arraySet(p,i,m-a.w_size,a.w_size,0),i=p,m=a.w_size),f=t.avail_in,d=t.next_in,c=t.input,t.avail_in=m,t.next_in=0,t.input=i,U(a);a.lookahead>=w;){s=a.strstart,o=a.lookahead-(w-1);do a.ins_h=(a.ins_h<<a.hash_shift^a.window[s+w-1])&a.hash_mask,a.prev[s&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=s,s++;while(--o)a.strstart=s,a.lookahead=w-1,U(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=w-1,a.match_available=0,t.next_in=d,t.input=c,t.avail_in=f,a.wrap=l,u},deflate.deflateInfo="pako deflate (from Nodeca project)",deflate}var hasRequiredStrings,zstream,hasRequiredZstream,hasRequiredDeflate,strings={};function requireStrings(){if(hasRequiredStrings)return strings;hasRequiredStrings=1;var t=requireCommon(),r=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){i=!1}for(var n=new t.Buf8(256),a=0;a<256;a++)n[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function s(n,a){if(a<65534&&(n.subarray&&i||!n.subarray&&r))return String.fromCharCode.apply(null,t.shrinkBuf(n,a));for(var s="",o=0;o<a;o++)s+=String.fromCharCode(n[o]);return s}return n[254]=n[254]=1,strings.string2buf=function(r){var i,n,a,s,o,l=r.length,u=0;for(s=0;s<l;s++)55296==(64512&(n=r.charCodeAt(s)))&&s+1<l&&56320==(64512&(a=r.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(a-56320),s++),u+=n<128?1:n<2048?2:n<65536?3:4;for(i=new t.Buf8(u),o=0,s=0;o<u;s++)55296==(64512&(n=r.charCodeAt(s)))&&s+1<l&&56320==(64512&(a=r.charCodeAt(s+1)))&&(n=65536+(n-55296<<10)+(a-56320),s++),n<128?i[o++]=n:(n<2048?i[o++]=192|n>>>6:(n<65536?i[o++]=224|n>>>12:(i[o++]=240|n>>>18,i[o++]=128|n>>>12&63),i[o++]=128|n>>>6&63),i[o++]=128|63&n);return i},strings.buf2binstring=function(t){return s(t,t.length)},strings.binstring2buf=function(r){for(var i=new t.Buf8(r.length),n=0,a=i.length;n<a;n++)i[n]=r.charCodeAt(n);return i},strings.buf2string=function(t,r){var i,a,o,l,u=r||t.length,h=Array(2*u);for(a=0,i=0;i<u;)if((o=t[i++])<128)h[a++]=o;else if((l=n[o])>4)h[a++]=65533,i+=l-1;else{for(o&=2===l?31:3===l?15:7;l>1&&i<u;)o=o<<6|63&t[i++],l--;l>1?h[a++]=65533:o<65536?h[a++]=o:(o-=65536,h[a++]=55296|o>>10&1023,h[a++]=56320|1023&o)}return s(h,a)},strings.utf8border=function(t,r){var i;for((r=r||t.length)>t.length&&(r=t.length),i=r-1;i>=0&&128==(192&t[i]);)i--;return i<0||0===i?r:i+n[t[i]]>r?i:r},strings}function requireZstream(){return hasRequiredZstream?zstream:(hasRequiredZstream=1,zstream=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0})}function requireDeflate(){if(hasRequiredDeflate)return deflate$1;hasRequiredDeflate=1;var t=requireDeflate$1(),r=requireCommon(),i=requireStrings(),n=requireMessages(),a=requireZstream(),s=Object.prototype.toString,o=0,l=-1,u=0,h=8;function f(d){if(!(this instanceof f))return new f(d);this.options=r.assign({level:l,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},d||{});var c,p=this.options;p.raw&&p.windowBits>0?p.windowBits=-p.windowBits:p.gzip&&p.windowBits>0&&p.windowBits<16&&(p.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var m=t.deflateInit2(this.strm,p.level,p.method,p.windowBits,p.memLevel,p.strategy);if(m!==o)throw Error(n[m]);if(p.header&&t.deflateSetHeader(this.strm,p.header),p.dictionary){if(c="string"==typeof p.dictionary?i.string2buf(p.dictionary):"[object ArrayBuffer]"===s.call(p.dictionary)?new Uint8Array(p.dictionary):p.dictionary,(m=t.deflateSetDictionary(this.strm,c))!==o)throw Error(n[m]);this._dict_set=!0}}function d(t,r){var i=new f(r);if(i.push(t,!0),i.err)throw i.msg||n[i.err];return i.result}return f.prototype.push=function(n,a){var l,u,h=this.strm,f=this.options.chunkSize;if(this.ended)return!1;u=a===~~a?a:4*(!0===a),"string"==typeof n?h.input=i.string2buf(n):"[object ArrayBuffer]"===s.call(n)?h.input=new Uint8Array(n):h.input=n,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new r.Buf8(f),h.next_out=0,h.avail_out=f),1!==(l=t.deflate(h,u))&&l!==o)return this.onEnd(l),this.ended=!0,!1;0!==h.avail_out&&(0!==h.avail_in||4!==u&&2!==u)||("string"===this.options.to?this.onData(i.buf2binstring(r.shrinkBuf(h.output,h.next_out))):this.onData(r.shrinkBuf(h.output,h.next_out)))}while((h.avail_in>0||0===h.avail_out)&&1!==l)return 4===u?(l=t.deflateEnd(this.strm),this.onEnd(l),this.ended=!0,l===o):2!==u||(this.onEnd(o),h.avail_out=0,!0)},f.prototype.onData=function(t){this.chunks.push(t)},f.prototype.onEnd=function(t){t===o&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},deflate$1.Deflate=f,deflate$1.deflate=d,deflate$1.deflateRaw=function(t,r){return(r=r||{}).raw=!0,d(t,r)},deflate$1.gzip=function(t,r){return(r=r||{}).gzip=!0,d(t,r)},deflate$1}var inffast,hasRequiredInffast,inftrees,hasRequiredInftrees,hasRequiredInflate$1,constants,hasRequiredConstants,gzheader,hasRequiredGzheader,hasRequiredInflate,pako_1,hasRequiredPako,inflate$1={},inflate={};function requireInffast(){return hasRequiredInffast?inffast:(hasRequiredInffast=1,inffast=function(t,r){var i,n,a,s,o,l,u,h,f,d,c,p,m,g,_,b,y,v,w,x,k,E,S,$,I;i=t.state,n=t.next_in,$=t.input,a=n+(t.avail_in-5),s=t.next_out,I=t.output,o=s-(r-t.avail_out),l=s+(t.avail_out-257),u=i.dmax,h=i.wsize,f=i.whave,d=i.wnext,c=i.window,p=i.hold,m=i.bits,g=i.lencode,_=i.distcode,b=(1<<i.lenbits)-1,y=(1<<i.distbits)-1;t:do for(m<15&&(p+=$[n++]<<m,m+=8,p+=$[n++]<<m,m+=8),v=g[p&b];;){if(p>>>=w=v>>>24,m-=w,0==(w=v>>>16&255))I[s++]=65535&v;else{if(!(16&w)){if(64&w){if(32&w){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}v=g[(65535&v)+(p&(1<<w)-1)];continue}for(x=65535&v,(w&=15)&&(m<w&&(p+=$[n++]<<m,m+=8),x+=p&(1<<w)-1,p>>>=w,m-=w),m<15&&(p+=$[n++]<<m,m+=8,p+=$[n++]<<m,m+=8),v=_[p&y];;){if(p>>>=w=v>>>24,m-=w,16&(w=v>>>16&255)){if(k=65535&v,m<(w&=15)&&(p+=$[n++]<<m,(m+=8)<w&&(p+=$[n++]<<m,m+=8)),(k+=p&(1<<w)-1)>u){t.msg="invalid distance too far back",i.mode=30;break t}if(p>>>=w,m-=w,k>(w=s-o)){if((w=k-w)>f&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(E=0,S=c,0===d){if(E+=h-w,w<x){x-=w;do I[s++]=c[E++];while(--w)E=s-k,S=I}}else if(d<w){if(E+=h+d-w,(w-=d)<x){x-=w;do I[s++]=c[E++];while(--w)if(E=0,d<x){x-=w=d;do I[s++]=c[E++];while(--w)E=s-k,S=I}}}else if(E+=d-w,w<x){x-=w;do I[s++]=c[E++];while(--w)E=s-k,S=I}for(;x>2;)I[s++]=S[E++],I[s++]=S[E++],I[s++]=S[E++],x-=3;x&&(I[s++]=S[E++],x>1&&(I[s++]=S[E++]))}else{E=s-k;do I[s++]=I[E++],I[s++]=I[E++],I[s++]=I[E++],x-=3;while(x>2)x&&(I[s++]=I[E++],x>1&&(I[s++]=I[E++]))}break}if(64&w){t.msg="invalid distance code",i.mode=30;break t}v=_[(65535&v)+(p&(1<<w)-1)]}}break}while(n<a&&s<l)n-=x=m>>3,p&=(1<<(m-=x<<3))-1,t.next_in=n,t.next_out=s,t.avail_in=n<a?a-n+5:5-(n-a),t.avail_out=s<l?l-s+257:257-(s-l),i.hold=p,i.bits=m})}function requireInftrees(){if(hasRequiredInftrees)return inftrees;hasRequiredInftrees=1;var t=requireCommon(),r=15,i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return inftrees=function(o,l,u,h,f,d,c,p){var m,g,_,b,y,v,w,x,k,E=p.bits,S=0,$=0,I=0,A=0,M=0,T=0,C=0,z=0,R=0,B=0,O=null,P=0,D=new t.Buf16(16),N=new t.Buf16(16),L=null,U=0;for(S=0;S<=r;S++)D[S]=0;for($=0;$<h;$++)D[l[u+$]]++;for(M=E,A=r;A>=1&&0===D[A];A--);if(M>A&&(M=A),0===A)return f[d++]=0x1400000,f[d++]=0x1400000,p.bits=1,0;for(I=1;I<A&&0===D[I];I++);for(M<I&&(M=I),z=1,S=1;S<=r;S++)if(z<<=1,(z-=D[S])<0)return -1;if(z>0&&(0===o||1!==A))return -1;for(N[1]=0,S=1;S<r;S++)N[S+1]=N[S]+D[S];for($=0;$<h;$++)0!==l[u+$]&&(c[N[l[u+$]]++]=$);if(0===o?(O=L=c,v=19):1===o?(O=i,P-=257,L=n,U-=257,v=256):(O=a,L=s,v=-1),B=0,$=0,S=I,y=d,T=M,C=0,_=-1,b=(R=1<<M)-1,1===o&&R>852||2===o&&R>592)return 1;for(;;){w=S-C,c[$]<v?(x=0,k=c[$]):c[$]>v?(x=L[U+c[$]],k=O[P+c[$]]):(x=96,k=0),m=1<<S-C,I=g=1<<T;do f[y+(B>>C)+(g-=m)]=w<<24|x<<16|k;while(0!==g)for(m=1<<S-1;B&m;)m>>=1;if(0!==m?(B&=m-1,B+=m):B=0,$++,0==--D[S]){if(S===A)break;S=l[u+c[$]]}if(S>M&&(B&b)!==_){for(0===C&&(C=M),y+=I,z=1<<(T=S-C);T+C<A&&!((z-=D[T+C])<=0);)T++,z<<=1;if(R+=1<<T,1===o&&R>852||2===o&&R>592)return 1;f[_=B&b]=M<<24|T<<16|y-d}}return 0!==B&&(f[y+B]=S-C<<24|4194304),p.bits=M,0}}function requireInflate$1(){if(hasRequiredInflate$1)return inflate;hasRequiredInflate$1=1;var t=requireCommon(),r=requireAdler32(),i=requireCrc32(),n=requireInffast(),a=requireInftrees(),s=1,o=2,l=0,u=-2,h=1,f=12,d=30,c=852,p=592;function m(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new t.Buf16(320),this.work=new t.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _(r){var i;return r&&r.state?(i=r.state,r.total_in=r.total_out=i.total=0,r.msg="",i.wrap&&(r.adler=1&i.wrap),i.mode=h,i.last=0,i.havedict=0,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new t.Buf32(c),i.distcode=i.distdyn=new t.Buf32(p),i.sane=1,i.back=-1,l):u}function b(t){var r;return t&&t.state?((r=t.state).wsize=0,r.whave=0,r.wnext=0,_(t)):u}function y(t,r){var i,n;return t&&t.state?(n=t.state,r<0?(i=0,r=-r):(i=1+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?u:(null!==n.window&&n.wbits!==r&&(n.window=null),n.wrap=i,n.wbits=r,b(t))):u}function v(t,r){var i,n;return t?(t.state=n=new g,n.window=null,(i=y(t,r))!==l&&(t.state=null),i):u}var w,x,k=!0;function E(r){if(k){var i;for(w=new t.Buf32(512),x=new t.Buf32(32),i=0;i<144;)r.lens[i++]=8;for(;i<256;)r.lens[i++]=9;for(;i<280;)r.lens[i++]=7;for(;i<288;)r.lens[i++]=8;for(a(s,r.lens,0,288,w,0,r.work,{bits:9}),i=0;i<32;)r.lens[i++]=5;a(o,r.lens,0,32,x,0,r.work,{bits:5}),k=!1}r.lencode=w,r.lenbits=9,r.distcode=x,r.distbits=5}function S(r,i,n,a){var s,o=r.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new t.Buf8(o.wsize)),a>=o.wsize?(t.arraySet(o.window,i,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((s=o.wsize-o.wnext)>a&&(s=a),t.arraySet(o.window,i,n-a,s,o.wnext),(a-=s)?(t.arraySet(o.window,i,n-a,a,0),o.wnext=a,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}return inflate.inflateReset=b,inflate.inflateReset2=y,inflate.inflateResetKeep=_,inflate.inflateInit=function(t){return v(t,15)},inflate.inflateInit2=v,inflate.inflate=function(c,p){var g,_,b,y,v,w,x,k,$,I,A,M,T,C,z,R,B,O,P,D,N,L,U,j,F=0,G=new t.Buf8(4),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!c||!c.state||!c.output||!c.input&&0!==c.avail_in)return u;(g=c.state).mode===f&&(g.mode=13),v=c.next_out,b=c.output,x=c.avail_out,y=c.next_in,_=c.input,w=c.avail_in,k=g.hold,$=g.bits,I=w,A=x,L=l;t:for(;;)switch(g.mode){case h:if(0===g.wrap){g.mode=13;break}for(;$<16;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}if(2&g.wrap&&35615===k){g.check=0,G[0]=255&k,G[1]=k>>>8&255,g.check=i(g.check,G,2,0),k=0,$=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&k)<<8)+(k>>8))%31){c.msg="incorrect header check",g.mode=d;break}if(8!=(15&k)){c.msg="unknown compression method",g.mode=d;break}if($-=4,N=8+(15&(k>>>=4)),0===g.wbits)g.wbits=N;else if(N>g.wbits){c.msg="invalid window size",g.mode=d;break}g.dmax=1<<N,c.adler=g.check=1,g.mode=512&k?10:f,k=0,$=0;break;case 2:for(;$<16;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}if(g.flags=k,8!=(255&g.flags)){c.msg="unknown compression method",g.mode=d;break}if(57344&g.flags){c.msg="unknown header flags set",g.mode=d;break}g.head&&(g.head.text=k>>8&1),512&g.flags&&(G[0]=255&k,G[1]=k>>>8&255,g.check=i(g.check,G,2,0)),k=0,$=0,g.mode=3;case 3:for(;$<32;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}g.head&&(g.head.time=k),512&g.flags&&(G[0]=255&k,G[1]=k>>>8&255,G[2]=k>>>16&255,G[3]=k>>>24&255,g.check=i(g.check,G,4,0)),k=0,$=0,g.mode=4;case 4:for(;$<16;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}g.head&&(g.head.xflags=255&k,g.head.os=k>>8),512&g.flags&&(G[0]=255&k,G[1]=k>>>8&255,g.check=i(g.check,G,2,0)),k=0,$=0,g.mode=5;case 5:if(1024&g.flags){for(;$<16;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}g.length=k,g.head&&(g.head.extra_len=k),512&g.flags&&(G[0]=255&k,G[1]=k>>>8&255,g.check=i(g.check,G,2,0)),k=0,$=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&((M=g.length)>w&&(M=w),M&&(g.head&&(N=g.head.extra_len-g.length,g.head.extra||(g.head.extra=Array(g.head.extra_len)),t.arraySet(g.head.extra,_,y,M,N)),512&g.flags&&(g.check=i(g.check,_,M,y)),w-=M,y+=M,g.length-=M),g.length))break t;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(0===w)break t;M=0;do N=_[y+M++],g.head&&N&&g.length<65536&&(g.head.name+=String.fromCharCode(N));while(N&&M<w)if(512&g.flags&&(g.check=i(g.check,_,M,y)),w-=M,y+=M,N)break t}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(0===w)break t;M=0;do N=_[y+M++],g.head&&N&&g.length<65536&&(g.head.comment+=String.fromCharCode(N));while(N&&M<w)if(512&g.flags&&(g.check=i(g.check,_,M,y)),w-=M,y+=M,N)break t}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;$<16;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}if(k!==(65535&g.check)){c.msg="header crc mismatch",g.mode=d;break}k=0,$=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),c.adler=g.check=0,g.mode=f;break;case 10:for(;$<32;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}c.adler=g.check=m(k),k=0,$=0,g.mode=11;case 11:if(0===g.havedict)return c.next_out=v,c.avail_out=x,c.next_in=y,c.avail_in=w,g.hold=k,g.bits=$,2;c.adler=g.check=1,g.mode=f;case f:if(5===p||6===p)break t;case 13:if(g.last){k>>>=7&$,$-=7&$,g.mode=27;break}for(;$<3;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}switch(g.last=1&k,$-=1,3&(k>>>=1)){case 0:g.mode=14;break;case 1:if(E(g),g.mode=20,6===p){k>>>=2,$-=2;break t}break;case 2:g.mode=17;break;case 3:c.msg="invalid block type",g.mode=d}k>>>=2,$-=2;break;case 14:for(k>>>=7&$,$-=7&$;$<32;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}if((65535&k)!=(k>>>16^65535)){c.msg="invalid stored block lengths",g.mode=d;break}if(g.length=65535&k,k=0,$=0,g.mode=15,6===p)break t;case 15:g.mode=16;case 16:if(M=g.length){if(M>w&&(M=w),M>x&&(M=x),0===M)break t;t.arraySet(b,_,y,M,v),w-=M,y+=M,x-=M,v+=M,g.length-=M;break}g.mode=f;break;case 17:for(;$<14;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}if(g.nlen=257+(31&k),$-=5,g.ndist=1+(31&(k>>>=5)),$-=5,g.ncode=4+(15&(k>>>=5)),k>>>=4,$-=4,g.nlen>286||g.ndist>30){c.msg="too many length or distance symbols",g.mode=d;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;$<3;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}g.lens[W[g.have++]]=7&k,k>>>=3,$-=3}for(;g.have<19;)g.lens[W[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,U={bits:g.lenbits},L=a(0,g.lens,0,19,g.lencode,0,g.work,U),g.lenbits=U.bits,L){c.msg="invalid code lengths set",g.mode=d;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;R=(F=g.lencode[k&(1<<g.lenbits)-1])>>>16&255,B=65535&F,!((z=F>>>24)<=$);){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}if(B<16)k>>>=z,$-=z,g.lens[g.have++]=B;else{if(16===B){for(j=z+2;$<j;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}if(k>>>=z,$-=z,0===g.have){c.msg="invalid bit length repeat",g.mode=d;break}N=g.lens[g.have-1],M=3+(3&k),k>>>=2,$-=2}else if(17===B){for(j=z+3;$<j;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}$-=z,N=0,M=3+(7&(k>>>=z)),k>>>=3,$-=3}else{for(j=z+7;$<j;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}$-=z,N=0,M=11+(127&(k>>>=z)),k>>>=7,$-=7}if(g.have+M>g.nlen+g.ndist){c.msg="invalid bit length repeat",g.mode=d;break}for(;M--;)g.lens[g.have++]=N}}if(g.mode===d)break;if(0===g.lens[256]){c.msg="invalid code -- missing end-of-block",g.mode=d;break}if(g.lenbits=9,U={bits:g.lenbits},L=a(s,g.lens,0,g.nlen,g.lencode,0,g.work,U),g.lenbits=U.bits,L){c.msg="invalid literal/lengths set",g.mode=d;break}if(g.distbits=6,g.distcode=g.distdyn,U={bits:g.distbits},L=a(o,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,U),g.distbits=U.bits,L){c.msg="invalid distances set",g.mode=d;break}if(g.mode=20,6===p)break t;case 20:g.mode=21;case 21:if(w>=6&&x>=258){c.next_out=v,c.avail_out=x,c.next_in=y,c.avail_in=w,g.hold=k,g.bits=$,n(c,A),v=c.next_out,b=c.output,x=c.avail_out,y=c.next_in,_=c.input,w=c.avail_in,k=g.hold,$=g.bits,g.mode===f&&(g.back=-1);break}for(g.back=0;R=(F=g.lencode[k&(1<<g.lenbits)-1])>>>16&255,B=65535&F,!((z=F>>>24)<=$);){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}if(R&&!(240&R)){for(O=z,P=R,D=B;R=(F=g.lencode[D+((k&(1<<O+P)-1)>>O)])>>>16&255,B=65535&F,!(O+(z=F>>>24)<=$);){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}k>>>=O,$-=O,g.back+=O}if(k>>>=z,$-=z,g.back+=z,g.length=B,0===R){g.mode=26;break}if(32&R){g.back=-1,g.mode=f;break}if(64&R){c.msg="invalid literal/length code",g.mode=d;break}g.extra=15&R,g.mode=22;case 22:if(g.extra){for(j=g.extra;$<j;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}g.length+=k&(1<<g.extra)-1,k>>>=g.extra,$-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;R=(F=g.distcode[k&(1<<g.distbits)-1])>>>16&255,B=65535&F,!((z=F>>>24)<=$);){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}if(!(240&R)){for(O=z,P=R,D=B;R=(F=g.distcode[D+((k&(1<<O+P)-1)>>O)])>>>16&255,B=65535&F,!(O+(z=F>>>24)<=$);){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}k>>>=O,$-=O,g.back+=O}if(k>>>=z,$-=z,g.back+=z,64&R){c.msg="invalid distance code",g.mode=d;break}g.offset=B,g.extra=15&R,g.mode=24;case 24:if(g.extra){for(j=g.extra;$<j;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}g.offset+=k&(1<<g.extra)-1,k>>>=g.extra,$-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){c.msg="invalid distance too far back",g.mode=d;break}g.mode=25;case 25:if(0===x)break t;if(M=A-x,g.offset>M){if((M=g.offset-M)>g.whave&&g.sane){c.msg="invalid distance too far back",g.mode=d;break}M>g.wnext?(M-=g.wnext,T=g.wsize-M):T=g.wnext-M,M>g.length&&(M=g.length),C=g.window}else C=b,T=v-g.offset,M=g.length;M>x&&(M=x),x-=M,g.length-=M;do b[v++]=C[T++];while(--M)0===g.length&&(g.mode=21);break;case 26:if(0===x)break t;b[v++]=g.length,x--,g.mode=21;break;case 27:if(g.wrap){for(;$<32;){if(0===w)break t;w--,k|=_[y++]<<$,$+=8}if(A-=x,c.total_out+=A,g.total+=A,A&&(c.adler=g.check=g.flags?i(g.check,b,A,v-A):r(g.check,b,A,v-A)),A=x,(g.flags?k:m(k))!==g.check){c.msg="incorrect data check",g.mode=d;break}k=0,$=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;$<32;){if(0===w)break t;w--,k+=_[y++]<<$,$+=8}if(k!==(0|g.total)){c.msg="incorrect length check",g.mode=d;break}k=0,$=0}g.mode=29;case 29:L=1;break t;case d:L=-3;break t;case 31:return -4;default:return u}return c.next_out=v,c.avail_out=x,c.next_in=y,c.avail_in=w,g.hold=k,g.bits=$,(g.wsize||A!==c.avail_out&&g.mode<d&&(g.mode<27||4!==p))&&S(c,c.output,c.next_out,A-c.avail_out),I-=c.avail_in,A-=c.avail_out,c.total_in+=I,c.total_out+=A,g.total+=A,g.wrap&&A&&(c.adler=g.check=g.flags?i(g.check,b,A,c.next_out-A):r(g.check,b,A,c.next_out-A)),c.data_type=g.bits+64*!!g.last+128*(g.mode===f)+256*(20===g.mode||15===g.mode),(0===I&&0===A||4===p)&&L===l&&(L=-5),L},inflate.inflateEnd=function(t){if(!t||!t.state)return u;var r=t.state;return r.window&&(r.window=null),t.state=null,l},inflate.inflateGetHeader=function(t,r){var i;return t&&t.state&&2&(i=t.state).wrap?(i.head=r,r.done=!1,l):u},inflate.inflateSetDictionary=function(t,i){var n,a=i.length;return t&&t.state?0!==(n=t.state).wrap&&11!==n.mode?u:11===n.mode&&r(1,i,a,0)!==n.check?-3:S(t,i,a,a)?(n.mode=31,-4):(n.havedict=1,l):u},inflate.inflateInfo="pako inflate (from Nodeca project)",inflate}function requireConstants(){return hasRequiredConstants?constants:(hasRequiredConstants=1,constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8})}function requireGzheader(){return hasRequiredGzheader?gzheader:(hasRequiredGzheader=1,gzheader=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1})}function requireInflate(){if(hasRequiredInflate)return inflate$1;hasRequiredInflate=1;var t=requireInflate$1(),r=requireCommon(),i=requireStrings(),n=requireConstants(),a=requireMessages(),s=requireZstream(),o=requireGzheader(),l=Object.prototype.toString;function u(h){if(!(this instanceof u))return new u(h);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},h||{});var f=this.options;f.raw&&f.windowBits>=0&&f.windowBits<16&&(f.windowBits=-f.windowBits,0===f.windowBits&&(f.windowBits=-15)),!(f.windowBits>=0&&f.windowBits<16)||h&&h.windowBits||(f.windowBits+=32),f.windowBits>15&&f.windowBits<48&&(15&f.windowBits||(f.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var d=t.inflateInit2(this.strm,f.windowBits);if(d!==n.Z_OK||(this.header=new o,t.inflateGetHeader(this.strm,this.header),f.dictionary&&("string"==typeof f.dictionary?f.dictionary=i.string2buf(f.dictionary):"[object ArrayBuffer]"===l.call(f.dictionary)&&(f.dictionary=new Uint8Array(f.dictionary)),f.raw&&(d=t.inflateSetDictionary(this.strm,f.dictionary))!==n.Z_OK)))throw Error(a[d])}function h(t,r){var i=new u(r);if(i.push(t,!0),i.err)throw i.msg||a[i.err];return i.result}return u.prototype.push=function(a,s){var o,u,h,f,d,c=this.strm,p=this.options.chunkSize,m=this.options.dictionary,g=!1;if(this.ended)return!1;u=s===~~s?s:!0===s?n.Z_FINISH:n.Z_NO_FLUSH,"string"==typeof a?c.input=i.binstring2buf(a):"[object ArrayBuffer]"===l.call(a)?c.input=new Uint8Array(a):c.input=a,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new r.Buf8(p),c.next_out=0,c.avail_out=p),(o=t.inflate(c,n.Z_NO_FLUSH))===n.Z_NEED_DICT&&m&&(o=t.inflateSetDictionary(this.strm,m)),o===n.Z_BUF_ERROR&&!0===g&&(o=n.Z_OK,g=!1),o!==n.Z_STREAM_END&&o!==n.Z_OK)return this.onEnd(o),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&o!==n.Z_STREAM_END&&(0!==c.avail_in||u!==n.Z_FINISH&&u!==n.Z_SYNC_FLUSH)||("string"===this.options.to?(h=i.utf8border(c.output,c.next_out),f=c.next_out-h,d=i.buf2string(c.output,h),c.next_out=f,c.avail_out=p-f,f&&r.arraySet(c.output,c.output,h,f,0),this.onData(d)):this.onData(r.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(g=!0)}while((c.avail_in>0||0===c.avail_out)&&o!==n.Z_STREAM_END)return o===n.Z_STREAM_END&&(u=n.Z_FINISH),u===n.Z_FINISH?(o=t.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===n.Z_OK):u!==n.Z_SYNC_FLUSH||(this.onEnd(n.Z_OK),c.avail_out=0,!0)},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){t===n.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},inflate$1.Inflate=u,inflate$1.inflate=h,inflate$1.inflateRaw=function(t,r){return(r=r||{}).raw=!0,h(t,r)},inflate$1.ungzip=h,inflate$1}function requirePako(){if(hasRequiredPako)return pako_1;hasRequiredPako=1;var t={};return(0,requireCommon().assign)(t,requireDeflate(),requireInflate(),requireConstants()),pako_1=t}!function(t){!function(){var r={};function i(){void 0!==__TURBOPACK__imported__module__47167__.default||console.log.apply(console,arguments)}t.exports=r,function(t,r){!function(){var r=function(){function t(t){this.message="JPEG error: "+t}return t.prototype=Error(),t.prototype.name="JpegError",t.constructor=t,t}();function i(t,r){return t[r]<<8|t[r+1]}t.JpegDecoder=function(){var t=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),n=4017,a=799,s=3406,o=2276,l=1567,u=3784,h=5793,f=2896;function d(t){null==t&&(t={}),null==t.w&&(t.w=-1),this.V=t.n,this.N=t.w}function c(t,r){for(var i,n,a,s=0,o=[],l=16;l>0&&!t[l-1];)l--;o.push({children:[],index:0});var u=o[0];for(i=0;i<l;i++){for(n=0;n<t[i];n++){for((u=o.pop()).children[u.index]=r[s];u.index>0;)u=o.pop();for(u.index++,o.push(u);o.length<=i;)o.push(a={children:[],index:0}),u.children[u.index]=a.children,u=a;s++}i+1<l&&(o.push(a={children:[],index:0}),u.children[u.index]=a.children,u=a)}return o[0].children}function p(t,r,i){return 64*((t.P+1)*r+i)}function m(n,a,s,o,l,u,h,f,d,c){null==c&&(c=!1);var m,g,_,y,v,w,x,k,E,S,$,I=s.m,A=s.Z,M=a,T=0,C=0,z=0,R=0,B=0,O=0;function P(){if(C>0)return C--,T>>C&1;if(255===(T=n[a++])){var t=n[a++];if(t){if(220===t&&c){var o=i(n,a+=2);if(a+=2,o>0&&o!==s.s)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",o)}else if(217===t){if(c){var l=8*B;if(l>0&&l<s.s/10)throw new DNLMarkerError("Found EOI marker (0xFFD9) while parsing scan data, possibly caused by incorrect `scanLines` parameter",l)}throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data")}throw new r("unexpected marker")}}return C=7,T>>>7}function D(t){for(var i=t;;){switch(typeof(i=i[P()])){case"number":return i;case"object":continue}throw new r("invalid huffman sequence")}}function N(t){for(var r=0;t>0;)r=r<<1|P(),t--;return r}function L(t){if(1===t)return 1===P()?1:-1;var r=N(t);return r>=1<<t-1?r:r+(-1<<t)+1}function U(t,r,i,n,a){var s=i%I;B=(i/I|0)*t.A+n;var o=s*t.h+a;r(t,p(t,B,o))}function j(t,r,i){B=i/t.P|0;var n=i%t.P;r(t,p(t,B,n))}var F=o.length;for(x=A?0===u?0===f?function(t,r){var i=D(t.J),n=0===i?0:L(i)<<d;t.D[r]=t.Q+=n}:function(t,r){t.D[r]|=P()<<d}:0===f?function(r,i){if(z>0)z--;else for(var n=u,a=h;n<=a;){var s=D(r.i),o=15&s,l=s>>4;if(0!==o){var f=t[n+=l];r.D[i+f]=L(o)*(1<<d),n++}else{if(l<15){z=N(l)+(1<<l)-1;break}n+=16}}}:function(i,n){for(var a,s,o=u,l=h,f=0;o<=l;){var c=n+t[o],p=i.D[c]<0?-1:1;switch(R){case 0:if(f=(s=D(i.i))>>4,0==(a=15&s))f<15?(z=N(f)+(1<<f),R=4):(f=16,R=1);else{if(1!==a)throw new r("invalid ACn encoding");m=L(a),R=f?2:3}continue;case 1:case 2:i.D[c]?i.D[c]+=p*(P()<<d):0==--f&&(R=3*(2===R));break;case 3:i.D[c]?i.D[c]+=p*(P()<<d):(i.D[c]=m<<d,R=0);break;case 4:i.D[c]&&(i.D[c]+=p*(P()<<d))}o++}4===R&&0==--z&&(R=0)}:function(r,i){var n=D(r.J),a=0===n?0:L(n),s=1;for(r.D[i]=r.Q+=a;s<64;){var o=D(r.i),l=15&o,u=o>>4;if(0!==l){var h=t[s+=u];r.D[i+h]=L(l),s++}else{if(u<15)break;s+=16}}},E=1===F?o[0].P*o[0].c:I*s.R;O<=E;){var G=l?Math.min(E-O,l):E;if(G>0){for(_=0;_<F;_++)o[_].Q=0;if(z=0,1===F)for(g=o[0],w=0;w<G;w++)j(g,x,O),O++;else for(w=0;w<G;w++){for(_=0;_<F;_++)for(S=(g=o[_]).h,$=g.A,y=0;y<$;y++)for(v=0;v<S;v++)U(g,x,O,y,v);O++}}if(C=0,!(k=b(n,a))||(k.u&&(a=k.offset),!(k.M>=65488&&k.M<=65495)))break;a+=2}return a-M}function g(t,i,d){var c,p,m,g,_,b,y,v,w,x,k,E,S,$,I,A,M,T=t.$,C=t.D;if(!T)throw new r("missing required Quantization Table.");for(var z=0;z<64;z+=8)w=C[i+z],x=C[i+z+1],k=C[i+z+2],E=C[i+z+3],S=C[i+z+4],$=C[i+z+5],I=C[i+z+6],A=C[i+z+7],w*=T[z],x|k|E|S|$|I|A?(x*=T[z+1],k*=T[z+2],E*=T[z+3],S*=T[z+4],$*=T[z+5],I*=T[z+6],A*=T[z+7],p=(c=(c=h*w+128>>8)+(p=h*S+128>>8)+1>>1)-p,M=(m=k)*u+(g=I)*l+128>>8,m=m*l-g*u+128>>8,y=(_=(_=f*(x-A)+128>>8)+(y=$<<4)+1>>1)-y,b=(v=(v=f*(x+A)+128>>8)+(b=E<<4)+1>>1)-b,g=(c=c+(g=M)+1>>1)-g,m=(p=p+m+1>>1)-m,M=_*o+v*s+2048>>12,_=_*s-v*o+2048>>12,v=M,M=b*a+y*n+2048>>12,b=b*n-y*a+2048>>12,y=M,d[z]=c+v,d[z+7]=c-v,d[z+1]=p+y,d[z+6]=p-y,d[z+2]=m+b,d[z+5]=m-b,d[z+3]=g+_,d[z+4]=g-_):(M=h*w+512>>10,d[z]=M,d[z+1]=M,d[z+2]=M,d[z+3]=M,d[z+4]=M,d[z+5]=M,d[z+6]=M,d[z+7]=M);for(var R=0;R<8;++R)w=d[R],(x=d[R+8])|(k=d[R+16])|(E=d[R+24])|(S=d[R+32])|($=d[R+40])|(I=d[R+48])|(A=d[R+56])?(p=(c=4112+((c=h*w+2048>>12)+(p=h*S+2048>>12)+1>>1))-p,M=(m=k)*u+(g=I)*l+2048>>12,m=m*l-g*u+2048>>12,g=M,y=(_=(_=f*(x-A)+2048>>12)+(y=$)+1>>1)-y,b=(v=(v=f*(x+A)+2048>>12)+(b=E)+1>>1)-b,M=_*o+v*s+2048>>12,_=_*s-v*o+2048>>12,v=M,M=b*a+y*n+2048>>12,b=b*n-y*a+2048>>12,(w=(c=c+g+1>>1)+v)<16?w=0:w>=4080?w=255:w>>=4,(x=(p=p+m+1>>1)+(y=M))<16?x=0:x>=4080?x=255:x>>=4,(k=(m=p-m)+b)<16?k=0:k>=4080?k=255:k>>=4,(E=(g=c-g)+_)<16?E=0:E>=4080?E=255:E>>=4,(S=g-_)<16?S=0:S>=4080?S=255:S>>=4,($=m-b)<16?$=0:$>=4080?$=255:$>>=4,(I=p-y)<16?I=0:I>=4080?I=255:I>>=4,(A=c-v)<16?A=0:A>=4080?A=255:A>>=4,C[i+R]=w,C[i+R+8]=x,C[i+R+16]=k,C[i+R+24]=E,C[i+R+32]=S,C[i+R+40]=$,C[i+R+48]=I,C[i+R+56]=A):(M=(M=h*w+8192>>14)<-2040?0:M>=2024?255:M+2056>>4,C[i+R]=M,C[i+R+8]=M,C[i+R+16]=M,C[i+R+24]=M,C[i+R+32]=M,C[i+R+40]=M,C[i+R+48]=M,C[i+R+56]=M)}function _(t,r){for(var i=r.P,n=r.c,a=new Int16Array(64),s=0;s<n;s++)for(var o=0;o<i;o++)g(r,p(r,s,o),a);return r.D}function b(t,r,n){null==n&&(n=r);var a=t.length-1,s=n<r?n:r;if(r>=a)return null;var o=i(t,r);if(o>=65472&&o<=65534)return{u:null,M:o,offset:r};for(var l=i(t,s);!(l>=65472&&l<=65534);){if(++s>=a)return null;l=i(t,s)}return{u:o.toString(16),M:l,offset:s}}return d.prototype={parse(n,a){null==a&&(a={});var s,o,l=a.F,u=0,h=null,f=null,d=0;function p(){var t=i(n,u),r=(u+=2)+t-2,a=b(n,r,u);a&&a.u&&(r=a.offset);var s=n.subarray(u,r);return u+=s.length,s}function g(t){for(var r=Math.ceil(t.o/8/t.X),i=Math.ceil(t.s/8/t.B),n=0;n<t.W.length;n++){G=t.W[n];var a=Math.ceil(Math.ceil(t.o/8)*G.h/t.X),s=Math.ceil(Math.ceil(t.s/8)*G.A/t.B),o=r*G.h,l=64*(i*G.A)*(o+1);G.D=new Int16Array(l),G.P=a,G.c=s}t.m=r,t.R=i}var y=[],v=[],w=[],x=i(n,0);if(u+=2,65496!==x)throw new r("SOI not found");x=i(n,u),u+=2;t:for(;65497!==x;){switch(x){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var k=p();65504===x&&74===k[0]&&70===k[1]&&73===k[2]&&70===k[3]&&0===k[4]&&(h={version:{d:k[5],T:k[6]},K:k[7],j:k[8]<<8|k[9],H:k[10]<<8|k[11],S:k[12],I:k[13],C:k.subarray(14,14+3*k[12]*k[13])}),65518===x&&65===k[0]&&100===k[1]&&111===k[2]&&98===k[3]&&101===k[4]&&(f={version:k[5]<<8|k[6],k:k[7]<<8|k[8],q:k[9]<<8|k[10],a:k[11]});break;case 65499:for(var E=i(n,u)+(u+=2)-2;u<E;){var S=n[u++],$=new Uint16Array(64);if(S>>4){if(S>>4!=1)throw new r("DQT - invalid table spec");for(A=0;A<64;A++)$[t[A]]=i(n,u),u+=2}else for(A=0;A<64;A++)$[t[A]]=n[u++];y[15&S]=$}break;case 65472:case 65473:case 65474:if(s)throw new r("Only single frame JPEGs supported");u+=2,(s={}).G=65473===x,s.Z=65474===x,s.precision=n[u++];var I,A,M,T,C=i(n,u),z=0,R=0;u+=2,s.s=l||C,s.o=i(n,u),u+=2,s.W=[],s._={};var B=n[u++];for(I=0;I<B;I++){T=n[u];var O=n[u+1]>>4,P=15&n[u+1];z<O&&(z=O),R<P&&(R=P);var D=n[u+2];M=s.W.push({h:O,A:P,L:D,$:null}),s._[T]=M-1,u+=3}s.X=z,s.B=R,g(s);break;case 65476:var N=i(n,u);for(u+=2,I=2;I<N;){var L=n[u++],U=new Uint8Array(16),j=0;for(A=0;A<16;A++,u++)j+=U[A]=n[u];var F=new Uint8Array(j);for(A=0;A<j;A++,u++)F[A]=n[u];I+=17+j,(L>>4?v:w)[15&L]=c(U,F)}break;case 65501:o=i(n,u+=2),u+=2;break;case 65498:var G,W=1==++d&&!l;u+=2;var q=n[u++],H=[];for(I=0;I<q;I++){var V=n[u++],Z=s._[V];(G=s.W[Z]).index=V;var K=n[u++];G.J=w[K>>4],G.i=v[15&K],H.push(G)}var Y=n[u++],X=n[u++],Q=n[u++];try{var J=m(n,u,s,H,o,Y,X,Q>>4,15&Q,W);u+=J}catch(t){if(t instanceof DNLMarkerError)return this.parse(n,{F:t.s});if(t instanceof EOIMarkerError)break t;throw t}break;case 65500:u+=4;break;case 65535:255!==n[u]&&u--;break;default:var ee=b(n,u-2,u-3);if(ee&&ee.u){u=ee.offset;break}if(u>=n.length-1)break t;throw new r("JpegImage.parse - unknown marker: "+x.toString(16))}x=i(n,u),u+=2}for(this.width=s.o,this.height=s.s,this.g=h,this.b=f,this.W=[],I=0;I<s.W.length;I++){var et=y[(G=s.W[I]).L];et&&(G.$=et),this.W.push({index:G.index,e:_(0,G),l:G.h/s.X,t:G.A/s.B,P:G.P,c:G.c})}this.p=this.W.length},Y(t,r,i){null==i&&(i=!1);var n,a,s,o,l,u,h,f,d,c,p,m,g=this.width/t,_=this.height/r,b=0,y=this.W.length,v=t*r*y,w=new Uint8ClampedArray(v),x=new Uint32Array(t),k=0xfffffff8;for(h=0;h<y;h++){if(a=(n=this.W[h]).l*g,s=n.t*_,b=h,p=n.e,o=n.P+1<<3,a!==m){for(l=0;l<t;l++)f=0|l*a,x[l]=(f&k)<<3|7&f;m=a}for(u=0;u<r;u++)for(c=o*((f=0|u*s)&k)|(7&f)<<3,l=0;l<t;l++)w[b]=p[c+x[l]],b+=y}var E=this.V;if(i||4!==y||E||(E=new Int32Array([-256,255,-256,255,-256,255,-256,255])),E)for(h=0;h<v;)for(f=0,d=0;f<y;f++,h++,d+=2)w[h]=(w[h]*E[d]>>8)+E[d+1];return w},get f(){return this.b?!!this.b.a:3===this.p?0!==this.N&&(82!==this.W[0].index||71!==this.W[1].index||66!==this.W[2].index):1===this.N},z:function(t){for(var r,i,n,a=0,s=t.length;a<s;a+=3)r=t[a],i=t[a+1],n=t[a+2],t[a]=r-179.456+1.402*n,t[a+1]=r+135.459-.344*i-.714*n,t[a+2]=r-226.816+1.772*i;return t},O:function(t){for(var r,i,n,a,s=0,o=0,l=t.length;o<l;o+=4)r=t[o],i=t[o+1],n=t[o+2],a=t[o+3],t[s++]=i*(-660635669420364e-19*i+437130475926232e-18*n-54080610064599e-18*r+48449797120281e-17*a-.154362151871126)-122.67195406894+n*(-957964378445773e-18*n+817076911346625e-18*r-.00477271405408747*a+1.53380253221734)+r*(961250184130688e-18*r-.00266257332283933*a+.48357088451265)+a*(-336197177618394e-18*a+.484791561490776),t[s++]=107.268039397724+i*(219927104525741e-19*i-640992018297945e-18*n+659397001245577e-18*r+426105652938837e-18*a-.176491792462875)+n*(-778269941513683e-18*n+.00130872261408275*r+770482631801132e-18*a-.151051492775562)+r*(.00126935368114843*r-.00265090189010898*a+.25802910206845)+a*(-318913117588328e-18*a-.213742400323665),t[s++]=i*(-570115196973677e-18*i-263409051004589e-19*n+.0020741088115012*r-.00288260236853442*a+.814272968359295)-20.810012546947+n*(-153496057440975e-19*n-132689043961446e-18*r+560833691242812e-18*a-.195152027534049)+r*(.00174418132927582*r-.00255243321439347*a+.116935020465145)+a*(-343531996510555e-18*a+.24165260232407);return t.subarray(0,s)},r:function(t){for(var r,i,n,a=0,s=t.length;a<s;a+=4)r=t[a],i=t[a+1],n=t[a+2],t[a]=434.456-r-1.402*n,t[a+1]=119.541-r+.344*i+.714*n,t[a+2]=481.816-r-1.772*i;return t},U:function(t){for(var r,i,n,a,s=0,o=0,l=t.length;o<l;o+=4)r=t[o],i=t[o+1],n=t[o+2],a=t[o+3],t[s++]=255+r*(-6747147073602441e-20*r+8379262121013727e-19*i+2894718188643294e-19*n+.003264231057537806*a-1.1185611867203937)+i*(26374107616089405e-21*i-8626949158638572e-20*n-2748769067499491e-19*a-.02155688794978967)+n*(-3878099212869363e-20*n-3267808279485286e-19*a+.0686742238595345)-a*(3361971776183937e-19*a+.7430659151342254),t[s++]=255+r*(13596372813588848e-20*r+924537132573585e-18*i+10567359618683593e-20*n+4791864687436512e-19*a-.3109689587515875)+i*(-23545346108370344e-20*i+2702845253534714e-19*n+.0020200308977307156*a-.7488052167015494)+n*(6834815998235662e-20*n+15168452363460973e-20*a-.09751927774728933)-a*(3189131175883281e-19*a+.7364883807733168),t[s++]=255+r*(13598650411385307e-21*r+12423956175490851e-20*i+4751985097583589e-19*n-36729317476630422e-22*a-.05562186980264034)+i*(16141380598724676e-20*i+9692239130725186e-19*n+7782692450036253e-19*a-.44015232367526463)+n*(5068882914068769e-22*n+.0017778369011375071*a-.7591454649749609)-a*(3435319965105553e-19*a+.7063770186160144);return t.subarray(0,s)},getData:function(t){var i=t.width,n=t.height,a=t.forceRGB,s=t.isSourcePDF;if(this.p>4)throw new r("Unsupported color mode");var o=this.Y(i,n,s);if(1===this.p&&a){for(var l=o.length,u=new Uint8ClampedArray(3*l),h=0,f=0;f<l;f++){var d=o[f];u[h++]=d,u[h++]=d,u[h++]=d}return u}if(3===this.p&&this.f)return this.z(o);if(4===this.p){if(this.f)return a?this.O(o):this.r(o);if(a)return this.U(o)}return o}},d}()}(),t.encodeImage=function(r,i,n,a){var s={t256:[i],t257:[n],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[n],t279:[i*n*4],t282:[[72,1]],t283:[[72,1]],t284:[1],t286:[[0,1]],t287:[[0,1]],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(a)for(var o in a)s[o]=a[o];var l=new Uint8Array(t.encode([s])),u=new Uint8Array(r),h=new Uint8Array(1e3+i*n*4);for(o=0;o<l.length;o++)h[o]=l[o];for(o=0;o<u.length;o++)h[1e3+o]=u[o];return h.buffer},t.encode=function(r){var i=new Uint8Array(2e4),n=4,a=t._binBE;i[0]=i[1]=77,a.writeUshort(i,2,42);var s=8;a.writeUint(i,n,s),n+=4;for(var o=0;o<r.length;o++){var l=t._writeIFD(a,t._types.basic,i,s,r[o]);s=l[1],o<r.length-1&&(3&s&&(s+=4-(3&s)),a.writeUint(i,l[0],s))}return i.slice(0,s).buffer},t.decode=function(r,n){null==n&&(n={parseMN:!0,debug:!1});var a=new Uint8Array(r),s=0,o=t._binBE.readASCII(a,s,2);s+=2;var l="II"==o?t._binLE:t._binBE;l.readUshort(a,s),s+=2;var u=l.readUint(a,s);s+=4;for(var h=[];;){var f=l.readUshort(a,u),d=l.readUshort(a,u+4);if(0!=f&&(d<1||13<d)){i("error in TIFF");break}if(t._readIFD(l,a,u,h,0,n),0==(u=l.readUint(a,u+2+12*f)))break}return h},t.decodeImage=function(r,n,a){if(!n.data){var s=new Uint8Array(r),o=t._binBE.readASCII(s,0,2);if(null!=n.t256){n.isLE="II"==o,n.width=n.t256[0],n.height=n.t257[0];var l=n.t259?n.t259[0]:1,u=n.t266?n.t266[0]:1;n.t284&&2==n.t284[0]&&i("PlanarConfiguration 2 should not be used!"),7==l&&n.t258&&n.t258.length>3&&(n.t258=n.t258.slice(0,3));var h=n.t277?n.t277[0]:1,f=(n.t258?n.t258[0]:1)*h;1==l&&null!=n.t279&&n.t278&&32803==n.t262[0]&&(f=Math.round(8*n.t279[0]/(n.width*n.t278[0]))),n.t50885&&4==n.t50885[0]&&(f=3*n.t258[0]);var d=8*Math.ceil(n.width*f/8),c=n.t273;(null==c||n.t322)&&(c=n.t324);var p=n.t279;1==l&&1==c.length&&(p=[n.height*(d>>>3)]),(null==p||n.t322)&&(p=n.t325);var m=new Uint8Array(n.height*(d>>>3)),g=0;if(null!=n.t322){var _=n.t322[0],b=n.t323[0],y=Math.floor((n.width+_-1)/_),v=Math.floor((n.height+b-1)/b),w=new Uint8Array(0|Math.ceil(_*b*f/8));console.log("====",y,v);for(var x=0;x<v;x++)for(var k=0;k<y;k++){var E=x*y+k;w.fill(0),t.decode._decompress(n,a,s,c[E],p[E],l,w,0,u,_,b),6==l?m=w:t._copyTile(w,0|Math.ceil(_*f/8),b,m,0|Math.ceil(n.width*f/8),n.height,0|Math.ceil(k*_*f/8),x*b)}g=8*m.length}else{if(null==c)return;var S=n.t278?n.t278[0]:n.height;for(E=0,S=Math.min(S,n.height);E<c.length;E++)t.decode._decompress(n,a,s,c[E],p[E],l,m,0|Math.ceil(g/8),u,n.width,S),g+=d*S;g=Math.min(g,8*m.length)}n.data=new Uint8Array(m.buffer,0,0|Math.ceil(g/8))}}},t.decode._decompress=function(n,a,s,o,l,u,h,f,d,c,p){if(n.t271&&"Panasonic"==n.t271[0]&&n.t45&&6==n.t45[0]&&(u=34316),1==u)for(var m=0;m<l;m++)h[f+m]=s[o+m];else if(2==u)t.decode._decodeG2(s,o,l,h,f,c,d);else if(3==u)t.decode._decodeG3(s,o,l,h,f,c,d,!!n.t292&&!(1&~n.t292[0]));else if(4==u)t.decode._decodeG4(s,o,l,h,f,c,d);else if(5==u)t.decode._decodeLZW(s,o,l,h,f,8);else if(6==u)t.decode._decodeOldJPEG(n,s,o,l,h,f);else if(7==u||34892==u)t.decode._decodeNewJPEG(n,s,o,l,h,f);else if(8==u||32946==u){var g=new Uint8Array(s.buffer,o+2,l-6),_=r.inflateRaw(g);f+_.length<=h.length&&h.set(_,f)}else 9==u?t.decode._decodeVC5(s,o,l,h,f,n.t33422):32767==u?t.decode._decodeARW(n,s,o,l,h,f):32773==u?t.decode._decodePackBits(s,o,l,h,f):32809==u?t.decode._decodeThunder(s,o,l,h,f):34316==u?t.decode._decodePanasonic(n,s,o,l,h,f):34713==u?t.decode._decodeNikon(n,a,s,o,l,h,f):34676==u?t.decode._decodeLogLuv32(n,s,o,l,h,f):i("Unknown compression",u);var b=n.t258?Math.min(32,n.t258[0]):1,y=n.t277?n.t277[0]:1,v=b*y>>>3,w=Math.ceil(b*y*c/8);if(16==b&&!n.isLE&&null==n.t33422)for(var x=0;x<p;x++)for(var k=f+x*w,E=1;E<w;E+=2){var S=h[k+E];h[k+E]=h[k+E-1],h[k+E-1]=S}if(n.t317&&2==n.t317[0])for(x=0;x<p;x++){var $=f+x*w;if(16==b)for(m=v;m<w;m+=2){var I=(h[$+m+1]<<8|h[$+m])+(h[$+m-v+1]<<8|h[$+m-v]);h[$+m]=255&I,h[$+m+1]=I>>>8&255}else if(3==y)for(m=3;m<w;m+=3)h[$+m]=h[$+m]+h[$+m-3]&255,h[$+m+1]=h[$+m+1]+h[$+m-2]&255,h[$+m+2]=h[$+m+2]+h[$+m-1]&255;else for(m=v;m<w;m++)h[$+m]=h[$+m]+h[$+m-v]&255}},t.decode._decodePanasonic=function(t,r,i,n,a,s){var o,l,u,h,f,d,c,p,m=r.buffer,g=t.t2[0],_=t.t3[0],b=t.t10[0],y=t.t45[0],v=0,w=0,x=0,k=0,E=6==y?new Uint32Array(18):new Uint8Array(16),S=[0,0],$=[0,0],I=0,A=new Uint8Array(16384),M=new Uint16Array(a.buffer);function T(t){if(0==x){var r=new Uint8Array(m,i+w+8184,8200),n=new Uint8Array(m,i+w,8184);A.set(r),A.set(n,r.length),w+=16384}if(5!=y)return(A[k=(x=x-t&131071)>>3^16368]|A[k+1]<<8)>>(7&x)&~(-1<<t);for(o=0;o<16;o++)E[o]=A[x++],x&=16383}function C(t){return A[x+15-t]}function z(){S[0]=0,S[1]=0,$[0]=0,$[1]=0}if(7==y)throw y;if(6==y){var R=12==b,B=R?function(){E[0]=C(0)<<4|C(1)>>4,E[1]=4095&((15&C(1))<<8|C(2)),E[2]=C(3)>>6&3,E[3]=(63&C(3))<<2|C(4)>>6,E[4]=(63&C(4))<<2|C(5)>>6,E[5]=(63&C(5))<<2|C(6)>>6,E[6]=C(6)>>4&3,E[7]=(15&C(6))<<4|C(7)>>4,E[8]=(15&C(7))<<4|C(8)>>4,E[9]=(15&C(8))<<4|C(9)>>4,E[10]=C(9)>>2&3,E[11]=(3&C(9))<<6|C(10)>>2,E[12]=(3&C(10))<<6|C(11)>>2,E[13]=(3&C(11))<<6|C(12)>>2,E[14]=3&C(12),E[15]=C(13),E[16]=C(14),E[17]=C(15),x+=16,k=0}:function(){E[0]=C(0)<<6|C(1)>>2,E[1]=16383&((3&C(1))<<12|C(2)<<4|C(3)>>4),E[2]=C(3)>>2&3,E[3]=(3&C(3))<<8|C(4),E[4]=C(5)<<2|C(6)>>6,E[5]=(63&C(6))<<4|C(7)>>4,E[6]=C(7)>>2&3,E[7]=(3&C(7))<<8|C(8),E[8]=C(9)<<2&1020|C(10)>>6,E[9]=1023&(C(10)<<4|C(11)>>4),E[10]=C(11)>>2&3,E[11]=(3&C(11))<<8|C(12),E[12]=1023&(C(13)<<2&1020|C(14)>>6),E[13]=1023&(C(14)<<4|C(15)>>4),x+=16,k=0},O=R?14:11,P=R?128:512,D=R?2048:8192,N=R?16383:65535,L=R?4095:16383,U=g/O,j=16*U,F=R?18:14;for(d=0;d<_-15;d+=16){var G=Math.min(16,_-d),W=j*G;for(A=new Uint8Array(m,i+v,W),x=0,v+=W,p=0,c=0;p<G;p++,c=0){I=(d+p)*g;for(var q=0;q<U;q++)for(B(),z(),u=0,f=0,o=0;o<O;o++){if(h=1&o,o%3==2){var H=k<F?E[k++]:0;3==H&&(H=4),f=P<<H,u=1<<H}var V=k<F?E[k++]:0;S[h]?(V*=u,f<D&&$[h]>f&&(V+=$[h]-f),$[h]=V):(S[h]=V,V?$[h]=V:V=$[h]),M[I+c++]=V-15<=N?V-15&N:V+0x7ffffff1>>31&L}}}}else if(5==y){var Z=12==b?10:9;for(d=0;d<_;d++)for(c=0;c<g;c+=Z)T(0),12==b?(M[I++]=((15&E[1])<<8)+E[0],M[I++]=16*E[2]+(E[1]>>4),M[I++]=((15&E[4])<<8)+E[3],M[I++]=16*E[5]+(E[4]>>4),M[I++]=((15&E[7])<<8)+E[6],M[I++]=16*E[8]+(E[7]>>4),M[I++]=((15&E[10])<<8)+E[9],M[I++]=16*E[11]+(E[10]>>4),M[I++]=((15&E[13])<<8)+E[12],M[I++]=16*E[14]+(E[13]>>4)):14==b&&(M[I++]=E[0]+((63&E[1])<<8),M[I++]=(E[1]>>6)+4*E[2]+((15&E[3])<<10),M[I++]=(E[3]>>4)+16*E[4]+((3&E[5])<<12),M[I++]=((252&E[5])>>2)+(E[6]<<6),M[I++]=E[7]+((63&E[8])<<8),M[I++]=(E[8]>>6)+4*E[9]+((15&E[10])<<10),M[I++]=(E[10]>>4)+16*E[11]+((3&E[12])<<12),M[I++]=((252&E[12])>>2)+(E[13]<<6),M[I++]=E[14]+((63&E[15])<<8))}else{if(4!=y)throw y;for(d=0;d<_;d++)for(c=0;c<g;c++)h=1&(o=c%14),0==o&&z(),o%3==2&&(u=4>>3-T(2)),$[h]?0!=(l=T(8))&&(S[h]-=128<<u,(S[h]<0||4==u)&&(S[h]&=~(-1<<u)),S[h]+=l<<u):($[h]=T(8),($[h]||o>11)&&(S[h]=$[h]<<4|T(4))),M[I++]=S[1&c]}},t.decode._decodeVC5=function(){var r,i,n,a=[1,0,1,0,2,2,1,1,3,7,1,2,5,25,1,3,6,48,1,4,6,54,1,5,7,111,1,8,7,99,1,6,7,105,12,0,7,107,1,7,8,209,20,0,8,212,1,9,8,220,1,10,9,393,1,11,9,394,32,0,9,416,1,12,9,427,1,13,10,887,1,18,10,784,1,14,10,790,1,15,10,835,60,0,10,852,1,16,10,885,1,17,11,1571,1,19,11,1668,1,20,11,1669,100,0,11,1707,1,21,11,1772,1,22,12,3547,1,29,12,3164,1,24,12,3166,1,25,12,3140,1,23,12,3413,1,26,12,3537,1,27,12,3539,1,28,13,7093,1,35,13,6283,1,30,13,6331,1,31,13,6335,180,0,13,6824,1,32,13,7072,1,33,13,7077,320,0,13,7076,1,34,14,12565,1,36,14,12661,1,37,14,12669,1,38,14,13651,1,39,14,14184,1,40,15,28295,1,46,15,28371,1,47,15,25320,1,42,15,25336,1,43,15,25128,1,41,15,27300,1,44,15,28293,1,45,16,50259,1,48,16,50643,1,49,16,50675,1,50,16,56740,1,53,16,56584,1,51,16,56588,1,52,17,113483,1,61,17,113482,1,60,17,101285,1,55,17,101349,1,56,17,109205,1,57,17,109207,1,58,17,100516,1,54,17,113171,1,59,18,202568,1,62,18,202696,1,63,18,218408,1,64,18,218412,1,65,18,226340,1,66,18,226356,1,67,18,226358,1,68,19,402068,1,69,19,405138,1,70,19,405394,1,71,19,436818,1,72,19,436826,1,73,19,452714,1,75,19,452718,1,76,19,452682,1,74,20,804138,1,77,20,810279,1,78,20,810790,1,79,20,873638,1,80,20,873654,1,81,20,905366,1,82,20,905430,1,83,20,905438,1,84,21,1608278,1,85,21,1620557,1,86,21,1621582,1,87,21,1621583,1,88,21,1747310,1,89,21,1810734,1,90,21,1810735,1,91,21,1810863,1,92,21,1810879,1,93,22,3621725,1,99,22,3621757,1,100,22,3241112,1,94,22,3494556,1,95,22,3494557,1,96,22,3494622,1,97,22,3494623,1,98,23,6482227,1,102,23,6433117,1,101,23,6989117,1,103,23,6989119,1,105,23,6989118,1,104,23,7243449,1,106,23,7243512,1,107,24,0xd54a79,1,111,24,0xc5d265,1,109,24,0xc452b8,1,108,24,0xdd0d71,1,113,24,0xd54a78,1,110,24,0xdd0d70,1,112,24,0xdd0df2,1,114,24,0xdd0df3,1,115,25,0x188a5f6,1,225,25,0x188a5f5,1,189,25,0x188a5f4,1,188,25,0x188a5f3,1,203,25,0x188a5f2,1,202,25,0x188a5f1,1,197,25,0x188a5f0,1,207,25,0x188a5ef,1,169,25,0x188a5ee,1,223,25,0x188a5ed,1,159,25,0x188a5aa,1,235,25,0x188a5e3,1,152,25,0x188a5df,1,192,25,0x188a589,1,179,25,0x188a5dd,1,201,25,0x188a578,1,172,25,0x188a5e0,1,149,25,0x188a588,1,178,25,0x188a5d6,1,120,25,0x188a5db,1,219,25,0x188a5e1,1,150,25,0x188a587,1,127,25,0x188a59a,1,211,25,0x188a5c4,1,125,25,0x188a5ec,1,158,25,0x188a586,1,247,25,0x188a573,1,238,25,0x188a59c,1,163,25,0x188a5c8,1,228,25,0x188a5fb,1,183,25,0x188a5a1,1,217,25,0x188a5eb,1,168,25,0x188a5a8,1,122,25,0x188a584,1,128,25,0x188a5d2,1,249,25,0x188a599,1,187,25,0x188a598,1,186,25,0x188a583,1,136,25,0x18ba4c9,1,181,25,0x188a5d0,1,255,25,0x188a594,1,230,25,0x188a582,1,135,25,0x188a5cb,1,233,25,0x188a5d8,1,222,25,0x188a5e7,1,145,25,0x188a581,1,134,25,0x188a5ea,1,167,25,0x188a5a9,1,248,25,0x188a5a6,1,209,25,0x188a580,1,243,25,0x188a5a0,1,216,25,0x188a59d,1,164,25,0x188a5c3,1,140,25,0x188a57f,1,157,25,0x188a5c0,1,239,25,0x188a5de,1,191,25,0x188a5d4,1,251,25,0x188a57e,1,156,25,0x188a5c2,1,139,25,0x188a592,1,242,25,0x188a5cd,1,133,25,0x188a57d,1,162,25,0x188a5a3,1,213,25,0x188a5e8,1,165,25,0x188a5a2,1,212,25,0x188a57c,1,227,25,0x188a58e,1,198,25,0x188a5b3,1,236,25,0x188a5b2,1,234,25,0x188a5b1,1,117,25,0x188a5b0,1,215,25,0x188a5af,1,124,25,0x188a5ae,1,123,25,0x188a5ad,1,254,25,0x188a5ac,1,253,25,0x188a5ab,1,148,25,0x188a5da,1,218,25,0x188a5e4,1,146,25,0x188a5e5,1,147,25,0x188a5d9,1,224,25,0x188a5b5,1,143,25,0x188a5bc,1,184,25,0x188a5bd,1,185,25,0x188a5e9,1,166,25,0x188a5cc,1,132,25,0x188a585,1,129,25,0x188a5d3,1,250,25,0x188a5e2,1,151,25,0x188a595,1,119,25,0x188a596,1,193,25,0x188a5b8,1,176,25,0x188a590,1,245,25,0x188a5c9,1,229,25,0x188a5a4,1,206,25,0x188a5e6,1,144,25,0x188a5a5,1,208,25,0x188a5ce,1,137,25,0x188a5bf,1,241,25,0x188a572,1,237,25,0x188a59b,1,190,25,0x188a5be,1,240,25,0x188a5c7,1,131,25,0x188a5ca,1,232,25,0x188a5d5,1,252,25,0x188a57b,1,171,25,0x188a58d,1,205,25,0x188a58c,1,204,25,0x188a58b,1,118,25,0x188a58a,1,214,25,0x18ba4c8,1,180,25,0x188a5c5,1,126,25,0x188a5fa,1,182,25,0x188a5bb,1,175,25,0x188a5c1,1,141,25,0x188a5cf,1,138,25,0x188a5b9,1,177,25,0x188a5b6,1,153,25,0x188a597,1,194,25,0x188a5fe,1,160,25,0x188a5d7,1,121,25,0x188a5ba,1,174,25,0x188a591,1,246,25,0x188a5c6,1,130,25,0x188a5dc,1,200,25,0x188a57a,1,170,25,0x188a59f,1,221,25,0x188a5f9,1,196,25,0x188a5b4,1,142,25,0x188a5a7,1,210,25,0x188a58f,1,199,25,0x188a5fd,1,155,25,0x188a5b7,1,154,25,0x188a593,1,244,25,0x188a59e,1,220,25,0x188a5f8,1,195,25,0x188a5ff,1,161,25,0x188a5fc,1,231,25,0x188a579,1,173,25,0x188a5f7,1,226,26,0x3114ba2,1,116,26,0x3114ba3,0,1],s=[3,3,3,3,2,2,2,1,1,1];function o(t){var r=t[1],i=t[0][r>>>3]>>>7-(7&r)&1;return t[1]++,i}function l(t,i){if(null==r){r={};for(var n=0;n<a.length;n+=4)r[a[n+1]]=a.slice(n,n+4)}for(var s=o(t),l=r[s];null==l;)l=r[s=s<<1|o(t)];var u=l[3];0!=u&&(u=0==o(t)?u:-u),i[0]=l[2],i[1]=u}function u(t,r){for(var i=0;i<r;i++)1&~t||t++,t>>>=1;return t}function h(t,r){return t>>r}function f(t,r,i,n,a,s){r[i]=h(h(11*t[a]-4*t[a+s]+t[a+s+s]+4,3)+t[n],1),r[i+s]=h(h(5*t[a]+4*t[a+s]-t[a+s+s]+4,3)-t[n],1)}function d(t,r,i,n,a,s){var o=t[a-s]-t[a+s],l=t[a],u=t[n];r[i]=h(h(o+4,3)+l+u,1),r[i+s]=h(h(4-o,3)+l-u,1)}function c(t,r,i,n,a,s){r[i]=h(h(5*t[a]+4*t[a-s]-t[a-s-s]+4,3)+t[n],1),r[i+s]=h(h(11*t[a]-4*t[a-s]+t[a-s-s]+4,3)-t[n],1)}function p(t){return n[t=t<0?0:t>4095?4095:t]>>>2}return function(r,a,o,h,m,g){h=new Uint16Array(h.buffer);var _,b,y,v,w,x,k,E,S=Date.now(),$=t._binBE,I=a+o;a+=4;for(var A=1==g[0];a<I;){var M=$.readShort(r,a),T=$.readUshort(r,a+2);if(a+=4,12==M)D=T;else if(20==M)_=T;else if(21==M)b=T;else if(48==M)y=T;else if(53==M)v=T;else if(35==M);else if(62==M)w=T;else if(101==M);else if(109==M)x=T;else if(84==M);else if(106==M);else if(107==M);else if(108==M);else if(102==M);else if(104==M)ei=T;else if(105==M);else{var C=M<0?-M:M,z=65280&C,R=0;if(24576&C&&(R=8192&C?(65535&T)+((255&C)<<16):65535&T),24576&~C){if(16388==C)a+=4*R;else if(8192!=z&&8448!=z&&9216!=z)throw C.toString(16)}else{if(null==k){k=[];for(var B=0;B<4;B++)k[B]=new Int16Array((_>>>1)*(b>>>1));for(E=new Int16Array((_>>>1)*(b>>>1)),i=new Int16Array(1024),B=0;B<1024;B++){var O=B-512,P=Math.abs(O),D=Math.floor(768*P*P*P/0xfd02ff)+P;i[B]=Math.sign(O)*D}for(B=0,n=new Uint16Array(4096);B<4096;B++){var N=65535*(Math.pow(113,B/4095)-1)/112;n[B]=Math.min(N,65535)}}var L=k[w],U=u(_,1+s[y]),j=u(b,1+s[y]);if(0==y)for(var F=0;F<j;F++)for(var G=0;G<U;G++){var W=a+2*(F*U+G);L[F*(_>>>1)+G]=r[W]<<8|r[W+1]}else{var q=[r,8*a],H=[],V=0,Z=U*j,K=[0,0],Y=0;for(T=0;V<Z;)for(l(q,K),Y=K[0],T=K[1];Y>0;)H[V++]=T,Y--;var X=(y-1)%3,Q=1!=X?U:0,J=0!=X?j:0;for(F=0;F<j;F++){var ee=(F+J)*(_>>>1)+Q,et=F*U;for(G=0;G<U;G++)L[ee+G]=i[H[et+G]+512]*v}if(2==X){var er,ei=_>>>1,en=2*U,ea=2*j;for(F=0;F<j;F++)for(G=0;G<en;G++){B=2*F*ei+G;var es=j*ei+(er=F*ei+G);0==F?f(L,E,B,es,er,ei):F==j-1?c(L,E,B,es,er,ei):d(L,E,B,es,er,ei)}var eo=L;for(L=E,E=eo,F=0;F<ea;F++)for(G=0;G<U;G++)B=F*ei+2*G,es=U+(er=F*ei+G),0==G?f(L,E,B,es,er,1):G==U-1?c(L,E,B,es,er,1):d(L,E,B,es,er,1);eo=L,L=E,E=eo;for(var el=[],eu=2-~~((y-1)/3),eh=0;eh<3;eh++)el[eh]=x>>14-2*eh&3;var ef=el[eu];if(0!=ef)for(F=0;F<ea;F++)for(G=0;G<en;G++)L[B=F*ei+G]=L[B]<<ef}}if(9==y&&3==w){var ed=k[0],ec=k[1],ep=k[2],em=k[3];for(F=0;F<b;F+=2)for(G=0;G<_;G+=2){var eg=F*_+G,e_=ed[W=(F>>>1)*(_>>>1)+(G>>>1)],eb=ec[W]-2048,ey=ep[W]-2048,ev=em[W]-2048,ew=(eb<<1)+e_,ex=(ey<<1)+e_,ek=e_+ev,eE=e_-ev;A?(h[eg]=p(ek),h[eg+1]=p(ex),h[eg+_]=p(ew),h[eg+_+1]=p(eE)):(h[eg]=p(ew),h[eg+1]=p(ek),h[eg+_]=p(eE),h[eg+_+1]=p(ex))}}a+=4*R}}}console.log(Date.now()-S)}}(),t.decode._decodeLogLuv32=function(t,r,i,n,a,s){for(var o=t.width,l=4*o,u=0,h=new Uint8Array(l);u<n;){for(var f=0;f<l;){var d=r[i+u];if(u++,d<128){for(var c=0;c<d;c++)h[f+c]=r[i+u+c];f+=d,u+=d}else{for(d-=126,c=0;c<d;c++)h[f+c]=r[i+u];f+=d,u++}}for(var p=0;p<o;p++)a[s+0]=h[p],a[s+1]=h[p+o],a[s+2]=h[p+2*o],a[s+4]=h[p+3*o],s+=6}},t.decode._ljpeg_diff=function(r,i,n){var a,s,o=t.decode._getbithuff;return a=o(r,i,n[0],n),(s=o(r,i,a,0))&1<<a-1||(s-=(1<<a)-1),s},t.decode._decodeARW=function(r,i,n,a,s,o){var l=r.t256[0],u=r.t257[0],h=r.t258[0],f=r.isLE?t._binLE:t._binBE;if(l*u==a||l*u*1.5==a)if(l*u*1.5!=a){var d,c,p,m,g,_,b,y,v=new Uint16Array(16),w=new Uint8Array(l+1);for(M=0;M<u;M++){for(var x=0;x<l;x++)w[x]=i[n++];for(y=0,A=0;A<l-30;y+=16){for(c=2047&(d=f.readUint(w,y)),p=2047&d>>>11,m=15&d>>>22,g=15&d>>>26,_=0;_<4&&128<<_<=c-p;_++);for(b=30,k=0;k<16;k++)k==m?v[k]=c:k==g?v[k]=p:(v[k]=((f.readUshort(w,y+(b>>3))>>>(7&b)&127)<<_)+p,v[k]>2047&&(v[k]=2047),b+=7);for(k=0;k<16;k++,A+=2)D=v[k]<<1,t.decode._putsF(s,(M*l+A)*h,D<<16-h);A-=1&A?1:31}}}else for(var k=0;k<a;k+=3){var E=i[n+k+0],S=i[n+k+1],$=i[n+k+2];s[o+k]=S<<4|E>>>4,s[o+k+1]=E<<4|$>>>4,s[o+k+2]=$<<4|S>>>4}else{u+=8;var I,A,M,T=[n,0,0,0],C=new Uint16Array(32770),z=[3857,3856,3599,3342,3085,2828,2571,2314,2057,1800,1543,1286,1029,772,771,768,514,513],R=0,B=t.decode._ljpeg_diff;for(C[0]=15,I=k=0;k<18;k++)for(var O=32768>>>(z[k]>>>8),P=0;P<O;P++)C[++I]=z[k];for(A=l;A--;)for(M=0;M<u+1;M+=2)if(M==u&&(M=1),R+=B(i,T,C),M<u){var D=4095&R;t.decode._putsF(s,(M*l+A)*h,D<<16-h)}}},t.decode._decodeNikon=function(r,i,n,a,s,o,l){var u=[[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,5,4,3,6,2,7,1,0,8,9,11,10,12],[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,57,90,56,39,22,5,4,3,2,1,0,11,12,12],[0,0,1,4,2,3,1,2,0,0,0,0,0,0,0,0,0,5,4,6,3,7,2,8,1,9,0,10,11,12],[0,0,1,4,3,1,1,1,1,1,2,0,0,0,0,0,0,5,6,4,7,8,3,9,2,1,0,10,11,12,13,14],[0,0,1,5,1,1,1,1,1,1,1,2,0,0,0,0,0,8,92,75,58,41,7,6,5,4,3,2,1,0,13,14],[0,0,1,4,2,2,3,1,2,0,0,0,0,0,0,0,0,7,6,8,5,9,4,10,3,11,12,2,0,1,13,14]],h=r.t256[0],f=r.t257[0],d=r.t258[0],c=0,p=0,m=t.decode._make_decoder,g=t.decode._getbithuff,_=i[0].exifIFD.makerNote,b=_.t150?_.t150:_.t140,y=0,v=b[y++],w=b[y++];73!=v&&88!=w||(y+=2110),70==v&&(c=2),14==d&&(c+=3);for(var x=[[0,0],[0,0]],k=r.isLE?t._binLE:t._binBE,E=0;E<2;E++)for(var S=0;S<2;S++)x[E][S]=k.readShort(b,y),y+=2;var $,I,A,M,T,C=1<<d&32767,z=0,R=k.readShort(b,y);y+=2,R>1&&(z=Math.floor(C/(R-1))),68==v&&32==w&&z>0&&(p=k.readShort(b,562));var B=[0,0],O=m(u[c]),P=[a,0,0,0];for($=0;$<f;$++)for(p&&$==p&&(O=m(u[c+1])),I=0;I<h;I++){E=g(n,P,O[0],O),(T=1+(g(n,P,(A=15&E)-(M=E>>>4),0)<<1)<<M>>>1)&1<<A-1||(T-=(1<<A)-(0==M)),I<2?B[I]=x[1&$][I]+=T:B[1&I]+=T;var D=Math.min(Math.max(B[1&I],0),(1<<d)-1),N=($*h+I)*d;t.decode._putsF(o,N,D<<16-d)}},t.decode._putsF=function(t,r,i){i<<=8-(7&r);var n=r>>>3;t[n]|=i>>>16,t[n+1]|=i>>>8,t[n+2]|=i},t.decode._getbithuff=function(r,i,n,a){t.decode._get_byte;var s,o=i[0],l=i[1],u=i[2],h=i[3];if(0==n||u<0)return 0;for(;!h&&u<n&&-1!=(s=r[o++])&&(h=0,1);)l=(l<<8)+s,u+=8;if(s=l<<32-u>>>32-n,a?(u-=a[s+1]>>>8,s=255&a[s+1]):u-=n,u<0)throw"e";return i[0]=o,i[1]=l,i[2]=u,i[3]=h,s},t.decode._make_decoder=function(t){var r,i,n,a,s,o=[];for(r=16;0!=r&&!t[r];r--);var l=17;for(o[0]=r,n=i=1;i<=r;i++)for(a=0;a<t[i];a++,++l)for(s=0;s<1<<r-i;s++)n<=1<<r&&(o[n++]=i<<8|t[l]);return o},t.decode._decodeNewJPEG=function(r,i,n,a,s,o){a=Math.min(a,i.length-n);var l=r.t347,u=l?l.length:0,h=new Uint8Array(u+a);if(l){for(var f=0,d=0;d<u-1&&(255!=l[d]||217!=l[d+1]);d++)h[f++]=l[d];var c=i[n],p=i[n+1];for(255==c&&216==p||(h[f++]=c,h[f++]=p),d=2;d<a;d++)h[f++]=i[n+d]}else for(d=0;d<a;d++)h[d]=i[n+d];if(32803==r.t262[0]||7==r.t259[0]&&34892==r.t262[0]){var m=r.t258[0],g=t.LosslessJpegDecode(h),_=g.length;if(16==m)if(r.isLE)for(d=0;d<_;d++)s[o+(d<<1)]=255&g[d],s[o+(d<<1)+1]=g[d]>>>8;else for(d=0;d<_;d++)s[o+(d<<1)]=g[d]>>>8,s[o+(d<<1)+1]=255&g[d];else if(14==m||12==m||10==m){var b=16-m;for(d=0;d<_;d++)t.decode._putsF(s,d*m,g[d]<<b)}else{if(8!=m)throw Error("unsupported bit depth "+m);for(d=0;d<_;d++)s[o+d]=g[d]}}else{var y=new t.JpegDecoder;y.parse(h);var v=y.getData({width:y.width,height:y.height,forceRGB:!0,isSourcePDF:!1});for(d=0;d<v.length;d++)s[o+d]=v[d]}6==r.t262[0]&&(r.t262[0]=2)},t.decode._decodeOldJPEGInit=function(t,r,n,a){var s,o,l,u,h,f=216,d=0,c=0,p=!1,m=t.t513,g=m?m[0]:0,_=t.t514,b=_?_[0]:0,y=t.t324||t.t273||m,v=t.t530,w=0,x=0,k=t.t277?t.t277[0]:1,E=t.t515;if(y&&(c=y[0],p=y.length>1),!p){if(255==r[n]&&r[n+1]==f)return{jpegOffset:n};if(null!=m&&(255==r[n+g]&&r[n+g+1]==f?d=n+g:i("JPEGInterchangeFormat does not point to SOI"),null==_?i("JPEGInterchangeFormatLength field is missing"):(g>=c||g+b<=c)&&i("JPEGInterchangeFormatLength field value is invalid"),null!=d))return{jpegOffset:d}}if(null!=v&&(w=v[0],x=v[1]),null!=m&&null!=_)if(b>=2&&g+b<=c){for(s=new Uint8Array(255==r[n+g+b-2]&&r[n+g+b-1]==f?b-2:b),l=0;l<s.length;l++)s[l]=r[n+g+l];i("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else i("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(null==s){var S=0,$=[];$[S++]=255,$[S++]=f;var I=t.t519;if(null==I)throw Error("JPEGQTables tag is missing");for(l=0;l<I.length;l++)for($[S++]=255,$[S++]=219,$[S++]=0,$[S++]=67,$[S++]=l,u=0;u<64;u++)$[S++]=r[n+I[l]+u];for(h=0;h<2;h++){var A=t[0==h?"t520":"t521"];if(null==A)throw Error((0==h?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(l=0;l<A.length;l++){$[S++]=255,$[S++]=196;var M=19;for(u=0;u<16;u++)M+=r[n+A[l]+u];for($[S++]=M>>>8,$[S++]=255&M,$[S++]=l|h<<4,u=0;u<16;u++)$[S++]=r[n+A[l]+u];for(u=0;u<M;u++)$[S++]=r[n+A[l]+16+u]}}if($[S++]=255,$[S++]=192,$[S++]=0,$[S++]=8+3*k,$[S++]=8,$[S++]=t.height>>>8&255,$[S++]=255&t.height,$[S++]=t.width>>>8&255,$[S++]=255&t.width,$[S++]=k,1==k)$[S++]=1,$[S++]=17,$[S++]=0;else for(l=0;l<3;l++)$[S++]=l+1,$[S++]=0!=l?17:(15&w)<<4|15&x,$[S++]=l;null!=E&&0!=E[0]&&($[S++]=255,$[S++]=221,$[S++]=0,$[S++]=4,$[S++]=E[0]>>>8&255,$[S++]=255&E[0]),s=new Uint8Array($)}var T=-1;for(l=0;l<s.length-1;){if(255==s[l]&&192==s[l+1]){T=l;break}l++}if(-1==T){var C=new Uint8Array(s.length+10+3*k);C.set(s);var z=s.length;if(T=s.length,(s=C)[z++]=255,s[z++]=192,s[z++]=0,s[z++]=8+3*k,s[z++]=8,s[z++]=t.height>>>8&255,s[z++]=255&t.height,s[z++]=t.width>>>8&255,s[z++]=255&t.width,s[z++]=k,1==k)s[z++]=1,s[z++]=17,s[z++]=0;else for(l=0;l<3;l++)s[z++]=l+1,s[z++]=0!=l?17:(15&w)<<4|15&x,s[z++]=l}if(255==r[c]&&218==r[c+1]){var R=r[c+2]<<8|r[c+3];for((o=new Uint8Array(R+2))[0]=r[c],o[1]=r[c+1],o[2]=r[c+2],o[3]=r[c+3],l=0;l<R-2;l++)o[l+4]=r[c+l+4]}else{var B=0;if((o=new Uint8Array(8+2*k))[B++]=255,o[B++]=218,o[B++]=0,o[B++]=6+2*k,o[B++]=k,1==k)o[B++]=1,o[B++]=0;else for(l=0;l<3;l++)o[B++]=l+1,o[B++]=l<<4|l;o[B++]=0,o[B++]=63,o[B++]=0}return{jpegOffset:n,tables:s,sosMarker:o,sofPosition:T}},t.decode._decodeOldJPEG=function(r,i,n,a,s,o){var l,u,h,f,d=t.decode._decodeOldJPEGInit(r,i,n,a);if(null!=d.jpegOffset)for(h=new Uint8Array(l=n+a-d.jpegOffset),m=0;m<l;m++)h[m]=i[d.jpegOffset+m];else{for((h=new Uint8Array((u=d.tables.length)+d.sosMarker.length+a+2)).set(d.tables),f=u,h[d.sofPosition+5]=r.height>>>8&255,h[d.sofPosition+6]=255&r.height,h[d.sofPosition+7]=r.width>>>8&255,h[d.sofPosition+8]=255&r.width,255==i[n]&&i[n+1]==SOS||(h.set(d.sosMarker,f),f+=sosMarker.length),m=0;m<a;m++)h[f++]=i[n+m];h[f++]=255,h[f++]=EOI}var c=new t.JpegDecoder;c.parse(h);for(var p=c.getData({width:c.width,height:c.height,forceRGB:!0,isSourcePDF:!1}),m=0;m<p.length;m++)s[o+m]=p[m];r.t262&&6==r.t262[0]&&(r.t262[0]=2)},t.decode._decodePackBits=function(t,r,i,n,a){for(var s=new Int8Array(t.buffer),o=new Int8Array(n.buffer),l=r+i;r<l;){var u=s[r];if(r++,u>=0&&u<128)for(var h=0;h<u+1;h++)o[a]=s[r],a++,r++;if(u>=-127&&u<0){for(h=0;h<1-u;h++)o[a]=s[r],a++;r++}}return a},t.decode._decodeThunder=function(t,r,i,n,a){for(var s=[0,1,0,-1],o=[0,1,2,3,0,-3,-2,-1],l=r+i,u=2*a,h=0;r<l;){var f,d=t[r],c=d>>>6,p=63&d;if(r++,3==c&&(h=15&p,n[u>>>1]|=h<<4*(1-u&1),u++),0==c)for(var m=0;m<p;m++)n[u>>>1]|=h<<4*(1-u&1),u++;if(2==c)for(m=0;m<2;m++)4!=(f=p>>>3*(1-m)&7)&&(h+=o[f],n[u>>>1]|=h<<4*(1-u&1),u++);if(1==c)for(m=0;m<3;m++)2!=(f=p>>>2*(2-m)&3)&&(h+=s[f],n[u>>>1]|=h<<4*(1-u&1),u++)}},t.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},t.decode._lens=function(){var t=function(t,r,i,n){for(var a=0;a<r.length;a++)t[r[a]]=i+a*n},r="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",i="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",n="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",a="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",s="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";r=r.split(","),i=i.split(","),n=n.split(","),a=a.split(","),s=s.split(",");var o={},l={};return t(o,r,0,1),t(o,n,64,64),t(o,s,1792,64),t(l,i,0,1),t(l,a,64,64),t(l,s,1792,64),[o,l]}(),t.decode._decodeG4=function(r,i,n,a,s,o,l){for(var u=t.decode,h=i<<3,f=0,d="",c=[],p=[],m=0;m<o;m++)p.push(0);p=u._makeDiff(p);for(var g=0,_=0,b=0,y=0,v=0,w=0,x="",k=0,E=8*Math.ceil(o/8);h>>>3<i+n;){b=u._findDiff(p,g+ +(0!=g),1-v),y=u._findDiff(p,b,v);var S=0;if(1==l&&(S=r[h>>>3]>>>7-(7&h)&1),2==l&&(S=r[h>>>3]>>>(7&h)&1),h++,d+=S,"H"==x){if(null!=u._lens[v][d]){var $=u._lens[v][d];d="",f+=$,$<64&&(u._addNtimes(c,f,v),g+=f,v=1-v,f=0,0==--k&&(x=""))}}else"0001"==d&&(d="",u._addNtimes(c,y-g,v),g=y),"001"==d&&(d="",x="H",k=2),null!=u._dmap[d]&&(_=b+u._dmap[d],u._addNtimes(c,_-g,v),g=_,d="",v=1-v);c.length==o&&""==x&&(u._writeBits(c,a,8*s+w*E),v=0,w++,g=0,p=u._makeDiff(c),c=[])}},t.decode._findDiff=function(t,r,i){for(var n=0;n<t.length;n+=2)if(t[n]>=r&&t[n+1]==i)return t[n]},t.decode._makeDiff=function(t){var r=[];1==t[0]&&r.push(0,1);for(var i=1;i<t.length;i++)t[i-1]!=t[i]&&r.push(i,t[i]);return r.push(t.length,0,t.length,1),r},t.decode._decodeG2=function(r,i,n,a,s,o,l){for(var u=t.decode,h=i<<3,f=0,d="",c=[],p=0,m=0,g=8*Math.ceil(o/8);h>>>3<i+n;){var _=0;1==l&&(_=r[h>>>3]>>>7-(7&h)&1),2==l&&(_=r[h>>>3]>>>(7&h)&1),h++,d+=_,null!=(f=u._lens[p][d])&&(u._addNtimes(c,f,p),d="",f<64&&(p=1-p),c.length==o&&(u._writeBits(c,a,8*s+m*g),c=[],m++,p=0,7&h&&(h+=8-(7&h)),f>=64&&(h+=8)))}},t.decode._decodeG3=function(r,i,n,a,s,o,l,u){for(var h=t.decode,f=i<<3,d=0,c="",p=[],m=[],g=0;g<o;g++)p.push(0);for(var _=0,b=0,y=0,v=0,w=0,x=-1,k="",E=0,S=!0,$=8*Math.ceil(o/8);f>>>3<i+n;){y=h._findDiff(m,_+ +(0!=_),1-w),v=h._findDiff(m,y,w);var I=0;if(1==l&&(I=r[f>>>3]>>>7-(7&f)&1),2==l&&(I=r[f>>>3]>>>(7&f)&1),f++,c+=I,S){if(null!=h._lens[w][c]){var A=h._lens[w][c];c="",d+=A,A<64&&(h._addNtimes(p,d,w),w=1-w,d=0)}}else"H"==k?null!=h._lens[w][c]&&(A=h._lens[w][c],c="",d+=A,A<64&&(h._addNtimes(p,d,w),_+=d,w=1-w,d=0,0==--E&&(k=""))):("0001"==c&&(c="",h._addNtimes(p,v-_,w),_=v),"001"==c&&(c="",k="H",E=2),null!=h._dmap[c]&&(b=y+h._dmap[c],h._addNtimes(p,b-_,w),_=b,c="",w=1-w));c.endsWith("000000000001")&&(x>=0&&h._writeBits(p,a,8*s+x*$),u&&(1==l&&(S=1==(r[f>>>3]>>>7-(7&f)&1)),2==l&&(S=1==(r[f>>>3]>>>(7&f)&1)),f++),c="",w=0,x++,_=0,m=h._makeDiff(p),p=[])}p.length==o&&h._writeBits(p,a,8*s+x*$)},t.decode._addNtimes=function(t,r,i){for(var n=0;n<r;n++)t.push(i)},t.decode._writeBits=function(t,r,i){for(var n=0;n<t.length;n++)r[i+n>>>3]|=t[n]<<7-(i+n&7)},t.decode._decodeLZW=t.decode._decodeLZW=function(){var t,r,i,n,a=0,s=0,o=0,l=0,u=function(){var i=t>>>3,n=(r[i]<<16|r[i+1]<<8|r[i+2])>>>24-(7&t)-s&(1<<s)-1;return t+=s,n},h=new Uint32Array(16384),f=0,d=function(t){s=t+1,a=l+1},c=function(t){for(var r=t<<2,a=h[r+2],s=n+a-1;65535!=r;)i[s--]=h[r],r=h[r+1];n+=a},p=function(t,r){var i=a<<2,n=t<<2;h[i]=h[3+(r<<2)],h[i+1]=n,h[i+2]=h[n+2]+1,h[i+3]=h[n+3],++a+1==1<<s&&12!=s&&s++};return function(s,m,g,_,b,y){t=m<<3,r=s,i=_,n=b;var v=m+g<<3,w=0,x=0;for(!function(t){if(t!=f){f=t,l=1+(o=1<<t);for(var r=0;r<l+1;r++)h[4*r]=h[4*r+3]=r,h[4*r+1]=65535,h[4*r+2]=1}}(y),d(y);t<v&&(w=u())!=l;){if(w==o){if(d(y),(w=u())==l)break;c(w)}else w<a?(c(w),p(x,w)):(p(x,x),c(a-1));x=w}return n}}(),t.tags={},t._types=function(){var t=Array(250);return t.fill(0),{basic:{main:t=t.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),rest:{33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7}},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}}(),t._readIFD=function(r,n,a,s,o,l){var u=r.readUshort(n,a);a+=2;var h={};l.debug&&i("   ".repeat(o),s.length-1,">>>----------------");for(var f=0;f<u;f++){var d=r.readUshort(n,a);a+=2;var c=r.readUshort(n,a);a+=2;var p=r.readUint(n,a);a+=4;var m=r.readUint(n,a);a+=4;var g=[];if(1==c||7==c){var _=p<5?a-4:m;_+p>n.buffer.byteLength&&(p=n.buffer.byteLength-_),g=new Uint8Array(n.buffer,_,p)}if(2==c){var b=p<5?a-4:m,y=n[b],v=Math.max(0,Math.min(p-1,n.length-b));y<128||0==v?g.push(r.readASCII(n,b,v)):g=new Uint8Array(n.buffer,b,v)}if(3==c)for(var w=0;w<p;w++)g.push(r.readUshort(n,(p<3?a-4:m)+2*w));if(4==c||13==c)for(w=0;w<p;w++)g.push(r.readUint(n,(p<2?a-4:m)+4*w));if(5==c||10==c){var x=5==c?r.readUint:r.readInt;for(w=0;w<p;w++)g.push([x(n,m+8*w),x(n,m+8*w+4)])}if(8==c)for(w=0;w<p;w++)g.push(r.readShort(n,(p<3?a-4:m)+2*w));if(9==c)for(w=0;w<p;w++)g.push(r.readInt(n,(p<2?a-4:m)+4*w));if(11==c)for(w=0;w<p;w++)g.push(r.readFloat(n,m+4*w));if(12==c)for(w=0;w<p;w++)g.push(r.readDouble(n,m+8*w));if(0==p||0!=g.length){if(l.debug&&i("   ".repeat(o),d,c,t.tags[d],g),h["t"+d]=g,330==d&&h.t272&&"DSLR-A100"==h.t272[0]);else if(330==d||34665==d||34853==d||50740==d&&300>r.readUshort(n,r.readUint(g,0))||61440==d){var k=50740==d?[r.readUint(g,0)]:g,E=[];for(w=0;w<k.length;w++)t._readIFD(r,n,k[w],E,o+1,l);330==d&&(h.subIFD=E),34665==d&&(h.exifIFD=E[0]),34853==d&&(h.gpsiIFD=E[0]),50740==d&&(h.dngPrvt=E[0]),61440==d&&(h.fujiIFD=E[0])}if(37500==d&&l.parseMN){var S=g;if("Nikon"==r.readASCII(S,0,5))h.makerNote=t.decode(S.slice(10).buffer)[0];else if("OLYMP"==r.readASCII(S,0,5)||"OM SYSTEM"==r.readASCII(S,0,9)){var $=[8208,8224,8240,8256,8272],I=[];t._readIFD(r,S,77==S[1]?16:85==S[5]?12:8,I,o+1,l);var A=h.makerNote=I.pop();for(w=0;w<$.length;w++){var M="t"+$[w];null!=A[M]&&(t._readIFD(r,S,A[M][0],I,o+1,l),A[M]=I.pop())}A.t12288&&(t._readIFD(r,A.t12288,0,I,o+1,l),A.t12288=I.pop())}else 300>r.readUshort(n,m)&&12>=r.readUshort(n,m+4)&&(I=[],t._readIFD(r,n,m,I,o+1,l),h.makerNote=I[0])}}else if(i(d,"unknown TIFF tag type: ",c,"num:",p),0==f)return}return s.push(h),l.debug&&i("   ".repeat(o),"<<<---------------"),a},t._writeIFD=function(r,i,n,a,s){var o=Object.keys(s),l=o.length;s.exifIFD&&l--,s.gpsiIFD&&l--,r.writeUshort(n,a,l);for(var u=(a+=2)+12*l+4,h=0;h<o.length;h++){var f=o[h];if("t34665"!=f&&"t34853"!=f){"exifIFD"==f&&(f="t34665"),"gpsiIFD"==f&&(f="t34853");var d=parseInt(f.slice(1)),c=i.main[d];if(null==c&&(c=i.rest[d]),null==c||0==c)throw Error("unknown type of tag: "+d);var p=s[f];34665==d&&(p=[u],u=t._writeIFD(r,i,n,u,s.exifIFD)[1]),34853==d&&(p=[u],u=t._writeIFD(r,t._types.gps,n,u,s.gpsiIFD)[1]),2==c&&(p=p[0]+"\0");var m=p.length;r.writeUshort(n,a,d),a+=2,r.writeUshort(n,a,c),a+=2,r.writeUint(n,a,m);var g=[-1,1,1,2,4,8,0,1,0,4,8,0,8][c]*m,_=a+=4;if(g>4&&(r.writeUint(n,a,u),_=u),1==c||7==c)for(var b=0;b<m;b++)n[_+b]=p[b];else if(2==c)r.writeASCII(n,_,p);else if(3==c)for(b=0;b<m;b++)r.writeUshort(n,_+2*b,p[b]);else if(4==c)for(b=0;b<m;b++)r.writeUint(n,_+4*b,p[b]);else if(5==c||10==c){var y=5==c?r.writeUint:r.writeInt;for(b=0;b<m;b++){var v=p[b],w=v[0],x=v[1];if(null==w)throw"e";y(n,_+8*b,w),y(n,_+8*b+4,x)}}else if(9==c)for(b=0;b<m;b++)r.writeInt(n,_+4*b,p[b]);else{if(12!=c)throw c;for(b=0;b<m;b++)r.writeDouble(n,_+8*b,p[b])}g>4&&(u+=g+=1&g),a+=4}}return[a,u]},t.toRGBA8=function(t,r){function n(t){return t<.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055}var a=t.width,s=t.height,o=a*s,l=t.data,u=new Uint8Array(4*o),h=t.t262?t.t262[0]:2,f=t.t258?Math.min(32,t.t258[0]):1;null==t.t262&&1==f&&(h=0);var d=t.t277?t.t277[0]:t.t258?t.t258.length:[1,1,3,1,1,4,3][h],c=t.t339?t.t339[0]:null;if(1==h&&32==f&&3!=c)throw"e";var p=Math.ceil(d*f*a/8);if(0==h){r=1/256;for(var m=0;m<s;m++){var g=m*p,_=m*a;if(1==f)for(var b=0;b<a;b++){var y=_+b<<2,v=l[g+(b>>3)]>>7-(7&b)&1;u[y]=u[y+1]=u[y+2]=255*(1-v),u[y+3]=255}if(4==f)for(b=0;b<a;b++)y=_+b<<2,v=l[g+(b>>1)]>>4-4*(1&b)&15,u[y]=u[y+1]=u[y+2]=17*(15-v),u[y+3]=255;if(8==f)for(b=0;b<a;b++)y=_+b<<2,v=l[g+b],u[y]=u[y+1]=u[y+2]=255-v,u[y+3]=255;if(16==f)for(b=0;b<a;b++)y=_+b<<2,v=l[(w=g+2*b)+1]<<8|l[w],u[y]=u[y+1]=u[y+2]=Math.min(255,255-~~(v*r)),u[y+3]=255}}else if(1==h){null==r&&(r=1/256);var w,x=3&l.length?null:new Float32Array(l.buffer);for(m=0;m<s;m++){if(g=m*p,_=m*a,1==f)for(b=0;b<a;b++)y=_+b<<2,v=l[g+(b>>3)]>>7-(7&b)&1,u[y]=u[y+1]=u[y+2]=255*v,u[y+3]=255;if(2==f)for(b=0;b<a;b++)y=_+b<<2,v=l[g+(b>>2)]>>6-2*(3&b)&3,u[y]=u[y+1]=u[y+2]=85*v,u[y+3]=255;if(8==f)for(b=0;b<a;b++)y=_+b<<2,v=l[g+b*d],u[y]=u[y+1]=u[y+2]=v,u[y+3]=255;if(16==f)for(b=0;b<a;b++)y=_+b<<2,v=l[(w=g+2*b)+1]<<8|l[w],u[y]=u[y+1]=u[y+2]=Math.min(255,~~(v*r)),u[y+3]=255;if(32==f)for(b=0;b<a;b++)y=_+b<<2,v=x[w=(g>>>2)+b],u[y]=u[y+1]=u[y+2]=~~(.5+255*v),u[y+3]=255}}else if(2==h)if(8==f){if(1==d)for(b=0;b<o;b++)u[4*b]=u[4*b+1]=u[4*b+2]=l[b],u[4*b+3]=255;if(3==d)for(b=0;b<o;b++){var k=3*b;u[y=b<<2]=l[k],u[y+1]=l[k+1],u[y+2]=l[k+2],u[y+3]=255}if(d>=4)for(b=0;b<o;b++)k=b*d,u[y=b<<2]=l[k],u[y+1]=l[k+1],u[y+2]=l[k+2],u[y+3]=l[k+3]}else if(16==f){if(4==d)for(b=0;b<o;b++)k=8*b+1,u[y=b<<2]=l[k],u[y+1]=l[k+2],u[y+2]=l[k+4],u[y+3]=l[k+6];if(3==d)for(b=0;b<o;b++)k=6*b+1,u[y=b<<2]=l[k],u[y+1]=l[k+2],u[y+2]=l[k+4],u[y+3]=255}else{if(32!=f)throw f;var E=new Float32Array(l.buffer),S=0;for(b=0;b<E.length;b++)S=Math.min(S,E[b]);if(S<0)for(b=0;b<l.length;b+=4){var $=l[b];l[b]=l[b+3],l[b+3]=$,$=l[b+1],l[b+1]=l[b+2],l[b+2]=$}var I=[];for(b=0;b<65536;b++)I.push(n(b/65535));for(b=0;b<E.length;b++){var A=Math.max(0,Math.min(1,E[b]));E[b]=I[~~(.5+65535*A)]}if(3==d)for(b=0;b<o;b++)k=3*b,u[y=b<<2]=~~(.5+255*E[k]),u[y+1]=~~(.5+255*E[k+1]),u[y+2]=~~(.5+255*E[k+2]),u[y+3]=255;else{if(4!=d)throw d;for(b=0;b<o;b++)k=4*b,u[y=b<<2]=~~(.5+255*E[k]),u[y+1]=~~(.5+255*E[k+1]),u[y+2]=~~(.5+255*E[k+2]),u[y+3]=~~(.5+255*E[k+3])}}else if(3==h){var M=t.t320,T=1<<f,C=8==f&&d>1&&t.t338&&0!=t.t338[0];for(m=0;m<s;m++)for(var z=0;z<a;z++){y=(b=m*a+z)<<2;var R=0,B=m*p;if(1==f)R=l[B+(z>>>3)]>>>7-(7&z)&1;else if(2==f)R=l[B+(z>>>2)]>>>6-2*(3&z)&3;else if(4==f)R=l[B+(z>>>1)]>>>4-4*(1&z)&15;else{if(8!=f)throw f;R=l[B+z*d]}u[y]=M[R]>>8,u[y+1]=M[T+R]>>8,u[y+2]=M[T+T+R]>>8,u[y+3]=C?l[B+z*d+1]:255}}else if(5==h){var O=+(d>4);for(b=0;b<o;b++){y=b<<2;var P=b*d;if(window.UDOC){var D=l[P],N=l[P+1],L=l[P+2],U=l[P+3],j=UDOC.C.cmykToRgb([1/255*D,1/255*N,1/255*L,1/255*U]);u[y]=~~(.5+255*j[0]),u[y+1]=~~(.5+255*j[1]),u[y+2]=~~(.5+255*j[2])}else D=255-l[P],N=255-l[P+1],L=255-l[P+2],U=(255-l[P+3])*(1/255),u[y]=~~(D*U+.5),u[y+1]=~~(N*U+.5),u[y+2]=~~(L*U+.5);u[y+3]=255*(1-O)+l[P+4]*O}}else if(6==h&&t.t278){var F=t.t278[0];for(m=0;m<s;m+=F){b=m*a;for(var G=F*a,W=0;W<G;W++){y=4*(b+W),L=l[(P=3*b+4*(W>>>1))+(1&W)];var q=l[P+2]-128,H=l[P+3]-128,V=L+((H>>2)+(H>>3)+(H>>5)),Z=L-((q>>2)+(q>>4)+(q>>5))-((H>>1)+(H>>3)+(H>>4)+(H>>5)),K=L+(q+(q>>1)+(q>>2)+(q>>6));u[y]=Math.max(0,Math.min(255,V)),u[y+1]=Math.max(0,Math.min(255,Z)),u[y+2]=Math.max(0,Math.min(255,K)),u[y+3]=255}}}else if(32845==h)for(m=0;m<s;m++)for(z=0;z<a;z++){y=4*(m*a+z);var Y=l[(P=6*(m*a+z))+1]<<8|l[P],X=(Y=Math.pow(2,(Y+.5)/256-64),(l[P+3]+.5)/410),Q=(l[P+5]+.5)/410,J=9*X/(6*X-16*Q+12),ee=4*Q/(6*X-16*Q+12),et=J*Y/ee,er=(1-J-ee)*Y/ee;V=2.69*et-1.276*(L=Y)-.414*er,Z=-1.022*et+1.978*L+.044*er,K=.061*et-.224*L+1.163*er,u[y]=255*n(Math.min(V,1)),u[y+1]=255*n(Math.min(Z,1)),u[y+2]=255*n(Math.min(K,1)),u[y+3]=255}else i("Unknown Photometric interpretation: "+h);return u},t.replaceIMG=function(r){null==r&&(r=document.getElementsByTagName("img"));for(var i=["tif","tiff","dng","cr2","nef"],n=0;n<r.length;n++){var a=r[n],s=a.getAttribute("src");if(null!=s){var o=s.split(".").pop().toLowerCase();if(-1!=i.indexOf(o)){var l=new XMLHttpRequest;t._xhrs.push(l),t._imgs.push(a),l.open("GET",s),l.responseType="arraybuffer",l.onload=t._imgLoaded,l.send()}}}},t._xhrs=[],t._imgs=[],t._imgLoaded=function(r){var i=t._xhrs.indexOf(r.target),n=t._imgs[i];t._xhrs.splice(i,1),t._imgs.splice(i,1),n.setAttribute("src",t.bufferToURI(r.target.response))},t.bufferToURI=function(r){var i=t.decode(r),n=i,a=0,s=n[0];i[0].subIFD&&(n=n.concat(i[0].subIFD));for(var o=0;o<n.length;o++){var l=n[o];if(!(null==l.t258||l.t258.length<3)){var u=l.t256*l.t257;u>a&&(a=u,s=l)}}t.decodeImage(r,s,i);var h=t.toRGBA8(s),f=s.width,d=s.height,c=document.createElement("canvas");c.width=f,c.height=d;var p=c.getContext("2d"),m=new ImageData(new Uint8ClampedArray(h.buffer),f,d);return p.putImageData(m,0,0),c.toDataURL()},t._binBE={nextZero:function(t,r){for(;0!=t[r];)r++;return r},readUshort:function(t,r){return t[r]<<8|t[r+1]},readShort:function(r,i){var n=t._binBE.ui8;return n[0]=r[i+1],n[1]=r[i+0],t._binBE.i16[0]},readInt:function(r,i){var n=t._binBE.ui8;return n[0]=r[i+3],n[1]=r[i+2],n[2]=r[i+1],n[3]=r[i+0],t._binBE.i32[0]},readUint:function(r,i){var n=t._binBE.ui8;return n[0]=r[i+3],n[1]=r[i+2],n[2]=r[i+1],n[3]=r[i+0],t._binBE.ui32[0]},readASCII:function(t,r,i){for(var n="",a=0;a<i;a++)n+=String.fromCharCode(t[r+a]);return n},readFloat:function(r,i){for(var n=t._binBE.ui8,a=0;a<4;a++)n[a]=r[i+3-a];return t._binBE.fl32[0]},readDouble:function(r,i){for(var n=t._binBE.ui8,a=0;a<8;a++)n[a]=r[i+7-a];return t._binBE.fl64[0]},writeUshort:function(t,r,i){t[r]=i>>8&255,t[r+1]=255&i},writeInt:function(r,i,n){var a=t._binBE.ui8;t._binBE.i32[0]=n,r[i+3]=a[0],r[i+2]=a[1],r[i+1]=a[2],r[i+0]=a[3]},writeUint:function(t,r,i){t[r]=i>>24&255,t[r+1]=i>>16&255,t[r+2]=i>>8&255,t[r+3]=255&i},writeASCII:function(t,r,i){for(var n=0;n<i.length;n++)t[r+n]=i.charCodeAt(n)},writeDouble:function(r,i,n){t._binBE.fl64[0]=n;for(var a=0;a<8;a++)r[i+a]=t._binBE.ui8[7-a]}},t._binBE.ui8=new Uint8Array(8),t._binBE.i16=new Int16Array(t._binBE.ui8.buffer),t._binBE.i32=new Int32Array(t._binBE.ui8.buffer),t._binBE.ui32=new Uint32Array(t._binBE.ui8.buffer),t._binBE.fl32=new Float32Array(t._binBE.ui8.buffer),t._binBE.fl64=new Float64Array(t._binBE.ui8.buffer),t._binLE={nextZero:t._binBE.nextZero,readUshort:function(t,r){return t[r+1]<<8|t[r]},readShort:function(r,i){var n=t._binBE.ui8;return n[0]=r[i+0],n[1]=r[i+1],t._binBE.i16[0]},readInt:function(r,i){var n=t._binBE.ui8;return n[0]=r[i+0],n[1]=r[i+1],n[2]=r[i+2],n[3]=r[i+3],t._binBE.i32[0]},readUint:function(r,i){var n=t._binBE.ui8;return n[0]=r[i+0],n[1]=r[i+1],n[2]=r[i+2],n[3]=r[i+3],t._binBE.ui32[0]},readASCII:t._binBE.readASCII,readFloat:function(r,i){for(var n=t._binBE.ui8,a=0;a<4;a++)n[a]=r[i+a];return t._binBE.fl32[0]},readDouble:function(r,i){for(var n=t._binBE.ui8,a=0;a<8;a++)n[a]=r[i+a];return t._binBE.fl64[0]},writeUshort:function(t,r,i){t[r]=255&i,t[r+1]=i>>8&255},writeInt:function(r,i,n){var a=t._binBE.ui8;t._binBE.i32[0]=n,r[i+0]=a[0],r[i+1]=a[1],r[i+2]=a[2],r[i+3]=a[3]},writeUint:function(t,r,i){t[r]=i>>>0&255,t[r+1]=i>>>8&255,t[r+2]=i>>>16&255,t[r+3]=i>>>24&255},writeASCII:t._binBE.writeASCII},t._copyTile=function(t,r,i,n,a,s,o,l){for(var u=Math.min(r,a-o),h=Math.min(i,s-l),f=0;f<h;f++)for(var d=(l+f)*a+o,c=f*r,p=0;p<u;p++)n[d+p]=t[c+p]},t.LosslessJpegDecode=function(){var t,r;function i(){return t[r++]}function n(){return t[r++]<<8|t[r++]}function a(t){for(var r=i(),n=[0,0,0,255],a=[],o=0;o<16;o++)a[o]=i();for(o=0;o<16;o++)for(var l=0;l<a[o];l++)n[s(n,0,o+1,1)+3]=i();var u=new Uint8Array(256);for(o=0,t[r]=[new Uint8Array(n),u];o<256;o++){for(var h=8,f=o,d=0;255==n[d+3]&&0!=h;)d=n[d+(f>>--h&1)];u[o]=d}}function s(t,r,i,n){if(255!=t[r+3])return 0;if(0==i)return r;for(var a=0;a<2;a++){0==t[r+a]&&(t[r+a]=t.length,t.push(0,0,n,255));var o=s(t,t[r+a],i-1,n+1);if(0!=o)return o}return 0}function o(t){for(var r=t.b,i=t.f;r<25&&t.a<t.d;){var n=t.data[t.a++];255!=n||t.c||t.a++,i=i<<8|n,r+=8}if(r<0)throw"e";t.b=r,t.f=i}function l(t,r){return r.b<t&&o(r),r.f>>(r.b-=t)&65535>>16-t}function u(t,r){var i=t[0],n=0,a=255;r.b<16&&o(r);var s=r.f>>r.b-8&255;for(a=i[(n=t[1][s])+3],r.b-=i[n+2];255==a;)a=i[(n=i[n+(r.f>>--r.b&1)])+3];return a}function h(t,r){return t<32768>>16-r&&(t+=1-(1<<r)),t}function f(t,r){var i=u(t,r);return 0==i?0:16==i?-32768:h(l(i,r),i)}function d(t,r,i,n,a,s){for(var o=0,l=0;l<s;l++){for(var u=l*r,h=0;h<r;h+=a){o++;for(var d=0;d<a;d++)t[u+h+d]=f(n[d],i)}if(0!=i.e&&o%i.e==0&&0!=l){for(var c=i.a,p=i.data;255!=p[c]||!(208<=p[c+1]&&p[c+1]<=215);)c--;i.a=c+2,i.f=0,i.b=0}}}function c(t,r){return h(l(t,r),t)}function p(t,r,i,n,a,s,o,l){for(var u=i*o,h=a;h<s;h++)t[h]+=1<<l-1;for(var f=o;f<u;f+=o)for(h=a;h<s;h++)t[f+h]+=t[f+h-o];for(var d=1;d<n;d++){var c=d*u;for(h=a;h<s;h++)t[c+h]+=t[c+h-u];for(f=o;f<u;f+=o)for(h=a;h<s;h++){var p=c+f+h,m=p-u,g=t[p-o],_=0;if(0==r)_=0;else if(1==r)_=g;else if(2==r)_=t[m];else if(3==r)_=t[m-o];else if(4==r)_=g+(t[m]-t[m-o]);else if(5==r)_=g+(t[m]-t[m-o]>>>1);else if(6==r)_=t[m]+(g-t[m-o]>>>1);else{if(7!=r)throw r;_=g+t[m]>>>1}t[p]+=_}}}return function(s){if(t=s,r=0,65496!=n())throw"e";for(var o=[],l=0,h=0,f=0,m=[],g=[],_=[],b=0,y=0,v=0;;){var w=n();if(65535!=w){var x=n();if(65475==w){h=i(),y=n(),v=n(),b=i();for(var k=0;k<b;k++){var E=i(),S=i();if(0!=i())throw"e";o[E]=[k,S>>4,15&S]}}else if(65476==w)for(var $=r+x-2;r<$;)a(g);else{if(65498==w){for(r++,k=0;k<b;k++){var I=o[i()];_[I[0]]=g[i()>>>4],m[I[0]]=I.slice(1)}l=i(),r+=2;break}65501==w?f=n():r+=x-2}}else r--}var A=new(h>8?Uint16Array:Uint8Array)(y*v*b),M={b:0,f:0,c:8==l,a:r,data:t,d:t.length,e:f};if(M.c)!function(i,n,a,s,o){for(var l=t.length-r,h=0;h<l;h+=4){var f=t[r+h];t[r+h]=t[r+h+3],t[r+h+3]=f,f=t[r+h+1],t[r+h+1]=t[r+h+2],t[r+h+2]=f}for(var d=0;d<o;d++)for(var p=32768,m=32768,g=0;g<n;g+=2){var _=u(s,a),b=u(s,a);0!=_&&(p+=c(_,a)),0!=b&&(m+=c(b,a)),i[d*n+g]=65535&p,i[d*n+g+1]=65535&m}}(A,v*b,M,_[0],y);else{var T=[],C=0,z=0;for(k=0;k<b;k++){var R=m[k];(W=R[0])>C&&(C=W),(G=R[1])>z&&(z=G),T.push(W*G)}if(1!=C||1!=z){if(3!=b||1!=T[1]||1!=T[2]||2!=C||1!=z&&2!=z)throw"e";var B,O=[],P=0;for(k=0;k<b;k++){for(var D=0;D<T[k];D++)O.push(_[k]);P+=T[k]}var N=v/C,L=y/z,U=N*L;d(A,N*P,M,O,P,L),p(A,l,N,L,P-2,P,P,h);var j=new Uint16Array(U*T[0]);if(2==C&&2==z){for(k=0;k<U;k++)j[4*k]=A[6*k],j[4*k+1]=A[6*k+1],j[4*k+2]=A[6*k+2],j[4*k+3]=A[6*k+3];for(p(j,l,4*N,L,0,1,1,h),k=0;k<U;k++)A[6*k]=j[4*k],A[6*k+1]=j[4*k+1],A[6*k+2]=j[4*k+2],A[6*k+3]=j[4*k+3]}if(2==C&&1==z){for(k=0;k<U;k++)j[2*k]=A[4*k],j[2*k+1]=A[4*k+1];for(p(j,l,2*N,L,0,1,1,h),k=0;k<U;k++)A[4*k]=j[2*k],A[4*k+1]=j[2*k+1]}for(var F=A.slice(0),G=0;G<y;G++)if(2==z)for(var W=0;W<v;W++){var q=((G>>>1)*N+(W>>>1))*P,H=2*(1&G)+(1&W);A[B=(G*v+W)*b]=F[q+H],A[B+1]=F[q+4],A[B+2]=F[q+5]}else for(W=0;W<v;W++)q=(G*N+(W>>>1))*P,H=1&W,A[B=(G*v+W)*b]=F[q+H],A[B+1]=F[q+2],A[B+2]=F[q+3]}else if(d(A,v*b,M,_,b,y),0==f)p(A,l,v,y,0,b,b,h);else{var V=Math.floor(f/v);for(G=0;G<y;G+=V){var Z=A.slice(G*v*b,(G+V)*v*b);p(Z,l,v,V,0,b,b,h),A.set(Z,G*v*b)}}}return A}}(),function(){var r=2,i=4,n=5,a=6,s=7,o=12,l=13,u=14,h=15,f=17;function d(t){var r={c:new Int8Array(2<<t.u)};return function(t,r,i){var n=[0,18,67,276,i];t.o=0,t.w=(n[4]+0)/1+1|0,t.v=Math.ceil(Math.log2(t.w)),t.t=9,function(t,r){for(var i=-r[4],n=0;i<=r[4];n++,i++)t[n]=i<=-r[3]?-4:i<=-r[2]?-3:i<=-r[1]?-2:i<-r[0]?-1:i<=r[0]?0:i<r[1]?1:i<r[2]?2:i<r[3]?3:4}(t.c,n)}(r,0,t.g),r}function c(t){for(var r=[[],[],[]],i=Math.max(2,t.w+32>>>6),n=0;n<3;n++)for(var a=0;a<41;a++)r[n][a]=[i,1];return r}function p(t,r){var i=0,n=8-t.a;if(t.j,t.a,r){if(r>=n)do i<<=n,r-=n,i|=t[t.j]&(1<<n)-1,t.j++,n=8;while(r>=8)r&&(i<<=r,n-=r,i|=t[t.j]>>>n&(1<<r)-1),t.a=8-n}return i}function m(t,r,i,n,a,s,o,l){null==l&&(l=0);var u,h,f,d,c,m,g=s+1,_=g%2,b=0,y=n[a],v=n[a-1],w=n[a-2][g],x=v[g-1],k=v[g],E=v[g+1],S=y[g-1],$=y[g+1],I=Math.abs;if(_&&(f=I(E-k),d=I(w-k),c=I(x-k)),_){if(m=(m=f>c&&d<f?w+x:f<c&&d<c?w+E:E+x)+2*k>>>2,l)return void(y[g]=m);u=r.t*r.c[t.g+k-w]+r.c[t.g+x-k]}else m=k>x&&k>E||k<x&&k<E?$+S+2*k>>>2:S+$>>>1,u=r.t*r.c[t.g+k-x]+r.c[t.g+x-S];h=I(u);var A=function(t){for(var r=-1,i=0;!i;r++)i=t[t.j]>>>7-t.a&1,t.a++,t.a&=7,t.a||t.j++;return r}(i);if(A<t.n-r.v-1){var M=function(t,r){var i=0;if(r<t)for(;i<=14&&r<<++i<t;);return i}(o[h][0],o[h][1]);b=p(i,M)+(A<<M)}else b=p(i,r.v)+1;b=1&b?-1-(b>>>1):b>>>1,o[h][0]+=I(b),o[h][1]==t.f&&(o[h][0]>>>=1,o[h][1]>>>=1),o[h][1]++,m=u<0?m-b:m+b,t.i&&(m<0?m+=r.w:m>t.g&&(m-=r.w)),y[g]=m>=0?Math.min(m,t.g):0}function g(t,r,i){for(var n=t[0].length,a=r;a<=i;a++)t[a][0]=t[a-1][1],t[a][n-1]=t[a-1][n-2]}function _(t){g(t,s,o),g(t,r,i),g(t,h,f)}function b(t,r,n,a,s,o,u,h,f,d,c,p,g){for(var b=0,y=1,v=s<l&&s>i;y<t.m;)b<t.m&&(m(t,r,n,a,s,b,u[f],t.h&&(v&&d||!v&&(c||(b&p)==g))),m(t,r,n,a,o,b,u[f],t.h&&(!v&&d||v&&(c||(b&p)==g))),b+=2),b>8&&(m(t,r,n,a,s,y,h[f]),m(t,r,n,a,o,y,h[f]),y+=2);_(a)}function y(t,n,a,l,u,d){b(t,n,a,l,r,s,u,d,0,0,1,0,8),b(t,n,a,l,8,h,u,d,1,0,1,0,8),b(t,n,a,l,3,9,u,d,2,1,0,3,0),b(t,n,a,l,10,16,u,d,0,0,0,3,2),b(t,n,a,l,i,11,u,d,1,0,0,3,2),b(t,n,a,l,o,f,u,d,2,1,0,3,0)}function v(t,i,n,a,o,l){var u=l.length,f=t.l;o+1==t.s&&(f=t.e-o*t.l);for(var d=6*t.e*a+o*t.l,c=0;c<6;c++){for(var p=0;p<f;p++){var m,g=l[c%u][p%u];m=0==g?r+(c>>>1):2==g?h+(c>>>1):s+c;var _=t.h?(2*p/3&0x7ffffffe|p%3&1)+(p%3>>>1):p>>>1;i[d+p]=n[m][_+1]}d+=t.e}}t._decompressRAF=function(s,h){var p=function(r){var i=t._binBE.readUshort,n={b:i(r,0),i:r[2],C:r[3],u:r[4],q:i(r,5),k:i(r,7),e:i(r,9),l:i(r,11),s:r[13],d:i(r,14)};if(18771!=n.b||n.i>1||n.q<6||n.q%6||n.e<768||n.e%24||768!=n.l||n.k<n.l||n.k%n.l||n.k-n.e>=n.l||n.s>16||n.s!=n.k/n.l||n.s!=Math.ceil(n.e/n.l)||n.d!=n.q/6||12!=n.u&&14!=n.u&&16!=n.u||16!=n.C&&0!=n.C)throw"Invalid data";if(0==n.i)throw"Not implemented. We need this file!";return n.h=16==n.C,n.m=0|(n.h?2*n.l/3:n.l>>>1),n.A=n.m+2,n.f=64,n.g=(1<<n.u)-1,n.n=4*n.u,n}(s),m=function(r,i){var n=Array(i.s),a=4*i.s,s=16+a;12&a&&(s+=16-(12&a));for(var o=0,l=16;o<i.s;l+=4){var u=t._binBE.readUint(r,l);n[o]=r.slice(s,s+u),n[o].j=0,n[o].a=0,s+=u,o++}if(s!=r.length)throw"Invalid data";return n}(s,p),g=d(p),b=new Int16Array(p.e*p.q);null==h&&(h=p.h?[[1,1,0,1,1,2],[1,1,2,1,1,0],[2,0,1,0,2,1],[1,1,2,1,1,0],[1,1,0,1,1,2],[0,2,1,2,0,1]]:[[0,1],[3,2]]);for(var w=[[0,3],[1,i],[n,11],[a,o],[l,16],[u,f]],x=[],k=0;k<18;k++)x[k]=new Uint16Array(p.A);for(var E=0;E<p.s;E++){var S=c(g),$=c(g);for(k=0;k<18;k++)for(var I=0;I<p.A;I++)x[k][I]=0;for(var A=0;A<p.d;A++){for(y(p,g,m[E],x,S,$),k=0;k<6;k++)for(I=0;I<p.A;I++)x[w[k][0]][I]=x[w[k][1]][I];for(v(p,b,x,A,E,h),k=r;k<18;k++)if(-1==[n,a,l,u].indexOf(k))for(I=0;I<p.A;I++)x[k][I]=0;_(x)}}return b}}()}(r,requirePako())}()}(UTIF);var util$1,objectUtil,UTIFExports=UTIF.exports,utif=getDefaultExportFromCjs(UTIFExports);function getDimensionValue(t){return"number"==typeof t?t:t instanceof Uint8Array?t[0]:"string"==typeof t[0]?parseInt(t[0]):t[0]}function tiff(){return{mime:"image/tiff",encode:t=>{let r=utif.encodeImage(t.data,t.width,t.height);return Buffer.from(r)},decode:t=>{let r=utif.decode(t),i=r[0];if(!i)throw Error("No page found in TIFF");if(!i.t256)throw Error("No image width found in TIFF");if(!i.t257)throw Error("No image height found in TIFF");r.forEach(r=>{utif.decodeImage(t,r)});let n=utif.toRGBA8(i);return{data:Buffer.from(n),width:getDimensionValue(i.t256),height:getDimensionValue(i.t257)}}}}!function(t){t.assertEqual=t=>t,t.assertIs=function(t){},t.assertNever=function(t){throw Error()},t.arrayToEnum=t=>{let r={};for(let i of t)r[i]=i;return r},t.getValidEnumValues=r=>{let i=t.objectKeys(r).filter(t=>"number"!=typeof r[r[t]]),n={};for(let t of i)n[t]=r[t];return t.objectValues(n)},t.objectValues=r=>t.objectKeys(r).map(function(t){return r[t]}),t.objectKeys="function"==typeof Object.keys?t=>Object.keys(t):t=>{let r=[];for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&r.push(i);return r},t.find=(t,r)=>{for(let i of t)if(r(i))return i},t.isInteger="function"==typeof Number.isInteger?t=>Number.isInteger(t):t=>"number"==typeof t&&isFinite(t)&&Math.floor(t)===t,t.joinValues=function(t,r=" | "){return t.map(t=>"string"==typeof t?`'${t}'`:t).join(r)},t.jsonStringifyReplacer=(t,r)=>"bigint"==typeof r?r.toString():r}(util$1||(util$1={})),function(t){t.mergeShapes=(t,r)=>({...t,...r})}(objectUtil||(objectUtil={}));let ZodParsedType=util$1.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=t=>{switch(typeof t){case"undefined":return ZodParsedType.undefined;case"string":return ZodParsedType.string;case"number":return isNaN(t)?ZodParsedType.nan:ZodParsedType.number;case"boolean":return ZodParsedType.boolean;case"function":return ZodParsedType.function;case"bigint":return ZodParsedType.bigint;case"symbol":return ZodParsedType.symbol;case"object":return Array.isArray(t)?ZodParsedType.array:null===t?ZodParsedType.null:t.then&&"function"==typeof t.then&&t.catch&&"function"==typeof t.catch?ZodParsedType.promise:"undefined"!=typeof Map&&t instanceof Map?ZodParsedType.map:"undefined"!=typeof Set&&t instanceof Set?ZodParsedType.set:"undefined"!=typeof Date&&t instanceof Date?ZodParsedType.date:ZodParsedType.object;default:return ZodParsedType.unknown}},ZodIssueCode=util$1.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),quotelessJson=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class ZodError extends Error{constructor(t){super(),this.issues=[],this.addIssue=t=>{this.issues=[...this.issues,t]},this.addIssues=(t=[])=>{this.issues=[...this.issues,...t]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}get errors(){return this.issues}format(t){let r=t||function(t){return t.message},i={_errors:[]},n=t=>{for(let a of t.issues)if("invalid_union"===a.code)a.unionErrors.map(n);else if("invalid_return_type"===a.code)n(a.returnTypeError);else if("invalid_arguments"===a.code)n(a.argumentsError);else if(0===a.path.length)i._errors.push(r(a));else{let t=i,n=0;for(;n<a.path.length;){let i=a.path[n];n===a.path.length-1?(t[i]=t[i]||{_errors:[]},t[i]._errors.push(r(a))):t[i]=t[i]||{_errors:[]},t=t[i],n++}}};return n(this),i}static assert(t){if(!(t instanceof ZodError))throw Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,util$1.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(t=t=>t.message){let r={},i=[];for(let n of this.issues)n.path.length>0?(r[n.path[0]]=r[n.path[0]]||[],r[n.path[0]].push(t(n))):i.push(t(n));return{formErrors:i,fieldErrors:r}}get formErrors(){return this.flatten()}}ZodError.create=t=>new ZodError(t);let errorMap=(t,r)=>{let i;switch(t.code){case ZodIssueCode.invalid_type:i=t.received===ZodParsedType.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case ZodIssueCode.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,util$1.jsonStringifyReplacer)}`;break;case ZodIssueCode.unrecognized_keys:i=`Unrecognized key(s) in object: ${util$1.joinValues(t.keys,", ")}`;break;case ZodIssueCode.invalid_union:i="Invalid input";break;case ZodIssueCode.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${util$1.joinValues(t.options)}`;break;case ZodIssueCode.invalid_enum_value:i=`Invalid enum value. Expected ${util$1.joinValues(t.options)}, received '${t.received}'`;break;case ZodIssueCode.invalid_arguments:i="Invalid function arguments";break;case ZodIssueCode.invalid_return_type:i="Invalid function return type";break;case ZodIssueCode.invalid_date:i="Invalid date";break;case ZodIssueCode.invalid_string:"object"==typeof t.validation?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,"number"==typeof t.validation.position&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:util$1.assertNever(t.validation):i="regex"!==t.validation?`Invalid ${t.validation}`:"Invalid";break;case ZodIssueCode.too_small:i="array"===t.type?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:"string"===t.type?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:"number"===t.type?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:"date"===t.type?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case ZodIssueCode.too_big:i="array"===t.type?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:"string"===t.type?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:"number"===t.type?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:"bigint"===t.type?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:"date"===t.type?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case ZodIssueCode.custom:i="Invalid input";break;case ZodIssueCode.invalid_intersection_types:i="Intersection results could not be merged";break;case ZodIssueCode.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case ZodIssueCode.not_finite:i="Number must be finite";break;default:i=r.defaultError,util$1.assertNever(t)}return{message:i}},overrideErrorMap=errorMap;function setErrorMap(t){overrideErrorMap=t}function getErrorMap(){return overrideErrorMap}let makeIssue=t=>{let{data:r,path:i,errorMaps:n,issueData:a}=t,s=[...i,...a.path||[]],o={...a,path:s};if(void 0!==a.message)return{...a,path:s,message:a.message};let l="";for(let t of n.filter(t=>!!t).slice().reverse())l=t(o,{data:r,defaultError:l}).message;return{...a,path:s,message:l}},EMPTY_PATH=[];function addIssueToContext(t,r){let i=getErrorMap(),n=makeIssue({issueData:r,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===errorMap?void 0:errorMap].filter(t=>!!t)});t.common.issues.push(n)}class ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(t,r){let i=[];for(let n of r){if("aborted"===n.status)return INVALID;"dirty"===n.status&&t.dirty(),i.push(n.value)}return{status:t.value,value:i}}static async mergeObjectAsync(t,r){let i=[];for(let t of r){let r=await t.key,n=await t.value;i.push({key:r,value:n})}return ParseStatus.mergeObjectSync(t,i)}static mergeObjectSync(t,r){let i={};for(let n of r){let{key:r,value:a}=n;if("aborted"===r.status||"aborted"===a.status)return INVALID;"dirty"===r.status&&t.dirty(),"dirty"===a.status&&t.dirty(),"__proto__"!==r.value&&(void 0!==a.value||n.alwaysSet)&&(i[r.value]=a.value)}return{status:t.value,value:i}}}let INVALID=Object.freeze({status:"aborted"}),DIRTY=t=>({status:"dirty",value:t}),OK=t=>({status:"valid",value:t}),isAborted=t=>"aborted"===t.status,isDirty=t=>"dirty"===t.status,isValid=t=>"valid"===t.status,isAsync=t=>"undefined"!=typeof Promise&&t instanceof Promise;function __classPrivateFieldGet(t,r,i,n){if("function"==typeof r?t!==r||!n:!r.has(t))throw TypeError("Cannot read private member from an object whose class did not declare it");return r.get(t)}function __classPrivateFieldSet(t,r,i,n,a){if("function"==typeof r?t!==r||!a:!r.has(t))throw TypeError("Cannot write private member to an object whose class did not declare it");return r.set(t,i),i}"function"==typeof SuppressedError&&SuppressedError,function(t){t.errToObj=t=>"string"==typeof t?{message:t}:t||{},t.toString=t=>"string"==typeof t?t:null==t?void 0:t.message}(errorUtil||(errorUtil={}));class ParseInputLazyPath{constructor(t,r,i,n){this._cachedPath=[],this.parent=t,this.data=r,this._path=i,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let handleResult=(t,r)=>{if(isValid(r))return{success:!0,data:r.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new ZodError(t.common.issues);return this._error=r,this._error}}};function processCreateParams(t){if(!t)return{};let{errorMap:r,invalid_type_error:i,required_error:n,description:a}=t;if(r&&(i||n))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return r?{errorMap:r,description:a}:{errorMap:(r,a)=>{var s,o;let{message:l}=t;return"invalid_enum_value"===r.code?{message:null!=l?l:a.defaultError}:void 0===a.data?{message:null!=(s=null!=l?l:n)?s:a.defaultError}:"invalid_type"!==r.code?{message:a.defaultError}:{message:null!=(o=null!=l?l:i)?o:a.defaultError}},description:a}}class ZodType{constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(t){return getParsedType(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:getParsedType(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ParseStatus,ctx:{common:t.parent.common,data:t.data,parsedType:getParsedType(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let r=this._parse(t);if(isAsync(r))throw Error("Synchronous parse encountered promise.");return r}_parseAsync(t){return Promise.resolve(this._parse(t))}parse(t,r){let i=this.safeParse(t,r);if(i.success)return i.data;throw i.error}safeParse(t,r){var i;let n={common:{issues:[],async:null!=(i=null==r?void 0:r.async)&&i,contextualErrorMap:null==r?void 0:r.errorMap},path:(null==r?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:getParsedType(t)},a=this._parseSync({data:t,path:n.path,parent:n});return handleResult(n,a)}async parseAsync(t,r){let i=await this.safeParseAsync(t,r);if(i.success)return i.data;throw i.error}async safeParseAsync(t,r){let i={common:{issues:[],contextualErrorMap:null==r?void 0:r.errorMap,async:!0},path:(null==r?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:getParsedType(t)},n=this._parse({data:t,path:i.path,parent:i});return handleResult(i,await (isAsync(n)?n:Promise.resolve(n)))}refine(t,r){let i=t=>"string"==typeof r||void 0===r?{message:r}:"function"==typeof r?r(t):r;return this._refinement((r,n)=>{let a=t(r),s=()=>n.addIssue({code:ZodIssueCode.custom,...i(r)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then(t=>!!t||(s(),!1)):!!a||(s(),!1)})}refinement(t,r){return this._refinement((i,n)=>!!t(i)||(n.addIssue("function"==typeof r?r(i,n):r),!1))}_refinement(t){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(t){return ZodUnion.create([this,t],this._def)}and(t){return ZodIntersection.create(this,t,this._def)}transform(t){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let r="function"==typeof t?t:()=>t;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:r,typeName:ZodFirstPartyTypeKind.ZodDefault})}brand(){return new ZodBranded({typeName:ZodFirstPartyTypeKind.ZodBranded,type:this,...processCreateParams(this._def)})}catch(t){let r="function"==typeof t?t:()=>t;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:r,typeName:ZodFirstPartyTypeKind.ZodCatch})}describe(t){return new(0,this.constructor)({...this._def,description:t})}pipe(t){return ZodPipeline.create(this,t)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let cuidRegex=/^c[^\s-]{8,}$/i,cuid2Regex=/^[0-9a-z]+$/,ulidRegex=/^[0-9A-HJKMNP-TV-Z]{26}$/,uuidRegex=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,nanoidRegex=/^[a-z0-9_-]{21}$/i,durationRegex=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,emailRegex=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_emojiRegex="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",ipv4Regex=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6Regex=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64Regex=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,dateRegexSource="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",dateRegex=RegExp(`^${dateRegexSource}$`);function timeRegexSource(t){let r="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?r=`${r}\\.\\d{${t.precision}}`:null==t.precision&&(r=`${r}(\\.\\d+)?`),r}function timeRegex(t){return RegExp(`^${timeRegexSource(t)}$`)}function datetimeRegex(t){let r=`${dateRegexSource}T${timeRegexSource(t)}`,i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),r=`${r}(${i.join("|")})`,RegExp(`^${r}$`)}function isValidIP(t,r){return!("v4"!==r&&r||!ipv4Regex.test(t))||!("v6"!==r&&r||!ipv6Regex.test(t))}class ZodString extends ZodType{_parse(t){let r;if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==ZodParsedType.string){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.string,received:r.parsedType}),INVALID}let i=new ParseStatus;for(let n of this._def.checks)if("min"===n.kind)t.data.length<n.value&&(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),i.dirty());else if("max"===n.kind)t.data.length>n.value&&(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),i.dirty());else if("length"===n.kind){let a=t.data.length>n.value,s=t.data.length<n.value;(a||s)&&(r=this._getOrReturnCtx(t,r),a?addIssueToContext(r,{code:ZodIssueCode.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):s&&addIssueToContext(r,{code:ZodIssueCode.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),i.dirty())}else if("email"===n.kind)emailRegex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"email",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty());else if("emoji"===n.kind)emojiRegex||(emojiRegex=RegExp(_emojiRegex,"u")),emojiRegex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"emoji",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty());else if("uuid"===n.kind)uuidRegex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"uuid",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty());else if("nanoid"===n.kind)nanoidRegex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"nanoid",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty());else if("cuid"===n.kind)cuidRegex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"cuid",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty());else if("cuid2"===n.kind)cuid2Regex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"cuid2",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty());else if("ulid"===n.kind)ulidRegex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"ulid",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty());else if("url"===n.kind)try{new URL(t.data)}catch(a){addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"url",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty()}else"regex"===n.kind?(n.regex.lastIndex=0,n.regex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"regex",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty())):"trim"===n.kind?t.data=t.data.trim():"includes"===n.kind?t.data.includes(n.value,n.position)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),i.dirty()):"toLowerCase"===n.kind?t.data=t.data.toLowerCase():"toUpperCase"===n.kind?t.data=t.data.toUpperCase():"startsWith"===n.kind?t.data.startsWith(n.value)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.invalid_string,validation:{startsWith:n.value},message:n.message}),i.dirty()):"endsWith"===n.kind?t.data.endsWith(n.value)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.invalid_string,validation:{endsWith:n.value},message:n.message}),i.dirty()):"datetime"===n.kind?datetimeRegex(n).test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.invalid_string,validation:"datetime",message:n.message}),i.dirty()):"date"===n.kind?dateRegex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.invalid_string,validation:"date",message:n.message}),i.dirty()):"time"===n.kind?timeRegex(n).test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.invalid_string,validation:"time",message:n.message}),i.dirty()):"duration"===n.kind?durationRegex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"duration",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty()):"ip"===n.kind?isValidIP(t.data,n.version)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"ip",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty()):"base64"===n.kind?base64Regex.test(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{validation:"base64",code:ZodIssueCode.invalid_string,message:n.message}),i.dirty()):util$1.assertNever(n);return{status:i.value,value:t.data}}_regex(t,r,i){return this.refinement(r=>t.test(r),{validation:r,code:ZodIssueCode.invalid_string,...errorUtil.errToObj(i)})}_addCheck(t){return new ZodString({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...errorUtil.errToObj(t)})}url(t){return this._addCheck({kind:"url",...errorUtil.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...errorUtil.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...errorUtil.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...errorUtil.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...errorUtil.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...errorUtil.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...errorUtil.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...errorUtil.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...errorUtil.errToObj(t)})}datetime(t){var r,i;return"string"==typeof t?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:void 0===(null==t?void 0:t.precision)?null:null==t?void 0:t.precision,offset:null!=(r=null==t?void 0:t.offset)&&r,local:null!=(i=null==t?void 0:t.local)&&i,...errorUtil.errToObj(null==t?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return"string"==typeof t?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:void 0===(null==t?void 0:t.precision)?null:null==t?void 0:t.precision,...errorUtil.errToObj(null==t?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...errorUtil.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...errorUtil.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:null==r?void 0:r.position,...errorUtil.errToObj(null==r?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...errorUtil.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...errorUtil.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...errorUtil.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...errorUtil.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...errorUtil.errToObj(r)})}nonempty(t){return this.min(1,errorUtil.errToObj(t))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>"datetime"===t.kind)}get isDate(){return!!this._def.checks.find(t=>"date"===t.kind)}get isTime(){return!!this._def.checks.find(t=>"time"===t.kind)}get isDuration(){return!!this._def.checks.find(t=>"duration"===t.kind)}get isEmail(){return!!this._def.checks.find(t=>"email"===t.kind)}get isURL(){return!!this._def.checks.find(t=>"url"===t.kind)}get isEmoji(){return!!this._def.checks.find(t=>"emoji"===t.kind)}get isUUID(){return!!this._def.checks.find(t=>"uuid"===t.kind)}get isNANOID(){return!!this._def.checks.find(t=>"nanoid"===t.kind)}get isCUID(){return!!this._def.checks.find(t=>"cuid"===t.kind)}get isCUID2(){return!!this._def.checks.find(t=>"cuid2"===t.kind)}get isULID(){return!!this._def.checks.find(t=>"ulid"===t.kind)}get isIP(){return!!this._def.checks.find(t=>"ip"===t.kind)}get isBase64(){return!!this._def.checks.find(t=>"base64"===t.kind)}get minLength(){let t=null;for(let r of this._def.checks)"min"===r.kind&&(null===t||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(let r of this._def.checks)"max"===r.kind&&(null===t||r.value<t)&&(t=r.value);return t}}function floatSafeRemainder(t,r){let i=(t.toString().split(".")[1]||"").length,n=(r.toString().split(".")[1]||"").length,a=i>n?i:n;return parseInt(t.toFixed(a).replace(".",""))%parseInt(r.toFixed(a).replace(".",""))/Math.pow(10,a)}ZodString.create=t=>{var r;return new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,coerce:null!=(r=null==t?void 0:t.coerce)&&r,...processCreateParams(t)})};class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){let r;if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==ZodParsedType.number){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.number,received:r.parsedType}),INVALID}let i=new ParseStatus;for(let n of this._def.checks)"int"===n.kind?util$1.isInteger(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.invalid_type,expected:"integer",received:"float",message:n.message}),i.dirty()):"min"===n.kind?(n.inclusive?t.data<n.value:t.data<=n.value)&&(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):"max"===n.kind?(n.inclusive?t.data>n.value:t.data>=n.value)&&(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),i.dirty()):"multipleOf"===n.kind?0!==floatSafeRemainder(t.data,n.value)&&(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):"finite"===n.kind?Number.isFinite(t.data)||(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.not_finite,message:n.message}),i.dirty()):util$1.assertNever(n);return{status:i.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,errorUtil.toString(r))}gt(t,r){return this.setLimit("min",t,!1,errorUtil.toString(r))}lte(t,r){return this.setLimit("max",t,!0,errorUtil.toString(r))}lt(t,r){return this.setLimit("max",t,!1,errorUtil.toString(r))}setLimit(t,r,i,n){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:i,message:errorUtil.toString(n)}]})}_addCheck(t){return new ZodNumber({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:errorUtil.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:errorUtil.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:errorUtil.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:errorUtil.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:errorUtil.toString(t)})}get minValue(){let t=null;for(let r of this._def.checks)"min"===r.kind&&(null===t||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)"max"===r.kind&&(null===t||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>"int"===t.kind||"multipleOf"===t.kind&&util$1.isInteger(t.value))}get isFinite(){let t=null,r=null;for(let i of this._def.checks){if("finite"===i.kind||"int"===i.kind||"multipleOf"===i.kind)return!0;"min"===i.kind?(null===r||i.value>r)&&(r=i.value):"max"===i.kind&&(null===t||i.value<t)&&(t=i.value)}return Number.isFinite(r)&&Number.isFinite(t)}}ZodNumber.create=t=>new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,coerce:(null==t?void 0:t.coerce)||!1,...processCreateParams(t)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){let r;if(this._def.coerce&&(t.data=BigInt(t.data)),this._getType(t)!==ZodParsedType.bigint){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.bigint,received:r.parsedType}),INVALID}let i=new ParseStatus;for(let n of this._def.checks)"min"===n.kind?(n.inclusive?t.data<n.value:t.data<=n.value)&&(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):"max"===n.kind?(n.inclusive?t.data>n.value:t.data>=n.value)&&(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),i.dirty()):"multipleOf"===n.kind?t.data%n.value!==BigInt(0)&&(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.not_multiple_of,multipleOf:n.value,message:n.message}),i.dirty()):util$1.assertNever(n);return{status:i.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,errorUtil.toString(r))}gt(t,r){return this.setLimit("min",t,!1,errorUtil.toString(r))}lte(t,r){return this.setLimit("max",t,!0,errorUtil.toString(r))}lt(t,r){return this.setLimit("max",t,!1,errorUtil.toString(r))}setLimit(t,r,i,n){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:i,message:errorUtil.toString(n)}]})}_addCheck(t){return new ZodBigInt({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:errorUtil.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:errorUtil.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:errorUtil.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:errorUtil.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:errorUtil.toString(r)})}get minValue(){let t=null;for(let r of this._def.checks)"min"===r.kind&&(null===t||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(let r of this._def.checks)"max"===r.kind&&(null===t||r.value<t)&&(t=r.value);return t}}ZodBigInt.create=t=>{var r;return new ZodBigInt({checks:[],typeName:ZodFirstPartyTypeKind.ZodBigInt,coerce:null!=(r=null==t?void 0:t.coerce)&&r,...processCreateParams(t)})};class ZodBoolean extends ZodType{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==ZodParsedType.boolean){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.boolean,received:r.parsedType}),INVALID}return OK(t.data)}}ZodBoolean.create=t=>new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,coerce:(null==t?void 0:t.coerce)||!1,...processCreateParams(t)});class ZodDate extends ZodType{_parse(t){let r;if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==ZodParsedType.date){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.date,received:r.parsedType}),INVALID}if(isNaN(t.data.getTime()))return addIssueToContext(this._getOrReturnCtx(t),{code:ZodIssueCode.invalid_date}),INVALID;let i=new ParseStatus;for(let n of this._def.checks)"min"===n.kind?t.data.getTime()<n.value&&(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),i.dirty()):"max"===n.kind?t.data.getTime()>n.value&&(addIssueToContext(r=this._getOrReturnCtx(t,r),{code:ZodIssueCode.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),i.dirty()):util$1.assertNever(n);return{status:i.value,value:new Date(t.data.getTime())}}_addCheck(t){return new ZodDate({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:errorUtil.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:errorUtil.toString(r)})}get minDate(){let t=null;for(let r of this._def.checks)"min"===r.kind&&(null===t||r.value>t)&&(t=r.value);return null!=t?new Date(t):null}get maxDate(){let t=null;for(let r of this._def.checks)"max"===r.kind&&(null===t||r.value<t)&&(t=r.value);return null!=t?new Date(t):null}}ZodDate.create=t=>new ZodDate({checks:[],coerce:(null==t?void 0:t.coerce)||!1,typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(t)});class ZodSymbol extends ZodType{_parse(t){if(this._getType(t)!==ZodParsedType.symbol){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.symbol,received:r.parsedType}),INVALID}return OK(t.data)}}ZodSymbol.create=t=>new ZodSymbol({typeName:ZodFirstPartyTypeKind.ZodSymbol,...processCreateParams(t)});class ZodUndefined extends ZodType{_parse(t){if(this._getType(t)!==ZodParsedType.undefined){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.undefined,received:r.parsedType}),INVALID}return OK(t.data)}}ZodUndefined.create=t=>new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(t)});class ZodNull extends ZodType{_parse(t){if(this._getType(t)!==ZodParsedType.null){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.null,received:r.parsedType}),INVALID}return OK(t.data)}}ZodNull.create=t=>new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(t)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(t){return OK(t.data)}}ZodAny.create=t=>new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(t)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(t){return OK(t.data)}}ZodUnknown.create=t=>new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(t)});class ZodNever extends ZodType{_parse(t){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.never,received:r.parsedType}),INVALID}}ZodNever.create=t=>new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(t)});class ZodVoid extends ZodType{_parse(t){if(this._getType(t)!==ZodParsedType.undefined){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.void,received:r.parsedType}),INVALID}return OK(t.data)}}ZodVoid.create=t=>new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(t)});class ZodArray extends ZodType{_parse(t){let{ctx:r,status:i}=this._processInputParams(t),n=this._def;if(r.parsedType!==ZodParsedType.array)return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:r.parsedType}),INVALID;if(null!==n.exactLength){let t=r.data.length>n.exactLength.value,a=r.data.length<n.exactLength.value;(t||a)&&(addIssueToContext(r,{code:t?ZodIssueCode.too_big:ZodIssueCode.too_small,minimum:a?n.exactLength.value:void 0,maximum:t?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),i.dirty())}if(null!==n.minLength&&r.data.length<n.minLength.value&&(addIssueToContext(r,{code:ZodIssueCode.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),i.dirty()),null!==n.maxLength&&r.data.length>n.maxLength.value&&(addIssueToContext(r,{code:ZodIssueCode.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),i.dirty()),r.common.async)return Promise.all([...r.data].map((t,i)=>n.type._parseAsync(new ParseInputLazyPath(r,t,r.path,i)))).then(t=>ParseStatus.mergeArray(i,t));let a=[...r.data].map((t,i)=>n.type._parseSync(new ParseInputLazyPath(r,t,r.path,i)));return ParseStatus.mergeArray(i,a)}get element(){return this._def.type}min(t,r){return new ZodArray({...this._def,minLength:{value:t,message:errorUtil.toString(r)}})}max(t,r){return new ZodArray({...this._def,maxLength:{value:t,message:errorUtil.toString(r)}})}length(t,r){return new ZodArray({...this._def,exactLength:{value:t,message:errorUtil.toString(r)}})}nonempty(t){return this.min(1,t)}}function deepPartialify(t){if(t instanceof ZodObject){let r={};for(let i in t.shape){let n=t.shape[i];r[i]=ZodOptional.create(deepPartialify(n))}return new ZodObject({...t._def,shape:()=>r})}return t instanceof ZodArray?new ZodArray({...t._def,type:deepPartialify(t.element)}):t instanceof ZodOptional?ZodOptional.create(deepPartialify(t.unwrap())):t instanceof ZodNullable?ZodNullable.create(deepPartialify(t.unwrap())):t instanceof ZodTuple?ZodTuple.create(t.items.map(t=>deepPartialify(t))):t}ZodArray.create=(t,r)=>new ZodArray({type:t,minLength:null,maxLength:null,exactLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(r)});class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let t=this._def.shape(),r=util$1.objectKeys(t);return this._cached={shape:t,keys:r}}_parse(t){if(this._getType(t)!==ZodParsedType.object){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:r.parsedType}),INVALID}let{status:r,ctx:i}=this._processInputParams(t),{shape:n,keys:a}=this._getCached(),s=[];if(!(this._def.catchall instanceof ZodNever&&"strip"===this._def.unknownKeys))for(let t in i.data)a.includes(t)||s.push(t);let o=[];for(let t of a){let r=n[t],a=i.data[t];o.push({key:{status:"valid",value:t},value:r._parse(new ParseInputLazyPath(i,a,i.path,t)),alwaysSet:t in i.data})}if(this._def.catchall instanceof ZodNever){let t=this._def.unknownKeys;if("passthrough"===t)for(let t of s)o.push({key:{status:"valid",value:t},value:{status:"valid",value:i.data[t]}});else if("strict"===t)s.length>0&&(addIssueToContext(i,{code:ZodIssueCode.unrecognized_keys,keys:s}),r.dirty());else if("strip"!==t)throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let t=this._def.catchall;for(let r of s){let n=i.data[r];o.push({key:{status:"valid",value:r},value:t._parse(new ParseInputLazyPath(i,n,i.path,r)),alwaysSet:r in i.data})}}return i.common.async?Promise.resolve().then(async()=>{let t=[];for(let r of o){let i=await r.key,n=await r.value;t.push({key:i,value:n,alwaysSet:r.alwaysSet})}return t}).then(t=>ParseStatus.mergeObjectSync(r,t)):ParseStatus.mergeObjectSync(r,o)}get shape(){return this._def.shape()}strict(t){return errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...void 0!==t?{errorMap:(r,i)=>{var n,a,s,o;let l=null!=(s=null==(a=(n=this._def).errorMap)?void 0:a.call(n,r,i).message)?s:i.defaultError;return"unrecognized_keys"===r.code?{message:null!=(o=errorUtil.errToObj(t).message)?o:l}:{message:l}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(t){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new ZodObject({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:ZodFirstPartyTypeKind.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new ZodObject({...this._def,catchall:t})}pick(t){let r={};return util$1.objectKeys(t).forEach(i=>{t[i]&&this.shape[i]&&(r[i]=this.shape[i])}),new ZodObject({...this._def,shape:()=>r})}omit(t){let r={};return util$1.objectKeys(this.shape).forEach(i=>{t[i]||(r[i]=this.shape[i])}),new ZodObject({...this._def,shape:()=>r})}deepPartial(){return deepPartialify(this)}partial(t){let r={};return util$1.objectKeys(this.shape).forEach(i=>{let n=this.shape[i];t&&!t[i]?r[i]=n:r[i]=n.optional()}),new ZodObject({...this._def,shape:()=>r})}required(t){let r={};return util$1.objectKeys(this.shape).forEach(i=>{if(t&&!t[i])r[i]=this.shape[i];else{let t=this.shape[i];for(;t instanceof ZodOptional;)t=t._def.innerType;r[i]=t}}),new ZodObject({...this._def,shape:()=>r})}keyof(){return createZodEnum(util$1.objectKeys(this.shape))}}ZodObject.create=(t,r)=>new ZodObject({shape:()=>t,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(r)}),ZodObject.strictCreate=(t,r)=>new ZodObject({shape:()=>t,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(r)}),ZodObject.lazycreate=(t,r)=>new ZodObject({shape:t,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(r)});class ZodUnion extends ZodType{_parse(t){let{ctx:r}=this._processInputParams(t),i=this._def.options;if(r.common.async)return Promise.all(i.map(async t=>{let i={...r,common:{...r.common,issues:[]},parent:null};return{result:await t._parseAsync({data:r.data,path:r.path,parent:i}),ctx:i}})).then(function(t){for(let r of t)if("valid"===r.result.status)return r.result;for(let i of t)if("dirty"===i.result.status)return r.common.issues.push(...i.ctx.common.issues),i.result;let i=t.map(t=>new ZodError(t.ctx.common.issues));return addIssueToContext(r,{code:ZodIssueCode.invalid_union,unionErrors:i}),INVALID});{let t,n=[];for(let a of i){let i={...r,common:{...r.common,issues:[]},parent:null},s=a._parseSync({data:r.data,path:r.path,parent:i});if("valid"===s.status)return s;"dirty"!==s.status||t||(t={result:s,ctx:i}),i.common.issues.length&&n.push(i.common.issues)}if(t)return r.common.issues.push(...t.ctx.common.issues),t.result;let a=n.map(t=>new ZodError(t));return addIssueToContext(r,{code:ZodIssueCode.invalid_union,unionErrors:a}),INVALID}}get options(){return this._def.options}}ZodUnion.create=(t,r)=>new ZodUnion({options:t,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(r)});let getDiscriminator=t=>t instanceof ZodLazy?getDiscriminator(t.schema):t instanceof ZodEffects?getDiscriminator(t.innerType()):t instanceof ZodLiteral?[t.value]:t instanceof ZodEnum?t.options:t instanceof ZodNativeEnum?util$1.objectValues(t.enum):t instanceof ZodDefault?getDiscriminator(t._def.innerType):t instanceof ZodUndefined?[void 0]:t instanceof ZodNull?[null]:t instanceof ZodOptional?[void 0,...getDiscriminator(t.unwrap())]:t instanceof ZodNullable?[null,...getDiscriminator(t.unwrap())]:t instanceof ZodBranded||t instanceof ZodReadonly?getDiscriminator(t.unwrap()):t instanceof ZodCatch?getDiscriminator(t._def.innerType):[];class ZodDiscriminatedUnion extends ZodType{_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==ZodParsedType.object)return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:r.parsedType}),INVALID;let i=this.discriminator,n=r.data[i],a=this.optionsMap.get(n);return a?r.common.async?a._parseAsync({data:r.data,path:r.path,parent:r}):a._parseSync({data:r.data,path:r.path,parent:r}):(addIssueToContext(r,{code:ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[i]}),INVALID)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,r,i){let n=new Map;for(let i of r){let r=getDiscriminator(i.shape[t]);if(!r.length)throw Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(let a of r){if(n.has(a))throw Error(`Discriminator property ${String(t)} has duplicate value ${String(a)}`);n.set(a,i)}}return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator:t,options:r,optionsMap:n,...processCreateParams(i)})}}function mergeValues(t,r){let i=getParsedType(t),n=getParsedType(r);if(t===r)return{valid:!0,data:t};if(i===ZodParsedType.object&&n===ZodParsedType.object){let i=util$1.objectKeys(r),n=util$1.objectKeys(t).filter(t=>-1!==i.indexOf(t)),a={...t,...r};for(let i of n){let n=mergeValues(t[i],r[i]);if(!n.valid)return{valid:!1};a[i]=n.data}return{valid:!0,data:a}}if(i===ZodParsedType.array&&n===ZodParsedType.array){if(t.length!==r.length)return{valid:!1};let i=[];for(let n=0;n<t.length;n++){let a=mergeValues(t[n],r[n]);if(!a.valid)return{valid:!1};i.push(a.data)}return{valid:!0,data:i}}return i===ZodParsedType.date&&n===ZodParsedType.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}class ZodIntersection extends ZodType{_parse(t){let{status:r,ctx:i}=this._processInputParams(t),n=(t,n)=>{if(isAborted(t)||isAborted(n))return INVALID;let a=mergeValues(t.value,n.value);return a.valid?((isDirty(t)||isDirty(n))&&r.dirty(),{status:r.value,value:a.data}):(addIssueToContext(i,{code:ZodIssueCode.invalid_intersection_types}),INVALID)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([t,r])=>n(t,r)):n(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}ZodIntersection.create=(t,r,i)=>new ZodIntersection({left:t,right:r,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(i)});class ZodTuple extends ZodType{_parse(t){let{status:r,ctx:i}=this._processInputParams(t);if(i.parsedType!==ZodParsedType.array)return addIssueToContext(i,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:i.parsedType}),INVALID;if(i.data.length<this._def.items.length)return addIssueToContext(i,{code:ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),INVALID;!this._def.rest&&i.data.length>this._def.items.length&&(addIssueToContext(i,{code:ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());let n=[...i.data].map((t,r)=>{let n=this._def.items[r]||this._def.rest;return n?n._parse(new ParseInputLazyPath(i,t,i.path,r)):null}).filter(t=>!!t);return i.common.async?Promise.all(n).then(t=>ParseStatus.mergeArray(r,t)):ParseStatus.mergeArray(r,n)}get items(){return this._def.items}rest(t){return new ZodTuple({...this._def,rest:t})}}ZodTuple.create=(t,r)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:t,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(r)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:r,ctx:i}=this._processInputParams(t);if(i.parsedType!==ZodParsedType.object)return addIssueToContext(i,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:i.parsedType}),INVALID;let n=[],a=this._def.keyType,s=this._def.valueType;for(let t in i.data)n.push({key:a._parse(new ParseInputLazyPath(i,t,i.path,t)),value:s._parse(new ParseInputLazyPath(i,i.data[t],i.path,t)),alwaysSet:t in i.data});return i.common.async?ParseStatus.mergeObjectAsync(r,n):ParseStatus.mergeObjectSync(r,n)}get element(){return this._def.valueType}static create(t,r,i){return new ZodRecord(r instanceof ZodType?{keyType:t,valueType:r,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(i)}:{keyType:ZodString.create(),valueType:t,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(r)})}}class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:r,ctx:i}=this._processInputParams(t);if(i.parsedType!==ZodParsedType.map)return addIssueToContext(i,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.map,received:i.parsedType}),INVALID;let n=this._def.keyType,a=this._def.valueType,s=[...i.data.entries()].map(([t,r],s)=>({key:n._parse(new ParseInputLazyPath(i,t,i.path,[s,"key"])),value:a._parse(new ParseInputLazyPath(i,r,i.path,[s,"value"]))}));if(i.common.async){let t=new Map;return Promise.resolve().then(async()=>{for(let i of s){let n=await i.key,a=await i.value;if("aborted"===n.status||"aborted"===a.status)return INVALID;"dirty"!==n.status&&"dirty"!==a.status||r.dirty(),t.set(n.value,a.value)}return{status:r.value,value:t}})}{let t=new Map;for(let i of s){let n=i.key,a=i.value;if("aborted"===n.status||"aborted"===a.status)return INVALID;"dirty"!==n.status&&"dirty"!==a.status||r.dirty(),t.set(n.value,a.value)}return{status:r.value,value:t}}}}ZodMap.create=(t,r,i)=>new ZodMap({valueType:r,keyType:t,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(i)});class ZodSet extends ZodType{_parse(t){let{status:r,ctx:i}=this._processInputParams(t);if(i.parsedType!==ZodParsedType.set)return addIssueToContext(i,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.set,received:i.parsedType}),INVALID;let n=this._def;null!==n.minSize&&i.data.size<n.minSize.value&&(addIssueToContext(i,{code:ZodIssueCode.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),r.dirty()),null!==n.maxSize&&i.data.size>n.maxSize.value&&(addIssueToContext(i,{code:ZodIssueCode.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),r.dirty());let a=this._def.valueType;function s(t){let i=new Set;for(let n of t){if("aborted"===n.status)return INVALID;"dirty"===n.status&&r.dirty(),i.add(n.value)}return{status:r.value,value:i}}let o=[...i.data.values()].map((t,r)=>a._parse(new ParseInputLazyPath(i,t,i.path,r)));return i.common.async?Promise.all(o).then(t=>s(t)):s(o)}min(t,r){return new ZodSet({...this._def,minSize:{value:t,message:errorUtil.toString(r)}})}max(t,r){return new ZodSet({...this._def,maxSize:{value:t,message:errorUtil.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}ZodSet.create=(t,r)=>new ZodSet({valueType:t,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(r)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(t){let{ctx:r}=this._processInputParams(t);if(r.parsedType!==ZodParsedType.function)return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.function,received:r.parsedType}),INVALID;function i(t,i){return makeIssue({data:t,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,getErrorMap(),errorMap].filter(t=>!!t),issueData:{code:ZodIssueCode.invalid_arguments,argumentsError:i}})}function n(t,i){return makeIssue({data:t,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,getErrorMap(),errorMap].filter(t=>!!t),issueData:{code:ZodIssueCode.invalid_return_type,returnTypeError:i}})}let a={errorMap:r.common.contextualErrorMap},s=r.data;if(this._def.returns instanceof ZodPromise){let t=this;return OK(async function(...r){let o=new ZodError([]),l=await t._def.args.parseAsync(r,a).catch(t=>{throw o.addIssue(i(r,t)),o}),u=await Reflect.apply(s,this,l);return await t._def.returns._def.type.parseAsync(u,a).catch(t=>{throw o.addIssue(n(u,t)),o})})}{let t=this;return OK(function(...r){let o=t._def.args.safeParse(r,a);if(!o.success)throw new ZodError([i(r,o.error)]);let l=Reflect.apply(s,this,o.data),u=t._def.returns.safeParse(l,a);if(!u.success)throw new ZodError([n(l,u.error)]);return u.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new ZodFunction({...this._def,args:ZodTuple.create(t).rest(ZodUnknown.create())})}returns(t){return new ZodFunction({...this._def,returns:t})}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,r,i){return new ZodFunction({args:t||ZodTuple.create([]).rest(ZodUnknown.create()),returns:r||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(i)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(t){let{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}ZodLazy.create=(t,r)=>new ZodLazy({getter:t,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(r)});class ZodLiteral extends ZodType{_parse(t){if(t.data!==this._def.value){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{received:r.data,code:ZodIssueCode.invalid_literal,expected:this._def.value}),INVALID}return{status:"valid",value:t.data}}get value(){return this._def.value}}function createZodEnum(t,r){return new ZodEnum({values:t,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(r)})}ZodLiteral.create=(t,r)=>new ZodLiteral({value:t,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(r)});class ZodEnum extends ZodType{constructor(){super(...arguments),_ZodEnum_cache.set(this,void 0)}_parse(t){if("string"!=typeof t.data){let r=this._getOrReturnCtx(t),i=this._def.values;return addIssueToContext(r,{expected:util$1.joinValues(i),received:r.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodEnum_cache)||__classPrivateFieldSet(this,_ZodEnum_cache,new Set(this._def.values)),!__classPrivateFieldGet(this,_ZodEnum_cache).has(t.data)){let r=this._getOrReturnCtx(t),i=this._def.values;return addIssueToContext(r,{received:r.data,code:ZodIssueCode.invalid_enum_value,options:i}),INVALID}return OK(t.data)}get options(){return this._def.values}get enum(){let t={};for(let r of this._def.values)t[r]=r;return t}get Values(){let t={};for(let r of this._def.values)t[r]=r;return t}get Enum(){let t={};for(let r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return ZodEnum.create(t,{...this._def,...r})}exclude(t,r=this._def){return ZodEnum.create(this.options.filter(r=>!t.includes(r)),{...this._def,...r})}}_ZodEnum_cache=new WeakMap,ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{constructor(){super(...arguments),_ZodNativeEnum_cache.set(this,void 0)}_parse(t){let r=util$1.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(t);if(i.parsedType!==ZodParsedType.string&&i.parsedType!==ZodParsedType.number){let t=util$1.objectValues(r);return addIssueToContext(i,{expected:util$1.joinValues(t),received:i.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(__classPrivateFieldGet(this,_ZodNativeEnum_cache)||__classPrivateFieldSet(this,_ZodNativeEnum_cache,new Set(util$1.getValidEnumValues(this._def.values))),!__classPrivateFieldGet(this,_ZodNativeEnum_cache).has(t.data)){let t=util$1.objectValues(r);return addIssueToContext(i,{received:i.data,code:ZodIssueCode.invalid_enum_value,options:t}),INVALID}return OK(t.data)}get enum(){return this._def.values}}_ZodNativeEnum_cache=new WeakMap,ZodNativeEnum.create=(t,r)=>new ZodNativeEnum({values:t,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(r)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(t){let{ctx:r}=this._processInputParams(t);return r.parsedType!==ZodParsedType.promise&&!1===r.common.async?(addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.promise,received:r.parsedType}),INVALID):OK((r.parsedType===ZodParsedType.promise?r.data:Promise.resolve(r.data)).then(t=>this._def.type.parseAsync(t,{path:r.path,errorMap:r.common.contextualErrorMap})))}}ZodPromise.create=(t,r)=>new ZodPromise({type:t,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(r)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ZodFirstPartyTypeKind.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:r,ctx:i}=this._processInputParams(t),n=this._def.effect||null,a={addIssue:t=>{addIssueToContext(i,t),t.fatal?r.abort():r.dirty()},get path(){return i.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===n.type){let t=n.transform(i.data,a);if(i.common.async)return Promise.resolve(t).then(async t=>{if("aborted"===r.value)return INVALID;let n=await this._def.schema._parseAsync({data:t,path:i.path,parent:i});return"aborted"===n.status?INVALID:"dirty"===n.status||"dirty"===r.value?DIRTY(n.value):n});{if("aborted"===r.value)return INVALID;let n=this._def.schema._parseSync({data:t,path:i.path,parent:i});return"aborted"===n.status?INVALID:"dirty"===n.status||"dirty"===r.value?DIRTY(n.value):n}}if("refinement"===n.type){let t=t=>{let r=n.refinement(t,a);if(i.common.async)return Promise.resolve(r);if(r instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return t};if(!1===i.common.async){let n=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===n.status?INVALID:("dirty"===n.status&&r.dirty(),t(n.value),{status:r.value,value:n.value})}return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(i=>"aborted"===i.status?INVALID:("dirty"===i.status&&r.dirty(),t(i.value).then(()=>({status:r.value,value:i.value}))))}if("transform"===n.type){if(!1===i.common.async){let t=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!isValid(t))return t;let s=n.transform(t.value,a);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:s}}return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(t=>isValid(t)?Promise.resolve(n.transform(t.value,a)).then(t=>({status:r.value,value:t})):t)}util$1.assertNever(n)}}ZodEffects.create=(t,r,i)=>new ZodEffects({schema:t,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:r,...processCreateParams(i)}),ZodEffects.createWithPreprocess=(t,r,i)=>new ZodEffects({schema:r,effect:{type:"preprocess",transform:t},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(i)});class ZodOptional extends ZodType{_parse(t){return this._getType(t)===ZodParsedType.undefined?OK(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}ZodOptional.create=(t,r)=>new ZodOptional({innerType:t,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(r)});class ZodNullable extends ZodType{_parse(t){return this._getType(t)===ZodParsedType.null?OK(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}ZodNullable.create=(t,r)=>new ZodNullable({innerType:t,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(r)});class ZodDefault extends ZodType{_parse(t){let{ctx:r}=this._processInputParams(t),i=r.data;return r.parsedType===ZodParsedType.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}ZodDefault.create=(t,r)=>new ZodDefault({innerType:t,typeName:ZodFirstPartyTypeKind.ZodDefault,defaultValue:"function"==typeof r.default?r.default:()=>r.default,...processCreateParams(r)});class ZodCatch extends ZodType{_parse(t){let{ctx:r}=this._processInputParams(t),i={...r,common:{...r.common,issues:[]}},n=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return isAsync(n)?n.then(t=>({status:"valid",value:"valid"===t.status?t.value:this._def.catchValue({get error(){return new ZodError(i.common.issues)},input:i.data})})):{status:"valid",value:"valid"===n.status?n.value:this._def.catchValue({get error(){return new ZodError(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(t,r)=>new ZodCatch({innerType:t,typeName:ZodFirstPartyTypeKind.ZodCatch,catchValue:"function"==typeof r.catch?r.catch:()=>r.catch,...processCreateParams(r)});class ZodNaN extends ZodType{_parse(t){if(this._getType(t)!==ZodParsedType.nan){let r=this._getOrReturnCtx(t);return addIssueToContext(r,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.nan,received:r.parsedType}),INVALID}return{status:"valid",value:t.data}}}ZodNaN.create=t=>new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(t)});let BRAND=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(t){let{ctx:r}=this._processInputParams(t),i=r.data;return this._def.type._parse({data:i,path:r.path,parent:r})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(t){let{status:r,ctx:i}=this._processInputParams(t);if(i.common.async)return(async()=>{let t=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return"aborted"===t.status?INVALID:"dirty"===t.status?(r.dirty(),DIRTY(t.value)):this._def.out._parseAsync({data:t.value,path:i.path,parent:i})})();{let t=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return"aborted"===t.status?INVALID:"dirty"===t.status?(r.dirty(),{status:"dirty",value:t.value}):this._def.out._parseSync({data:t.value,path:i.path,parent:i})}}static create(t,r){return new ZodPipeline({in:t,out:r,typeName:ZodFirstPartyTypeKind.ZodPipeline})}}class ZodReadonly extends ZodType{_parse(t){let r=this._def.innerType._parse(t),i=t=>(isValid(t)&&(t.value=Object.freeze(t.value)),t);return isAsync(r)?r.then(t=>i(t)):i(r)}unwrap(){return this._def.innerType}}function custom(t,r={},i){return t?ZodAny.create().superRefine((n,a)=>{var s,o;if(!t(n)){let t="function"==typeof r?r(n):"string"==typeof r?{message:r}:r,l=null==(o=null!=(s=t.fatal)?s:i)||o,u="string"==typeof t?{message:t}:t;a.addIssue({code:"custom",...u,fatal:l})}}):ZodAny.create()}ZodReadonly.create=(t,r)=>new ZodReadonly({innerType:t,typeName:ZodFirstPartyTypeKind.ZodReadonly,...processCreateParams(r)});let late={object:ZodObject.lazycreate};!function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"}(ZodFirstPartyTypeKind||(ZodFirstPartyTypeKind={}));let instanceOfType=(t,r={message:`Input not instance of ${t.name}`})=>custom(r=>r instanceof t,r),stringType=ZodString.create,numberType=ZodNumber.create,nanType=ZodNaN.create,bigIntType=ZodBigInt.create,booleanType=ZodBoolean.create,dateType=ZodDate.create,symbolType=ZodSymbol.create,undefinedType=ZodUndefined.create,nullType=ZodNull.create,anyType=ZodAny.create,unknownType=ZodUnknown.create,neverType=ZodNever.create,voidType=ZodVoid.create,arrayType=ZodArray.create,objectType=ZodObject.create,strictObjectType=ZodObject.strictCreate,unionType=ZodUnion.create,discriminatedUnionType=ZodDiscriminatedUnion.create,intersectionType=ZodIntersection.create,tupleType=ZodTuple.create,recordType=ZodRecord.create,mapType=ZodMap.create,setType=ZodSet.create,functionType=ZodFunction.create,lazyType=ZodLazy.create,literalType=ZodLiteral.create,enumType=ZodEnum.create,nativeEnumType=ZodNativeEnum.create,promiseType=ZodPromise.create,effectsType=ZodEffects.create,optionalType=ZodOptional.create,nullableType=ZodNullable.create,preprocessType=ZodEffects.createWithPreprocess,pipelineType=ZodPipeline.create,ostring=()=>stringType().optional(),onumber=()=>numberType().optional(),oboolean=()=>booleanType().optional(),coerce={string:t=>ZodString.create({...t,coerce:!0}),number:t=>ZodNumber.create({...t,coerce:!0}),boolean:t=>ZodBoolean.create({...t,coerce:!0}),bigint:t=>ZodBigInt.create({...t,coerce:!0}),date:t=>ZodDate.create({...t,coerce:!0})},NEVER=INVALID;var errorUtil,_ZodEnum_cache,_ZodNativeEnum_cache,ZodFirstPartyTypeKind,Edge,Edge2,z=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap:setErrorMap,getErrorMap:getErrorMap,makeIssue:makeIssue,EMPTY_PATH:EMPTY_PATH,addIssueToContext:addIssueToContext,ParseStatus:ParseStatus,INVALID:INVALID,DIRTY:DIRTY,OK:OK,isAborted:isAborted,isDirty:isDirty,isValid:isValid,isAsync:isAsync,get util(){return util$1},get objectUtil(){return objectUtil},ZodParsedType:ZodParsedType,getParsedType:getParsedType,ZodType:ZodType,datetimeRegex:datetimeRegex,ZodString:ZodString,ZodNumber:ZodNumber,ZodBigInt:ZodBigInt,ZodBoolean:ZodBoolean,ZodDate:ZodDate,ZodSymbol:ZodSymbol,ZodUndefined:ZodUndefined,ZodNull:ZodNull,ZodAny:ZodAny,ZodUnknown:ZodUnknown,ZodNever:ZodNever,ZodVoid:ZodVoid,ZodArray:ZodArray,ZodObject:ZodObject,ZodUnion:ZodUnion,ZodDiscriminatedUnion:ZodDiscriminatedUnion,ZodIntersection:ZodIntersection,ZodTuple:ZodTuple,ZodRecord:ZodRecord,ZodMap:ZodMap,ZodSet:ZodSet,ZodFunction:ZodFunction,ZodLazy:ZodLazy,ZodLiteral:ZodLiteral,ZodEnum:ZodEnum,ZodNativeEnum:ZodNativeEnum,ZodPromise:ZodPromise,ZodEffects:ZodEffects,ZodTransformer:ZodEffects,ZodOptional:ZodOptional,ZodNullable:ZodNullable,ZodDefault:ZodDefault,ZodCatch:ZodCatch,ZodNaN:ZodNaN,BRAND:BRAND,ZodBranded:ZodBranded,ZodPipeline:ZodPipeline,ZodReadonly:ZodReadonly,custom:custom,Schema:ZodType,ZodSchema:ZodType,late:late,get ZodFirstPartyTypeKind(){return ZodFirstPartyTypeKind},coerce:coerce,any:anyType,array:arrayType,bigint:bigIntType,boolean:booleanType,date:dateType,discriminatedUnion:discriminatedUnionType,effect:effectsType,enum:enumType,function:functionType,instanceof:instanceOfType,intersection:intersectionType,lazy:lazyType,literal:literalType,map:mapType,nan:nanType,nativeEnum:nativeEnumType,never:neverType,null:nullType,nullable:nullableType,number:numberType,object:objectType,oboolean:oboolean,onumber:onumber,optional:optionalType,ostring:ostring,pipeline:pipelineType,preprocess:preprocessType,promise:promiseType,record:recordType,set:setType,strictObject:strictObjectType,string:stringType,symbol:symbolType,transformer:effectsType,tuple:tupleType,undefined:undefinedType,union:unionType,unknown:unknownType,void:voidType,NEVER:NEVER,ZodIssueCode:ZodIssueCode,quotelessJson:quotelessJson,ZodError:ZodError});Edge2=Edge||(Edge={}),Edge2[Edge2.EXTEND=1]="EXTEND",Edge2[Edge2.WRAP=2]="WRAP",Edge2[Edge2.CROP=3]="CROP";let JimpClassSchema=z.object({bitmap:z.object({data:z.union([z.instanceof(Buffer),z.instanceof(Uint8Array)]),width:z.number(),height:z.number()})}),BlitOptionsSchemaComplex=z.object({src:JimpClassSchema,x:z.number().optional(),y:z.number().optional(),srcX:z.number().optional(),srcY:z.number().optional(),srcW:z.number().optional(),srcH:z.number().optional()}),BlitOptionsSchema=z.union([JimpClassSchema,BlitOptionsSchemaComplex]),methods$h={blit(t,r){let i=BlitOptionsSchema.parse(r),{src:n,x:a=0,y:s=0,srcX:o=0,srcY:l=0,srcW:u=n.bitmap.width,srcH:h=n.bitmap.height}="bitmap"in i?{src:i}:i;if(!("bitmap"in n))throw Error("The source must be a Jimp image");if("number"!=typeof a||"number"!=typeof s)throw Error("x and y must be numbers");a=Math.round(a),s=Math.round(s),o=Math.round(o),l=Math.round(l),u=Math.round(u),h=Math.round(h);let f=t.bitmap.width,d=t.bitmap.height;return scan(n,o,l,u,h,function(r,i,u){let h=a+r-o,c=s+i-l;if(h>=0&&c>=0&&f-h>0&&d-c>0){let r=t.getPixelIndex(h,c),i={r:n.bitmap.data[u]||0,g:n.bitmap.data[u+1]||0,b:n.bitmap.data[u+2]||0,a:n.bitmap.data[u+3]||0},a={r:t.bitmap.data[r]||0,g:t.bitmap.data[r+1]||0,b:t.bitmap.data[r+2]||0,a:t.bitmap.data[r+3]||0};t.bitmap.data[r]=(i.a*(i.r-a.r)-a.r+255>>8)+a.r,t.bitmap.data[r+1]=(i.a*(i.g-a.g)-a.g+255>>8)+a.g,t.bitmap.data[r+2]=(i.a*(i.b-a.b)-a.b+255>>8)+a.b,t.bitmap.data[r+3]=limit255(a.a+i.a)}}),t}},mulTable=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1],shgTable=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18],methods$g={blur(t,r){let i,n,a,s,o,l,u,h,f,d,c,p,m;if("number"!=typeof r)throw Error("r must be a number");if(r<1)throw Error("r must be greater than 0");let g=t.bitmap.width-1,_=t.bitmap.height-1,b=r+1,y=mulTable[r],v=shgTable[r],w=[],x=[],k=[],E=[],S=[],$=[],I=2;for(;I-- >0;){for(p=0,m=0,l=0;l<t.bitmap.height;l++){for(i=t.bitmap.data[m]*b,n=t.bitmap.data[m+1]*b,a=t.bitmap.data[m+2]*b,s=t.bitmap.data[m+3]*b,u=1;u<=r;u++)h=m+((u>g?g:u)<<2),i+=t.bitmap.data[h++],n+=t.bitmap.data[h++],a+=t.bitmap.data[h++],s+=t.bitmap.data[h];for(o=0;o<t.bitmap.width;o++)w[p]=i,x[p]=n,k[p]=a,E[p]=s,0===l&&(S[o]=((h=o+b)<g?h:g)<<2,$[o]=(h=o-r)>0?h<<2:0),f=m+S[o],d=m+$[o],i+=t.bitmap.data[f++]-t.bitmap.data[d++],n+=t.bitmap.data[f++]-t.bitmap.data[d++],a+=t.bitmap.data[f++]-t.bitmap.data[d++],s+=t.bitmap.data[f]-t.bitmap.data[d++],p++;m+=t.bitmap.width<<2}for(o=0;o<t.bitmap.width;o++){for(i=w[c=o]*b,n=x[c]*b,a=k[c]*b,s=E[c]*b,u=1;u<=r;u++)c+=u>_?0:t.bitmap.width,i+=w[c],n+=x[c],a+=k[c],s+=E[c];for(p=o<<2,l=0;l<t.bitmap.height;l++)t.bitmap.data[p]=limit255(i*y>>>v),t.bitmap.data[p+1]=limit255(n*y>>>v),t.bitmap.data[p+2]=limit255(a*y>>>v),t.bitmap.data[p+3]=limit255(s*y>>>v),0===o&&(S[l]=((h=l+b)<_?h:_)*t.bitmap.width,$[l]=(h=l-r)>0?h*t.bitmap.width:0),f=o+S[l],d=o+$[l],i+=w[f]-w[d],n+=x[f]-x[d],a+=k[f]-k[d],s+=E[f]-E[d],p+=t.bitmap.width<<2}}return t},gaussian(t,r){if("number"!=typeof r)throw Error("r must be a number");if(r<1)throw Error("r must be greater than 0");let i=Math.ceil(2.57*r),n=2*i+1,a=r*r*2,s=a*Math.PI,o=[];for(let t=0;t<n;t++){let r=[];for(let o=0;o<n;o++){let n=(o-i)**2+(t-i)**2;r[o]=Math.exp(-n/a)/s}o.push(r)}for(let r=0;r<t.bitmap.height;r++)for(let a=0;a<t.bitmap.width;a++){let s=0,l=0,u=0,h=0,f=0;for(let d=0;d<n;d++){for(let c=0;c<n;c++){let n=Math.min(t.bitmap.width-1,Math.max(0,c+a-i)),p=Math.min(t.bitmap.height-1,Math.max(0,d+r-i)),m=o[d][c],g=p*t.bitmap.width+n<<2;s+=t.bitmap.data[g]*m,l+=t.bitmap.data[g+1]*m,u+=t.bitmap.data[g+2]*m,h+=t.bitmap.data[g+3]*m,f+=m}let c=r*t.bitmap.width+a<<2;t.bitmap.data[c]=Math.round(s/f),t.bitmap.data[c+1]=Math.round(l/f),t.bitmap.data[c+2]=Math.round(u/f),t.bitmap.data[c+3]=Math.round(h/f)}}return t}},CircleOptionsSchema=z.object({x:z.number().optional(),y:z.number().optional(),radius:z.number().min(0).optional()}),methods$f={circle(t,r={}){let i=CircleOptionsSchema.parse(r),n=i.radius||(t.bitmap.width>t.bitmap.height?t.bitmap.height:t.bitmap.width)/2,a="number"==typeof i.x?i.x:t.bitmap.width/2,s="number"==typeof i.y?i.y:t.bitmap.height/2;return t.scan((r,i,o)=>{let l=Math.sqrt(Math.pow(r-a,2)+Math.pow(i-s,2));n-l<=0?t.bitmap.data[o+3]=0:n-l<1&&(t.bitmap.data[o+3]=255*(n-l))}),t}},ConvolutionMatrixSchema=z.array(z.number()).min(1).array(),ConvolutionComplexOptionsSchema=z.object({kernel:ConvolutionMatrixSchema,edgeHandling:z.nativeEnum(Edge).optional()}),ConvolutionOptionsSchema=z.union([ConvolutionMatrixSchema,ConvolutionComplexOptionsSchema]),ConvoluteComplexOptionsSchema=z.object({kernel:ConvolutionMatrixSchema,x:z.number().optional(),y:z.number().optional(),w:z.number().optional(),h:z.number().optional()}),ConvoluteOptionsSchema=z.union([ConvolutionMatrixSchema,ConvoluteComplexOptionsSchema]),PixelateSize=z.number().min(1).max(1/0),PixelateComplexOptionsSchema=z.object({size:PixelateSize,x:z.number().optional(),y:z.number().optional(),w:z.number().optional(),h:z.number().optional()}),PixelateOptionsSchema=z.union([PixelateSize,PixelateComplexOptionsSchema]);function applyKernel(t,r,i,n){let a=[0,0,0,0],s=(r.length-1)/2;for(let o=0;o<r.length;o+=1)for(let l=0;l<r[o].length;l+=1){let u=t.getPixelIndex(i+o-s,n+l-s);a[0]+=t.bitmap.data[u]*r[o][l],a[1]+=t.bitmap.data[u+1]*r[o][l],a[2]+=t.bitmap.data[u+2]*r[o][l],a[3]+=t.bitmap.data[u+3]*r[o][l]}return a}function mix(t,r,i=50){return{r:(r.r-t.r)*(i/100)+t.r,g:(r.g-t.g)*(i/100)+t.g,b:(r.b-t.b)*(i/100)+t.b}}let HueActionSchema=z.object({apply:z.literal("hue"),params:z.tuple([z.number().min(-360).max(360)])}),SpinActionSchema=z.object({apply:z.literal("spin"),params:z.tuple([z.number().min(-360).max(360)])}),LightenActionSchema=z.object({apply:z.literal("lighten"),params:z.tuple([z.number().min(0).max(100)]).optional()}),RGBColorSchema=z.object({r:z.number().min(0).max(255),g:z.number().min(0).max(255),b:z.number().min(0).max(255)}),MixActionSchema=z.object({apply:z.literal("mix"),params:z.union([z.tuple([RGBColorSchema]),z.tuple([RGBColorSchema,z.number().min(0).max(100)])])}),TintActionSchema=z.object({apply:z.literal("tint"),params:z.tuple([z.number().min(0).max(100)]).optional()}),ShadeActionSchema=z.object({apply:z.literal("shade"),params:z.tuple([z.number().min(0).max(100)]).optional()}),XorActionSchema=z.object({apply:z.literal("xor"),params:z.tuple([RGBColorSchema])}),RedActionSchema=z.object({apply:z.literal("red"),params:z.tuple([z.number().min(-255).max(255)])}),GreenActionSchema=z.object({apply:z.literal("green"),params:z.tuple([z.number().min(-255).max(255)])}),BlueActionSchema=z.object({apply:z.literal("blue"),params:z.tuple([z.number().min(-255).max(255)])}),BrightenActionSchema=z.object({apply:z.literal("brighten"),params:z.tuple([z.number().min(0).max(100)]).optional()}),DarkenActionSchema=z.object({apply:z.literal("darken"),params:z.tuple([z.number().min(0).max(100)]).optional()}),DesaturateActionSchema=z.object({apply:z.literal("desaturate"),params:z.tuple([z.number().min(0).max(100)]).optional()}),SaturateActionSchema=z.object({apply:z.literal("saturate"),params:z.tuple([z.number().min(0).max(100)]).optional()}),GrayscaleActionSchema=z.object({apply:z.literal("greyscale"),params:z.tuple([]).optional()}),ColorActionNameSchema=z.union([HueActionSchema,SpinActionSchema,LightenActionSchema,MixActionSchema,TintActionSchema,ShadeActionSchema,XorActionSchema,RedActionSchema,GreenActionSchema,BlueActionSchema,BrightenActionSchema,DarkenActionSchema,DesaturateActionSchema,SaturateActionSchema,GrayscaleActionSchema]);function histogram(t){let r={r:Array(256).fill(0),g:Array(256).fill(0),b:Array(256).fill(0)};return t.scan((i,n,a)=>{r.r[t.bitmap.data[a+0]]++,r.g[t.bitmap.data[a+1]]++,r.b[t.bitmap.data[a+2]]++}),r}let normalizeValue=function(t,r,i){return 255*(t-r)/(i-r)},getBounds=function(t){return[t.findIndex(t=>t>0),255-t.slice().reverse().findIndex(t=>t>0)]},methods$e={normalize(t){let r=histogram(t),i={r:getBounds(r.r),g:getBounds(r.g),b:getBounds(r.b)};return t.scan((r,n,a)=>{let s=t.bitmap.data[a+0],o=t.bitmap.data[a+1],l=t.bitmap.data[a+2];t.bitmap.data[a+0]=normalizeValue(s,i.r[0],i.r[1]),t.bitmap.data[a+1]=normalizeValue(o,i.g[0],i.g[1]),t.bitmap.data[a+2]=normalizeValue(l,i.b[0],i.b[1])}),t},invert:t=>(t.scan((r,i,n)=>{t.bitmap.data[n]=255-t.bitmap.data[n],t.bitmap.data[n+1]=255-t.bitmap.data[n+1],t.bitmap.data[n+2]=255-t.bitmap.data[n+2]}),t),brightness(t,r){if("number"!=typeof r)throw Error("val must be numbers");return t.scan((i,n,a)=>{t.bitmap.data[a]=limit255(t.bitmap.data[a]*r),t.bitmap.data[a+1]=limit255(t.bitmap.data[a+1]*r),t.bitmap.data[a+2]=limit255(t.bitmap.data[a+2]*r)}),t},contrast(t,r){if("number"!=typeof r)throw Error("val must be numbers");if(r<-1||r>1)throw Error("val must be a number between -1 and +1");let i=(r+1)/(1-r);function n(t){return(t=Math.floor(i*(t-127)+127))<0?0:t>255?255:t}return t.scan((r,i,a)=>{t.bitmap.data[a]=n(t.bitmap.data[a]),t.bitmap.data[a+1]=n(t.bitmap.data[a+1]),t.bitmap.data[a+2]=n(t.bitmap.data[a+2])}),t},posterize(t,r){if("number"!=typeof r)throw Error("n must be numbers");return r<2&&(r=2),t.scan((i,n,a)=>{let s=t.bitmap.data[a],o=t.bitmap.data[a+1],l=t.bitmap.data[a+2];t.bitmap.data[a]=Math.floor(s/255*(r-1))/(r-1)*255,t.bitmap.data[a+1]=Math.floor(o/255*(r-1))/(r-1)*255,t.bitmap.data[a+2]=Math.floor(l/255*(r-1))/(r-1)*255}),t},greyscale:t=>(t.scan((r,i,n)=>{let a=.2126*t.bitmap.data[n]+.7152*t.bitmap.data[n+1]+.0722*t.bitmap.data[n+2];t.bitmap.data[n]=a,t.bitmap.data[n+1]=a,t.bitmap.data[n+2]=a}),t),opacity(t,r){if("number"!=typeof r)throw Error("f must be a number");if(r<0||r>1)throw Error("f must be a number from 0 to 1");return t.scan((i,n,a)=>{let s=t.bitmap.data[a+3]*r;t.bitmap.data[a+3]=s}),t},sepia:t=>(t.scan((r,i,n)=>{let a=t.bitmap.data[n],s=t.bitmap.data[n+1],o=t.bitmap.data[n+2];s=.349*(a=.393*a+.769*s+.189*o)+.686*s+.168*o,o=.272*a+.534*s+.131*o,t.bitmap.data[n]=a<255?a:255,t.bitmap.data[n+1]=s<255?s:255,t.bitmap.data[n+2]=o<255?o:255}),t),fade(t,r){if("number"!=typeof r)throw Error("f must be a number");if(r<0||r>1)throw Error("f must be a number from 0 to 1");return this.opacity(t,1-r)},convolution(t,r){let i,n,a,s,o,l,u,h,f,d,c=ConvolutionOptionsSchema.parse(r),{kernel:p,edgeHandling:m=Edge.EXTEND}="kernel"in c?c:{kernel:c,edgeHandling:void 0};if(!p[0])throw Error("kernel must be a matrix");let g=Buffer.from(t.bitmap.data),_=p.length,b=p[0].length,y=Math.floor(_/2),v=Math.floor(b/2),w=-y,x=-v;return t.scan((r,c,_)=>{s=0,a=0,n=0;for(let g=w;g<=y;g++)for(let _=x;_<=v;_++)h=r+_,f=c+g,i=p[g+y][_+v],-1===(d=t.getPixelIndex(h,f,m))?(u=0,l=0,o=0):(o=t.bitmap.data[d+0],l=t.bitmap.data[d+1],u=t.bitmap.data[d+2]),n+=i*o,a+=i*l,s+=i*u;n<0&&(n=0),a<0&&(a=0),s<0&&(s=0),n>255&&(n=255),a>255&&(a=255),s>255&&(s=255),g[_+0]=n,g[_+1]=a,g[_+2]=s}),t.bitmap.data=g,t},opaque:t=>(t.scan((r,i,n)=>{t.bitmap.data[n+3]=255}),t),pixelate(t,r){let i=PixelateOptionsSchema.parse(r),{size:n,x:a=0,y:s=0,w:o=t.bitmap.width-a,h:l=t.bitmap.height-s}="number"==typeof i?{size:i}:i,u=[[1/16,2/16,1/16],[2/16,.25,2/16],[1/16,2/16,1/16]],h=clone(t);return scan(h,a,s,o,l,(r,i,a)=>{let s=applyKernel(h,u,r=n*Math.floor(r/n),i=n*Math.floor(i/n));t.bitmap.data[a]=s[0],t.bitmap.data[a+1]=s[1],t.bitmap.data[a+2]=s[2],t.bitmap.data[a+3]=s[3]}),t},convolute(t,r){let i=ConvoluteOptionsSchema.parse(r),{kernel:n,x:a=0,y:s=0,w:o=t.bitmap.width-a,h:l=t.bitmap.height-s}="kernel"in i?i:{kernel:i},u=clone(t);return scan(u,a,s,o,l,(r,i,a)=>{let s=applyKernel(u,n,r,i);t.bitmap.data[a]=limit255(s[0]),t.bitmap.data[a+1]=limit255(s[1]),t.bitmap.data[a+2]=limit255(s[2]),t.bitmap.data[a+3]=limit255(s[3])}),t},color(t,r){if(!r||!Array.isArray(r))throw Error("actions must be an array");return r.forEach(t=>ColorActionNameSchema.parse(t)),r=r.map(t=>("xor"!==t.apply&&"mix"!==t.apply||(t.params[0]=tinycolor(t.params[0]).toRgb()),t)),t.scan((i,n,a)=>{let s={r:t.bitmap.data[a],g:t.bitmap.data[a+1],b:t.bitmap.data[a+2]},o=(t,r)=>limit255(s[t]+r);r.forEach(t=>{if("mix"===t.apply)s=mix(s,t.params[0],t.params[1]);else if("tint"===t.apply)s=mix(s,{r:255,g:255,b:255},t.params?.[0]);else if("shade"===t.apply)s=mix(s,{r:0,g:0,b:0},t.params?.[0]);else if("xor"===t.apply)s={r:s.r^t.params[0].r,g:s.g^t.params[0].g,b:s.b^t.params[0].b};else if("red"===t.apply)s.r=o("r",t.params[0]);else if("green"===t.apply)s.g=o("g",t.params[0]);else if("blue"===t.apply)s.b=o("b",t.params[0]);else{"hue"===t.apply&&(t.apply="spin");let r=tinycolor(s),i=r[t.apply].bind(r);if(!i)throw Error("action "+t.apply+" not supported");s=i(...t.params||[]).toRgb()}}),t.bitmap.data[a]=s.r,t.bitmap.data[a+1]=s.g,t.bitmap.data[a+2]=s.b}),t}};var lib$1={},ieee754={read:function(t,r,i,n,a){var s,o,l=8*a-n-1,u=(1<<l)-1,h=u>>1,f=-7,d=i?a-1:0,c=i?-1:1,p=t[r+d];for(d+=c,s=p&(1<<-f)-1,p>>=-f,f+=l;f>0;s=256*s+t[r+d],d+=c,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=n;f>0;o=256*o+t[r+d],d+=c,f-=8);if(0===s)s=1-h;else{if(s===u)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=h}return(p?-1:1)*o*Math.pow(2,s-n)},write:function(t,r,i,n,a,s){var o,l,u,h=8*s-a-1,f=(1<<h)-1,d=f>>1,c=5960464477539062e-23*(23===a),p=n?0:s-1,m=n?1:-1,g=+(r<0||0===r&&1/r<0);for(isNaN(r=Math.abs(r))||r===1/0?(l=+!!isNaN(r),o=f):(o=Math.floor(Math.log(r)/Math.LN2),r*(u=Math.pow(2,-o))<1&&(o--,u*=2),(r+=o+d>=1?c/u:c*Math.pow(2,1-d))*u>=2&&(o++,u/=2),o+d>=f?(l=0,o=f):o+d>=1?(l=(r*u-1)*Math.pow(2,a),o+=d):(l=r*Math.pow(2,d-1)*Math.pow(2,a),o=0));a>=8;t[i+p]=255&l,p+=m,l/=256,a-=8);for(o=o<<a|l,h+=a;h>0;t[i+p]=255&o,p+=m,o/=256,h-=8);t[i+p-m]|=128*g}};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.AnsiStringType=t.StringType=t.BufferType=t.Uint8ArrayType=t.IgnoreType=t.Float80_LE=t.Float80_BE=t.Float64_LE=t.Float64_BE=t.Float32_LE=t.Float32_BE=t.Float16_LE=t.Float16_BE=t.INT64_BE=t.UINT64_BE=t.INT64_LE=t.UINT64_LE=t.INT32_LE=t.INT32_BE=t.INT24_BE=t.INT24_LE=t.INT16_LE=t.INT16_BE=t.INT8=t.UINT32_BE=t.UINT32_LE=t.UINT24_BE=t.UINT24_LE=t.UINT16_BE=t.UINT16_LE=t.UINT8=void 0;let r=ieee754;function i(t){return new DataView(t.buffer,t.byteOffset)}t.UINT8={len:1,get:(t,r)=>i(t).getUint8(r),put:(t,r,n)=>(i(t).setUint8(r,n),r+1)},t.UINT16_LE={len:2,get:(t,r)=>i(t).getUint16(r,!0),put:(t,r,n)=>(i(t).setUint16(r,n,!0),r+2)},t.UINT16_BE={len:2,get:(t,r)=>i(t).getUint16(r),put:(t,r,n)=>(i(t).setUint16(r,n),r+2)},t.UINT24_LE={len:3,get(t,r){let n=i(t);return n.getUint8(r)+(n.getUint16(r+1,!0)<<8)},put(t,r,n){let a=i(t);return a.setUint8(r,255&n),a.setUint16(r+1,n>>8,!0),r+3}},t.UINT24_BE={len:3,get(t,r){let n=i(t);return(n.getUint16(r)<<8)+n.getUint8(r+2)},put(t,r,n){let a=i(t);return a.setUint16(r,n>>8),a.setUint8(r+2,255&n),r+3}},t.UINT32_LE={len:4,get:(t,r)=>i(t).getUint32(r,!0),put:(t,r,n)=>(i(t).setUint32(r,n,!0),r+4)},t.UINT32_BE={len:4,get:(t,r)=>i(t).getUint32(r),put:(t,r,n)=>(i(t).setUint32(r,n),r+4)},t.INT8={len:1,get:(t,r)=>i(t).getInt8(r),put:(t,r,n)=>(i(t).setInt8(r,n),r+1)},t.INT16_BE={len:2,get:(t,r)=>i(t).getInt16(r),put:(t,r,n)=>(i(t).setInt16(r,n),r+2)},t.INT16_LE={len:2,get:(t,r)=>i(t).getInt16(r,!0),put:(t,r,n)=>(i(t).setInt16(r,n,!0),r+2)},t.INT24_LE={len:3,get(r,i){let n=t.UINT24_LE.get(r,i);return n>8388607?n-0x1000000:n},put(t,r,n){let a=i(t);return a.setUint8(r,255&n),a.setUint16(r+1,n>>8,!0),r+3}},t.INT24_BE={len:3,get(r,i){let n=t.UINT24_BE.get(r,i);return n>8388607?n-0x1000000:n},put(t,r,n){let a=i(t);return a.setUint16(r,n>>8),a.setUint8(r+2,255&n),r+3}},t.INT32_BE={len:4,get:(t,r)=>i(t).getInt32(r),put:(t,r,n)=>(i(t).setInt32(r,n),r+4)},t.INT32_LE={len:4,get:(t,r)=>i(t).getInt32(r,!0),put:(t,r,n)=>(i(t).setInt32(r,n,!0),r+4)},t.UINT64_LE={len:8,get:(t,r)=>i(t).getBigUint64(r,!0),put:(t,r,n)=>(i(t).setBigUint64(r,n,!0),r+8)},t.INT64_LE={len:8,get:(t,r)=>i(t).getBigInt64(r,!0),put:(t,r,n)=>(i(t).setBigInt64(r,n,!0),r+8)},t.UINT64_BE={len:8,get:(t,r)=>i(t).getBigUint64(r),put:(t,r,n)=>(i(t).setBigUint64(r,n),r+8)},t.INT64_BE={len:8,get:(t,r)=>i(t).getBigInt64(r),put:(t,r,n)=>(i(t).setBigInt64(r,n),r+8)},t.Float16_BE={len:2,get(t,i){return r.read(t,i,!1,10,this.len)},put(t,i,n){return r.write(t,n,i,!1,10,this.len),i+this.len}},t.Float16_LE={len:2,get(t,i){return r.read(t,i,!0,10,this.len)},put(t,i,n){return r.write(t,n,i,!0,10,this.len),i+this.len}},t.Float32_BE={len:4,get:(t,r)=>i(t).getFloat32(r),put:(t,r,n)=>(i(t).setFloat32(r,n),r+4)},t.Float32_LE={len:4,get:(t,r)=>i(t).getFloat32(r,!0),put:(t,r,n)=>(i(t).setFloat32(r,n,!0),r+4)},t.Float64_BE={len:8,get:(t,r)=>i(t).getFloat64(r),put:(t,r,n)=>(i(t).setFloat64(r,n),r+8)},t.Float64_LE={len:8,get:(t,r)=>i(t).getFloat64(r,!0),put:(t,r,n)=>(i(t).setFloat64(r,n,!0),r+8)},t.Float80_BE={len:10,get(t,i){return r.read(t,i,!1,63,this.len)},put(t,i,n){return r.write(t,n,i,!1,63,this.len),i+this.len}},t.Float80_LE={len:10,get(t,i){return r.read(t,i,!0,63,this.len)},put(t,i,n){return r.write(t,n,i,!0,63,this.len),i+this.len}},t.IgnoreType=class{constructor(t){this.len=t}get(t,r){}},t.Uint8ArrayType=class{constructor(t){this.len=t}get(t,r){return t.subarray(r,r+this.len)}},t.BufferType=class{constructor(t){this.len=t}get(t,r){return Buffer.from(t.subarray(r,r+this.len))}},t.StringType=class{constructor(t,r){this.len=t,this.encoding=r}get(t,r){return Buffer.from(t).toString(this.encoding,r,r+this.len)}};class n{constructor(t){this.len=t}static decode(t,r,i){let a="";for(let s=r;s<i;++s)a+=n.codePointToString(n.singleByteDecoder(t[s]));return a}static inRange(t,r,i){return r<=t&&t<=i}static codePointToString(t){return t<=65535?String.fromCharCode(t):String.fromCharCode(55296+((t-=65536)>>10),56320+(1023&t))}static singleByteDecoder(t){if(n.inRange(t,0,127))return t;let r=n.windows1252[t-128];if(null===r)throw Error("invaliding encoding");return r}get(t,r=0){return n.decode(t,r,r+this.len)}}t.AnsiStringType=n,n.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]}(lib$1);var core$1={},ReadStreamTokenizer$1={},AbstractTokenizer$1={},lib={},EndOfFileStream={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.EndOfStreamError=t.defaultMessages=void 0,t.defaultMessages="End-Of-Stream";class r extends Error{constructor(){super(t.defaultMessages)}}t.EndOfStreamError=r}(EndOfFileStream);var StreamReader={},Deferred$1={};Object.defineProperty(Deferred$1,"__esModule",{value:!0}),Deferred$1.Deferred=void 0;class Deferred{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((t,r)=>{this.reject=r,this.resolve=t})}}Deferred$1.Deferred=Deferred,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.StreamReader=t.EndOfStreamError=void 0;let r=EndOfFileStream,i=Deferred$1;var n=EndOfFileStream;Object.defineProperty(t,"EndOfStreamError",{enumerable:!0,get:function(){return n.EndOfStreamError}}),t.StreamReader=class{constructor(t){if(this.s=t,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!t.read||!t.once)throw Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new r.EndOfStreamError)),this.s.once("error",t=>this.reject(t)),this.s.once("close",()=>this.reject(Error("Stream closed")))}async peek(t,r,i){let n=await this.read(t,r,i);return this.peekQueue.push(t.subarray(r,r+n)),n}async read(t,i,n){if(0===n)return 0;if(0===this.peekQueue.length&&this.endOfStream)throw new r.EndOfStreamError;let a=n,s=0;for(;this.peekQueue.length>0&&a>0;){let r=this.peekQueue.pop();if(!r)throw Error("peekData should be defined");let n=Math.min(r.length,a);t.set(r.subarray(0,n),i+s),s+=n,a-=n,n<r.length&&this.peekQueue.push(r.subarray(n))}for(;a>0&&!this.endOfStream;){let r=Math.min(a,1048576),n=await this.readFromStream(t,i+s,r);if(s+=n,n<r)break;a-=n}return s}async readFromStream(t,r,n){let a=this.s.read(n);if(a)return t.set(a,r),a.length;{let a={buffer:t,offset:r,length:n,deferred:new i.Deferred};return this.deferred=a.deferred,this.s.once("readable",()=>{this.readDeferred(a)}),a.deferred.promise}}readDeferred(t){let r=this.s.read(t.length);r?(t.buffer.set(r,t.offset),t.deferred.resolve(r.length),this.deferred=null):this.s.once("readable",()=>{this.readDeferred(t)})}reject(t){this.endOfStream=!0,this.deferred&&(this.deferred.reject(t),this.deferred=null)}}}(StreamReader),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.StreamReader=t.EndOfStreamError=void 0;var r=EndOfFileStream;Object.defineProperty(t,"EndOfStreamError",{enumerable:!0,get:function(){return r.EndOfStreamError}});var i=StreamReader;Object.defineProperty(t,"StreamReader",{enumerable:!0,get:function(){return i.StreamReader}})}(lib),Object.defineProperty(AbstractTokenizer$1,"__esModule",{value:!0}),AbstractTokenizer$1.AbstractTokenizer=void 0;let peek_readable_1$2=lib;class AbstractTokenizer{constructor(t){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=t||{}}async readToken(t,r=this.position){let i=Buffer.alloc(t.len);if(await this.readBuffer(i,{position:r})<t.len)throw new peek_readable_1$2.EndOfStreamError;return t.get(i,0)}async peekToken(t,r=this.position){let i=Buffer.alloc(t.len);if(await this.peekBuffer(i,{position:r})<t.len)throw new peek_readable_1$2.EndOfStreamError;return t.get(i,0)}async readNumber(t){if(await this.readBuffer(this.numBuffer,{length:t.len})<t.len)throw new peek_readable_1$2.EndOfStreamError;return t.get(this.numBuffer,0)}async peekNumber(t){if(await this.peekBuffer(this.numBuffer,{length:t.len})<t.len)throw new peek_readable_1$2.EndOfStreamError;return t.get(this.numBuffer,0)}async ignore(t){if(void 0!==this.fileInfo.size){let r=this.fileInfo.size-this.position;if(t>r)return this.position+=r,r}return this.position+=t,t}async close(){}normalizeOptions(t,r){if(r&&void 0!==r.position&&r.position<this.position)throw Error("`options.position` must be equal or greater than `tokenizer.position`");return r?{mayBeLess:!0===r.mayBeLess,offset:r.offset?r.offset:0,length:r.length?r.length:t.length-(r.offset?r.offset:0),position:r.position?r.position:this.position}:{mayBeLess:!1,offset:0,length:t.length,position:this.position}}}AbstractTokenizer$1.AbstractTokenizer=AbstractTokenizer,Object.defineProperty(ReadStreamTokenizer$1,"__esModule",{value:!0}),ReadStreamTokenizer$1.ReadStreamTokenizer=void 0;let AbstractTokenizer_1$1=AbstractTokenizer$1,peek_readable_1$1=lib,maxBufferSize=256e3;class ReadStreamTokenizer extends AbstractTokenizer_1$1.AbstractTokenizer{constructor(t,r){super(r),this.streamReader=new peek_readable_1$1.StreamReader(t)}async getFileInfo(){return this.fileInfo}async readBuffer(t,r){let i=this.normalizeOptions(t,r),n=i.position-this.position;if(n>0)return await this.ignore(n),this.readBuffer(t,r);if(n<0)throw Error("`options.position` must be equal or greater than `tokenizer.position`");if(0===i.length)return 0;let a=await this.streamReader.read(t,i.offset,i.length);if(this.position+=a,(!r||!r.mayBeLess)&&a<i.length)throw new peek_readable_1$1.EndOfStreamError;return a}async peekBuffer(t,r){let i=this.normalizeOptions(t,r),n=0;if(i.position){let r=i.position-this.position;if(r>0){let a=new Uint8Array(i.length+r);return n=await this.peekBuffer(a,{mayBeLess:i.mayBeLess}),t.set(a.subarray(r),i.offset),n-r}if(r<0)throw Error("Cannot peek from a negative offset in a stream")}if(i.length>0){try{n=await this.streamReader.peek(t,i.offset,i.length)}catch(t){if(r&&r.mayBeLess&&t instanceof peek_readable_1$1.EndOfStreamError)return 0;throw t}if(!i.mayBeLess&&n<i.length)throw new peek_readable_1$1.EndOfStreamError}return n}async ignore(t){let r=Math.min(maxBufferSize,t),i=new Uint8Array(r),n=0;for(;n<t;){let a=t-n,s=await this.readBuffer(i,{length:Math.min(r,a)});if(s<0)return s;n+=s}return n}}ReadStreamTokenizer$1.ReadStreamTokenizer=ReadStreamTokenizer;var BufferTokenizer$1={};Object.defineProperty(BufferTokenizer$1,"__esModule",{value:!0}),BufferTokenizer$1.BufferTokenizer=void 0;let peek_readable_1=lib,AbstractTokenizer_1=AbstractTokenizer$1;class BufferTokenizer extends AbstractTokenizer_1.AbstractTokenizer{constructor(t,r){super(r),this.uint8Array=t,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:t.length}async readBuffer(t,r){if(r&&r.position){if(r.position<this.position)throw Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=r.position}let i=await this.peekBuffer(t,r);return this.position+=i,i}async peekBuffer(t,r){let i=this.normalizeOptions(t,r),n=Math.min(this.uint8Array.length-i.position,i.length);if(!i.mayBeLess&&n<i.length)throw new peek_readable_1.EndOfStreamError;return t.set(this.uint8Array.subarray(i.position,i.position+n),i.offset),n}async close(){}}BufferTokenizer$1.BufferTokenizer=BufferTokenizer,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.fromBuffer=t.fromStream=t.EndOfStreamError=void 0;let r=ReadStreamTokenizer$1,i=BufferTokenizer$1;var n=lib;Object.defineProperty(t,"EndOfStreamError",{enumerable:!0,get:function(){return n.EndOfStreamError}}),t.fromStream=function(t,i){return i=i||{},new r.ReadStreamTokenizer(t,i)},t.fromBuffer=function(t,r){return new i.BufferTokenizer(t,r)}}(core$1);var util={stringToBytes:t=>[...t].map(t=>t.charCodeAt(0)),tarHeaderChecksumMatches:(t,r=0)=>{let i=parseInt(t.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(i))return!1;let n=256;for(let i=r;i<r+148;i++)n+=t[i];for(let i=r+156;i<r+512;i++)n+=t[i];return i===n},uint32SyncSafeToken:{get:(t,r)=>127&t[r+3]|t[r+2]<<7|t[r+1]<<14|t[r]<<21,len:4}},supported$1={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]};let Token=lib$1,strtok3=core$1,{stringToBytes:stringToBytes,tarHeaderChecksumMatches:tarHeaderChecksumMatches,uint32SyncSafeToken:uint32SyncSafeToken}=util,supported=supported$1,minimumBytes=4100;async function fromStream(t){let r=await strtok3.fromStream(t);try{return await fromTokenizer(r)}finally{await r.close()}}async function fromBuffer(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Buffer.isBuffer(t)))throw TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof t}\``);let r=t instanceof Buffer?t:Buffer.from(t);if(r&&r.length>1)return fromTokenizer(strtok3.fromBuffer(r))}function _check(t,r,i){for(let[n,a]of(i={offset:0,...i},r.entries()))if(i.mask){if(a!==(i.mask[n]&t[n+i.offset]))return!1}else if(a!==t[n+i.offset])return!1;return!0}async function fromTokenizer(t){try{return _fromTokenizer(t)}catch(t){if(!(t instanceof strtok3.EndOfStreamError))throw t}}async function _fromTokenizer(t){let r=Buffer.alloc(minimumBytes),i=(t,i)=>_check(r,t,i),n=(t,r)=>i(stringToBytes(t),r);if(t.fileInfo.size||(t.fileInfo.size=Number.MAX_SAFE_INTEGER),await t.peekBuffer(r,{length:12,mayBeLess:!0}),i([66,77]))return{ext:"bmp",mime:"image/bmp"};if(i([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(i([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(i([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(i([37,33]))return await t.peekBuffer(r,{length:24,mayBeLess:!0}),n("PS-Adobe-",{offset:2})&&n(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(i([31,160])||i([31,157]))return{ext:"Z",mime:"application/x-compress"};if(i([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(i([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(i([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(i([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(n("ID3")){await t.ignore(6);let r=await t.readToken(uint32SyncSafeToken);return t.position+r>t.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await t.ignore(r),fromTokenizer(t))}if(n("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((67===r[0]||70===r[0])&&i([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(i([71,73,70]))return{ext:"gif",mime:"image/gif"};if(n("FLIF"))return{ext:"flif",mime:"image/flif"};if(n("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(n("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(n("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(n("FORM"))return{ext:"aif",mime:"audio/aiff"};if(n("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(i([80,75,3,4])){try{for(;t.position+30<t.fileInfo.size;){await t.readBuffer(r,{length:30});let i={compressedSize:r.readUInt32LE(18),uncompressedSize:r.readUInt32LE(22),filenameLength:r.readUInt16LE(26),extraFieldLength:r.readUInt16LE(28)};if(i.filename=await t.readToken(new Token.StringType(i.filenameLength,"utf-8")),await t.ignore(i.extraFieldLength),"META-INF/mozilla.rsa"===i.filename)return{ext:"xpi",mime:"application/x-xpinstall"};if(i.filename.endsWith(".rels")||i.filename.endsWith(".xml"))switch(i.filename.split("/")[0]){case"_rels":default:break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}}if(i.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(i.filename.startsWith("3D/")&&i.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if("mimetype"===i.filename&&i.compressedSize===i.uncompressedSize)switch(await t.readToken(new Token.StringType(i.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}if(0===i.compressedSize){let i=-1;for(;i<0&&t.position<t.fileInfo.size;)await t.peekBuffer(r,{mayBeLess:!0}),i=r.indexOf("504B0304",0,"hex"),await t.ignore(i>=0?i:r.length)}else await t.ignore(i.compressedSize)}}catch(t){if(!(t instanceof strtok3.EndOfStreamError))throw t}return{ext:"zip",mime:"application/zip"}}if(n("OggS")){await t.ignore(28);let r=Buffer.alloc(8);return await t.readBuffer(r),_check(r,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check(r,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check(r,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check(r,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check(r,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check(r,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(i([80,75])&&(3===r[2]||5===r[2]||7===r[2])&&(4===r[3]||6===r[3]||8===r[3]))return{ext:"zip",mime:"application/zip"};if(n("ftyp",{offset:4})&&96&r[8]){let t=r.toString("binary",8,12).replace("\0"," ").trim();switch(t){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return t.startsWith("3g")?t.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(n("MThd"))return{ext:"mid",mime:"audio/midi"};if(n("wOFF")&&(i([0,1,0,0],{offset:4})||n("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(n("wOF2")&&(i([0,1,0,0],{offset:4})||n("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(i([212,195,178,161])||i([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(n("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(n("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(n("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(i([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(n("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(n("%PDF")){await t.ignore(1350);let r=0xa00000,i=Buffer.alloc(Math.min(r,t.fileInfo.size));return await t.readBuffer(i,{mayBeLess:!0}),i.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(i([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(i([73,73,42,0]))return n("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:i([28,0,254,0],{offset:8})||i([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:i([8,0,0,0],{offset:4})&&(i([45,0,254,0],{offset:8})||i([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(r=Buffer.alloc(24),await t.peekBuffer(r),(i([16,251,134,1],{offset:4})||i([8,0,0,0],{offset:4}))&&i([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(i([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(n("MAC "))return{ext:"ape",mime:"audio/ape"};if(i([26,69,223,163])){async function a(){let r=await t.peekNumber(Token.UINT8),i=128,n=0;for(;!(r&i)&&0!==i;)++n,i>>=1;let a=Buffer.alloc(n+1);return await t.readBuffer(a),a}async function s(){let t=await a(),r=await a();r[0]^=128>>r.length-1;let i=Math.min(6,r.length);return{id:t.readUIntBE(0,t.length),len:r.readUIntBE(r.length-i,i)}}async function o(r,i){for(;i>0;){let r=await s();if(17026===r.id)return t.readToken(new Token.StringType(r.len,"utf-8"));await t.ignore(r.len),--i}}let r=await s();switch(await o(0,r.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(i([82,73,70,70])){if(i([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(i([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(i([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(n("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(i([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(n("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(n("MSCF")||n("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(i([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(i([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(i([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(i([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(n("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(n("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(i([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(n("IMPM"))return{ext:"it",mime:"audio/x-it"};if(n("-lh0-",{offset:2})||n("-lh1-",{offset:2})||n("-lh2-",{offset:2})||n("-lh3-",{offset:2})||n("-lh4-",{offset:2})||n("-lh5-",{offset:2})||n("-lh6-",{offset:2})||n("-lh7-",{offset:2})||n("-lzs-",{offset:2})||n("-lz4-",{offset:2})||n("-lz5-",{offset:2})||n("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(i([0,0,1,186])){if(i([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(i([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(n("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(i([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(n("<?xml "))return{ext:"xml",mime:"application/xml"};if(i([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(i([82,97,114,33,26,7])&&(0===r[6]||1===r[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(n("solid "))return{ext:"stl",mime:"model/stl"};if(n("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(n("!<arch>"))return await t.ignore(8),"debian-binary"===await t.readToken(new Token.StringType(13,"ascii"))?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(i([137,80,78,71,13,10,26,10])){async function l(){return{length:await t.readToken(Token.INT32_BE),type:await t.readToken(new Token.StringType(4,"binary"))}}await t.ignore(8);do{let r=await l();if(r.length<0)return;switch(r.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await t.ignore(r.length+4)}}while(t.position+8<t.fileInfo.size)return{ext:"png",mime:"image/png"}}if(i([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(i([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(i([102,114,101,101],{offset:4})||i([109,100,97,116],{offset:4})||i([109,111,111,118],{offset:4})||i([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(i([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(n("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(i([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(i([48,38,178,117,142,102,207,17,166,217])){async function u(){let r=Buffer.alloc(16);return await t.readBuffer(r),{id:r,size:Number(await t.readToken(Token.UINT64_LE))}}for(await t.ignore(30);t.position+24<t.fileInfo.size;){let r=await u(),i=r.size-24;if(_check(r.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){let r=Buffer.alloc(16);if(i-=await t.readBuffer(r),_check(r,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(r,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await t.ignore(i)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(i([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((i([126,16,4])||i([126,24,4]))&&i([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(i([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(i([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await t.ignore(20),await t.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(i([255,10])||i([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(i([0,0,1,186])||i([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(i([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(i([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(i([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(i([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await t.peekBuffer(r,{length:Math.min(256,t.fileInfo.size),mayBeLess:!0}),n("BEGIN:")){if(n("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(n("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(n("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(n("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(n("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(i([4,0,0,0])&&r.length>=16){let t=r.readUInt32LE(12);if(t>12&&r.length>=t+16)try{let i=r.slice(16,t+16).toString();if(JSON.parse(i).files)return{ext:"asar",mime:"application/x-asar"}}catch(t){}}if(i([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(n("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(i([71],{offset:4})&&(i([71],{offset:192})||i([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(i([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(i([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(i([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(i([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(i([76,80],{offset:34})&&(i([0,0,1],{offset:8})||i([1,0,2],{offset:8})||i([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(i([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await t.peekBuffer(r,{length:Math.min(512,t.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(r))return{ext:"tar",mime:"application/x-tar"};if(i([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(n("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(r.length>=2&&i([255,224],{offset:0,mask:[255,224]})){if(i([16],{offset:1,mask:[22]}))return i([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(i([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(i([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(i([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}let stream=readableStream=>new Promise((resolve,reject)=>{let stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",async()=>{let t,r=new stream.PassThrough;t=stream.pipeline?stream.pipeline(readableStream,r,()=>{}):readableStream.pipe(r);let i=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{r.fileType=await fromBuffer(i)}catch(t){reject(t)}resolve(t)})}),fileType={fromStream:fromStream,fromTokenizer:fromTokenizer,fromBuffer:fromBuffer,stream:stream};Object.defineProperty(fileType,"extensions",{get:()=>new Set(supported.extensions)}),Object.defineProperty(fileType,"mimeTypes",{get:()=>new Set(supported.mimeTypes)});var core=fileType,fileType$1=getDefaultExportFromCjs(core);function to(t,r){return t.then(function(t){return[null,t]}).catch(function(t){return[t,void 0]})}let writeFile=async()=>{throw Error("Not supported")};function Mime$1(){this._types=Object.create(null),this._extensions=Object.create(null);for(let t=0;t<arguments.length;t++)this.define(arguments[t]);this.define=this.define.bind(this),this.getType=this.getType.bind(this),this.getExtension=this.getExtension.bind(this)}Mime$1.prototype.define=function(t,r){for(let i in t){let n=t[i].map(function(t){return t.toLowerCase()});i=i.toLowerCase();for(let t=0;t<n.length;t++){let a=n[t];if("*"!==a[0]){if(!r&&a in this._types)throw Error('Attempt to change mapping for "'+a+'" extension from "'+this._types[a]+'" to "'+i+'". Pass `force=true` to allow this, otherwise remove "'+a+'" from the list of extensions for "'+i+'".');this._types[a]=i}}if(r||!this._extensions[i]){let t=n[0];this._extensions[i]="*"!==t[0]?t:t.substr(1)}}},Mime$1.prototype.getType=function(t){let r=(t=String(t)).replace(/^.*[/\\]/,"").toLowerCase(),i=r.replace(/^.*\./,"").toLowerCase(),n=r.length<t.length;return(i.length<r.length-1||!n)&&this._types[i]||null},Mime$1.prototype.getExtension=function(t){return(t=/^\s*([^;\s]*)/.test(t)&&RegExp.$1)&&this._extensions[t.toLowerCase()]||null};var Mime_1=Mime$1,standard={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomdeleted+xml":["atomdeleted"],"application/atomsvc+xml":["atomsvc"],"application/atsc-dwd+xml":["dwd"],"application/atsc-held+xml":["held"],"application/atsc-rsat+xml":["rsat"],"application/bdoc":["bdoc"],"application/calendar+xml":["xcs"],"application/ccxml+xml":["ccxml"],"application/cdfx+xml":["cdfx"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/dash+xml":["mpd"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["es","ecma"],"application/emma+xml":["emma"],"application/emotionml+xml":["emotionml"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/express":["exp"],"application/fdt+xml":["fdt"],"application/font-tdpfr":["pfr"],"application/geo+json":["geojson"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/gzip":["gz"],"application/hjson":["hjson"],"application/hyperstudio":["stk"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/its+xml":["its"],"application/java-archive":["jar","war","ear"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js","mjs"],"application/json":["json","map"],"application/json5":["json5"],"application/jsonml+json":["jsonml"],"application/ld+json":["jsonld"],"application/lgr+xml":["lgr"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/manifest+json":["webmanifest"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mmt-aei+xml":["maei"],"application/mmt-usd+xml":["musd"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s","m4p"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/n-quads":["nq"],"application/n-triples":["nt"],"application/node":["cjs"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/p2p-overlay+xml":["relo"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/provenance+xml":["provx"],"application/pskc+xml":["pskcxml"],"application/raml+yaml":["raml"],"application/rdf+xml":["rdf","owl"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/route-apd+xml":["rapd"],"application/route-s-tsid+xml":["sls"],"application/route-usd+xml":["rusd"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/senml+xml":["senmlx"],"application/sensml+xml":["sensmlx"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/sieve":["siv","sieve"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/swid+xml":["swidtag"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/toml":["toml"],"application/trig":["trig"],"application/ttml+xml":["ttml"],"application/ubjson":["ubj"],"application/urc-ressheet+xml":["rsheet"],"application/urc-targetdesc+xml":["td"],"application/voicexml+xml":["vxml"],"application/wasm":["wasm"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/xaml+xml":["xaml"],"application/xcap-att+xml":["xav"],"application/xcap-caps+xml":["xca"],"application/xcap-diff+xml":["xdf"],"application/xcap-el+xml":["xel"],"application/xcap-ns+xml":["xns"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xliff+xml":["xlf"],"application/xml":["xml","xsl","xsd","rng"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["*xsl","xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/3gpp":["*3gpp"],"audio/adpcm":["adp"],"audio/amr":["amr"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mobile-xmf":["mxmf"],"audio/mp3":["*mp3"],"audio/mp4":["m4a","mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx","opus"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/wav":["wav"],"audio/wave":["*wav"],"audio/webm":["weba"],"audio/xm":["xm"],"font/collection":["ttc"],"font/otf":["otf"],"font/ttf":["ttf"],"font/woff":["woff"],"font/woff2":["woff2"],"image/aces":["exr"],"image/apng":["apng"],"image/avif":["avif"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/dicom-rle":["drle"],"image/emf":["emf"],"image/fits":["fits"],"image/g3fax":["g3"],"image/gif":["gif"],"image/heic":["heic"],"image/heic-sequence":["heics"],"image/heif":["heif"],"image/heif-sequence":["heifs"],"image/hej2k":["hej2"],"image/hsj2":["hsj2"],"image/ief":["ief"],"image/jls":["jls"],"image/jp2":["jp2","jpg2"],"image/jpeg":["jpeg","jpg","jpe"],"image/jph":["jph"],"image/jphc":["jhc"],"image/jpm":["jpm"],"image/jpx":["jpx","jpf"],"image/jxr":["jxr"],"image/jxra":["jxra"],"image/jxrs":["jxrs"],"image/jxs":["jxs"],"image/jxsc":["jxsc"],"image/jxsi":["jxsi"],"image/jxss":["jxss"],"image/ktx":["ktx"],"image/ktx2":["ktx2"],"image/png":["png"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/t38":["t38"],"image/tiff":["tif","tiff"],"image/tiff-fx":["tfx"],"image/webp":["webp"],"image/wmf":["wmf"],"message/disposition-notification":["disposition-notification"],"message/global":["u8msg"],"message/global-delivery-status":["u8dsn"],"message/global-disposition-notification":["u8mdn"],"message/global-headers":["u8hdr"],"message/rfc822":["eml","mime"],"model/3mf":["3mf"],"model/gltf+json":["gltf"],"model/gltf-binary":["glb"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/mtl":["mtl"],"model/obj":["obj"],"model/step+xml":["stpx"],"model/step+zip":["stpz"],"model/step-xml+zip":["stpxz"],"model/stl":["stl"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["*x3db","x3dbz"],"model/x3d+fastinfoset":["x3db"],"model/x3d+vrml":["*x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"model/x3d-vrml":["x3dv"],"text/cache-manifest":["appcache","manifest"],"text/calendar":["ics","ifb"],"text/coffeescript":["coffee","litcoffee"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm","shtml"],"text/jade":["jade"],"text/jsx":["jsx"],"text/less":["less"],"text/markdown":["markdown","md"],"text/mathml":["mml"],"text/mdx":["mdx"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in","ini"],"text/richtext":["rtx"],"text/rtf":["*rtf"],"text/sgml":["sgml","sgm"],"text/shex":["shex"],"text/slim":["slim","slm"],"text/spdx":["spdx"],"text/stylus":["stylus","styl"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vtt":["vtt"],"text/xml":["*xml"],"text/yaml":["yaml","yml"],"video/3gpp":["3gp","3gpp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/iso.segment":["m4s"],"video/jpeg":["jpgv"],"video/jpm":["*jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp2t":["ts"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/webm":["webm"]};let Mime=Mime_1;var HorizontalAlign,HorizontalAlign2,VerticalAlign,VerticalAlign2,BlendMode,BlendMode2,lite=new Mime(standard),mime=getDefaultExportFromCjs(lite);function srcOver(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a;return{r:(t.r*t.a+r.r*r.a*(1-t.a))/n,g:(t.g*t.a+r.g*r.a*(1-t.a))/n,b:(t.b*t.a+r.b*r.a*(1-t.a))/n,a:n}}function dstOver(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a;return{r:(r.r*r.a+t.r*t.a*(1-r.a))/n,g:(r.g*r.a+t.g*t.a*(1-r.a))/n,b:(r.b*r.a+t.b*t.a*(1-r.a))/n,a:n}}function multiply(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a,a=t.r*t.a,s=t.g*t.a,o=t.b*t.a,l=r.r*r.a,u=r.g*r.a,h=r.b*r.a;return{r:(a*l+a*(1-r.a)+l*(1-t.a))/n,g:(s*u+s*(1-r.a)+u*(1-t.a))/n,b:(o*h+o*(1-r.a)+h*(1-t.a))/n,a:n}}function add(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a,a=t.r*t.a,s=t.g*t.a,o=t.b*t.a;return{r:(a+r.r*r.a)/n,g:(s+r.g*r.a)/n,b:(o+r.b*r.a)/n,a:n}}function screen(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a,a=t.r*t.a,s=t.g*t.a,o=t.b*t.a,l=r.r*r.a,u=r.g*r.a,h=r.b*r.a;return{r:(a*r.a+l*t.a-a*l+a*(1-r.a)+l*(1-t.a))/n,g:(s*r.a+u*t.a-s*u+s*(1-r.a)+u*(1-t.a))/n,b:(o*r.a+h*t.a-o*h+o*(1-r.a)+h*(1-t.a))/n,a:n}}function overlay(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a,a=t.r*t.a,s=t.g*t.a,o=t.b*t.a,l=r.r*r.a,u=r.g*r.a,h=r.b*r.a;return{r:(2*l<=r.a?2*a*l+a*(1-r.a)+l*(1-t.a):a*(1+r.a)+l*(1+t.a)-2*l*a-r.a*t.a)/n,g:(2*u<=r.a?2*s*u+s*(1-r.a)+u*(1-t.a):s*(1+r.a)+u*(1+t.a)-2*u*s-r.a*t.a)/n,b:(2*h<=r.a?2*o*h+o*(1-r.a)+h*(1-t.a):o*(1+r.a)+h*(1+t.a)-2*h*o-r.a*t.a)/n,a:n}}function darken(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a,a=t.r*t.a,s=t.g*t.a,o=t.b*t.a,l=r.r*r.a,u=r.g*r.a,h=r.b*r.a;return{r:(Math.min(a*r.a,l*t.a)+a*(1-r.a)+l*(1-t.a))/n,g:(Math.min(s*r.a,u*t.a)+s*(1-r.a)+u*(1-t.a))/n,b:(Math.min(o*r.a,h*t.a)+o*(1-r.a)+h*(1-t.a))/n,a:n}}function lighten(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a,a=t.r*t.a,s=t.g*t.a,o=t.b*t.a,l=r.r*r.a,u=r.g*r.a,h=r.b*r.a;return{r:(Math.max(a*r.a,l*t.a)+a*(1-r.a)+l*(1-t.a))/n,g:(Math.max(s*r.a,u*t.a)+s*(1-r.a)+u*(1-t.a))/n,b:(Math.max(o*r.a,h*t.a)+o*(1-r.a)+h*(1-t.a))/n,a:n}}function hardLight(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a,a=t.r*t.a,s=t.g*t.a,o=t.b*t.a,l=r.r*r.a,u=r.g*r.a,h=r.b*r.a;return{r:(2*a<=t.a?2*a*l+a*(1-r.a)+l*(1-t.a):a*(1+r.a)+l*(1+t.a)-2*l*a-r.a*t.a)/n,g:(2*s<=t.a?2*s*u+s*(1-r.a)+u*(1-t.a):s*(1+r.a)+u*(1+t.a)-2*u*s-r.a*t.a)/n,b:(2*o<=t.a?2*o*h+o*(1-r.a)+h*(1-t.a):o*(1+r.a)+h*(1+t.a)-2*h*o-r.a*t.a)/n,a:n}}function difference(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a,a=t.r*t.a,s=t.g*t.a,o=t.b*t.a,l=r.r*r.a,u=r.g*r.a,h=r.b*r.a;return{r:(a+l-2*Math.min(a*r.a,l*t.a))/n,g:(s+u-2*Math.min(s*r.a,u*t.a))/n,b:(o+h-2*Math.min(o*r.a,h*t.a))/n,a:n}}function exclusion(t,r,i=1){t.a*=i;let n=r.a+t.a-r.a*t.a,a=t.r*t.a,s=t.g*t.a,o=t.b*t.a,l=r.r*r.a,u=r.g*r.a,h=r.b*r.a;return{r:(a*r.a+l*t.a-2*a*l+a*(1-r.a)+l*(1-t.a))/n,g:(s*r.a+u*t.a-2*s*u+s*(1-r.a)+u*(1-t.a))/n,b:(o*r.a+h*t.a-2*o*h+o*(1-r.a)+h*(1-t.a))/n,a:n}}HorizontalAlign2=HorizontalAlign||(HorizontalAlign={}),HorizontalAlign2[HorizontalAlign2.LEFT=1]="LEFT",HorizontalAlign2[HorizontalAlign2.CENTER=2]="CENTER",HorizontalAlign2[HorizontalAlign2.RIGHT=4]="RIGHT",VerticalAlign2=VerticalAlign||(VerticalAlign={}),VerticalAlign2[VerticalAlign2.TOP=8]="TOP",VerticalAlign2[VerticalAlign2.MIDDLE=16]="MIDDLE",VerticalAlign2[VerticalAlign2.BOTTOM=32]="BOTTOM",BlendMode2=BlendMode||(BlendMode={}),BlendMode2.SRC_OVER="srcOver",BlendMode2.DST_OVER="dstOver",BlendMode2.MULTIPLY="multiply",BlendMode2.ADD="add",BlendMode2.SCREEN="screen",BlendMode2.OVERLAY="overlay",BlendMode2.DARKEN="darken",BlendMode2.LIGHTEN="lighten",BlendMode2.HARD_LIGHT="hardLight",BlendMode2.DIFFERENCE="difference",BlendMode2.EXCLUSION="exclusion";let names=[srcOver,dstOver,multiply,add,screen,overlay,darken,lighten,hardLight,difference,exclusion];var compositeModes=Object.freeze({__proto__:null,add:add,darken:darken,difference:difference,dstOver:dstOver,exclusion:exclusion,hardLight:hardLight,lighten:lighten,multiply:multiply,names:names,overlay:overlay,screen:screen,srcOver:srcOver});function composite(t,r,i=0,n=0,a={}){if(!(r instanceof t.constructor))throw Error("The source must be a Jimp image");if("number"!=typeof i||"number"!=typeof n)throw Error("x and y must be numbers");let{mode:s=BlendMode.SRC_OVER}=a,{opacitySource:o=1,opacityDest:l=1}=a;("number"!=typeof o||o<0||o>1)&&(o=1),("number"!=typeof l||l<0||l>1)&&(l=1);let u=compositeModes[s];return i=Math.round(i),n=Math.round(n),1!==l&&t.scan((r,i,n)=>{let a=t.bitmap.data[n+3]*l;t.bitmap.data[n+3]=a}),r.scan((a,s,l)=>{let h=t.getPixelIndex(i+a,n+s,Edge.CROP);if(-1===h)return;let f=u({r:r.bitmap.data[l+0]/255,g:r.bitmap.data[l+1]/255,b:r.bitmap.data[l+2]/255,a:r.bitmap.data[l+3]/255},{r:t.bitmap.data[h+0]/255,g:t.bitmap.data[h+1]/255,b:t.bitmap.data[h+2]/255,a:t.bitmap.data[h+3]/255},o);t.bitmap.data[h+0]=limit255(255*f.r),t.bitmap.data[h+1]=limit255(255*f.g),t.bitmap.data[h+2]=limit255(255*f.b),t.bitmap.data[h+3]=limit255(255*f.a)}),t}var jpeg$1={parseSections:function(t,r){var i,n;for(t.setBigEndian(!0);t.remainingLength()>0&&218!==n;){if(255!==t.nextUInt8())throw Error("Invalid JPEG section offset");i=(n=t.nextUInt8())>=208&&n<=217||218===n?0:t.nextUInt16()-2,r(n,t.branch(0,i)),t.skip(i)}},getSizeFromSOFSection:function(t){return t.skip(1),{height:t.nextUInt16(),width:t.nextUInt16()}},getSectionName:function(t){switch(t){case 216:r="SOI";break;case 196:r="DHT";break;case 219:r="DQT";break;case 221:r="DRI";break;case 218:r="SOS";break;case 254:r="COM";break;case 217:r="EOI";break;default:t>=224&&t<=239?(r="APP",i=t-224):t>=192&&t<=207&&196!==t&&200!==t&&204!==t?(r="SOF",i=t-192):t>=208&&t<=215&&(r="RST",i=t-208)}var r,i,n={name:r};return"number"==typeof i&&(n.index=i),n}};function readExifValue(t,r){switch(t){case 1:return r.nextUInt8();case 3:case 8:return r.nextUInt16();case 4:case 9:return r.nextUInt32();case 5:return[r.nextUInt32(),r.nextUInt32()];case 6:return r.nextInt8();case 10:return[r.nextInt32(),r.nextInt32()];case 11:return r.nextFloat();case 12:return r.nextDouble();default:throw Error("Invalid format while decoding: "+t)}}function getBytesPerComponent(t){switch(t){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function readExifTag(t,r){var i,n,a=r.nextUInt16(),s=r.nextUInt16(),o=getBytesPerComponent(s),l=r.nextUInt32(),u=o*l;if(u>4&&(r=t.openWithOffset(r.nextUInt32())),2===s){var h=(i=r.nextString(l)).indexOf("\0");-1!==h&&(i=i.substr(0,h))}else if(7===s)i=r.nextBuffer(l);else if(0!==s)for(i=[],n=0;n<l;++n)i.push(readExifValue(s,r));return u<4&&r.skip(4-u),[a,i,s]}function readIFDSection(t,r,i){var n,a,s=r.nextUInt16();for(a=0;a<s;++a)i((n=readExifTag(t,r))[0],n[1],n[2])}function readHeader(t){if("Exif\0\0"!==t.nextString(6))throw Error("Invalid EXIF header");var r=t.mark(),i=t.nextUInt16();if(18761===i)t.setBigEndian(!1);else{if(19789!==i)throw Error("Invalid TIFF header");t.setBigEndian(!0)}if(42!==t.nextUInt16())throw Error("Invalid TIFF data");return r}var exif$2={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(t,r){try{i=readHeader(t)}catch(t){return!1}var i,n,a,s,o=i.openWithOffset(t.nextUInt32()),l=this.IFD0;readIFDSection(i,o,function(t,i,s){switch(t){case 34853:a=i[0];break;case 34665:n=i[0];break;default:r(l,t,i,s)}});var u=o.nextUInt32();if(0!==u){var h=i.openWithOffset(u);readIFDSection(i,h,r.bind(null,this.IFD1))}if(a){var f=i.openWithOffset(a);readIFDSection(i,f,r.bind(null,this.GPSIFD))}if(n){var d=i.openWithOffset(n),c=this.InteropIFD;readIFDSection(i,d,function(t,i,n){40965===t?s=i[0]:r(c,t,i,n)})}if(s){var p=i.openWithOffset(s);readIFDSection(i,p,r.bind(null,this.InteropIFD))}return!0}};function parseNumber(t){return parseInt(t,10)}var hours=3600,minutes=60;function parseDateTimeParts(t,r){return t=t.map(parseNumber),r=r.map(parseNumber),Date.UTC(t[0],t[1]-1,t[2],r[0],r[1],r[2],0)/1e3}function parseDateWithTimezoneFormat(t){var r=t.substr(0,10).split("-"),i=t.substr(11,8).split(":"),n=t.substr(19,6).split(":").map(parseNumber),a=n[0]*hours+n[1]*minutes,s=parseDateTimeParts(r,i);if("number"==typeof(s-=a)&&!isNaN(s))return s}function parseDateWithSpecFormat(t){var r=t.split(" "),i=parseDateTimeParts(r[0].split(":"),r[1].split(":"));if("number"==typeof i&&!isNaN(i))return i}function parseExifDate(t){var r=19===t.length&&":"===t.charAt(4);return 25===t.length&&"T"===t.charAt(10)?parseDateWithTimezoneFormat(t):r?parseDateWithSpecFormat(t):void 0}var exifTags,hasRequiredExifTags,date$1={parseDateWithSpecFormat:parseDateWithSpecFormat,parseDateWithTimezoneFormat:parseDateWithTimezoneFormat,parseExifDate:parseExifDate},exif$1=exif$2,date=date$1,degreeTags=[{section:exif$1.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:exif$1.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],dateTags=[{section:exif$1.SubIFD,type:306,name:"ModifyDate"},{section:exif$1.SubIFD,type:36867,name:"DateTimeOriginal"},{section:exif$1.SubIFD,type:36868,name:"CreateDate"},{section:exif$1.SubIFD,type:306,name:"ModifyDate"}],simplify$1={castDegreeValues:function(t,r){degreeTags.forEach(function(i){var n=t(i);if(n){var a=t({section:i.section,type:i.refType,name:i.refName})===i.posVal?1:-1;r(i,(n[0]+n[1]/60+n[2]/3600)*a)}})},castDateValues:function(t,r){dateTags.forEach(function(i){var n=t(i);if(n){var a=date.parseExifDate(n);void 0!==a&&r(i,a)}})},simplifyValue:function(t,r){return Array.isArray(t)&&1===(t=t.map(function(t){return 10===r||5===r?t[0]/t[1]:t})).length&&(t=t[0]),t}};function requireExifTags(){return hasRequiredExifTags?exifTags:(hasRequiredExifTags=1,exifTags={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}})}var jpeg=jpeg$1,exif=exif$2,simplify=simplify$1;function ExifResult(t,r,i,n,a,s,o){this.startMarker=t,this.tags=r,this.imageSize=i,this.thumbnailOffset=n,this.thumbnailLength=a,this.thumbnailType=s,this.app1Offset=o}function Parser$1(t){this.stream=t,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}ExifResult.prototype={hasThumbnail:function(t){return!(!this.thumbnailOffset||!this.thumbnailLength)&&("string"!=typeof t||("image/jpeg"===t.toLowerCase().trim()?6===this.thumbnailType:"image/tiff"===t.toLowerCase().trim()&&1===this.thumbnailType))},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var t,r=this._getThumbnailStream();return jpeg.parseSections(r,function(r,i){"SOF"===jpeg.getSectionName(r).name&&(t=jpeg.getSizeFromSOFSection(i))}),t}},Parser$1.prototype={enableBinaryFields:function(t){return this.flags.readBinaryTags=!!t,this},enablePointers:function(t){return this.flags.hidePointers=!t,this},enableTagNames:function(t){return this.flags.resolveTagNames=!!t,this},enableImageSize:function(t){return this.flags.imageSize=!!t,this},enableReturnTags:function(t){return this.flags.returnTags=!!t,this},enableSimpleValues:function(t){return this.flags.simplifyValues=!!t,this},parse:function(){var t,r,i,n,a,s,o,l,u,h=this.stream.mark(),f=h.openWithOffset(0),d=this.flags;return d.resolveTagNames&&(o=requireExifTags()),d.resolveTagNames?(t={},l=function(r){return t[r.name]},u=function(r,i){t[r.name]=i}):(t=[],l=function(r){var i;for(i=0;i<t.length;++i)if(t[i].type===r.type&&t[i].section===r.section)return t.value},u=function(r,i){var n;for(n=0;n<t.length;++n)if(t[n].type===r.type&&t[n].section===r.section)return void(t.value=i)}),jpeg.parseSections(f,function(l,u){var f=u.offsetFrom(h);225===l?exif.parseTags(u,function(r,s,l,u){if(d.readBinaryTags||7!==u){if(513===s){if(i=l[0],d.hidePointers)return}else if(514===s){if(n=l[0],d.hidePointers)return}else if(259===s&&(a=l[0],d.hidePointers))return;if(d.returnTags)if(d.simplifyValues&&(l=simplify.simplifyValue(l,u)),d.resolveTagNames){var h=(r===exif.GPSIFD?o.gps:o.exif)[s];h||(h=o.exif[s]),t.hasOwnProperty(h)||(t[h]=l)}else t.push({section:r,type:s,value:l})}})&&(s=f):d.imageSize&&"SOF"===jpeg.getSectionName(l).name&&(r=jpeg.getSizeFromSOFSection(u))}),d.simplifyValues&&(simplify.castDegreeValues(l,u),simplify.castDateValues(l,u)),new ExifResult(h,t,r,i,n,a,s)}};var domBufferstream,hasRequiredDomBufferstream,bufferstream,hasRequiredBufferstream,parser=Parser$1;function requireDomBufferstream(){if(hasRequiredDomBufferstream)return domBufferstream;function t(t,r,i,n,a,s){this.global=a,r=r||0,i=i||t.byteLength-r,this.arrayBuffer=t.slice(r,r+i),this.view=new a.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(n),this.offset=0,this.parentOffset=(s||0)+r}return hasRequiredDomBufferstream=1,t.prototype={setBigEndian:function(t){this.littleEndian=!t},nextUInt8:function(){var t=this.view.getUint8(this.offset);return this.offset+=1,t},nextInt8:function(){var t=this.view.getInt8(this.offset);return this.offset+=1,t},nextUInt16:function(){var t=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},nextUInt32:function(){var t=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},nextInt16:function(){var t=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},nextInt32:function(){var t=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},nextFloat:function(){var t=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},nextDouble:function(){var t=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},nextBuffer:function(t){var r=this.arrayBuffer.slice(this.offset,this.offset+t);return this.offset+=t,r},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(t){var r=this.arrayBuffer.slice(this.offset,this.offset+t);return r=String.fromCharCode.apply(null,new this.global.Uint8Array(r)),this.offset+=t,r},mark:function(){var r=this;return{openWithOffset:function(i){return i=(i||0)+this.offset,new t(r.arrayBuffer,i,r.arrayBuffer.byteLength-i,!r.littleEndian,r.global,r.parentOffset)},offset:this.offset,getParentOffset:function(){return r.parentOffset}}},offsetFrom:function(t){return this.parentOffset+this.offset-(t.offset+t.getParentOffset())},skip:function(t){this.offset+=t},branch:function(r,i){return i="number"==typeof i?i:this.arrayBuffer.byteLength-(this.offset+r),new t(this.arrayBuffer,this.offset+r,i,!this.littleEndian,this.global,this.parentOffset)}},domBufferstream=t}function requireBufferstream(){if(hasRequiredBufferstream)return bufferstream;function t(t,r,i,n){this.buffer=t,this.offset=r||0,i="number"==typeof i?i:t.length,this.endPosition=this.offset+i,this.setBigEndian(n)}return hasRequiredBufferstream=1,t.prototype={setBigEndian:function(t){this.bigEndian=!!t},nextUInt8:function(){var t=this.buffer.readUInt8(this.offset);return this.offset+=1,t},nextInt8:function(){var t=this.buffer.readInt8(this.offset);return this.offset+=1,t},nextUInt16:function(){var t=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,t},nextUInt32:function(){var t=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,t},nextInt16:function(){var t=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,t},nextInt32:function(){var t=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,t},nextFloat:function(){var t=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,t},nextDouble:function(){var t=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,t},nextBuffer:function(t){var r=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,r},remainingLength:function(){return this.endPosition-this.offset},nextString:function(t){var r=this.buffer.toString("utf8",this.offset,this.offset+t);return this.offset+=t,r},mark:function(){var r=this;return{openWithOffset:function(i){return i=(i||0)+this.offset,new t(r.buffer,i,r.endPosition-i,r.bigEndian)},offset:this.offset}},offsetFrom:function(t){return this.offset-t.offset},skip:function(t){this.offset+=t},branch:function(r,i){return i="number"==typeof i?i:this.endPosition-(this.offset+r),new t(this.buffer,this.offset+r,i,this.bigEndian)}},bufferstream=t}var Parser=parser;function getGlobal(){return(0,eval)("this")}var exifParser={create:function(t,r){return new Parser(t instanceof(r=r||getGlobal()).ArrayBuffer?new(requireDomBufferstream())(t,0,t.byteLength,!0,r):new(requireBufferstream())(t,0,t.length,!0))}},EXIFParser=getDefaultExportFromCjs(exifParser);function getExifOrientation(t){let r=t._exif;return r&&r.tags&&r.tags.Orientation||1}function getExifOrientationTransformation(t){let r=t.bitmap.width,i=t.bitmap.height;switch(getExifOrientation(t)){case 1:default:return null;case 2:return function(t,i){return[r-t-1,i]};case 3:return function(t,n){return[r-t-1,i-n-1]};case 4:return function(t,r){return[t,i-r-1]};case 5:return function(t,r){return[r,t]};case 6:return function(t,r){return[r,i-t-1]};case 7:return function(t,n){return[r-n-1,i-t-1]};case 8:return function(t,i){return[r-i-1,t]}}}function transformBitmap(t,r,i,n){let a=t.bitmap.data,s=t.bitmap.width,o=Buffer.alloc(a.length);for(let t=0;t<r;t++)for(let l=0;l<i;l++){let[i,u]=n(t,l),h=r*l+t<<2,f=s*u+i<<2,d=a.readUInt32BE(f);o.writeUInt32BE(d,h)}t.bitmap.data=o,t.bitmap.width=r,t.bitmap.height=i,t._exif.tags.Orientation=1}function exifRotate(t){if(2>getExifOrientation(t))return;let r=getExifOrientationTransformation(t),i=getExifOrientation(t)>4,n=i?t.bitmap.height:t.bitmap.width,a=i?t.bitmap.width:t.bitmap.height;r&&transformBitmap(t,n,a,r)}async function attemptExifRotate(t,r){try{t._exif=EXIFParser.create(r).parse(),exifRotate(t)}catch{}}var __defProp$2=Object.defineProperty,__defNormalProp$2=(t,r,i)=>r in t?__defProp$2(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i,__publicField$2=(t,r,i)=>__defNormalProp$2(t,"symbol"!=typeof r?r+"":r,i);let emptyBitmap={data:Buffer.alloc(0),width:0,height:0};function bufferFromArrayBuffer(t){let r=Buffer.alloc(t.byteLength),i=new Uint8Array(t);for(let t=0;t<r.length;++t)r[t]=i[t];return r}function createJimp({plugins:t,formats:r}={}){let i=t||[],n=(r||[]).map(t=>t()),a=class{constructor(t=emptyBitmap){if(__publicField$2(this,"bitmap",emptyBitmap),__publicField$2(this,"background",0),__publicField$2(this,"formats",[]),__publicField$2(this,"mime"),this.formats=n,"data"in t)this.bitmap=t;else if(this.bitmap={data:Buffer.alloc(t.width*t.height*4),width:t.width,height:t.height},t.color){this.background="string"==typeof t.color?cssColorToHex(t.color):t.color;for(let t=0;t<this.bitmap.data.length;t+=4)this.bitmap.data.writeUInt32BE(this.background,t)}for(const t of i)for(const r in t)this[r]=(...i)=>{let n=t[r]?.(this,...i);return"object"==typeof n&&"bitmap"in n?(this.bitmap=n.bitmap,this):n}}static async read(t,r){if(Buffer.isBuffer(t)||t instanceof ArrayBuffer)return this.fromBuffer(t);let[i,n]=await to(fetch(t));if(i)throw Error(`Could not load Buffer from URL: ${t}`);if(!n.ok)throw Error(`HTTP Status ${n.status} for url ${t}`);let[a,s]=await to(n.arrayBuffer());if(a)throw Error(`Could not load Buffer from ${t}`);let o=bufferFromArrayBuffer(s);return this.fromBuffer(o,r)}static fromBitmap(t){let r;if(t.data instanceof Buffer&&(r=Buffer.from(t.data)),(t.data instanceof Uint8Array||t.data instanceof Uint8ClampedArray)&&(r=Buffer.from(t.data.buffer)),Array.isArray(t.data)&&(r=Buffer.concat(t.data.map(t=>Buffer.from(t.toString(16).padStart(8,"0"),"hex")))),!r)throw Error("data must be a Buffer");if("number"!=typeof t.height||"number"!=typeof t.width)throw Error("bitmap must have width and height");return new a({height:t.height,width:t.width,data:r})}static async fromBuffer(t,r){let i=t instanceof ArrayBuffer?bufferFromArrayBuffer(t):t,s=await fileType$1.fromBuffer(i);if(!s||!s.mime)throw Error("Could not find MIME for Buffer");let o=n.find(t=>t.mime===s.mime);if(!o||!o.decode)throw Error(`Mime type ${s.mime} does not support decoding`);let l=new a(await o.decode(i,r?.[o.mime]));return l.mime=s.mime,attemptExifRotate(l,i),l}inspect(){return"<Jimp "+(this.bitmap===emptyBitmap?"pending...":this.bitmap.width+"x"+this.bitmap.height)+">"}toString(){return"[object Jimp]"}get width(){return this.bitmap.width}get height(){return this.bitmap.height}async getBuffer(t,r){let i,n=this.formats.find(r=>r.mime===t);if(!n||!n.encode)throw Error(`Unsupported MIME type: ${t}`);return n.hasAlpha?i=this:composite(i=new a({width:this.bitmap.width,height:this.bitmap.height,color:this.background}),this),n.encode(i.bitmap,r)}async getBase64(t,r){return"data:"+t+";base64,"+(await this.getBuffer(t,r)).toString("base64")}async write(t,r){let i=mime.getType(t);await writeFile(t,await this.getBuffer(i,r))}clone(){return new a({...this.bitmap,data:Buffer.from(this.bitmap.data)})}getPixelIndex(t,r,i){let n,a;if(i||(i=Edge.EXTEND),"number"!=typeof t||"number"!=typeof r)throw Error("x and y must be numbers");n=t=Math.round(t),a=r=Math.round(r),i===Edge.EXTEND&&(t<0&&(n=0),t>=this.bitmap.width&&(n=this.bitmap.width-1),r<0&&(a=0),r>=this.bitmap.height&&(a=this.bitmap.height-1)),i===Edge.WRAP&&(t<0&&(n=this.bitmap.width+t),t>=this.bitmap.width&&(n=t%this.bitmap.width),r<0&&(a=this.bitmap.height+r),r>=this.bitmap.height&&(a=r%this.bitmap.height));let s=this.bitmap.width*a+n<<2;return(n<0||n>=this.bitmap.width)&&(s=-1),(a<0||a>=this.bitmap.height)&&(s=-1),s}getPixelColor(t,r){if("number"!=typeof t||"number"!=typeof r)throw Error("x and y must be numbers");let i=this.getPixelIndex(t,r);return this.bitmap.data.readUInt32BE(i)}setPixelColor(t,r,i){if("number"!=typeof t||"number"!=typeof r||"number"!=typeof i)throw Error("hex, x and y must be numbers");let n=this.getPixelIndex(r,i);return this.bitmap.data.writeUInt32BE(t,n),this}hasAlpha(){let{width:t,height:r,data:i}=this.bitmap,n=t*r<<2;for(let t=3;t<n;t+=4)if(255!==i[t])return!0;return!1}composite(t,r=0,i=0,n={}){return composite(this,t,r,i,n)}scan(t,r,i,n,a){return scan(this,t,r,i,n,a)}scanIterator(t=0,r=0,i=this.bitmap.width,n=this.bitmap.height){if("number"!=typeof t||"number"!=typeof r)throw Error("x and y must be numbers");if("number"!=typeof i||"number"!=typeof n)throw Error("w and h must be numbers");return scanIterator(this,t,r,i,n)}};return a}function Resize(t,r,i,n,a,s,o){this.widthOriginal=Math.abs(Math.floor(t)||0),this.heightOriginal=Math.abs(Math.floor(r)||0),this.targetWidth=Math.abs(Math.floor(i)||0),this.targetHeight=Math.abs(Math.floor(n)||0),this.colorChannels=a?4:3,this.interpolationPass=!!s,this.resizeCallback="function"==typeof o?o:function(){},this.targetWidthMultipliedByChannels=this.targetWidth*this.colorChannels,this.originalWidthMultipliedByChannels=this.widthOriginal*this.colorChannels,this.originalHeightMultipliedByChannels=this.heightOriginal*this.colorChannels,this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal,this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight,this.initialize()}ResizeStrategy2=ResizeStrategy||(ResizeStrategy={}),ResizeStrategy2.NEAREST_NEIGHBOR="nearestNeighbor",ResizeStrategy2.BILINEAR="bilinearInterpolation",ResizeStrategy2.BICUBIC="bicubicInterpolation",ResizeStrategy2.HERMITE="hermiteInterpolation",ResizeStrategy2.BEZIER="bezierInterpolation",Resize.prototype.initialize=function(){if(!(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0))throw console.log(this),Error("Invalid settings specified for the resizer.");this.configurePasses()},Resize.prototype.configurePasses=function(){this.widthOriginal===this.targetWidth?this.resizeWidth=this.bypassResizer:(this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth,this.ratioWeightWidthPass<1&&this.interpolationPass?(this.initializeFirstPassBuffers(!0),this.resizeWidth=4===this.colorChannels?this.resizeWidthInterpolatedRGBA:this.resizeWidthInterpolatedRGB):(this.initializeFirstPassBuffers(!1),this.resizeWidth=4===this.colorChannels?this.resizeWidthRGBA:this.resizeWidthRGB)),this.heightOriginal===this.targetHeight?this.resizeHeight=this.bypassResizer:(this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight,this.ratioWeightHeightPass<1&&this.interpolationPass?(this.initializeSecondPassBuffers(!0),this.resizeHeight=this.resizeHeightInterpolated):(this.initializeSecondPassBuffers(!1),this.resizeHeight=4===this.colorChannels?this.resizeHeightRGBA:this.resizeHeightRGB))},Resize.prototype._resizeWidthInterpolatedRGBChannels=function(t,r){let i=r?4:3,n=this.ratioWeightWidthPass,a=this.widthBuffer,s,o,l=0,u=0,h=0,f=0,d=0;for(s=0;l<1/3;s+=i,l+=n)for(u=s,h=0;u<this.widthPassResultSize;h+=this.originalWidthMultipliedByChannels,u+=this.targetWidthMultipliedByChannels)a[u]=t[h],a[u+1]=t[h+1],a[u+2]=t[h+2],r&&(a[u+3]=t[h+3]);for(l-=1/3,o=this.widthOriginal-1;l<o;s+=i,l+=n)for(f=1-(d=l%1),u=s,h=Math.floor(l)*i;u<this.widthPassResultSize;h+=this.originalWidthMultipliedByChannels,u+=this.targetWidthMultipliedByChannels)a[u+0]=t[h+0]*f+t[h+i+0]*d,a[u+1]=t[h+1]*f+t[h+i+1]*d,a[u+2]=t[h+2]*f+t[h+i+2]*d,r&&(a[u+3]=t[h+3]*f+t[h+i+3]*d);for(o=this.originalWidthMultipliedByChannels-i;s<this.targetWidthMultipliedByChannels;s+=i)for(u=s,h=o;u<this.widthPassResultSize;h+=this.originalWidthMultipliedByChannels,u+=this.targetWidthMultipliedByChannels)a[u]=t[h],a[u+1]=t[h+1],a[u+2]=t[h+2],r&&(a[u+3]=t[h+3]);return a},Resize.prototype._resizeWidthRGBChannels=function(t,r){let i=r?4:3,n=this.ratioWeightWidthPass,a=1/n,s=this.originalWidthMultipliedByChannels-i+1,o=this.targetWidthMultipliedByChannels-i+1,l=this.outputWidthWorkBench,u=this.widthBuffer,h=this.outputWidthWorkBenchOpaquePixelsCount,f=0,d=0,c=0,p=0,m=0,g=0,_=0,b=1,y=0,v=0,w=0,x=0;do{for(m=0;m<this.originalHeightMultipliedByChannels;)l[m++]=0,l[m++]=0,l[m++]=0,r&&(l[m++]=0,h[m/i-1]=0);f=n;do{for(b=Math.min(f,d=1+c-p),m=0,g=c;m<this.originalHeightMultipliedByChannels;g+=s)y=t[g],v=t[++g],w=t[++g],x=r?t[++g]:255,l[m++]+=(x?y:0)*b,l[m++]+=(x?v:0)*b,l[m++]+=(x?w:0)*b,r&&(l[m++]+=x*b,h[m/i-1]+=x?b:0);if(!(f>=d)){p+=f;break}c+=i,p=c,f-=d}while(f>0&&c<this.originalWidthMultipliedByChannels)for(m=0,g=_;m<this.originalHeightMultipliedByChannels;g+=o)f=r?h[m/i]:1,b=r?f?1/f:0:a,u[g]=l[m++]*b,u[++g]=l[m++]*b,u[++g]=l[m++]*b,r&&(u[++g]=l[m++]*a);_+=i}while(_<this.targetWidthMultipliedByChannels)return u},Resize.prototype._resizeHeightRGBChannels=function(t,r){let i=this.ratioWeightHeightPass,n=1/i,a=this.outputHeightWorkBench,s=this.heightBuffer,o=this.outputHeightWorkBenchOpaquePixelsCount,l=0,u=0,h=0,f=0,d=0,c=0,p=0,m=1,g=0,_=0,b=0,y=0;do{for(d=0;d<this.targetWidthMultipliedByChannels;)a[d++]=0,a[d++]=0,a[d++]=0,r&&(a[d++]=0,o[d/4-1]=0);l=i;do{for(m=Math.min(l,u=1+h-f),p=h,d=0;d<this.targetWidthMultipliedByChannels;)g=t[p++],_=t[p++],b=t[p++],y=r?t[p++]:255,a[d++]+=(y?g:0)*m,a[d++]+=(y?_:0)*m,a[d++]+=(y?b:0)*m,r&&(a[d++]+=y*m,o[d/4-1]+=y?m:0);if(!(l>=u)){f+=l;break}f=h=p,l-=u}while(l>0&&h<this.widthPassResultSize)for(d=0;d<this.targetWidthMultipliedByChannels;)l=r?o[d/4]:1,m=r?l?1/l:0:n,s[c++]=Math.round(a[d++]*m),s[c++]=Math.round(a[d++]*m),s[c++]=Math.round(a[d++]*m),r&&(s[c++]=Math.round(a[d++]*n))}while(c<this.finalResultSize)return s},Resize.prototype.resizeWidthInterpolatedRGB=function(t){return this._resizeWidthInterpolatedRGBChannels(t,!1)},Resize.prototype.resizeWidthInterpolatedRGBA=function(t){return this._resizeWidthInterpolatedRGBChannels(t,!0)},Resize.prototype.resizeWidthRGB=function(t){return this._resizeWidthRGBChannels(t,!1)},Resize.prototype.resizeWidthRGBA=function(t){return this._resizeWidthRGBChannels(t,!0)},Resize.prototype.resizeHeightInterpolated=function(t){let r=this.ratioWeightHeightPass,i=this.heightBuffer,n,a=0,s=0,o=0,l=0,u=0,h=0,f=0;for(;a<1/3;a+=r)for(o=0;o<this.targetWidthMultipliedByChannels;)i[s++]=Math.round(t[o++]);for(a-=1/3,n=this.heightOriginal-1;a<n;a+=r)for(h=1-(f=a%1),u=(l=Math.floor(a)*this.targetWidthMultipliedByChannels)+this.targetWidthMultipliedByChannels,o=0;o<this.targetWidthMultipliedByChannels;++o)i[s++]=Math.round(t[l++]*h+t[u++]*f);for(;s<this.finalResultSize;)for(o=0,l=n*this.targetWidthMultipliedByChannels;o<this.targetWidthMultipliedByChannels;++o)i[s++]=Math.round(t[l++]);return i},Resize.prototype.resizeHeightRGB=function(t){return this._resizeHeightRGBChannels(t,!1)},Resize.prototype.resizeHeightRGBA=function(t){return this._resizeHeightRGBChannels(t,!0)},Resize.prototype.resize=function(t){this.resizeCallback(this.resizeHeight(this.resizeWidth(t)))},Resize.prototype.bypassResizer=function(t){return t},Resize.prototype.initializeFirstPassBuffers=function(t){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize),t||(this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels),this.colorChannels>3&&(this.outputWidthWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.heightOriginal)))},Resize.prototype.initializeSecondPassBuffers=function(t){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize),t||(this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels),this.colorChannels>3&&(this.outputHeightWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.targetWidth)))},Resize.prototype.generateFloatBuffer=function(t){try{return new Float32Array(t)}catch(t){return console.error(t),[]}},Resize.prototype.generateFloat64Buffer=function(t){try{return new Float64Array(t)}catch(t){return console.error(t),[]}},Resize.prototype.generateUint8Buffer=function(t){try{return new Uint8Array(t)}catch(t){return console.error(t),[]}};let operations={nearestNeighbor(t,r){let i=t.width,n=t.height,a=r.width,s=r.height,o=t.data,l=r.data;for(let t=0;t<s;t++)for(let r=0;r<a;r++){let u=4*(t*a+r),h=4*(Math.floor(t*n/s)*i+Math.floor(r*i/a));l[u++]=o[h++],l[u++]=o[h++],l[u++]=o[h++],l[u++]=o[h++]}},bilinearInterpolation(t,r){let i=t.width,n=t.height,a=r.width,s=r.height,o=t.data,l=r.data,u=function(t,r,i,n,a){return r===n?i:Math.round((t-r)*a+(n-t)*i)},h=function(t,r,n,a,s,h,f,d){let c=4*(f*i+a)+r,p=4*(f*i+s)+r,m=u(n,a,o[c],s,o[p]);if(d===f)l[t+r]=m;else{c=4*(d*i+a)+r,p=4*(d*i+s)+r;let g=u(n,a,o[c],s,o[p]);l[t+r]=u(h,f,m,d,g)}};for(let t=0;t<s;t++)for(let r=0;r<a;r++){let o=4*(t*a+r),l=r*i/a,u=Math.floor(l),f=Math.min(Math.ceil(l),i-1),d=t*n/s,c=Math.floor(d),p=Math.min(Math.ceil(d),n-1);h(o,0,l,u,f,d,c,p),h(o,1,l,u,f,d,c,p),h(o,2,l,u,f,d,c,p),h(o,3,l,u,f,d,c,p)}},_interpolate2D(t,r,i,n){let a=t.data,s=r.data,o=t.width,l=t.height,u=r.width,h=r.height,f=Math.max(1,Math.floor(o/u)),d=u*f,c=Math.max(1,Math.floor(l/h)),p=h*c,m=Buffer.alloc(d*l*4);for(let t=0;t<l;t++)for(let r=0;r<d;r++){let i=r*(o-1)/d,s=Math.floor(i),l=i-s,u=4*(t*o+s),h=4*(t*d+r);for(let t=0;t<4;t++){let r=u+t,i=s>0?a[r-4]:2*a[r]-a[r+4],f=a[r],d=a[r+4],c=s<o-2?a[r+8]:2*a[r+4]-a[r];m[h+t]=n(i,f,d,c,l)}}let g=Buffer.alloc(d*p*4);for(let t=0;t<p;t++)for(let r=0;r<d;r++){let i=t*(l-1)/p,a=Math.floor(i),s=i-a,o=4*(a*d+r),u=4*(t*d+r);for(let t=0;t<4;t++){let r=o+t,i=a>0?m[r-4*d]:2*m[r]-m[r+4*d],h=m[r],f=m[r+4*d],c=a<l-2?m[r+8*d]:2*m[r+4*d]-m[r];g[u+t]=n(i,h,f,c,s)}}let _=f*c;if(_>1)for(let t=0;t<h;t++)for(let r=0;r<u;r++){let i=0,n=0,a=0,o=0,l=0;for(let s=0;s<c;s++){let u=t*c+s;for(let t=0;t<f;t++){let s=4*(u*d+(r*f+t)),h=g[s+3];h&&(i+=g[s],n+=g[s+1],a+=g[s+2],l++),o+=h}}let h=4*(t*u+r);s[h]=l?Math.round(i/l):0,s[h+1]=l?Math.round(n/l):0,s[h+2]=l?Math.round(a/l):0,s[h+3]=Math.round(o/_)}else r.data=g},bicubicInterpolation(t,r,i){return this._interpolate2D(t,r,i,function(t,r,i,n,a){let s=n-i-t+r,o=t-r-s;return Math.max(0,Math.min(255,a*a*a*s+a*a*o+(i-t)*a+r))})},hermiteInterpolation(t,r,i){return this._interpolate2D(t,r,i,function(t,r,i,n,a){let s=r,o=.5*(i-t),l=t-2.5*r+2*i-.5*n;return Math.max(0,Math.min(255,Math.round((((.5*(n-t)+1.5*(r-i))*a+l)*a+o)*a+s)))})},bezierInterpolation(t,r,i){return this._interpolate2D(t,r,i,function(t,r,i,n,a){let s=1-a;return Math.max(0,Math.min(255,Math.round(r*s*s*s+3*(r+(i-t)/4)*s*s*a+3*(i-(n-r)/4)*s*a*a+i*a*a*a)))})}},ResizeOptionsSchema=z.union([z.object({w:z.number().min(0),h:z.number().min(0).optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),z.object({w:z.number().min(0).optional(),h:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()})]),ScaleToFitOptionsSchema=z.object({w:z.number().min(0),h:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()}),ScaleComplexOptionsSchema=z.object({f:z.number().min(0),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$d={resize(t,r){let i,n,{mode:a}=ResizeOptionsSchema.parse(r);if("number"==typeof r.w)i=r.w,n=r.h??t.bitmap.height*(i/t.bitmap.width);else{if("number"!=typeof r.h)throw Error("w must be a number");n=r.h,i=r.w??t.bitmap.width*(n/t.bitmap.height)}if(i=Math.round(i)||1,n=Math.round(n)||1,a&&"function"==typeof operations[a]){let r={data:Buffer.alloc(i*n*4),width:i,height:n};operations[a](t.bitmap,r),t.bitmap=r}else new Resize(t.bitmap.width,t.bitmap.height,i,n,!0,!0,r=>{t.bitmap.data=Buffer.from(r),t.bitmap.width=i,t.bitmap.height=n}).resize(t.bitmap.data);return t},scale(t,r){let{f:i,mode:n}="number"==typeof r?{f:r}:ScaleComplexOptionsSchema.parse(r),a=t.bitmap.width*i,s=t.bitmap.height*i;return this.resize(t,{w:a,h:s,mode:n})},scaleToFit(t,r){let{h:i,w:n,mode:a}=ScaleToFitOptionsSchema.parse(r),s=n/i>t.bitmap.width/t.bitmap.height?i/t.bitmap.height:n/t.bitmap.width;return this.scale(t,{f:s,mode:a})}},ContainOptionsSchema=z.object({w:z.number(),h:z.number(),align:z.number().optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$c={contain(t,r){let{w:i,h:n,align:a=HorizontalAlign.CENTER|VerticalAlign.MIDDLE,mode:s}=ContainOptionsSchema.parse(r),o=7&a,l=a>>3;if((0===o||o&o-1)&&(0===l||l&l-1))throw Error("only use one flag per alignment direction");let u=o>>1,h=l>>1,f=i/n>t.bitmap.width/t.bitmap.height?n/t.bitmap.height:i/t.bitmap.width,d=methods$d.scale(clone(t),{f:f,mode:s});return(t=methods$d.resize(t,{w:i,h:n,mode:s})).scan((r,i,n)=>{t.bitmap.data.writeUInt32BE(t.background,n)}),t=methods$h.blit(t,{src:d,x:(t.bitmap.width-d.bitmap.width)/2*u,y:(t.bitmap.height-d.bitmap.height)/2*h})}},CropOptionsSchema=z.object({x:z.number(),y:z.number(),w:z.number(),h:z.number()}),AutocropComplexOptionsSchema=z.object({tolerance:z.number().min(0).max(1).optional(),cropOnlyFrames:z.boolean().optional(),cropSymmetric:z.boolean().optional(),leaveBorder:z.number().optional(),ignoreSides:z.object({north:z.boolean().optional(),south:z.boolean().optional(),east:z.boolean().optional(),west:z.boolean().optional()}).optional()}),methods$b={crop(t,r){let{x:i,y:n,w:a,h:s}=CropOptionsSchema.parse(r);if(i=Math.round(i),n=Math.round(n),a=Math.round(a),s=Math.round(s),0===i&&a===t.bitmap.width){let r=a*n+i<<2,o=r+(s*a<<2);t.bitmap.data=t.bitmap.data.slice(r,o)}else{let r=Buffer.allocUnsafe(a*s*4),o=0;scan(t,i,n,a,s,function(i,n,a){let s=t.bitmap.data.readUInt32BE(a);r.writeUInt32BE(s,o),o+=4}),t.bitmap.data=r}return t.bitmap.width=a,t.bitmap.height=s,t},autocrop(t,r={}){let{tolerance:i=2e-4,cropOnlyFrames:n=!0,cropSymmetric:a=!1,leaveBorder:s=0,ignoreSides:o}="number"==typeof r?{tolerance:r}:AutocropComplexOptionsSchema.parse(r),l=t.bitmap.width,u=t.bitmap.height,h={north:!1,south:!1,east:!1,west:!1,...o},f=t.getPixelColor(0,0),d=intToRGBA$1(f),c=0,p=0,m=0,g=0;if(f=t.getPixelColor(0,0),!h.north)t:for(let r=0;r<u-1;r++){for(let n=0;n<l;n++)if(colorDiff(d,intToRGBA$1(t.getPixelColor(n,r)))>i)break t;c++}if(f=t.getPixelColor(l,0),!h.west)t:for(let r=0;r<l-1;r++){for(let n=0+c;n<u;n++)if(colorDiff(d,intToRGBA$1(t.getPixelColor(r,n)))>i)break t;g++}if(f=t.getPixelColor(0,u),!h.south)t:for(let r=u-1;r>=c+1;r--){for(let n=l-p-1;n>=0;n--)if(colorDiff(d,intToRGBA$1(t.getPixelColor(n,r)))>i)break t;m++}if(f=t.getPixelColor(l,u),!h.east)t:for(let r=l-1;r>=0+g+1;r--){for(let n=u-1;n>=0+c;n--)if(colorDiff(d,intToRGBA$1(t.getPixelColor(r,n)))>i)break t;p++}let _=!1;if(g-=s,p-=s,c-=s,m-=s,a){let t=Math.min(p,g),r=Math.min(c,m);g=t,p=t,c=r,m=r}g=g>=0?g:0,p=p>=0?p:0,c=c>=0?c:0,m=m>=0?m:0;let b=l-(g+p),y=u-(m+c);return(_=n?0!==p&&0!==c&&0!==g&&0!==m:0!==p||0!==c||0!==g||0!==m)&&this.crop(t,{x:g,y:c,w:b,h:y}),t}},CoverOptionsSchema=z.object({w:z.number(),h:z.number(),align:z.number().optional(),mode:z.nativeEnum(ResizeStrategy).optional()}),methods$a={cover(t,r){let{w:i,h:n,align:a=HorizontalAlign.CENTER|VerticalAlign.MIDDLE,mode:s}=CoverOptionsSchema.parse(r),o=7&a,l=a>>3;if((0===o||o&o-1)&&(0===l||l&l-1))throw Error("only use one flag per alignment direction");let u=o>>1,h=l>>1,f=i/n>t.bitmap.width/t.bitmap.height?i/t.bitmap.width:n/t.bitmap.height;return t=methods$d.scale(t,{f:f,mode:s}),t=methods$b.crop(t,{x:(t.bitmap.width-i)/2*u,y:(t.bitmap.height-n)/2*h,w:i,h:n})}},DisplaceOptionsSchema=z.object({map:JimpClassSchema,offset:z.number()}),methods$9={displace(t,r){let{map:i,offset:n}=DisplaceOptionsSchema.parse(r),a=clone(t);return t.scan((r,s,o)=>{let l=i.bitmap.data[o]/256*n;l=Math.round(l);let u=t.getPixelIndex(r+l,s);t.bitmap.data[u]=a.bitmap.data[o],t.bitmap.data[u+1]=a.bitmap.data[o+1],t.bitmap.data[u+2]=a.bitmap.data[o+2]}),t}},methods$8={dither(t){let r=[1,9,3,11,13,5,15,7,4,12,2,10,16,8,14,6];return t.scan((i,n,a)=>{let s=r[((3&n)<<2)+i%4];t.bitmap.data[a]=Math.min(t.bitmap.data[a]+s,255),t.bitmap.data[a+1]=Math.min(t.bitmap.data[a+1]+s,255),t.bitmap.data[a+2]=Math.min(t.bitmap.data[a+2]+s,255)}),t}},FisheyeOptionsSchema=z.object({radius:z.number().min(0).optional()}),methods$7={fisheye(t,r={}){let{radius:i=2.5}=FisheyeOptionsSchema.parse(r),n=clone(t),{width:a,height:s}=n.bitmap;return n.scan((r,o)=>{let l=r/a,u=o/s,h=Math.sqrt(Math.pow(l-.5,2)+Math.pow(u-.5,2)),f=2*Math.pow(h,i),d=Math.round(((l-.5)/h*f+.5)*a),c=Math.round(((u-.5)/h*f+.5)*s),p=n.getPixelColor(d,c);t.setPixelColor(p,r,o)}),t.setPixelColor(n.getPixelColor(a/2,s/2),a/2,s/2),t}},FlipOptionsSchema=z.object({horizontal:z.boolean().optional(),vertical:z.boolean().optional()}),methods$6={flip(t,r){let{horizontal:i,vertical:n}=FlipOptionsSchema.parse(r),a=Buffer.alloc(t.bitmap.data.length);return t.scan((r,s,o)=>{let l=i?t.bitmap.width-1-r:r,u=n?t.bitmap.height-1-s:s,h=t.bitmap.width*u+l<<2,f=t.bitmap.data.readUInt32BE(o);a.writeUInt32BE(f,h)}),t.bitmap.data=Buffer.from(a),t}};function Converter$1(t,r){if(!(t&&r&&t.length&&r.length))throw Error("Bad alphabet");this.srcAlphabet=t,this.dstAlphabet=r}Converter$1.prototype.convert=function(t){var r,i,n,a={},s=this.srcAlphabet.length,o=this.dstAlphabet.length,l=t.length,u="string"==typeof t?"":[];if(!this.isValid(t))throw Error('Number "'+t+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return t;for(r=0;r<l;r++)a[r]=this.srcAlphabet.indexOf(t[r]);do{for(i=0,n=0,r=0;r<l;r++)(i=i*s+a[r])>=o?(a[n++]=parseInt(i/o,10),i%=o):n>0&&(a[n++]=0);l=n,u=this.dstAlphabet.slice(i,i+1).concat(u)}while(0!==n)return u},Converter$1.prototype.isValid=function(t){for(var r=0;r<t.length;++r)if(-1===this.srcAlphabet.indexOf(t[r]))return!1;return!0};var converter=Converter$1,Converter=converter;function anyBase(t,r){var i=new Converter(t,r);return function(t){return i.convert(t)}}anyBase.BIN="01",anyBase.OCT="01234567",anyBase.DEC="0123456789",anyBase.HEX="0123456789abcdef";var anyBase_1=anyBase,anyBase$1=getDefaultExportFromCjs(anyBase_1),__defProp$1=Object.defineProperty,__defNormalProp$1=(t,r,i)=>r in t?__defProp$1(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i,__publicField$1=(t,r,i)=>__defNormalProp$1(t,"symbol"!=typeof r?r+"":r,i);class ImagePHash{constructor(t,r){__publicField$1(this,"size"),__publicField$1(this,"smallerSize"),this.size=t||32,this.smallerSize=r||8,initCoefficients(this.size)}distance(t,r){let i=0;for(let n=0;n<t.length;n++)t[n]!==r[n]&&i++;return i/t.length}getHash(t){t=methods$d.resize(clone(t),{w:this.size,h:this.size}),t=methods$e.greyscale(t);let r=[];for(let i=0;i<t.bitmap.width;i++){let n=[];for(let r=0;r<t.bitmap.height;r++)n[r]=intToRGBA(t.getPixelColor(i,r)).b;r[i]=n}let i=applyDCT(r,this.size),n=0;for(let t=0;t<this.smallerSize;t++)for(let r=0;r<this.smallerSize;r++)n+=i[t][r];let a=n/(this.smallerSize*this.smallerSize),s="";for(let t=0;t<this.smallerSize;t++)for(let r=0;r<this.smallerSize;r++)s+=i[t][r]>a?"1":"0";return s}}function intToRGBA(t){let r=255&t,i=255&(t>>>=8),n=255&(t>>>=8);return{r:255&(t>>>=8),g:n,b:i,a:r}}let c$1=[];function initCoefficients(t){for(let r=1;r<t;r++)c$1[r]=1;c$1[0]=1/Math.sqrt(2)}function applyDCT(t,r){let i=r,n=[];for(let r=0;r<i;r++){let a=[];for(let s=0;s<i;s++){let o=0;for(let n=0;n<i;n++)for(let a=0;a<i;a++)o+=Math.cos((2*n+1)/(2*i)*r*Math.PI)*Math.cos((2*a+1)/(2*i)*s*Math.PI)*t[n][a];o*=c$1[r]*c$1[s]/4,a[s]=o,n[r]=a}}return n}let alphabet="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",maxHashLength=[NaN,NaN];for(let e1=2;e1<65;e1++){let t1=anyBase$1(anyBase$1.BIN,alphabet.slice(0,e1))(Array(65).join("1"));maxHashLength.push(t1.length)}let methods$5={pHash:t=>(new ImagePHash).getHash(t),hash(t,r=64){if(r<2||r>64)throw Error("base must be a number between 2 and 64");let i=alphabet.slice(0,r),n=this.pHash(t),a=maxHashLength[r];return anyBase$1(anyBase$1.BIN,i)(n).padStart(a,"0")},distanceFromHash(t,r){let i=new ImagePHash,n=i.getHash(t);return i.distance(n,r)}};function distance(t,r){let i=new ImagePHash,n=i.getHash(t),a=i.getHash(r);return i.distance(n,a)}function compareHashes(t,r){return(new ImagePHash).distance(t,r)}let MaskOptionsObjectSchema=z.object({src:JimpClassSchema,x:z.number().optional(),y:z.number().optional()}),MaskOptionsSchema=z.union([JimpClassSchema,MaskOptionsObjectSchema]),methods$4={mask(t,r){let i,n,a;MaskOptionsSchema.parse(r),"bitmap"in r?(i=r,n=0,a=0):(i=r.src,n=r.x??0,a=r.y??0),n=Math.round(n),a=Math.round(a);let s=t.bitmap.width,o=t.bitmap.height;return i.scan(function(r,l,u){let h=n+r,f=a+l;if(h>=0&&f>=0&&h<s&&f<o){let r=t.getPixelIndex(h,f),{data:n}=i.bitmap,a=(n[u+0]+n[u+1]+n[u+2])/3;t.bitmap.data[r+3]*=a/255}}),t}};function measureText(t,r){let i=0;for(let n=0;n<r.length;n++){let a=r[n],s=t.chars[a];if(s){let o=t.kernings[a],l=r[n+1],u=o&&l&&o[l]&&o[l]||0;i+=(s.xadvance||0)+u}}return i}function splitLines(t,r,i){let n=r.replace(/[\r\n]+/g," \n").split(" "),a=[],s=[],o=0;return n.forEach(r=>{if(measureText(t,r+(n.length>1?" ":""))>i){let n=r[Symbol.iterator](),o="";for(let r of n){let n=measureText(t,[...s,o+r].join(" "));n<i?o+=r:n>i?(a.push([...s,o]),s=[],o=r):(a.push([...s,o+r]),s=[],o="")}return}let l=measureText(t,[...s,r].join(" "));l<=i&&!r.includes("\n")?(l>o&&(o=l),s.push(r)):(a.push(s),s=[r.replace("\n","")])}),a.push(s),{lines:a,longestLine:o}}function measureTextHeight(t,r,i){let{lines:n}=splitLines(t,r,i);return n.length*t.common.lineHeight}let PrintOptionsSchema=z.object({x:z.number(),y:z.number(),text:z.union([z.union([z.string(),z.number()]),z.object({text:z.union([z.string(),z.number()]),alignmentX:z.nativeEnum(HorizontalAlign).optional(),alignmentY:z.nativeEnum(VerticalAlign).optional()})]),maxWidth:z.number().optional(),maxHeight:z.number().optional(),cb:z.function(z.tuple([z.object({x:z.number(),y:z.number()})])).optional()});function xOffsetBasedOnAlignment(t,r,i,n){return n===HorizontalAlign.LEFT?0:n===HorizontalAlign.CENTER?(i-measureText(t,r))/2:i-measureText(t,r)}function drawCharacter(t,r,i,n,a){if(a.width>0&&a.height>0){let s=r.pages[a.page];s&&(t=methods$h.blit(t,{src:s,x:i+a.xoffset,y:n+a.yoffset,srcX:a.x,srcY:a.y,srcW:a.width,srcH:a.height}))}return t}function printText(t,r,i,n,a,s){for(let o=0;o<a.length;o++){let l,u=a[o];l=r.chars[u]?u:/\s/.test(u)?"":"?";let h=r.chars[l]||{xadvance:void 0},f=r.kernings[l];h&&drawCharacter(t,r,i,n,h);let d=a[o+1];i+=(f&&d&&f[d]&&f[d]||0)+(h.xadvance||s)}}let methods$3={print(t,{font:r,...i}){let n,a,{x:s,y:o,text:l,maxWidth:u=1/0,maxHeight:h=1/0,cb:f=()=>{}}=PrintOptionsSchema.parse(i);"object"==typeof l&&null!==l.text&&void 0!==l.text?(n=l.alignmentX||HorizontalAlign.LEFT,a=l.alignmentY||VerticalAlign.TOP,{text:l}=l):(n=HorizontalAlign.LEFT,a=VerticalAlign.TOP,l=l.toString()),"number"==typeof l&&(l=l.toString()),h!==1/0&&a===VerticalAlign.BOTTOM?o+=h-measureTextHeight(r,l,u):h!==1/0&&a===VerticalAlign.MIDDLE&&(o+=h/2-measureTextHeight(r,l,u)/2);let d=Object.entries(r.chars).find(t=>t[1].xadvance)?.[1].xadvance;if("number"!=typeof d)throw Error("Could not find default character width");let{lines:c,longestLine:p}=splitLines(r,l,u);return c.forEach(i=>{let a=i.join(" "),l=xOffsetBasedOnAlignment(r,a,u,n);printText(t,r,s+l,o,a,d),o+=r.common.lineHeight}),f.bind(t)({x:s+p,y:o}),t}},RotateOptionsSchema=z.union([z.number(),z.object({deg:z.number(),mode:z.union([z.boolean(),z.nativeEnum(ResizeStrategy)]).optional()})]);function createIdxTranslationFunction(t){return function(r,i){return i*t+r<<2}}function matrixRotate(t,r){let i;if(Math.abs(r)%90!=0)throw Error("Unsupported matrix rotation degree");let n=t.bitmap.width,a=t.bitmap.height;switch(r){case 90:case -270:i=90;break;case 180:case -180:i=180;break;case 270:case -90:i=-90;break;default:throw Error("Unsupported matrix rotation degree")}let s=180===i?n:a,o=180===i?a:n,l=Buffer.alloc(t.bitmap.data.length),u=createIdxTranslationFunction(n),h=createIdxTranslationFunction(s);for(let r=0;r<n;r++)for(let s=0;s<a;s++){let o,f=u(r,s),d=t.bitmap.data.readUInt32BE(f);switch(i){case 90:o=h(s,n-r-1);break;case -90:o=h(a-s-1,r);break;case 180:o=h(n-r-1,a-s-1);break;default:throw Error("Unsupported matrix rotation angle")}l.writeUInt32BE(d,o)}t.bitmap.data=l,t.bitmap.width=s,t.bitmap.height=o}function createTranslationFunction(t,r){return function(i,n){return{x:i+t,y:n+r}}}function advancedRotate(t,r,i){let n=r*Math.PI/180,a=Math.cos(n),s=Math.sin(n),o=t.bitmap.width,l=t.bitmap.height;if(!0===i||"string"==typeof i){o=Math.ceil(Math.abs(t.bitmap.width*a)+Math.abs(t.bitmap.height*s))+1,l=Math.ceil(Math.abs(t.bitmap.width*s)+Math.abs(t.bitmap.height*a))+1,o%2!=0&&o++,l%2!=0&&l++;let r=clone(t);t.scan((r,i,n)=>{t.bitmap.data.writeUInt32BE(t.background,n)});let n=Math.max(o,l,t.bitmap.width,t.bitmap.height);t=composite(t=methods$d.resize(t,{h:n,w:n,mode:!0===i?void 0:i}),r,t.bitmap.width/2-r.bitmap.width/2,t.bitmap.height/2-r.bitmap.height/2)}let u=t.bitmap.width,h=t.bitmap.height,f=Buffer.alloc(t.bitmap.data.length),d=createTranslationFunction(-u/2,-h/2),c=createTranslationFunction(u/2+.5,h/2+.5);for(let r=1;r<=h;r++)for(let i=1;i<=u;i++){let n=d(i,r),o=c(a*n.x-s*n.y,a*n.y+s*n.x),l=u*(r-1)+i-1<<2;if(o.x>=0&&o.x<u&&o.y>=0&&o.y<h){let r=u*(0|o.y)+o.x<<2,i=t.bitmap.data.readUInt32BE(r);f.writeUInt32BE(i,l)}else f.writeUInt32BE(t.background,l)}if(t.bitmap.data=f,!0===i||"string"==typeof i){let r=Math.max(u/2-o/2,0),i=Math.max(h/2-l/2,0);t=methods$b.crop(t,{x:r,y:i,w:o,h:l})}}let methods$2={rotate(t,r){let i=RotateOptionsSchema.parse(r),n="number"==typeof i?{deg:i}:i,{mode:a=!0}=n,{deg:s}=n;return(s%=360)%360==0||(s%90==0&&(a||t.bitmap.width===t.bitmap.height||s%180==0)?matrixRotate(t,s):advancedRotate(t,s,a)),t}},ThresholdOptionsSchema=z.object({max:z.number().min(0).max(255),replace:z.number().min(0).max(255).optional(),autoGreyscale:z.boolean().optional()}),methods$1={threshold(t,r){let{max:i,replace:n=255,autoGreyscale:a=!0}=ThresholdOptionsSchema.parse(r);return i=limit255(i),n=limit255(n),a&&methods$e.greyscale(t),t.scan((r,a,s)=>{let o=t.bitmap.data[s]<i?t.bitmap.data[s]:n;t.bitmap.data[s]=o,t.bitmap.data[s+1]=o,t.bitmap.data[s+2]=o}),t}};var __defProp=Object.defineProperty,__defNormalProp=(t,r,i)=>r in t?__defProp(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i,__export=(t,r)=>{for(var i in r)__defProp(t,i,{get:r[i],enumerable:!0})},__publicField=(t,r,i)=>(__defNormalProp(t,"symbol"!=typeof r?r+"":r,i),i),constants_exports={};__export(constants_exports,{bt709:()=>bt709_exports});var bt709_exports={};__export(bt709_exports,{Y:()=>Y,x:()=>x$1,y:()=>y$1});var Y=(t=>(t[t.RED=.2126]="RED",t[t.GREEN=.7152]="GREEN",t[t.BLUE=.0722]="BLUE",t[t.WHITE=1]="WHITE",t))(Y||{}),x$1=(t=>(t[t.RED=.64]="RED",t[t.GREEN=.3]="GREEN",t[t.BLUE=.15]="BLUE",t[t.WHITE=.3127]="WHITE",t))(x$1||{}),y$1=(t=>(t[t.RED=.33]="RED",t[t.GREEN=.6]="GREEN",t[t.BLUE=.06]="BLUE",t[t.WHITE=.329]="WHITE",t))(y$1||{}),conversion_exports={};function correctGamma(t){return t>.04045?((t+.055)/1.055)**2.4:t/12.92}function rgb2xyz(t,r,i){return{x:.4124*(t=correctGamma(t/255))+.3576*(r=correctGamma(r/255))+.1805*(i=correctGamma(i/255)),y:.2126*t+.7152*r+.0722*i,z:.0193*t+.1192*r+.9505*i}}__export(conversion_exports,{lab2rgb:()=>lab2rgb,lab2xyz:()=>lab2xyz,rgb2hsl:()=>rgb2hsl,rgb2lab:()=>rgb2lab,rgb2xyz:()=>rgb2xyz,xyz2lab:()=>xyz2lab,xyz2rgb:()=>xyz2rgb});var arithmetic_exports={};function degrees2radians(t){return Math.PI/180*t}function max3(t,r,i){let n=t;return n<r&&(n=r),n<i&&(n=i),n}function min3(t,r,i){let n=t;return n>r&&(n=r),n>i&&(n=i),n}function intInRange(t,r,i){return t>i&&(t=i),t<r&&(t=r),0|t}function inRange0to255Rounded(t){return(t=Math.round(t))>255?t=255:t<0&&(t=0),t}function inRange0to255(t){return t>255?t=255:t<0&&(t=0),t}function stableSort(t,r){let i,n=typeof t[0];if("number"===n||"string"===n){let n=Object.create(null);for(let r=0,i=t.length;r<i;r++){let i=t[r];n[i]||0===n[i]||(n[i]=r)}i=t.sort((t,i)=>r(t,i)||n[t]-n[i])}else{let n=t.slice(0);i=t.sort((t,i)=>r(t,i)||n.indexOf(t)-n.indexOf(i))}return i}function rgb2hsl(t,r,i){let n=min3(t,r,i),a=max3(t,r,i),s=a-n,o=(n+a)/510,l=0;o>0&&o<1&&(l=s/(o<.5?a+n:510-a-n));let u=0;return s>0&&(u=(a===t?(r-i)/s:a===r?2+(i-t)/s:4+(t-r)/s)*60)<0&&(u+=360),{h:u,s:l,l:o}}__export(arithmetic_exports,{degrees2radians:()=>degrees2radians,inRange0to255:()=>inRange0to255,inRange0to255Rounded:()=>inRange0to255Rounded,intInRange:()=>intInRange,max3:()=>max3,min3:()=>min3,stableSort:()=>stableSort});var refX=.95047,refY=1,refZ=1.08883;function pivot(t){return t>.008856?t**(1/3):7.787*t+16/116}function xyz2lab(t,r,i){if(t=pivot(t/refX),r=pivot(r/refY),i=pivot(i/refZ),116*r-16<0)throw Error("xxx");return{L:Math.max(0,116*r-16),a:500*(t-r),b:200*(r-i)}}function rgb2lab(t,r,i){let n=rgb2xyz(t,r,i);return xyz2lab(n.x,n.y,n.z)}var refX2=.95047,refY2=1,refZ2=1.08883;function pivot2(t){return t>.206893034?t**3:(t-16/116)/7.787}function lab2xyz(t,r,i){let n=(t+16)/116,a=n-i/200;return{x:refX2*pivot2(r/500+n),y:refY2*pivot2(n),z:refZ2*pivot2(a)}}function correctGamma2(t){return t>.0031308?1.055*t**(1/2.4)-.055:12.92*t}function xyz2rgb(t,r,i){let n=correctGamma2(3.2406*t+-1.5372*r+-.4986*i),a=correctGamma2(-.9689*t+1.8758*r+.0415*i),s=correctGamma2(.0557*t+-.204*r+1.057*i);return{r:inRange0to255Rounded(255*n),g:inRange0to255Rounded(255*a),b:inRange0to255Rounded(255*s)}}function lab2rgb(t,r,i){let n=lab2xyz(t,r,i);return xyz2rgb(n.x,n.y,n.z)}var distance_exports={};__export(distance_exports,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator,AbstractEuclidean:()=>AbstractEuclidean,AbstractManhattan:()=>AbstractManhattan,CIE94GraphicArts:()=>CIE94GraphicArts,CIE94Textiles:()=>CIE94Textiles,CIEDE2000:()=>CIEDE2000,CMetric:()=>CMetric,Euclidean:()=>Euclidean,EuclideanBT709:()=>EuclideanBT709,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha,Manhattan:()=>Manhattan,ManhattanBT709:()=>ManhattanBT709,ManhattanNommyde:()=>ManhattanNommyde,PNGQuant:()=>PNGQuant});var AbstractDistanceCalculator=class{constructor(){__publicField(this,"_maxDistance"),__publicField(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(t,r,i,n){this._whitePoint={r:t>0?255/t:0,g:r>0?255/r:0,b:i>0?255/i:0,a:n>0?255/n:0},this._maxDistance=this.calculateRaw(t,r,i,n,0,0,0,0)}calculateNormalized(t,r){return this.calculateRaw(t.r,t.g,t.b,t.a,r.r,r.g,r.b,r.a)/this._maxDistance}},AbstractCIE94=class extends AbstractDistanceCalculator{calculateRaw(t,r,i,n,a,s,o,l){let u=rgb2lab(inRange0to255(t*this._whitePoint.r),inRange0to255(r*this._whitePoint.g),inRange0to255(i*this._whitePoint.b)),h=rgb2lab(inRange0to255(a*this._whitePoint.r),inRange0to255(s*this._whitePoint.g),inRange0to255(o*this._whitePoint.b)),f=u.L-h.L,d=u.a-h.a,c=u.b-h.b,p=Math.sqrt(u.a*u.a+u.b*u.b),m=p-Math.sqrt(h.a*h.a+h.b*h.b),g=d*d+c*c-m*m;g=g<0?0:Math.sqrt(g);let _=(l-n)*this._whitePoint.a*this._kA;return Math.sqrt((f/this._Kl)**2+(m/(1+this._K1*p))**2+(g/(1+this._K2*p))**2+_**2)}},CIE94Textiles=class extends AbstractCIE94{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=12.5/255}},CIE94GraphicArts=class extends AbstractCIE94{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=25/255}},_CIEDE2000=class extends AbstractDistanceCalculator{_setDefaults(){}static _calculatehp(t,r){let i=Math.atan2(t,r);return i>=0?i:i+_CIEDE2000._deg360InRad}static _calculateRT(t,r){let i=r**7,n=2*Math.sqrt(i/(i+_CIEDE2000._pow25to7));return-Math.sin(2*(_CIEDE2000._deg30InRad*Math.exp(-(((t-_CIEDE2000._deg275InRad)/_CIEDE2000._deg25InRad)**2))))*n}static _calculateT(t){return 1-.17*Math.cos(t-_CIEDE2000._deg30InRad)+.24*Math.cos(2*t)+.32*Math.cos(3*t+_CIEDE2000._deg6InRad)-.2*Math.cos(4*t-_CIEDE2000._deg63InRad)}static _calculate_ahp(t,r,i,n){let a=i+n;return 0===t?a:r<=_CIEDE2000._deg180InRad?a/2:a<_CIEDE2000._deg360InRad?(a+_CIEDE2000._deg360InRad)/2:(a-_CIEDE2000._deg360InRad)/2}static _calculate_dHp(t,r,i,n){let a;return a=0===t?0:r<=_CIEDE2000._deg180InRad?i-n:i<=n?i-n+_CIEDE2000._deg360InRad:i-n-_CIEDE2000._deg360InRad,2*Math.sqrt(t)*Math.sin(a/2)}calculateRaw(t,r,i,n,a,s,o,l){let u=rgb2lab(inRange0to255(t*this._whitePoint.r),inRange0to255(r*this._whitePoint.g),inRange0to255(i*this._whitePoint.b)),h=rgb2lab(inRange0to255(a*this._whitePoint.r),inRange0to255(s*this._whitePoint.g),inRange0to255(o*this._whitePoint.b)),f=(l-n)*this._whitePoint.a*_CIEDE2000._kA;return Math.sqrt(this.calculateRawInLab(u,h)+f*f)}calculateRawInLab(t,r){let i=t.L,n=t.a,a=t.b,s=r.L,o=r.a,l=r.b,u=((Math.sqrt(n*n+a*a)+Math.sqrt(o*o+l*l))/2)**7,h=.5*(1-Math.sqrt(u/(u+_CIEDE2000._pow25to7))),f=(1+h)*n,d=(1+h)*o,c=Math.sqrt(f*f+a*a),p=Math.sqrt(d*d+l*l),m=c*p,g=_CIEDE2000._calculatehp(a,f),_=_CIEDE2000._calculatehp(l,d),b=Math.abs(g-_),y=s-i,v=p-c,w=_CIEDE2000._calculate_dHp(m,b,_,g),x=_CIEDE2000._calculate_ahp(m,b,g,_),k=(c+p)/2,E=((i+s)/2-50)**2,S=v/(1+.045*k),$=w/(1+.015*_CIEDE2000._calculateT(x)*k);return(y/(1+.015*E/Math.sqrt(20+E)))**2+S**2+$**2+_CIEDE2000._calculateRT(x,k)*S*$}},CIEDE2000=_CIEDE2000;__publicField(CIEDE2000,"_kA",25/255),__publicField(CIEDE2000,"_pow25to7",0x16bcc41e9),__publicField(CIEDE2000,"_deg360InRad",degrees2radians(360)),__publicField(CIEDE2000,"_deg180InRad",degrees2radians(180)),__publicField(CIEDE2000,"_deg30InRad",degrees2radians(30)),__publicField(CIEDE2000,"_deg6InRad",degrees2radians(6)),__publicField(CIEDE2000,"_deg63InRad",degrees2radians(63)),__publicField(CIEDE2000,"_deg275InRad",degrees2radians(275)),__publicField(CIEDE2000,"_deg25InRad",degrees2radians(25));var CMetric=class extends AbstractDistanceCalculator{calculateRaw(t,r,i,n,a,s,o,l){let u=(t+a)/2*this._whitePoint.r,h=(t-a)*this._whitePoint.r,f=(r-s)*this._whitePoint.g,d=(i-o)*this._whitePoint.b,c=((512+u)*h*h>>8)+4*f*f+((767-u)*d*d>>8),p=(l-n)*this._whitePoint.a;return Math.sqrt(c+p*p)}_setDefaults(){}},AbstractEuclidean=class extends AbstractDistanceCalculator{calculateRaw(t,r,i,n,a,s,o,l){let u=a-t,h=s-r,f=o-i,d=l-n;return Math.sqrt(this._kR*u*u+this._kG*h*h+this._kB*f*f+this._kA*d*d)}},Euclidean=class extends AbstractEuclidean{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan=class extends AbstractDistanceCalculator{calculateRaw(t,r,i,n,a,s,o,l){let u=a-t,h=s-r,f=o-i,d=l-n;return u<0&&(u=0-u),h<0&&(h=0-h),f<0&&(f=0-f),d<0&&(d=0-d),this._kR*u+this._kG*h+this._kB*f+this._kA*d}},Manhattan=class extends AbstractManhattan{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde=class extends AbstractManhattan{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709=class extends AbstractManhattan{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant=class extends AbstractDistanceCalculator{calculateRaw(t,r,i,n,a,s,o,l){let u=(l-n)*this._whitePoint.a;return this._colordifferenceCh(t*this._whitePoint.r,a*this._whitePoint.r,u)+this._colordifferenceCh(r*this._whitePoint.g,s*this._whitePoint.g,u)+this._colordifferenceCh(i*this._whitePoint.b,o*this._whitePoint.b,u)}_colordifferenceCh(t,r,i){let n=t-r,a=n+i;return n*n+a*a}_setDefaults(){}},palette_exports={};__export(palette_exports,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer,ColorHistogram:()=>ColorHistogram,NeuQuant:()=>NeuQuant,NeuQuantFloat:()=>NeuQuantFloat,RGBQuant:()=>RGBQuant,WuColorCube:()=>WuColorCube,WuQuant:()=>WuQuant});var AbstractPaletteQuantizer=class{quantizeSync(){for(let t of this.quantize())if(t.palette)return t.palette;throw Error("unreachable")}},Point=class{constructor(){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),__publicField(this,"uint32"),__publicField(this,"rgba"),this.uint32=0xffffffff,this.r=this.g=this.b=this.a=0,this.rgba=[,,,,],this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(t){let r=new Point;return r.r=0|t[0],r.g=0|t[1],r.b=0|t[2],r.a=0|t[3],r._loadUINT32(),r._loadQuadruplet(),r}static createByRGBA(t,r,i,n){let a=new Point;return a.r=0|t,a.g=0|r,a.b=0|i,a.a=0|n,a._loadUINT32(),a._loadQuadruplet(),a}static createByUint32(t){let r=new Point;return r.uint32=t>>>0,r._loadRGBA(),r._loadQuadruplet(),r}from(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.uint32=t.uint32,this.rgba[0]=t.r,this.rgba[1]=t.g,this.rgba[2]=t.b,this.rgba[3]=t.a}getLuminosity(t){let r=this.r,i=this.g,n=this.b;return t&&(r=Math.min(255,255-this.a+this.a*r/255),i=Math.min(255,255-this.a+this.a*i/255),n=Math.min(255,255-this.a+this.a*n/255)),.2126*r+.7152*i+.0722*n}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=255&this.uint32,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer=class{constructor(){__publicField(this,"_pointArray"),__publicField(this,"_width"),__publicField(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(t){this._width=t}setHeight(t){this._height=t}getPointArray(){return this._pointArray}clone(){let t=new PointContainer;t._width=this._width,t._height=this._height;for(let r=0,i=this._pointArray.length;r<i;r++)t._pointArray[r]=Point.createByUint32(0|this._pointArray[r].uint32);return t}toUint32Array(){let t=this._pointArray.length,r=new Uint32Array(t);for(let i=0;i<t;i++)r[i]=this._pointArray[i].uint32;return r}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(t){let r=t.naturalWidth,i=t.naturalHeight,n=document.createElement("canvas");return n.width=r,n.height=i,n.getContext("2d").drawImage(t,0,0,r,i,0,0,r,i),PointContainer.fromHTMLCanvasElement(n)}static fromHTMLCanvasElement(t){let r=t.width,i=t.height,n=t.getContext("2d").getImageData(0,0,r,i);return PointContainer.fromImageData(n)}static fromImageData(t){let r=t.width,i=t.height;return PointContainer.fromUint8Array(t.data,r,i)}static fromUint8Array(t,r,i){switch(Object.prototype.toString.call(t)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:t=new Uint8Array(t)}let n=new Uint32Array(t.buffer);return PointContainer.fromUint32Array(n,r,i)}static fromUint32Array(t,r,i){let n=new PointContainer;n._width=r,n._height=i;for(let r=0,i=t.length;r<i;r++)n._pointArray[r]=Point.createByUint32(0|t[r]);return n}static fromBuffer(t,r,i){let n=new Uint32Array(t.buffer,t.byteOffset,t.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer.fromUint32Array(n,r,i)}},hueGroups=10;function hueGroup(t,r){let i=360/r;for(let n=1,a=i-i/2;n<r;n++,a+=i)if(t>=a&&t<a+i)return n;return 0}var Palette=class{constructor(){__publicField(this,"_pointContainer"),__publicField(this,"_pointArray",[]),__publicField(this,"_i32idx",{}),this._pointContainer=new PointContainer,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(t){this._pointArray.push(t),this._pointContainer.setWidth(this._pointArray.length)}has(t){for(let r=this._pointArray.length-1;r>=0;r--)if(t.uint32===this._pointArray[r].uint32)return!0;return!1}getNearestColor(t,r){return this._pointArray[0|this._getNearestIndex(t,r)]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(t){return"number"==typeof this._i32idx[t]?this._i32idx[t]:-1}_getNearestIndex(t,r){let i=this._nearestPointFromCache(""+r.uint32);if(i>=0)return i;let n=Number.MAX_VALUE;i=0;for(let a=0,s=this._pointArray.length;a<s;a++){let s=this._pointArray[a],o=t.calculateRaw(r.r,r.g,r.b,r.a,s.r,s.g,s.b,s.a);o<n&&(n=o,i=a)}return this._i32idx[r.uint32]=i,i}sort(){this._i32idx={},this._pointArray.sort((t,r)=>{let i=rgb2hsl(t.r,t.g,t.b),n=rgb2hsl(r.r,r.g,r.b),a=t.r===t.g&&t.g===t.b?0:1+hueGroup(i.h,hueGroups),s=(r.r===r.g&&r.g===r.b?0:1+hueGroup(n.h,hueGroups))-a;if(s)return-s;let o=t.getLuminosity(!0),l=r.getLuminosity(!0);if(l-o!=0)return l-o;let u=(100*n.s|0)-(100*i.s|0);return u?-u:0})}},utils_exports={};__export(utils_exports,{HueStatistics:()=>HueStatistics,Palette:()=>Palette,Point:()=>Point,PointContainer:()=>PointContainer,ProgressTracker:()=>ProgressTracker,arithmetic:()=>arithmetic_exports});var HueGroup=class{constructor(){__publicField(this,"num",0),__publicField(this,"cols",[])}},HueStatistics=class{constructor(t,r){__publicField(this,"_numGroups"),__publicField(this,"_minCols"),__publicField(this,"_stats"),__publicField(this,"_groupsFull"),this._numGroups=t,this._minCols=r,this._stats=[];for(let r=0;r<=t;r++)this._stats[r]=new HueGroup;this._groupsFull=0}check(t){this._groupsFull===this._numGroups+1&&(this.check=()=>{});let r=255&t,i=t>>>8&255,n=t>>>16&255,a=r===i&&i===n?0:1+hueGroup(rgb2hsl(r,i,n).h,this._numGroups),s=this._stats[a],o=this._minCols;s.num++,s.num>o||(s.num===o&&this._groupsFull++,s.num<=o&&this._stats[a].cols.push(t))}injectIntoDictionary(t){for(let r=0;r<=this._numGroups;r++)this._stats[r].num<=this._minCols&&this._stats[r].cols.forEach(r=>{t[r]?t[r]++:t[r]=1})}injectIntoArray(t){for(let r=0;r<=this._numGroups;r++)this._stats[r].num<=this._minCols&&this._stats[r].cols.forEach(r=>{-1===t.indexOf(r)&&t.push(r)})}},_ProgressTracker=class{constructor(t,r){__publicField(this,"progress"),__publicField(this,"_step"),__publicField(this,"_range"),__publicField(this,"_last"),__publicField(this,"_progressRange"),this._range=t,this._progressRange=r,this._step=Math.max(1,this._range/(_ProgressTracker.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(t){return t-this._last>=this._step&&(this._last=t,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0)}},ProgressTracker=_ProgressTracker;__publicField(ProgressTracker,"steps",100);var networkBiasShift=3,Neuron=class{constructor(t){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=t}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift,this.g>>networkBiasShift,this.b>>networkBiasShift,this.a>>networkBiasShift)}subtract(t,r,i,n){this.r-=0|t,this.g-=0|r,this.b-=0|i,this.a-=0|n}},_NeuQuant=class extends AbstractPaletteQuantizer{constructor(t,r=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=t,this._pointArray=[],this._sampleFactor=1,this._networkSize=r,this._distance.setWhitePoint(255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift)}sample(t){this._pointArray=this._pointArray.concat(t.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let t=0;t<this._networkSize;t++)this._network[t]=new Neuron((t<<networkBiasShift+8)/this._networkSize|0),this._freq[t]=_NeuQuant._initialBias/this._networkSize|0,this._bias[t]=0}*_learn(){let t=this._sampleFactor,r=this._pointArray.length;r<_NeuQuant._minpicturebytes&&(t=1);let i=30+(t-1)/3|0,n=r/t|0,a,s=n/_NeuQuant._nCycles|0,o=_NeuQuant._initAlpha,l=(this._networkSize>>3)*_NeuQuant._radiusBias,u=l>>_NeuQuant._radiusBiasShift;u<=1&&(u=0);for(let t=0;t<u;t++)this._radPower[t]=o*((u*u-t*t)*_NeuQuant._radBias/(u*u))>>>0;a=r<_NeuQuant._minpicturebytes?1:r%_NeuQuant._prime1!=0?_NeuQuant._prime1:r%_NeuQuant._prime2!=0?_NeuQuant._prime2:r%_NeuQuant._prime3!=0?_NeuQuant._prime3:_NeuQuant._prime4;let h=new ProgressTracker(n,99);for(let t=0,f=0;t<n;){h.shouldNotify(t)&&(yield{progress:h.progress});let n=this._pointArray[f],d=n.b<<networkBiasShift,c=n.g<<networkBiasShift,p=n.r<<networkBiasShift,m=n.a<<networkBiasShift,g=this._contest(d,c,p,m);if(this._alterSingle(o,g,d,c,p,m),0!==u&&this._alterNeighbour(u,g,d,c,p,m),(f+=a)>=r&&(f-=r),0===s&&(s=1),++t%s==0){o-=o/i|0,l-=l/_NeuQuant._radiusDecrease|0,u=l>>_NeuQuant._radiusBiasShift,u<=1&&(u=0);for(let t=0;t<u;t++)this._radPower[t]=o*((u*u-t*t)*_NeuQuant._radBias/(u*u))>>>0}}}_buildPalette(){let t=new Palette;return this._network.forEach(r=>{t.add(r.toPoint())}),t.sort(),t}_alterNeighbour(t,r,i,n,a,s){let o=r-t;o<-1&&(o=-1);let l=r+t;l>this._networkSize&&(l=this._networkSize);let u=r+1,h=r-1,f=1;for(;u<l||h>o;){let t=this._radPower[f++]/_NeuQuant._alphaRadBias;if(u<l){let r=this._network[u++];r.subtract(t*(r.r-a),t*(r.g-n),t*(r.b-i),t*(r.a-s))}if(h>o){let r=this._network[h--];r.subtract(t*(r.r-a),t*(r.g-n),t*(r.b-i),t*(r.a-s))}}}_alterSingle(t,r,i,n,a,s){t/=_NeuQuant._initAlpha;let o=this._network[r];o.subtract(t*(o.r-a),t*(o.g-n),t*(o.b-i),t*(o.a-s))}_contest(t,r,i,n){let a=1020<<networkBiasShift,s=0x7fffffff,o=0x7fffffff,l=-1,u=-1;for(let h=0;h<this._networkSize;h++){let f=this._network[h],d=this._distance.calculateNormalized(f,{r:i,g:r,b:t,a:n})*a|0;d<s&&(s=d,l=h);let c=d-(this._bias[h]>>_NeuQuant._initialBiasShift-networkBiasShift);c<o&&(o=c,u=h);let p=this._freq[h]>>_NeuQuant._betaShift;this._freq[h]-=p,this._bias[h]+=p<<_NeuQuant._gammaShift}return this._freq[l]+=_NeuQuant._beta,this._bias[l]-=_NeuQuant._betaGamma,u}},NeuQuant=_NeuQuant;__publicField(NeuQuant,"_prime1",499),__publicField(NeuQuant,"_prime2",491),__publicField(NeuQuant,"_prime3",487),__publicField(NeuQuant,"_prime4",503),__publicField(NeuQuant,"_minpicturebytes",_NeuQuant._prime4),__publicField(NeuQuant,"_nCycles",100),__publicField(NeuQuant,"_initialBiasShift",16),__publicField(NeuQuant,"_initialBias",1<<_NeuQuant._initialBiasShift),__publicField(NeuQuant,"_gammaShift",10),__publicField(NeuQuant,"_betaShift",10),__publicField(NeuQuant,"_beta",_NeuQuant._initialBias>>_NeuQuant._betaShift),__publicField(NeuQuant,"_betaGamma",_NeuQuant._initialBias<<_NeuQuant._gammaShift-_NeuQuant._betaShift),__publicField(NeuQuant,"_radiusBiasShift",6),__publicField(NeuQuant,"_radiusBias",1<<_NeuQuant._radiusBiasShift),__publicField(NeuQuant,"_radiusDecrease",30),__publicField(NeuQuant,"_alphaBiasShift",10),__publicField(NeuQuant,"_initAlpha",1<<_NeuQuant._alphaBiasShift),__publicField(NeuQuant,"_radBiasShift",8),__publicField(NeuQuant,"_radBias",1<<_NeuQuant._radBiasShift),__publicField(NeuQuant,"_alphaRadBiasShift",_NeuQuant._alphaBiasShift+_NeuQuant._radBiasShift),__publicField(NeuQuant,"_alphaRadBias",1<<_NeuQuant._alphaRadBiasShift);var networkBiasShift2=3,NeuronFloat=class{constructor(t){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=t}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift2,this.g>>networkBiasShift2,this.b>>networkBiasShift2,this.a>>networkBiasShift2)}subtract(t,r,i,n){this.r-=t,this.g-=r,this.b-=i,this.a-=n}},_NeuQuantFloat=class extends AbstractPaletteQuantizer{constructor(t,r=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=t,this._pointArray=[],this._sampleFactor=1,this._networkSize=r,this._distance.setWhitePoint(255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2)}sample(t){this._pointArray=this._pointArray.concat(t.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let t=0;t<this._networkSize;t++)this._network[t]=new NeuronFloat((t<<networkBiasShift2+8)/this._networkSize),this._freq[t]=_NeuQuantFloat._initialBias/this._networkSize,this._bias[t]=0}*_learn(){let t=this._sampleFactor,r=this._pointArray.length;r<_NeuQuantFloat._minpicturebytes&&(t=1);let i=30+(t-1)/3,n=r/t,a,s=n/_NeuQuantFloat._nCycles|0,o=_NeuQuantFloat._initAlpha,l=(this._networkSize>>3)*_NeuQuantFloat._radiusBias,u=l>>_NeuQuantFloat._radiusBiasShift;u<=1&&(u=0);for(let t=0;t<u;t++)this._radPower[t]=o*((u*u-t*t)*_NeuQuantFloat._radBias/(u*u));a=r<_NeuQuantFloat._minpicturebytes?1:r%_NeuQuantFloat._prime1!=0?_NeuQuantFloat._prime1:r%_NeuQuantFloat._prime2!=0?_NeuQuantFloat._prime2:r%_NeuQuantFloat._prime3!=0?_NeuQuantFloat._prime3:_NeuQuantFloat._prime4;let h=new ProgressTracker(n,99);for(let t=0,f=0;t<n;){h.shouldNotify(t)&&(yield{progress:h.progress});let n=this._pointArray[f],d=n.b<<networkBiasShift2,c=n.g<<networkBiasShift2,p=n.r<<networkBiasShift2,m=n.a<<networkBiasShift2,g=this._contest(d,c,p,m);if(this._alterSingle(o,g,d,c,p,m),0!==u&&this._alterNeighbour(u,g,d,c,p,m),(f+=a)>=r&&(f-=r),0===s&&(s=1),++t%s==0){o-=o/i,l-=l/_NeuQuantFloat._radiusDecrease,u=l>>_NeuQuantFloat._radiusBiasShift,u<=1&&(u=0);for(let t=0;t<u;t++)this._radPower[t]=o*((u*u-t*t)*_NeuQuantFloat._radBias/(u*u))}}}_buildPalette(){let t=new Palette;return this._network.forEach(r=>{t.add(r.toPoint())}),t.sort(),t}_alterNeighbour(t,r,i,n,a,s){let o=r-t;o<-1&&(o=-1);let l=r+t;l>this._networkSize&&(l=this._networkSize);let u=r+1,h=r-1,f=1;for(;u<l||h>o;){let t=this._radPower[f++]/_NeuQuantFloat._alphaRadBias;if(u<l){let r=this._network[u++];r.subtract(t*(r.r-a),t*(r.g-n),t*(r.b-i),t*(r.a-s))}if(h>o){let r=this._network[h--];r.subtract(t*(r.r-a),t*(r.g-n),t*(r.b-i),t*(r.a-s))}}}_alterSingle(t,r,i,n,a,s){t/=_NeuQuantFloat._initAlpha;let o=this._network[r];o.subtract(t*(o.r-a),t*(o.g-n),t*(o.b-i),t*(o.a-s))}_contest(t,r,i,n){let a=1020<<networkBiasShift2,s=0x7fffffff,o=0x7fffffff,l=-1,u=-1;for(let h=0;h<this._networkSize;h++){let f=this._network[h],d=this._distance.calculateNormalized(f,{r:i,g:r,b:t,a:n})*a;d<s&&(s=d,l=h);let c=d-(this._bias[h]>>_NeuQuantFloat._initialBiasShift-networkBiasShift2);c<o&&(o=c,u=h);let p=this._freq[h]>>_NeuQuantFloat._betaShift;this._freq[h]-=p,this._bias[h]+=p<<_NeuQuantFloat._gammaShift}return this._freq[l]+=_NeuQuantFloat._beta,this._bias[l]-=_NeuQuantFloat._betaGamma,u}},NeuQuantFloat=_NeuQuantFloat;__publicField(NeuQuantFloat,"_prime1",499),__publicField(NeuQuantFloat,"_prime2",491),__publicField(NeuQuantFloat,"_prime3",487),__publicField(NeuQuantFloat,"_prime4",503),__publicField(NeuQuantFloat,"_minpicturebytes",_NeuQuantFloat._prime4),__publicField(NeuQuantFloat,"_nCycles",100),__publicField(NeuQuantFloat,"_initialBiasShift",16),__publicField(NeuQuantFloat,"_initialBias",1<<_NeuQuantFloat._initialBiasShift),__publicField(NeuQuantFloat,"_gammaShift",10),__publicField(NeuQuantFloat,"_betaShift",10),__publicField(NeuQuantFloat,"_beta",_NeuQuantFloat._initialBias>>_NeuQuantFloat._betaShift),__publicField(NeuQuantFloat,"_betaGamma",_NeuQuantFloat._initialBias<<_NeuQuantFloat._gammaShift-_NeuQuantFloat._betaShift),__publicField(NeuQuantFloat,"_radiusBiasShift",6),__publicField(NeuQuantFloat,"_radiusBias",1<<_NeuQuantFloat._radiusBiasShift),__publicField(NeuQuantFloat,"_radiusDecrease",30),__publicField(NeuQuantFloat,"_alphaBiasShift",10),__publicField(NeuQuantFloat,"_initAlpha",1<<_NeuQuantFloat._alphaBiasShift),__publicField(NeuQuantFloat,"_radBiasShift",8),__publicField(NeuQuantFloat,"_radBias",1<<_NeuQuantFloat._radBiasShift),__publicField(NeuQuantFloat,"_alphaRadBiasShift",_NeuQuantFloat._alphaBiasShift+_NeuQuantFloat._radBiasShift),__publicField(NeuQuantFloat,"_alphaRadBias",1<<_NeuQuantFloat._alphaRadBiasShift);var _ColorHistogram=class{constructor(t,r){__publicField(this,"_method"),__publicField(this,"_hueStats"),__publicField(this,"_histogram"),__publicField(this,"_initColors"),__publicField(this,"_minHueCols"),this._method=t,this._minHueCols=r<<2,this._initColors=r<<2,this._hueStats=new HueStatistics(_ColorHistogram._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(t){switch(this._method){case 1:this._colorStats1D(t);break;case 2:this._colorStats2D(t)}}getImportanceSortedColorsIDXI32(){let t,r=stableSort(Object.keys(this._histogram),(t,r)=>this._histogram[r]-this._histogram[t]);if(0===r.length)return[];switch(this._method){case 1:let i=Math.min(r.length,this._initColors),n=r[i-1],a=this._histogram[n];t=r.slice(0,i);let s=i,o=r.length;for(;s<o&&this._histogram[r[s]]===a;)t.push(r[s++]);this._hueStats.injectIntoArray(t);break;case 2:t=r;break;default:throw Error("Incorrect method")}return t.map(t=>+t)}_colorStats1D(t){let r=this._histogram,i=t.getPointArray(),n=i.length;for(let t=0;t<n;t++){let n=i[t].uint32;this._hueStats.check(n),n in r?r[n]++:r[n]=1}}_colorStats2D(t){let r=t.getWidth(),i=t.getHeight(),n=t.getPointArray(),a=_ColorHistogram._boxSize[0],s=_ColorHistogram._boxSize[1],o=a*s,l=this._makeBoxes(r,i,a,s),u=this._histogram;l.forEach(t=>{let i=Math.round(t.w*t.h/o)*_ColorHistogram._boxPixels;i<2&&(i=2);let a={};this._iterateBox(t,r,t=>{let r=n[t].uint32;this._hueStats.check(r),r in u?u[r]++:r in a?++a[r]>=i&&(u[r]=a[r]):a[r]=1})}),this._hueStats.injectIntoDictionary(u)}_iterateBox(t,r,i){let n=t,a=n.y*r+n.x,s=(n.y+n.h-1)*r+(n.x+n.w-1),o=r-n.w+1,l=0,u=a;do i.call(this,u),u+=++l%n.w==0?o:1;while(u<=s)}_makeBoxes(t,r,i,n){let a=t%i,s=r%n,o=t-a,l=r-s,u=[];for(let h=0;h<r;h+=n)for(let r=0;r<t;r+=i)u.push({x:r,y:h,w:r===o?a:i,h:h===l?s:n});return u}},ColorHistogram=_ColorHistogram;__publicField(ColorHistogram,"_boxSize",[64,64]),__publicField(ColorHistogram,"_boxPixels",2),__publicField(ColorHistogram,"_hueGroups",10);var RemovedColor=class{constructor(t,r,i){__publicField(this,"index"),__publicField(this,"color"),__publicField(this,"distance"),this.index=t,this.color=r,this.distance=i}},RGBQuant=class extends AbstractPaletteQuantizer{constructor(t,r=256,i=2){super(),__publicField(this,"_colors"),__publicField(this,"_initialDistance"),__publicField(this,"_distanceIncrement"),__publicField(this,"_histogram"),__publicField(this,"_distance"),this._distance=t,this._colors=r,this._histogram=new ColorHistogram(i,r),this._initialDistance=.01,this._distanceIncrement=.005}sample(t){this._histogram.sample(t)}*quantize(){let t=this._histogram.getImportanceSortedColorsIDXI32();if(0===t.length)throw Error("No colors in image");yield*this._buildPalette(t)}*_buildPalette(t){let r=new Palette,i=r.getPointContainer().getPointArray(),n=Array(t.length);for(let r=0;r<t.length;r++)i.push(Point.createByUint32(t[r])),n[r]=1;let a=i.length,s=[],o=a,l=this._initialDistance,u=new ProgressTracker(o-this._colors,99);for(;o>this._colors;){s.length=0;for(let t=0;t<a;t++){if(u.shouldNotify(a-o)&&(yield{progress:u.progress}),0===n[t])continue;let r=i[t];for(let u=t+1;u<a;u++){if(0===n[u])continue;let t=i[u],a=this._distance.calculateNormalized(r,t);a<l&&(s.push(new RemovedColor(u,t,a)),n[u]=0,o--)}}l+=o>3*this._colors?this._initialDistance:this._distanceIncrement}if(o<this._colors){stableSort(s,(t,r)=>r.distance-t.distance);let t=0;for(;o<this._colors&&t<s.length;)n[s[t].index]=1,o++,t++}let h=i.length;for(let t=h-1;t>=0;t--)0===n[t]&&(t!==h-1&&(i[t]=i[h-1]),--h);i.length=h,r.sort(),yield{palette:r,progress:100}}};function createArray1D(t){let r=[];for(let i=0;i<t;i++)r[i]=0;return r}function createArray4D(t,r,i,n){let a=Array(t);for(let s=0;s<t;s++){a[s]=Array(r);for(let t=0;t<r;t++){a[s][t]=Array(i);for(let r=0;r<i;r++){a[s][t][r]=Array(n);for(let i=0;i<n;i++)a[s][t][r][i]=0}}}return a}function createArray3D(t,r,i){let n=Array(t);for(let a=0;a<t;a++){n[a]=Array(r);for(let t=0;t<r;t++){n[a][t]=Array(i);for(let r=0;r<i;r++)n[a][t][r]=0}}return n}function fillArray3D(t,r,i,n,a){for(let s=0;s<r;s++){t[s]=[];for(let r=0;r<i;r++){t[s][r]=[];for(let i=0;i<n;i++)t[s][r][i]=a}}}function fillArray1D(t,r,i){for(let n=0;n<r;n++)t[n]=i}var WuColorCube=class{constructor(){__publicField(this,"redMinimum"),__publicField(this,"redMaximum"),__publicField(this,"greenMinimum"),__publicField(this,"greenMaximum"),__publicField(this,"blueMinimum"),__publicField(this,"blueMaximum"),__publicField(this,"volume"),__publicField(this,"alphaMinimum"),__publicField(this,"alphaMaximum")}},_WuQuant=class extends AbstractPaletteQuantizer{constructor(t,r=256,i=5){super(),__publicField(this,"_reds"),__publicField(this,"_greens"),__publicField(this,"_blues"),__publicField(this,"_alphas"),__publicField(this,"_sums"),__publicField(this,"_weights"),__publicField(this,"_momentsRed"),__publicField(this,"_momentsGreen"),__publicField(this,"_momentsBlue"),__publicField(this,"_momentsAlpha"),__publicField(this,"_moments"),__publicField(this,"_table"),__publicField(this,"_pixels"),__publicField(this,"_cubes"),__publicField(this,"_colors"),__publicField(this,"_significantBitsPerChannel"),__publicField(this,"_maxSideIndex"),__publicField(this,"_alphaMaxSideIndex"),__publicField(this,"_sideSize"),__publicField(this,"_alphaSideSize"),__publicField(this,"_distance"),this._distance=t,this._setQuality(i),this._initialize(r)}sample(t){let r=t.getPointArray();for(let t=0,i=r.length;t<i;t++)this._addColor(r[t]);this._pixels=this._pixels.concat(r)}*quantize(){yield*this._preparePalette();let t=new Palette;for(let r=0;r<this._colors;r++)if(this._sums[r]>0){let i=this._sums[r],n=this._reds[r]/i,a=this._greens[r]/i,s=this._blues[r]/i,o=this._alphas[r]/i,l=Point.createByRGBA(0|n,0|a,0|s,0|o);t.add(l)}t.sort(),yield{palette:t,progress:100}}*_preparePalette(){yield*this._calculateMoments();let t=0,r=createArray1D(this._colors);for(let i=1;i<this._colors;++i){this._cut(this._cubes[t],this._cubes[i])?(r[t]=this._cubes[t].volume>1?this._calculateVariance(this._cubes[t]):0,r[i]=this._cubes[i].volume>1?this._calculateVariance(this._cubes[i]):0):(r[t]=0,i--),t=0;let n=r[0];for(let a=1;a<=i;++a)r[a]>n&&(n=r[a],t=a);if(n<=0){this._colors=i+1;break}}let i=[],n=[],a=[],s=[];for(let t=0;t<this._colors;++t){let r=_WuQuant._volume(this._cubes[t],this._weights);r>0?(i[t]=_WuQuant._volume(this._cubes[t],this._momentsRed)/r|0,n[t]=_WuQuant._volume(this._cubes[t],this._momentsGreen)/r|0,a[t]=_WuQuant._volume(this._cubes[t],this._momentsBlue)/r|0,s[t]=_WuQuant._volume(this._cubes[t],this._momentsAlpha)/r|0):(i[t]=0,n[t]=0,a[t]=0,s[t]=0)}this._reds=createArray1D(this._colors+1),this._greens=createArray1D(this._colors+1),this._blues=createArray1D(this._colors+1),this._alphas=createArray1D(this._colors+1),this._sums=createArray1D(this._colors+1);for(let t=0,r=this._pixels.length;t<r;t++){let r=this._pixels[t],o=-1,l=Number.MAX_VALUE;for(let t=0;t<this._colors;t++){let u=i[t],h=n[t],f=a[t],d=s[t],c=this._distance.calculateRaw(u,h,f,d,r.r,r.g,r.b,r.a);c<l&&(l=c,o=t)}this._reds[o]+=r.r,this._greens[o]+=r.g,this._blues[o]+=r.b,this._alphas[o]+=r.a,this._sums[o]++}}_addColor(t){let r=8-this._significantBitsPerChannel,i=1+(t.r>>r),n=1+(t.g>>r),a=1+(t.b>>r),s=1+(t.a>>r);this._weights[s][i][n][a]++,this._momentsRed[s][i][n][a]+=t.r,this._momentsGreen[s][i][n][a]+=t.g,this._momentsBlue[s][i][n][a]+=t.b,this._momentsAlpha[s][i][n][a]+=t.a,this._moments[s][i][n][a]+=this._table[t.r]+this._table[t.g]+this._table[t.b]+this._table[t.a]}*_calculateMoments(){let t=[],r=[],i=[],n=[],a=[],s=[],o=createArray3D(this._sideSize,this._sideSize,this._sideSize),l=createArray3D(this._sideSize,this._sideSize,this._sideSize),u=createArray3D(this._sideSize,this._sideSize,this._sideSize),h=createArray3D(this._sideSize,this._sideSize,this._sideSize),f=createArray3D(this._sideSize,this._sideSize,this._sideSize),d=createArray3D(this._sideSize,this._sideSize,this._sideSize),c=0,p=new ProgressTracker(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let m=1;m<=this._alphaMaxSideIndex;++m){fillArray3D(o,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(l,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(u,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(h,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(f,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(d,this._sideSize,this._sideSize,this._sideSize,0);for(let g=1;g<=this._maxSideIndex;++g,++c){p.shouldNotify(c)&&(yield{progress:p.progress}),fillArray1D(t,this._sideSize,0),fillArray1D(r,this._sideSize,0),fillArray1D(i,this._sideSize,0),fillArray1D(n,this._sideSize,0),fillArray1D(a,this._sideSize,0),fillArray1D(s,this._sideSize,0);for(let c=1;c<=this._maxSideIndex;++c){let p=0,_=0,b=0,y=0,v=0,w=0;for(let x=1;x<=this._maxSideIndex;++x)p+=this._weights[m][g][c][x],_+=this._momentsRed[m][g][c][x],b+=this._momentsGreen[m][g][c][x],y+=this._momentsBlue[m][g][c][x],v+=this._momentsAlpha[m][g][c][x],w+=this._moments[m][g][c][x],t[x]+=p,r[x]+=_,i[x]+=b,n[x]+=y,a[x]+=v,s[x]+=w,o[g][c][x]=o[g-1][c][x]+t[x],l[g][c][x]=l[g-1][c][x]+r[x],u[g][c][x]=u[g-1][c][x]+i[x],h[g][c][x]=h[g-1][c][x]+n[x],f[g][c][x]=f[g-1][c][x]+a[x],d[g][c][x]=d[g-1][c][x]+s[x],this._weights[m][g][c][x]=this._weights[m-1][g][c][x]+o[g][c][x],this._momentsRed[m][g][c][x]=this._momentsRed[m-1][g][c][x]+l[g][c][x],this._momentsGreen[m][g][c][x]=this._momentsGreen[m-1][g][c][x]+u[g][c][x],this._momentsBlue[m][g][c][x]=this._momentsBlue[m-1][g][c][x]+h[g][c][x],this._momentsAlpha[m][g][c][x]=this._momentsAlpha[m-1][g][c][x]+f[g][c][x],this._moments[m][g][c][x]=this._moments[m-1][g][c][x]+d[g][c][x]}}}}static _volumeFloat(t,r){return r[t.alphaMaximum][t.redMaximum][t.greenMaximum][t.blueMaximum]-r[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMaximum]-r[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMaximum]+r[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMaximum]-r[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMaximum]+r[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMaximum]+r[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMaximum]-r[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(r[t.alphaMaximum][t.redMaximum][t.greenMaximum][t.blueMinimum]-r[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMinimum]-r[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMinimum]+r[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]-r[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMinimum]+r[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]+r[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]-r[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum])}static _volume(t,r){return 0|_WuQuant._volumeFloat(t,r)}static _top(t,r,i,n){let a;switch(r){case _WuQuant._alpha:a=n[i][t.redMaximum][t.greenMaximum][t.blueMaximum]-n[i][t.redMaximum][t.greenMinimum][t.blueMaximum]-n[i][t.redMinimum][t.greenMaximum][t.blueMaximum]+n[i][t.redMinimum][t.greenMinimum][t.blueMaximum]-(n[i][t.redMaximum][t.greenMaximum][t.blueMinimum]-n[i][t.redMaximum][t.greenMinimum][t.blueMinimum]-n[i][t.redMinimum][t.greenMaximum][t.blueMinimum]+n[i][t.redMinimum][t.greenMinimum][t.blueMinimum]);break;case _WuQuant._red:a=n[t.alphaMaximum][i][t.greenMaximum][t.blueMaximum]-n[t.alphaMaximum][i][t.greenMinimum][t.blueMaximum]-n[t.alphaMinimum][i][t.greenMaximum][t.blueMaximum]+n[t.alphaMinimum][i][t.greenMinimum][t.blueMaximum]-(n[t.alphaMaximum][i][t.greenMaximum][t.blueMinimum]-n[t.alphaMaximum][i][t.greenMinimum][t.blueMinimum]-n[t.alphaMinimum][i][t.greenMaximum][t.blueMinimum]+n[t.alphaMinimum][i][t.greenMinimum][t.blueMinimum]);break;case _WuQuant._green:a=n[t.alphaMaximum][t.redMaximum][i][t.blueMaximum]-n[t.alphaMaximum][t.redMinimum][i][t.blueMaximum]-n[t.alphaMinimum][t.redMaximum][i][t.blueMaximum]+n[t.alphaMinimum][t.redMinimum][i][t.blueMaximum]-(n[t.alphaMaximum][t.redMaximum][i][t.blueMinimum]-n[t.alphaMaximum][t.redMinimum][i][t.blueMinimum]-n[t.alphaMinimum][t.redMaximum][i][t.blueMinimum]+n[t.alphaMinimum][t.redMinimum][i][t.blueMinimum]);break;case _WuQuant._blue:a=n[t.alphaMaximum][t.redMaximum][t.greenMaximum][i]-n[t.alphaMaximum][t.redMaximum][t.greenMinimum][i]-n[t.alphaMaximum][t.redMinimum][t.greenMaximum][i]+n[t.alphaMaximum][t.redMinimum][t.greenMinimum][i]-(n[t.alphaMinimum][t.redMaximum][t.greenMaximum][i]-n[t.alphaMinimum][t.redMaximum][t.greenMinimum][i]-n[t.alphaMinimum][t.redMinimum][t.greenMaximum][i]+n[t.alphaMinimum][t.redMinimum][t.greenMinimum][i]);break;default:throw Error("impossible")}return 0|a}static _bottom(t,r,i){switch(r){case _WuQuant._alpha:return-i[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMaximum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMaximum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMaximum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(-i[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMinimum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);case _WuQuant._red:return-i[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMaximum]+i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMaximum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMaximum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(-i[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMinimum]+i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);case _WuQuant._green:return-i[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMaximum]+i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMaximum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMaximum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMaximum]-(-i[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMinimum]+i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);case _WuQuant._blue:return-i[t.alphaMaximum][t.redMaximum][t.greenMaximum][t.blueMinimum]+i[t.alphaMaximum][t.redMaximum][t.greenMinimum][t.blueMinimum]+i[t.alphaMaximum][t.redMinimum][t.greenMaximum][t.blueMinimum]-i[t.alphaMaximum][t.redMinimum][t.greenMinimum][t.blueMinimum]-(-i[t.alphaMinimum][t.redMaximum][t.greenMaximum][t.blueMinimum]+i[t.alphaMinimum][t.redMaximum][t.greenMinimum][t.blueMinimum]+i[t.alphaMinimum][t.redMinimum][t.greenMaximum][t.blueMinimum]-i[t.alphaMinimum][t.redMinimum][t.greenMinimum][t.blueMinimum]);default:return 0}}_calculateVariance(t){let r=_WuQuant._volume(t,this._momentsRed),i=_WuQuant._volume(t,this._momentsGreen),n=_WuQuant._volume(t,this._momentsBlue),a=_WuQuant._volume(t,this._momentsAlpha);return _WuQuant._volumeFloat(t,this._moments)-(r*r+i*i+n*n+a*a)/_WuQuant._volume(t,this._weights)}_maximize(t,r,i,n,a,s,o,l,u){let h=0|_WuQuant._bottom(t,r,this._momentsRed),f=0|_WuQuant._bottom(t,r,this._momentsGreen),d=0|_WuQuant._bottom(t,r,this._momentsBlue),c=0|_WuQuant._bottom(t,r,this._momentsAlpha),p=0|_WuQuant._bottom(t,r,this._weights),m=0,g=-1;for(let _=i;_<n;++_){let i=h+_WuQuant._top(t,r,_,this._momentsRed),n=f+_WuQuant._top(t,r,_,this._momentsGreen),b=d+_WuQuant._top(t,r,_,this._momentsBlue),y=c+_WuQuant._top(t,r,_,this._momentsAlpha),v=p+_WuQuant._top(t,r,_,this._weights);if(0!==v){let t=i*i+n*n+b*b+y*y,r=t/v;i=a-i,n=s-n,b=o-b,y=l-y,0!=(v=u-v)&&(r+=(t=i*i+n*n+b*b+y*y)/v)>m&&(m=r,g=_)}}return{max:m,position:g}}_cut(t,r){let i,n=_WuQuant._volume(t,this._momentsRed),a=_WuQuant._volume(t,this._momentsGreen),s=_WuQuant._volume(t,this._momentsBlue),o=_WuQuant._volume(t,this._momentsAlpha),l=_WuQuant._volume(t,this._weights),u=this._maximize(t,_WuQuant._red,t.redMinimum+1,t.redMaximum,n,a,s,o,l),h=this._maximize(t,_WuQuant._green,t.greenMinimum+1,t.greenMaximum,n,a,s,o,l),f=this._maximize(t,_WuQuant._blue,t.blueMinimum+1,t.blueMaximum,n,a,s,o,l),d=this._maximize(t,_WuQuant._alpha,t.alphaMinimum+1,t.alphaMaximum,n,a,s,o,l);if(d.max>=u.max&&d.max>=h.max&&d.max>=f.max){if(i=_WuQuant._alpha,d.position<0)return!1}else i=u.max>=d.max&&u.max>=h.max&&u.max>=f.max?_WuQuant._red:h.max>=d.max&&h.max>=u.max&&h.max>=f.max?_WuQuant._green:_WuQuant._blue;switch(r.redMaximum=t.redMaximum,r.greenMaximum=t.greenMaximum,r.blueMaximum=t.blueMaximum,r.alphaMaximum=t.alphaMaximum,i){case _WuQuant._red:r.redMinimum=t.redMaximum=u.position,r.greenMinimum=t.greenMinimum,r.blueMinimum=t.blueMinimum,r.alphaMinimum=t.alphaMinimum;break;case _WuQuant._green:r.greenMinimum=t.greenMaximum=h.position,r.redMinimum=t.redMinimum,r.blueMinimum=t.blueMinimum,r.alphaMinimum=t.alphaMinimum;break;case _WuQuant._blue:r.blueMinimum=t.blueMaximum=f.position,r.redMinimum=t.redMinimum,r.greenMinimum=t.greenMinimum,r.alphaMinimum=t.alphaMinimum;break;case _WuQuant._alpha:r.alphaMinimum=t.alphaMaximum=d.position,r.blueMinimum=t.blueMinimum,r.redMinimum=t.redMinimum,r.greenMinimum=t.greenMinimum}return t.volume=(t.redMaximum-t.redMinimum)*(t.greenMaximum-t.greenMinimum)*(t.blueMaximum-t.blueMinimum)*(t.alphaMaximum-t.alphaMinimum),r.volume=(r.redMaximum-r.redMinimum)*(r.greenMaximum-r.greenMinimum)*(r.blueMaximum-r.blueMinimum)*(r.alphaMaximum-r.alphaMinimum),!0}_initialize(t){this._colors=t,this._cubes=[];for(let r=0;r<t;r++)this._cubes[r]=new WuColorCube;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let t=0;t<256;++t)this._table[t]=t*t;this._pixels=[]}_setQuality(t=5){this._significantBitsPerChannel=t,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant=_WuQuant;__publicField(WuQuant,"_alpha",3),__publicField(WuQuant,"_red",2),__publicField(WuQuant,"_green",1),__publicField(WuQuant,"_blue",0);var image_exports={};__export(image_exports,{AbstractImageQuantizer:()=>AbstractImageQuantizer,ErrorDiffusionArray:()=>ErrorDiffusionArray,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma,NearestColor:()=>NearestColor});var AbstractImageQuantizer=class{quantizeSync(t,r){for(let i of this.quantize(t,r))if(i.pointContainer)return i.pointContainer;throw Error("unreachable")}},NearestColor=class extends AbstractImageQuantizer{constructor(t){super(),__publicField(this,"_distance"),this._distance=t}*quantize(t,r){let i=t.getPointArray(),n=t.getWidth(),a=t.getHeight(),s=new ProgressTracker(a,99);for(let t=0;t<a;t++){s.shouldNotify(t)&&(yield{progress:s.progress});for(let a=0,s=t*n;a<n;a++,s++){let t=i[s];t.from(r.getNearestColor(this._distance,t))}}yield{pointContainer:t,progress:100}}},ErrorDiffusionArrayKernel=(t=>(t[t.FloydSteinberg=0]="FloydSteinberg",t[t.FalseFloydSteinberg=1]="FalseFloydSteinberg",t[t.Stucki=2]="Stucki",t[t.Atkinson=3]="Atkinson",t[t.Jarvis=4]="Jarvis",t[t.Burkes=5]="Burkes",t[t.Sierra=6]="Sierra",t[t.TwoSierra=7]="TwoSierra",t[t.SierraLite=8]="SierraLite",t))(ErrorDiffusionArrayKernel||{}),ErrorDiffusionArray=class extends AbstractImageQuantizer{constructor(t,r,i=!0,n=0,a=!1){super(),__publicField(this,"_minColorDistance"),__publicField(this,"_serpentine"),__publicField(this,"_kernel"),__publicField(this,"_calculateErrorLikeGIMP"),__publicField(this,"_distance"),this._setKernel(r),this._distance=t,this._minColorDistance=n,this._serpentine=i,this._calculateErrorLikeGIMP=a}*quantize(t,r){let i=t.getPointArray(),n=new Point,a=t.getWidth(),s=t.getHeight(),o=[],l=1,u=1;for(let t of this._kernel){let r=t[2]+1;u<r&&(u=r)}for(let t=0;t<u;t++)this._fillErrorLine(o[t]=[],a);let h=new ProgressTracker(s,99);for(let t=0;t<s;t++){h.shouldNotify(t)&&(yield{progress:h.progress}),this._serpentine&&(l*=-1);let u=t*a,f=1===l?0:a-1,d=1===l?a:-1;this._fillErrorLine(o[0],a),o.push(o.shift());let c=o[0];for(let h=f,p=u+f;h!==d;h+=l,p+=l){let u,f,d,m,g=i[p],_=c[h];n.from(g);let b=Point.createByRGBA(inRange0to255Rounded(g.r+_[0]),inRange0to255Rounded(g.g+_[1]),inRange0to255Rounded(g.b+_[2]),inRange0to255Rounded(g.a+_[3])),y=r.getNearestColor(this._distance,b);if(g.from(y),this._minColorDistance&&this._distance.calculateNormalized(n,y)<this._minColorDistance)continue;this._calculateErrorLikeGIMP?(u=b.r-y.r,f=b.g-y.g,d=b.b-y.b,m=b.a-y.a):(u=n.r-y.r,f=n.g-y.g,d=n.b-y.b,m=n.a-y.a);let v=1===l?0:this._kernel.length-1,w=1===l?this._kernel.length:-1;for(let r=v;r!==w;r+=l){let i=this._kernel[r][1]*l,n=this._kernel[r][2];if(i+h>=0&&i+h<a&&n+t>=0&&n+t<s){let t=this._kernel[r][0],a=o[n][i+h];a[0]+=u*t,a[1]+=f*t,a[2]+=d*t,a[3]+=m*t}}}}yield{pointContainer:t,progress:100}}_fillErrorLine(t,r){t.length>r&&(t.length=r);let i=t.length;for(let r=0;r<i;r++){let i=t[r];i[0]=i[1]=i[2]=i[3]=0}for(let n=i;n<r;n++)t[n]=[0,0,0,0]}_setKernel(t){switch(t){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[.25,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[.25,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[.25,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[.5,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw Error(`ErrorDiffusionArray: unknown kernel = ${t}`)}}};function*hilbertCurve(t,r,i){let n=Math.max(t,r),a={width:t,height:r,level:Math.floor(Math.log(n)/Math.log(2)+1),callback:i,tracker:new ProgressTracker(t*r,99),index:0,x:0,y:0};yield*walkHilbert(a,1),visit(a,0)}function*walkHilbert(t,r){if(!(t.level<1)){switch(t.tracker.shouldNotify(t.index)&&(yield{progress:t.tracker.progress}),t.level--,r){case 2:yield*walkHilbert(t,1),visit(t,3),yield*walkHilbert(t,2),visit(t,4),yield*walkHilbert(t,2),visit(t,2),yield*walkHilbert(t,4);break;case 3:yield*walkHilbert(t,4),visit(t,2),yield*walkHilbert(t,3),visit(t,1),yield*walkHilbert(t,3),visit(t,3),yield*walkHilbert(t,1);break;case 1:yield*walkHilbert(t,2),visit(t,4),yield*walkHilbert(t,1),visit(t,3),yield*walkHilbert(t,1),visit(t,1),yield*walkHilbert(t,3);break;case 4:yield*walkHilbert(t,3),visit(t,1),yield*walkHilbert(t,4),visit(t,2),yield*walkHilbert(t,4),visit(t,4),yield*walkHilbert(t,2)}t.level++}}function visit(t,r){switch(t.x>=0&&t.x<t.width&&t.y>=0&&t.y<t.height&&(t.callback(t.x,t.y),t.index++),r){case 2:t.x--;break;case 3:t.x++;break;case 1:t.y--;break;case 4:t.y++}}var ErrorDiffusionRiemersma=class extends AbstractImageQuantizer{constructor(t,r=16,i=1){super(),__publicField(this,"_distance"),__publicField(this,"_weights"),__publicField(this,"_errorQueueSize"),this._distance=t,this._errorQueueSize=r,this._weights=ErrorDiffusionRiemersma._createWeights(i,r)}*quantize(t,r){let i=t.getPointArray(),n=t.getWidth(),a=t.getHeight(),s=[],o=0;for(let t=0;t<this._errorQueueSize;t++)s[t]={r:0,g:0,b:0,a:0};yield*hilbertCurve(n,a,(t,a)=>{let l=i[t+a*n],{r:u,g:h,b:f,a:d}=l;for(let t=0;t<this._errorQueueSize;t++){let r=this._weights[t],i=s[(t+o)%this._errorQueueSize];u+=i.r*r,h+=i.g*r,f+=i.b*r,d+=i.a*r}let c=Point.createByRGBA(inRange0to255Rounded(u),inRange0to255Rounded(h),inRange0to255Rounded(f),inRange0to255Rounded(d)),p=r.getNearestColor(this._distance,c),m=((o=(o+1)%this._errorQueueSize)+this._errorQueueSize-1)%this._errorQueueSize;s[m].r=l.r-p.r,s[m].g=l.g-p.g,s[m].b=l.b-p.b,s[m].a=l.a-p.a,l.from(p)}),yield{pointContainer:t,progress:100}}static _createWeights(t,r){let i=[],n=Math.exp(Math.log(r)/(r-1));for(let a=0,s=1;a<r;a++)i[a]=(s+.5|0)/r*t,s*=n;return i}},quality_exports={};__export(quality_exports,{ssim:()=>ssim});var K1=.01,K2=.03;function ssim(t,r){if(t.getHeight()!==r.getHeight()||t.getWidth()!==r.getWidth())throw Error("Images have different sizes!");let i=(255*K1)**2,n=(255*K2)**2,a=0,s=0;return iterate(t,r,(t,r,o,l)=>{let u=0,h=0,f=0;for(let i=0;i<t.length;i++)h+=(t[i]-o)**2,f+=(r[i]-l)**2,u+=(t[i]-o)*(r[i]-l);let d=t.length-1;h/=d,f/=d,u/=d,s+=(2*o*l+i)*(2*u+n)/((o**2+l**2+i)*(h+f+n)),a++}),s/a}function iterate(t,r,i){let n=t.getWidth(),a=t.getHeight();for(let s=0;s<a;s+=8)for(let o=0;o<n;o+=8){let l=Math.min(8,n-o),u=Math.min(8,a-s),h=calculateLumaValuesForWindow(t,o,s,l,u),f=calculateLumaValuesForWindow(r,o,s,l,u);i(h,f,calculateAverageLuma(h),calculateAverageLuma(f))}}function calculateLumaValuesForWindow(t,r,i,n,a){let s=t.getPointArray(),o=[],l=0;for(let u=i;u<i+a;u++){let i=u*t.getWidth();for(let t=r;t<r+n;t++){let r=s[i+t];o[l]=.2126*r.r+.7152*r.g+.0722*r.b,l++}}return o}function calculateAverageLuma(t){let r=0;for(let i of t)r+=i;return r/t.length}function buildPaletteSync(t,{colorDistanceFormula:r,paletteQuantization:i,colors:n}={}){let a=paletteQuantizationToPaletteQuantizer(colorDistanceFormulaToColorDistance(r),i,n);return t.forEach(t=>a.sample(t)),a.quantizeSync()}function applyPaletteSync(t,r,{colorDistanceFormula:i,imageQuantization:n}={}){return imageQuantizationToImageQuantizer(colorDistanceFormulaToColorDistance(i),n).quantizeSync(t,r)}function colorDistanceFormulaToColorDistance(t="euclidean-bt709"){switch(t){case"cie94-graphic-arts":return new CIE94GraphicArts;case"cie94-textiles":return new CIE94Textiles;case"ciede2000":return new CIEDE2000;case"color-metric":return new CMetric;case"euclidean":return new Euclidean;case"euclidean-bt709":return new EuclideanBT709;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha;case"manhattan":return new Manhattan;case"manhattan-bt709":return new ManhattanBT709;case"manhattan-nommyde":return new ManhattanNommyde;case"pngquant":return new PNGQuant;default:throw Error(`Unknown colorDistanceFormula ${t}`)}}function imageQuantizationToImageQuantizer(t,r="floyd-steinberg"){switch(r){case"nearest":return new NearestColor(t);case"riemersma":return new ErrorDiffusionRiemersma(t);case"floyd-steinberg":return new ErrorDiffusionArray(t,0);case"false-floyd-steinberg":return new ErrorDiffusionArray(t,1);case"stucki":return new ErrorDiffusionArray(t,2);case"atkinson":return new ErrorDiffusionArray(t,3);case"jarvis":return new ErrorDiffusionArray(t,4);case"burkes":return new ErrorDiffusionArray(t,5);case"sierra":return new ErrorDiffusionArray(t,6);case"two-sierra":return new ErrorDiffusionArray(t,7);case"sierra-lite":return new ErrorDiffusionArray(t,8);default:throw Error(`Unknown imageQuantization ${r}`)}}function paletteQuantizationToPaletteQuantizer(t,r="wuquant",i=256){switch(r){case"neuquant":return new NeuQuant(t,i);case"rgbquant":return new RGBQuant(t,i);case"wuquant":return new WuQuant(t,i);case"neuquant-float":return new NeuQuantFloat(t,i);default:throw Error(`Unknown paletteQuantization ${r}`)}}"function"==typeof setImmediate||void 0!==__TURBOPACK__imported__module__47167__.default&&(null==__TURBOPACK__imported__module__47167__.default||__TURBOPACK__imported__module__47167__.default.nextTick);let QuantizeOptionsSchema=z.object({colors:z.number().optional(),colorDistanceFormula:z.union([z.literal("cie94-textiles"),z.literal("cie94-graphic-arts"),z.literal("ciede2000"),z.literal("color-metric"),z.literal("euclidean"),z.literal("euclidean-bt709-noalpha"),z.literal("euclidean-bt709"),z.literal("manhattan"),z.literal("manhattan-bt709"),z.literal("manhattan-nommyde"),z.literal("pngquant")]).optional(),paletteQuantization:z.union([z.literal("neuquant"),z.literal("neuquant-float"),z.literal("rgbquant"),z.literal("wuquant")]).optional(),imageQuantization:z.union([z.literal("nearest"),z.literal("riemersma"),z.literal("floyd-steinberg"),z.literal("false-floyd-steinberg"),z.literal("stucki"),z.literal("atkinson"),z.literal("jarvis"),z.literal("burkes"),z.literal("sierra"),z.literal("two-sierra"),z.literal("sierra-lite")]).optional()}),methods={quantize(t,r){let{colors:i,colorDistanceFormula:n,paletteQuantization:a,imageQuantization:s}=QuantizeOptionsSchema.parse(r),o=utils_exports.PointContainer.fromUint8Array(t.bitmap.data,t.bitmap.width,t.bitmap.height),l=applyPaletteSync(o,buildPaletteSync([o],{colors:i,colorDistanceFormula:n,paletteQuantization:a}),{colorDistanceFormula:n,imageQuantization:s});return t.bitmap.data=Buffer.from(l.toUint8Array()),t}};var parseBmfontAscii=function(t){if(!t)throw Error("no data provided");var r={pages:[],chars:[],kernings:[]},i=(t=t.toString().trim()).split(/\r\n?|\n/g);if(0===i.length)throw Error("no data in BMFont file");for(var n=0;n<i.length;n++){var a=splitLine(i[n],n);if(a)if("page"===a.key){if("number"!=typeof a.data.id)throw Error("malformed file at line "+n+" -- needs page id=N");if("string"!=typeof a.data.file)throw Error("malformed file at line "+n+' -- needs page file="path"');r.pages[a.data.id]=a.data.file}else"chars"===a.key||"kernings"===a.key||("char"===a.key?r.chars.push(a.data):"kerning"===a.key?r.kernings.push(a.data):r[a.key]=a.data)}return r};function splitLine(t,r){if(!(t=t.replace(/\t+/g," ").trim()))return null;var i=t.indexOf(" ");if(-1===i)throw Error("no named row at line "+r);var n=t.substring(0,i);t=(t=(t=(t=t.substring(i+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map(function(t){return t.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var a=[],s=0;s<t.length;s++){var o=t[s];0===s?a.push({key:o[0],data:""}):s===t.length-1?a[a.length-1].data=parseData(o[0]):(a[a.length-1].data=parseData(o[0]),a.push({key:o[1],data:""}))}var l={key:n,data:{}};return a.forEach(function(t){l.data[t.key]=t.data}),l}function parseData(t){return t&&0!==t.length?0===t.indexOf('"')||0===t.indexOf("'")?t.substring(1,t.length-1):-1!==t.indexOf(",")?parseIntList$1(t):parseInt(t,10):""}function parseIntList$1(t){return t.split(",").map(function(t){return parseInt(t,10)})}var parseASCII=getDefaultExportFromCjs(parseBmfontAscii),GLYPH_DESIGNER_ERROR="chasrset",parseAttribs=function(t){for(var r in GLYPH_DESIGNER_ERROR in(t=Object.assign({},t))&&(t.charset=t[GLYPH_DESIGNER_ERROR],delete t[GLYPH_DESIGNER_ERROR]),t)"face"!==r&&"charset"!==r&&(t[r]="padding"===r||"spacing"===r?parseIntList(t[r]):parseInt(t[r],10));return t};function parseIntList(t){return t.split(",").map(function(t){return parseInt(t,10)})}var xmlParseFromString=void 0!==self.DOMParser?function(t){return(new self.DOMParser).parseFromString(t,"application/xml")}:void 0!==self.ActiveXObject&&new self.ActiveXObject("Microsoft.XMLDOM")?function(t){var r=new self.ActiveXObject("Microsoft.XMLDOM");return r.async="false",r.loadXML(t),r}:function(t){var r=document.createElement("div");return r.innerHTML=t,r},parseAttributes=parseAttribs,parseFromString=xmlParseFromString,NAME_MAP={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"},browser=function(t){var r=parseFromString(t=t.toString()),i={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(t){var n=r.getElementsByTagName(t)[0];n&&(i[t]=parseAttributes(getAttribs(n)))});var n=r.getElementsByTagName("pages")[0];if(!n)throw Error("malformed file -- no <pages> element");for(var a=n.getElementsByTagName("page"),s=0;s<a.length;s++){var o=a[s],l=parseInt(o.getAttribute("id"),10),u=o.getAttribute("file");if(isNaN(l))throw Error('malformed file -- page "id" attribute is NaN');if(!u)throw Error('malformed file -- needs page "file" attribute');i.pages[parseInt(l,10)]=u}return["chars","kernings"].forEach(function(t){var n=r.getElementsByTagName(t)[0];if(n)for(var a=t.substring(0,t.length-1),s=n.getElementsByTagName(a),o=0;o<s.length;o++){var l=s[o];i[t].push(parseAttributes(getAttribs(l)))}}),i};function getAttribs(t){return getAttribList(t).reduce(function(t,r){return t[mapName(r.nodeName)]=r.nodeValue,t},{})}function getAttribList(t){for(var r=[],i=0;i<t.attributes.length;i++)r.push(t.attributes[i]);return r}function mapName(t){return NAME_MAP[t.toLowerCase()]||t}var parseXML=getDefaultExportFromCjs(browser),HEADER$1=[66,77,70],parseBmfontBinary=function(t){if(t.length<6)throw Error("invalid buffer length for BMFont");if(!HEADER$1.every(function(r,i){return t.readUInt8(i)===r}))throw Error("BMFont missing BMF byte header");var r=3;if(t.readUInt8(r++)>3)throw Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var i={kernings:[],chars:[]},n=0;n<5;n++)r+=readBlock(i,t,r);return i};function readBlock(t,r,i){if(i>r.length-1)return 0;var n=r.readUInt8(i++),a=r.readInt32LE(i);switch(i+=4,n){case 1:t.info=readInfo(r,i);break;case 2:t.common=readCommon(r,i);break;case 3:t.pages=readPages(r,i,a);break;case 4:t.chars=readChars(r,i,a);break;case 5:t.kernings=readKernings(r,i,a)}return 5+a}function readInfo(t,r){var i={};i.size=t.readInt16LE(r);var n=t.readUInt8(r+2);return i.smooth=n>>7&1,i.unicode=n>>6&1,i.italic=n>>5&1,i.bold=n>>4&1,n>>3&1&&(i.fixedHeight=1),i.charset=t.readUInt8(r+3)||"",i.stretchH=t.readUInt16LE(r+4),i.aa=t.readUInt8(r+6),i.padding=[t.readInt8(r+7),t.readInt8(r+8),t.readInt8(r+9),t.readInt8(r+10)],i.spacing=[t.readInt8(r+11),t.readInt8(r+12)],i.outline=t.readUInt8(r+13),i.face=readStringNT(t,r+14),i}function readCommon(t,r){var i={};return i.lineHeight=t.readUInt16LE(r),i.base=t.readUInt16LE(r+2),i.scaleW=t.readUInt16LE(r+4),i.scaleH=t.readUInt16LE(r+6),i.pages=t.readUInt16LE(r+8),t.readUInt8(r+10),i.packed=0,i.alphaChnl=t.readUInt8(r+11),i.redChnl=t.readUInt8(r+12),i.greenChnl=t.readUInt8(r+13),i.blueChnl=t.readUInt8(r+14),i}function readPages(t,r,i){for(var n=[],a=readNameNT(t,r),s=a.length+1,o=i/s,l=0;l<o;l++)n[l]=t.slice(r,r+a.length).toString("utf8"),r+=s;return n}function readChars(t,r,i){for(var n=[],a=i/20,s=0;s<a;s++){var o={},l=20*s;o.id=t.readUInt32LE(r+0+l),o.x=t.readUInt16LE(r+4+l),o.y=t.readUInt16LE(r+6+l),o.width=t.readUInt16LE(r+8+l),o.height=t.readUInt16LE(r+10+l),o.xoffset=t.readInt16LE(r+12+l),o.yoffset=t.readInt16LE(r+14+l),o.xadvance=t.readInt16LE(r+16+l),o.page=t.readUInt8(r+18+l),o.chnl=t.readUInt8(r+19+l),n[s]=o}return n}function readKernings(t,r,i){for(var n=[],a=i/10,s=0;s<a;s++){var o={},l=10*s;o.first=t.readUInt32LE(r+0+l),o.second=t.readUInt32LE(r+4+l),o.amount=t.readInt16LE(r+8+l),n[s]=o}return n}function readNameNT(t,r){for(var i=r;i<t.length&&0!==t[i];i++);return t.slice(r,i)}function readStringNT(t,r){return readNameNT(t,r).toString("utf8")}var readBinary=getDefaultExportFromCjs(parseBmfontBinary);function normalizeArray(t,r){for(var i=0,n=t.length-1;n>=0;n--){var a=t[n];"."===a?t.splice(n,1):".."===a?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(r)for(;i--;)t.unshift("..");return t}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(t){return splitPathRe.exec(t).slice(1)};function resolve(){for(var t="",r=!1,i=arguments.length-1;i>=-1&&!r;i--){var n=i>=0?arguments[i]:"/";if("string"!=typeof n)throw TypeError("Arguments to path.resolve must be strings");n&&(t=n+"/"+t,r="/"===n.charAt(0))}return t=normalizeArray(filter(t.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+t||"."}function normalize(t){var r=isAbsolute(t),i="/"===substr(t,-1);return(t=normalizeArray(filter(t.split("/"),function(t){return!!t}),!r).join("/"))||r||(t="."),t&&i&&(t+="/"),(r?"/":"")+t}function isAbsolute(t){return"/"===t.charAt(0)}function join(){return normalize(filter(Array.prototype.slice.call(arguments,0),function(t,r){if("string"!=typeof t)throw TypeError("Arguments to path.join must be strings");return t}).join("/"))}function relative(t,r){function i(t){for(var r=0;r<t.length&&""===t[r];r++);for(var i=t.length-1;i>=0&&""===t[i];i--);return r>i?[]:t.slice(r,i-r+1)}t=resolve(t).substr(1),r=resolve(r).substr(1);for(var n=i(t.split("/")),a=i(r.split("/")),s=Math.min(n.length,a.length),o=s,l=0;l<s;l++)if(n[l]!==a[l]){o=l;break}var u=[];for(l=o;l<n.length;l++)u.push("..");return(u=u.concat(a.slice(o))).join("/")}var sep="/",delimiter=":";function dirname(t){var r=splitPath(t),i=r[0],n=r[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."}function basename(t,r){var i=splitPath(t)[2];return r&&i.substr(-1*r.length)===r&&(i=i.substr(0,i.length-r.length)),i}function extname(t){return splitPath(t)[3]}var path={dirname:dirname,join:join};function filter(t,r){if(t.filter)return t.filter(r);for(var i=[],n=0;n<t.length;n++)r(t[n],n,t)&&i.push(t[n]);return i}var substr="b"==="ab".substr(-1)?function(t,r,i){return t.substr(r,i)}:function(t,r,i){return r<0&&(r=t.length+r),t.substr(r,i)};function e1(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}let t1=t=>{if(!t)return null;let i={};switch(t.type){case"ELEMENT":{let n={},a=E(t.value.attributes),s=t1(t.value.children);a&&(n=Object.assign(n,a)),s&&(n=Object.assign(n,r(t.value.children))),i[t.value.type]=n;break}case"ATTRIBUTE":{let n=t.value;i[n.name]=n.value;break}case"CONTENT":return{content:t.value}}return i},r=t=>t&&Array.isArray(t)&&0!==t.length?n(t)?{content:t[0].value}:{children:t.map(t1)}:null,n=t=>t&&Array.isArray(t)&&1===t.length&&"CONTENT"===t[0].type,E=t=>t&&Array.isArray(t)?t.map(t1).reduce((t,r)=>Object.assign(t,r),{}):null;var s={convert:t=>t1(t.value.children[0])},a={Token:(t,r)=>({type:t,value:r}),TOKEN_TYPE:{OPEN_BRACKET:"OPEN_BRACKET",ELEMENT_TYPE:"ELEMENT_TYPE",CLOSE_ELEMENT:"CLOSE_ELEMENT",ATTRIB_NAME:"ATTRIB_NAME",ATTRIB_VALUE:"ATTRIB_VALUE",ASSIGN:"ASSIGN",CLOSE_BRACKET:"CLOSE_BRACKET",CONTENT:"CONTENT",EOF:"EOF"}};let{Token:T,TOKEN_TYPE:u}=a,c=T("EOF"),l=t=>" "===t||"\n"===t||"\r"===t||"	"===t,o=t=>t.replace(/'/g,'"');var N={createLexer:function(t){let r=null,i=(t=>{let r=0;for(;r<t.length&&l(t[r]);)r++;return((t,r)=>{if(t.startsWith("<?xml",r)){let i=t.length;for(;r<i;)if("?"!==t[r])r++;else{if(">"===t[r+1])return r+2;r++}}return r})(t,r)})(t),n=[],a=()=>t[i],s=()=>r!==c&&i<t.length,h=t=>'"'===t||"'"===t,f=()=>{for(;s()&&l(t[i]);)i++},d=r=>{if(s()){if("<"===t[i]){let r="<";return i++,s()&&"/"===t[i]?(i++,r="</"):s()&&"!"===t[i]&&"-"===t[i+1]&&"-"===t[i+2]&&(i++,i++,i++,r="<!--"),r}if("/"===a()){let t="/";return i++,s()&&">"===a()&&(i++,t="/>"),t}if("="===t[i]||">"===t[i]){let r=t[i];return i++,r}}return p(!!r)},p=r=>{let n=r?/[^>=<]/u:/[a-zA-Z0-9_:-]/,a=i;for(;s()&&t[i].match(n);)i++;return o(t.substring(a,i))},m=()=>{let g=i;f();let _=i-g;if(s())if(r&&r.type===u.OPEN_BRACKET){f();let t=d(!1);r=T(u.ELEMENT_TYPE,t),n.push(t)}else if(r&&r.type===u.ASSIGN){s()&&h(a())&&i++;let n=i;for(;s()&&!h(a());)i++;let f=o(t.substring(n,i));i++,r=T(u.ATTRIB_VALUE,f)}else{f();let h=d(!0);switch(h){case"=":r=r.type===u.ATTRIB_NAME?T(u.ASSIGN):T(u.CONTENT,h);break;case"</":{let a=i;for(;">"!==t[i];)i++;r=T(u.CLOSE_ELEMENT,t.substring(a,i)),i++,n.pop();break}case"/>":{let t=n.pop();r=T(u.CLOSE_ELEMENT,t);break}case"<!--":{let r=["!","-","-"];for(;s()&&(">"!==r[2]||"-"!==r[1]||"-"!==r[0]);)r.shift(),r.push(t[i]),i++;return m()}case">":r=T(u.CLOSE_BRACKET);break;case"<":r=T(u.OPEN_BRACKET);break;default:if(h&&h.length>0){if(r.type===u.CLOSE_BRACKET){let t="";"<"!==a()&&(t=p(!0)),r=T(u.CONTENT,h+t)}else if(r.type!==u.ATTRIB_NAME&&r.type!==u.CONTENT)r.type===u.CLOSE_ELEMENT?(h=" ".repeat(_)+h,r=T(u.CONTENT,h)):r=T(u.ATTRIB_NAME,h);else{let t=" ".repeat(_)+h;r=T(u.CONTENT,t)}break}throw Error('Unknown Syntax : "'+t[i]+'"')}}else r=c;return r};return{peek:a,next:m,hasNext:s}}};let{createLexer:i}=N,{Token:p,TOKEN_TYPE:O}=a,[A,f,C,h]=["ROOT","ELEMENT","ATTRIBUTE","CONTENT"],_=(t,r)=>({type:t,value:r}),L=t=>_(h,t),y=(t,r,i)=>_(f,{type:t,attributes:r,children:i}),v=(t,r)=>_(C,{name:t,value:r}),S=(t,r)=>{let i=[];for(;t.hasNext();){let n=t.next();switch(n.type){case O.OPEN_BRACKET:{let r=t.next(),[n,a]=R(t),s=[];a.type!==O.CLOSE_ELEMENT&&(s=S(t,r)),s&&s.length>0&&s[0].type===O.CONTENT&&(s=b(s)),i.push(y(r.value,n,s));break}case O.CLOSE_ELEMENT:if(n.value===r.value)return i;break;case O.CONTENT:i.push(L(n.value));break;case O.EOF:return i;default:throw Error(`Unknown Lexem type: ${n.type} "${n.value}, scoping element: ${r.value}"`)}}return i},R=t=>{let r=[],i=t.peek();if(!t.hasNext()||i&&i.type===O.CLOSE_BRACKET||i&&i.type===O.CLOSE_ELEMENT)return[r,i];for(i=t.next();t.hasNext()&&i&&i.type!==O.CLOSE_BRACKET&&i.type!==O.CLOSE_ELEMENT;){let n=i;t.next();let a=t.next(),s=v(n.value,a.value);r.push(s),i=t.next()}return[r,i]};function b(t){let r=[],i="";return t.forEach(t=>{t.type===O.CONTENT?i+=t.value:(i.length&&(r.push(L(i)),i=""),r.push(t))}),i.length&&r.push(L(i)),r}var B={transpile:function(t,r){let n=_(A,{children:S(i(t),p(A,"ROOT"))});return r?r.convert(n):n},Node:_,ElementNode:y,AttribNode:v};let M=s,{transpile:x}=B;var k=e1({convertXML:function(t,r){return x(t,r||M)},createAST:function(t){return x(t)}}),simpleXmlToJson_min=k,xmlPackage=getDefaultExportFromCjs(simpleXmlToJson_min);let{convertXML:convertXML}=xmlPackage,isWebWorker="undefined"!=typeof self&&void 0===self.document,CharacterJimp=createJimp({formats:[png]}),HEADER=Buffer.from([66,77,70,3]);function isBinary(t){if("string"==typeof t)return"BMF"===t.substring(0,3);let r=t.slice(0,4);return t.length>4&&r[0]===HEADER[0]&&r[1]===HEADER[1]&&r[2]===HEADER[2]}function parseFont(t,r){return isBinary(r)?("string"==typeof r&&(r=Buffer.from(r,"binary")),readBinary(r)):(r=r.toString().trim(),/.json$/.test(t)||"{"===r.charAt(0)?JSON.parse(r):/.xml$/.test(t)||"<"===r.charAt(0)?parseXML(r):parseASCII(r))}function parseNumbersInObject(t){for(let r in t){try{t[r]=parseInt(t[r],10)}catch{}"object"==typeof t[r]&&parseNumbersInObject(t[r])}return t}async function loadBitmapFontData(t){if(isWebWorker&&"string"==typeof t){let r=await fetch(t),i=convertXML(await r.text()).font.children.reduce((t,r)=>({...t,...r}),{}),n=[],a=[],s=[];for(let t=0;t<i.pages.children.length;t++){let r=i.pages.children[t].page;n[parseInt(r.id,10)]=parseNumbersInObject(r.file)}for(let t=0;t<i.chars.children.length;t++)a.push(parseNumbersInObject(i.chars.children[t].char));for(let t=0;t<i.kernings.children.length;t++)s.push(parseNumbersInObject(i.kernings.children[t].kerning));return{info:i.info,common:i.common,pages:n,chars:a,kernings:s}}if("string"==typeof t){let r=await fetch(t);return parseFont(t,await r.text())}return parseFont("",t)}async function processBitmapFont(t,r){let i={},n={};for(let t=0;t<r.chars.length;t++){let n=r.chars[t];i[String.fromCharCode(n.id)]=n}for(let t=0;t<r.kernings.length;t++){let i=String.fromCharCode(r.kernings[t].first);n[i]=n[i]||{},n[i][String.fromCharCode(r.kernings[t].second)]=r.kernings[t].amount}return{...r,chars:i,kernings:n,pages:await Promise.all(r.pages.map(async r=>CharacterJimp.read(path.join(path.dirname(t),r))))}}async function loadFont(t){let r=t;if("undefined"==typeof window&&!isWebWorker){let{existsSync:i,promises:n}=await Promise.resolve().then(function(){return _polyfillNode_fs$1});i(t)&&(r=await n.readFile(t))}return processBitmapFont(t,await loadBitmapFontData(r))}var pixelmatch_1=pixelmatch;let defaultOptions={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function pixelmatch(t,r,i,n,a,s){if(!isPixelData(t)||!isPixelData(r)||i&&!isPixelData(i))throw Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(t.length!==r.length||i&&i.length!==t.length)throw Error("Image sizes do not match.");if(t.length!==n*a*4)throw Error("Image data size does not match width/height.");s=Object.assign({},defaultOptions,s);let o=n*a,l=new Uint32Array(t.buffer,t.byteOffset,o),u=new Uint32Array(r.buffer,r.byteOffset,o),h=!0;for(let t=0;t<o;t++)if(l[t]!==u[t]){h=!1;break}if(h){if(i&&!s.diffMask)for(let r=0;r<o;r++)drawGrayPixel(t,4*r,s.alpha,i);return 0}let f=35215*s.threshold*s.threshold,d=0;for(let o=0;o<a;o++)for(let l=0;l<n;l++){let u=4*(o*n+l),h=colorDelta(t,r,u,u);Math.abs(h)>f?!s.includeAA&&(antialiased(t,l,o,n,a,r)||antialiased(r,l,o,n,a,t))?i&&!s.diffMask&&drawPixel(i,u,...s.aaColor):(i&&drawPixel(i,u,...h<0&&s.diffColorAlt||s.diffColor),d++):i&&(s.diffMask||drawGrayPixel(t,u,s.alpha,i))}return d}function isPixelData(t){return ArrayBuffer.isView(t)&&1===t.constructor.BYTES_PER_ELEMENT}function antialiased(t,r,i,n,a,s){let o=Math.max(r-1,0),l=Math.max(i-1,0),u=Math.min(r+1,n-1),h=Math.min(i+1,a-1),f=4*(i*n+r),d,c,p,m,g=+(r===o||r===u||i===l||i===h),_=0,b=0;for(let a=o;a<=u;a++)for(let s=l;s<=h;s++){if(a===r&&s===i)continue;let o=colorDelta(t,t,f,4*(s*n+a),!0);if(0===o){if(++g>2)return!1}else o<_?(_=o,d=a,c=s):o>b&&(b=o,p=a,m=s)}return 0!==_&&0!==b&&(hasManySiblings(t,d,c,n,a)&&hasManySiblings(s,d,c,n,a)||hasManySiblings(t,p,m,n,a)&&hasManySiblings(s,p,m,n,a))}function hasManySiblings(t,r,i,n,a){let s=Math.max(r-1,0),o=Math.max(i-1,0),l=Math.min(r+1,n-1),u=Math.min(i+1,a-1),h=4*(i*n+r),f=+(r===s||r===l||i===o||i===u);for(let a=s;a<=l;a++)for(let s=o;s<=u;s++){if(a===r&&s===i)continue;let o=4*(s*n+a);if(t[h]===t[o]&&t[h+1]===t[o+1]&&t[h+2]===t[o+2]&&t[h+3]===t[o+3]&&f++,f>2)return!0}return!1}function colorDelta(t,r,i,n,a){let s=t[i+0],o=t[i+1],l=t[i+2],u=t[i+3],h=r[n+0],f=r[n+1],d=r[n+2],c=r[n+3];if(u===c&&s===h&&o===f&&l===d)return 0;u<255&&(u/=255,s=blend(s,u),o=blend(o,u),l=blend(l,u)),c<255&&(c/=255,h=blend(h,c),f=blend(f,c),d=blend(d,c));let p=rgb2y(s,o,l),m=rgb2y(h,f,d),g=p-m;if(a)return g;let _=rgb2i(s,o,l)-rgb2i(h,f,d),b=rgb2q(s,o,l)-rgb2q(h,f,d),y=.5053*g*g+.299*_*_+.1957*b*b;return p>m?-y:y}function rgb2y(t,r,i){return .29889531*t+.58662247*r+.11448223*i}function rgb2i(t,r,i){return .59597799*t-.2741761*r-.32180189*i}function rgb2q(t,r,i){return .21147017*t-.52261711*r+.31114694*i}function blend(t,r){return 255+(t-255)*r}function drawPixel(t,r,i,n,a){t[r+0]=i,t[r+1]=n,t[r+2]=a,t[r+3]=255}function drawGrayPixel(t,r,i,n){let a=blend(rgb2y(t[r+0],t[r+1],t[r+2]),i*t[r+3]/255);drawPixel(n,r,a,a,a)}var pixelMatch=getDefaultExportFromCjs(pixelmatch_1);function diff(t,r,i=.1){let n=t.bitmap,a=r.bitmap;if(n.width===a.width&&n.height===a.height||(n.width*n.height>a.width*a.height?n=methods$d.resize(clone(t),{w:a.width,h:a.height}).bitmap:a=methods$d.resize(clone(r),{w:n.width,h:n.height}).bitmap),"number"!=typeof i||i<0||i>1)throw Error("threshold must be a number between 0 and 1");let s=new t.constructor({width:n.width,height:n.height,color:0xffffffff});return{percent:pixelMatch(n.data,a.data,s.bitmap.data,s.bitmap.width,s.bitmap.height,{threshold:i})/(s.bitmap.width*s.bitmap.height),image:s}}let defaultPlugins=[methods$h,methods$g,methods$f,methods$e,methods$c,methods$a,methods$b,methods$9,methods$8,methods$7,methods$6,methods$5,methods$4,methods$3,methods$d,methods$2,methods$1,methods],defaultFormats=[bmp,msBmp,gif,jpeg$2,png,tiff],JimpMime={bmp:bmp().mime,gif:gif().mime,jpeg:jpeg$2().mime,png:png().mime,tiff:tiff().mime},Jimp=createJimp({formats:defaultFormats,plugins:defaultPlugins}),__TURBOPACK__import$2e$meta__={get url(){return`file://${__turbopack_context__.P("node_modules/onnxruntime-web/dist/ort.bundle.min.mjs")}`}};var ResizeStrategy,ResizeStrategy2,wr,kt,Pt,jp,Qi,Xi,ea,Ee,we,ra,na,Fn,ia,aa,sa,ua,la,Ot,Jt,ca,pa,fa,ha,De,qe,$r,ya,Ne,Me,wt,vt,xr,Kp,Ln=Object.defineProperty,Gp=Object.getOwnPropertyDescriptor,Hp=Object.getOwnPropertyNames,Fp=Object.prototype.hasOwnProperty,Wn=(e1=0,__turbopack_context__.z),L1=(t,r)=>()=>(t&&(r=t(t=0)),r),Wt=(t,r)=>{for(var i in r)Ln(t,i,{get:r[i],enumerable:!0})},qp=(t,r,i,n)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let a of Hp(r))Fp.call(t,a)||a===i||Ln(t,a,{get:()=>r[a],enumerable:!(n=Gp(r,a))||n.enumerable});return t},Xt=t=>qp(Ln({},"__esModule",{value:!0}),t),Gn=L1(()=>{wr=new Map,kt=[],Pt=(t,r,i)=>{if(r&&"function"==typeof r.init&&"function"==typeof r.createInferenceSessionHandler){let n=wr.get(t);if(void 0===n)wr.set(t,{backend:r,priority:i});else{if(n.priority>i)return;if(n.priority===i&&n.backend!==r)throw Error(`cannot register backend "${t}" using priority ${i}`)}if(i>=0){let r=kt.indexOf(t);-1!==r&&kt.splice(r,1);for(let r=0;r<kt.length;r++)if(wr.get(kt[r]).priority<=i)return void kt.splice(r,0,t);kt.push(t)}return}throw TypeError("not a valid backend")},jp=async t=>{let r=wr.get(t);if(!r)return"backend not found.";if(r.initialized)return r.backend;if(r.aborted)return r.error;{let i=!!r.initPromise;try{return i||(r.initPromise=r.backend.init(t)),await r.initPromise,r.initialized=!0,r.backend}catch(t){return i||(r.error=`${t}`,r.aborted=!0),r.error}finally{delete r.initPromise}}},Qi=async t=>{let r=t.executionProviders||[],i=r.map(t=>"string"==typeof t?t:t.name),n=0===i.length?kt:i,a,s=[],o=new Set;for(let t of n){let r=await jp(t);"string"==typeof r?s.push({name:t,err:r}):(a||(a=r),a===r&&o.add(t))}if(!a)throw Error(`no available backend found. ERR: ${s.map(t=>`[${t.name}] ${t.err}`).join(", ")}`);for(let{name:t,err:r}of s)i.includes(t)&&console.warn(`removing requested execution provider "${t}" from session options because it is not available: ${r}`);let l=r.filter(t=>o.has("string"==typeof t?t:t.name));return[a,new Proxy(t,{get:(t,r)=>"executionProviders"===r?l:Reflect.get(t,r)})]}}),Yi=L1(()=>{Gn()}),Ji=L1(()=>{Xi="1.23.2"}),Hn=L1(()=>{Ji(),ea="warning",Object.defineProperty(Ee={wasm:{},webgl:{},webgpu:{},versions:{common:Xi},set logLevel(e){if(void 0!==e){if("string"!=typeof e||-1===["verbose","info","warning","error","fatal"].indexOf(e))throw Error(`Unsupported logging level: ${e}`);ea=e}},get logLevel(){return ea}},"logLevel",{enumerable:!0})}),ta=L1(()=>{Hn(),we=Ee}),oa=L1(()=>{ra=(t,r)=>{let i="u">typeof document?document.createElement("canvas"):new OffscreenCanvas(1,1);i.width=t.dims[3],i.height=t.dims[2];let n=i.getContext("2d");if(null!=n){let a,s;r?.tensorLayout!==void 0&&"NHWC"===r.tensorLayout?(a=t.dims[2],s=t.dims[3]):(a=t.dims[3],s=t.dims[2]);let o=r?.format!==void 0?r.format:"RGB",l=r?.norm,u,h;void 0===l||void 0===l.mean?u=[255,255,255,255]:"number"==typeof l.mean?u=[l.mean,l.mean,l.mean,l.mean]:(u=[l.mean[0],l.mean[1],l.mean[2],0],void 0!==l.mean[3]&&(u[3]=l.mean[3])),void 0===l||void 0===l.bias?h=[0,0,0,0]:"number"==typeof l.bias?h=[l.bias,l.bias,l.bias,l.bias]:(h=[l.bias[0],l.bias[1],l.bias[2],0],void 0!==l.bias[3]&&(h[3]=l.bias[3]));let f=s*a,d=0,c=f,p=2*f,m=-1;"RGBA"===o?(d=0,c=f,p=2*f,m=3*f):"RGB"===o?(d=0,c=f,p=2*f):"RBG"===o&&(d=0,p=f,c=2*f);for(let r=0;r<s;r++)for(let i=0;i<a;i++)n.fillStyle="rgba("+(t.data[d++]-h[0])*u[0]+","+(t.data[c++]-h[1])*u[1]+","+(t.data[p++]-h[2])*u[2]+","+(-1===m?255:(t.data[m++]-h[3])*u[3])+")",n.fillRect(i,r,1,1);if("toDataURL"in i)return i.toDataURL();throw Error("toDataURL is not supported")}throw Error("Can not access image data")},na=(t,r)=>{let i="u">typeof document?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(null!=i){let a,s,o;r?.tensorLayout!==void 0&&"NHWC"===r.tensorLayout?(a=t.dims[2],s=t.dims[1],o=t.dims[3]):(a=t.dims[3],s=t.dims[2],o=t.dims[1]);let l=void 0!==r&&void 0!==r.format?r.format:"RGB",u=r?.norm,h,f;void 0===u||void 0===u.mean?h=[255,255,255,255]:"number"==typeof u.mean?h=[u.mean,u.mean,u.mean,u.mean]:(h=[u.mean[0],u.mean[1],u.mean[2],255],void 0!==u.mean[3]&&(h[3]=u.mean[3])),void 0===u||void 0===u.bias?f=[0,0,0,0]:"number"==typeof u.bias?f=[u.bias,u.bias,u.bias,u.bias]:(f=[u.bias[0],u.bias[1],u.bias[2],0],void 0!==u.bias[3]&&(f[3]=u.bias[3]));let d=s*a;if(void 0!==r&&(void 0!==r.format&&4===o&&"RGBA"!==r.format||3===o&&"RGB"!==r.format&&"BGR"!==r.format))throw Error("Tensor format doesn't match input tensor dims");let c=4,p=0,m=1,g=2,_=3,b=0,y=d,v=2*d,w=-1;"RGBA"===l?(b=0,y=d,v=2*d,w=3*d):"RGB"===l?(b=0,y=d,v=2*d):"RBG"===l&&(b=0,v=d,y=2*d),n=i.createImageData(a,s);for(let r=0;r<s*a;p+=c,m+=c,g+=c,_+=c,r++)n.data[p]=(t.data[b++]-f[0])*h[0],n.data[m]=(t.data[y++]-f[1])*h[1],n.data[g]=(t.data[v++]-f[2])*h[2],n.data[_]=-1===w?255:(t.data[w++]-f[3])*h[3]}else throw Error("Can not access image data");return n}}),da=L1(()=>{vr(),Fn=(t,r)=>{if(void 0===t)throw Error("Image buffer must be defined");if(void 0===r.height||void 0===r.width)throw Error("Image height and width must be defined");if("NHWC"===r.tensorLayout)throw Error("NHWC Tensor layout is not supported yet");let{height:i,width:n}=r,a=r.norm??{mean:255,bias:0},s,o;s="number"==typeof a.mean?[a.mean,a.mean,a.mean,a.mean]:[a.mean[0],a.mean[1],a.mean[2],a.mean[3]??255],o="number"==typeof a.bias?[a.bias,a.bias,a.bias,a.bias]:[a.bias[0],a.bias[1],a.bias[2],a.bias[3]??0];let l=void 0!==r.format?r.format:"RGBA",u=void 0!==r.tensorFormat&&void 0!==r.tensorFormat?r.tensorFormat:"RGB",h=i*n,f=new Float32Array("RGBA"===u?4*h:3*h),d=4,c=0,p=1,m=2,g=3,_=0,b=h,y=2*h,v=-1;"RGB"===l&&(d=3,c=0,p=1,m=2,g=-1),"RGBA"===u?v=3*h:"RBG"===u?(_=0,y=h,b=2*h):"BGR"===u&&(y=0,b=h,_=2*h);for(let r=0;r<h;r++,c+=d,m+=d,p+=d,g+=d)f[_++]=(t[c]+o[0])/s[0],f[b++]=(t[p]+o[1])/s[1],f[y++]=(t[m]+o[2])/s[2],-1!==v&&-1!==g&&(f[v++]=(t[g]+o[3])/s[3]);return"RGBA"===u?new De("float32",f,[1,4,i,n]):new De("float32",f,[1,3,i,n])},ia=async(t,r)=>{let i="u">typeof HTMLImageElement&&t instanceof HTMLImageElement,n="u">typeof ImageData&&t instanceof ImageData,a="u">typeof ImageBitmap&&t instanceof ImageBitmap,s="string"==typeof t,o,l=r??{},u=()=>{if("u">typeof document)return document.createElement("canvas");if("u">typeof OffscreenCanvas)return new OffscreenCanvas(1,1);throw Error("Canvas is not supported")},h=t=>"u">typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas?t.getContext("2d"):null;if(i){let i=u();i.width=t.width,i.height=t.height;let n=h(i);if(null!=n){let i=t.height,a=t.width;if(void 0!==r&&void 0!==r.resizedHeight&&void 0!==r.resizedWidth&&(i=r.resizedHeight,a=r.resizedWidth),void 0!==r){if(l=r,void 0!==r.tensorFormat)throw Error("Image input config format must be RGBA for HTMLImageElement");l.tensorFormat="RGBA",l.height=i,l.width=a}else l.tensorFormat="RGBA",l.height=i,l.width=a;n.drawImage(t,0,0),o=n.getImageData(0,0,a,i).data}else throw Error("Can not access image data")}else if(n){let i,n;if(void 0!==r&&void 0!==r.resizedWidth&&void 0!==r.resizedHeight?(i=r.resizedHeight,n=r.resizedWidth):(i=t.height,n=t.width),void 0!==r&&(l=r),l.format="RGBA",l.height=i,l.width=n,void 0!==r){let r=u();r.width=n,r.height=i;let a=h(r);if(null!=a)a.putImageData(t,0,0),o=a.getImageData(0,0,n,i).data;else throw Error("Can not access image data")}else o=t.data}else if(a){if(void 0===r)throw Error("Please provide image config with format for Imagebitmap");let i=u();i.width=t.width,i.height=t.height;let n=h(i);if(null!=n){let r=t.height,i=t.width;return n.drawImage(t,0,0,i,r),o=n.getImageData(0,0,i,r).data,l.height=r,l.width=i,Fn(o,l)}throw Error("Can not access image data")}else{if(s)return new Promise((r,i)=>{let n=u(),a=h(n);if(!t||!a)return i();let s=new Image;s.crossOrigin="Anonymous",s.src=t,s.onload=()=>{n.width=s.width,n.height=s.height,a.drawImage(s,0,0,n.width,n.height);let t=a.getImageData(0,0,n.width,n.height);l.height=n.height,l.width=n.width,r(Fn(t.data,l))}});throw Error("Input data provided is not supported - aborted tensor creation")}if(void 0!==o)return Fn(o,l);throw Error("Input data provided is not supported - aborted tensor creation")},aa=(t,r)=>{let{width:i,height:n,download:a,dispose:s}=r;return new De({location:"texture",type:"float32",texture:t,dims:[1,n,i,4],download:a,dispose:s})},sa=(t,r)=>{let{dataType:i,dims:n,download:a,dispose:s}=r;return new De({location:"gpu-buffer",type:i??"float32",gpuBuffer:t,dims:n,download:a,dispose:s})},ua=(t,r)=>{let{dataType:i,dims:n,download:a,dispose:s}=r;return new De({location:"ml-tensor",type:i??"float32",mlTensor:t,dims:n,download:a,dispose:s})},la=(t,r,i)=>new De({location:"cpu-pinned",type:t,data:r,dims:i??[r.length]})}),ma=L1(()=>{Ot=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Jt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),ca=!1,pa=()=>{if(!ca){ca=!0;let t="u">typeof BigInt64Array&&BigInt64Array.from,r="u">typeof BigUint64Array&&BigUint64Array.from,i=globalThis.Float16Array,n="u">typeof i&&i.from;t&&(Ot.set("int64",BigInt64Array),Jt.set(BigInt64Array,"int64")),r&&(Ot.set("uint64",BigUint64Array),Jt.set(BigUint64Array,"uint64")),n?(Ot.set("float16",i),Jt.set(i,"float16")):Ot.set("float16",Uint16Array)}}}),ga=L1(()=>{vr(),fa=t=>{let r=1;for(let i=0;i<t.length;i++){let n=t[i];if("number"!=typeof n||!Number.isSafeInteger(n))throw TypeError(`dims[${i}] must be an integer, got: ${n}`);if(n<0)throw RangeError(`dims[${i}] must be a non-negative integer, got: ${n}`);r*=n}return r},ha=(t,r)=>{switch(t.location){case"cpu":return new De(t.type,t.data,r);case"cpu-pinned":return new De({location:"cpu-pinned",data:t.data,type:t.type,dims:r});case"texture":return new De({location:"texture",texture:t.texture,type:t.type,dims:r});case"gpu-buffer":return new De({location:"gpu-buffer",gpuBuffer:t.gpuBuffer,type:t.type,dims:r});case"ml-tensor":return new De({location:"ml-tensor",mlTensor:t.mlTensor,type:t.type,dims:r});default:throw Error(`tensorReshape: tensor location ${t.location} is not supported`)}}}),vr=L1(()=>{oa(),da(),ma(),ga(),De=class{constructor(t,r,i){let n,a;if(pa(),"object"==typeof t&&"location"in t)switch(this.dataLocation=t.location,n=t.type,a=t.dims,t.location){case"cpu-pinned":{let r=Ot.get(n);if(!r)throw TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(t.data instanceof r))throw TypeError(`buffer should be of type ${r.name}`);this.cpuData=t.data;break}case"texture":if("float32"!==n)throw TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=t.texture,this.downloader=t.download,this.disposer=t.dispose;break;case"gpu-buffer":if("float32"!==n&&"float16"!==n&&"int32"!==n&&"int64"!==n&&"uint32"!==n&&"uint8"!==n&&"bool"!==n&&"uint4"!==n&&"int4"!==n)throw TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=t.gpuBuffer,this.downloader=t.download,this.disposer=t.dispose;break;case"ml-tensor":if("float32"!==n&&"float16"!==n&&"int32"!==n&&"int64"!==n&&"uint32"!==n&&"uint64"!==n&&"int8"!==n&&"uint8"!==n&&"bool"!==n&&"uint4"!==n&&"int4"!==n)throw TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=t.mlTensor,this.downloader=t.download,this.disposer=t.dispose;break;default:throw Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let s,o;if("string"==typeof t)if(n=t,o=i,"string"===t){if(!Array.isArray(r))throw TypeError("A string tensor's data must be a string array.");s=r}else{let i=Ot.get(t);if(void 0===i)throw TypeError(`Unsupported tensor type: ${t}.`);if(Array.isArray(r)){if("float16"===t&&i===Uint16Array||"uint4"===t||"int4"===t)throw TypeError(`Creating a ${t} tensor from number array is not supported. Please use ${i.name} as data.`);s="uint64"===t||"int64"===t?i.from(r,BigInt):i.from(r)}else if(r instanceof i)s=r;else if(r instanceof Uint8ClampedArray)if("uint8"===t)s=Uint8Array.from(r);else throw TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if("float16"===t&&r instanceof Uint16Array&&i!==Uint16Array)s=new globalThis.Float16Array(r.buffer,r.byteOffset,r.length);else throw TypeError(`A ${n} tensor's data must be type of ${i}`)}else if(o=r,Array.isArray(t)){if(0===t.length)throw TypeError("Tensor type cannot be inferred from an empty array.");let r=typeof t[0];if("string"===r)n="string",s=t;else if("boolean"===r)n="bool",s=Uint8Array.from(t);else throw TypeError(`Invalid element type of data array: ${r}.`)}else if(t instanceof Uint8ClampedArray)n="uint8",s=Uint8Array.from(t);else{let r=Jt.get(t.constructor);if(void 0===r)throw TypeError(`Unsupported type for tensor data: ${t.constructor}.`);n=r,s=t}if(void 0===o)o=[s.length];else if(!Array.isArray(o))throw TypeError("A tensor's dims must be a number array");a=o,this.cpuData=s,this.dataLocation="cpu"}let s=fa(a);if(this.cpuData&&s!==this.cpuData.length&&("uint4"!==n&&"int4"!==n||Math.ceil(s/2)!==this.cpuData.length))throw Error(`Tensor's size(${s}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=a,this.size=s}static async fromImage(t,r){return ia(t,r)}static fromTexture(t,r){return aa(t,r)}static fromGpuBuffer(t,r){return sa(t,r)}static fromMLTensor(t,r){return ua(t,r)}static fromPinnedBuffer(t,r,i){return la(t,r,i)}toDataURL(t){return ra(this,t)}toImageData(t){return na(this,t)}get data(){if(this.ensureValid(),!this.cpuData)throw Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(t){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":if(!this.downloader)throw Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let r=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=r,t&&this.disposer&&(this.disposer(),this.disposer=void 0),r}finally{this.isDownloading=!1}default:throw Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if("none"===this.dataLocation)throw Error("The tensor is disposed.")}reshape(t){if(this.ensureValid(),this.downloader||this.disposer)throw Error("Cannot reshape a tensor that owns GPU resource.");return ha(this,t)}}}),qn=L1(()=>{vr(),qe=De}),jn=L1(()=>{Hn(),$r=(t,r)=>{(typeof Ee.trace>"u"?Ee.wasm.trace:Ee.trace)&&console.timeStamp(`${t}::ORT::${r}`)},ya=(t,r)=>{let i=Error().stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let a=0;a<i.length;a++){if(n&&!i[a].includes("TRACE_FUNC")){let n=`FUNC_${t}::${i[a].trim().split(" ")[1]}`;r&&(n+=`::${r}`),$r("CPU",n);return}i[a].includes("TRACE_FUNC")&&(n=!0)}},Ne=t=>{(typeof Ee.trace>"u"?Ee.wasm.trace:Ee.trace)&&ya("BEGIN",t)},Me=t=>{(typeof Ee.trace>"u"?Ee.wasm.trace:Ee.trace)&&ya("END",t)},wt=t=>{(typeof Ee.trace>"u"?Ee.wasm.trace:Ee.trace)&&console.time(`ORT::${t}`)},vt=t=>{(typeof Ee.trace>"u"?Ee.wasm.trace:Ee.trace)&&console.timeEnd(`ORT::${t}`)}}),ba=L1(()=>{Gn(),qn(),jn(),xr=class t{constructor(t){this.handler=t}async run(t,r,i){Ne(),wt("InferenceSession.run");let n={},a={};if("object"!=typeof t||null===t||t instanceof qe||Array.isArray(t))throw TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let s=!0;if("object"==typeof r){if(null===r)throw TypeError("Unexpected argument[1]: cannot be null.");if(r instanceof qe)throw TypeError("'fetches' cannot be a Tensor");if(Array.isArray(r)){if(0===r.length)throw TypeError("'fetches' cannot be an empty array.");for(let t of(s=!1,r)){if("string"!=typeof t)throw TypeError("'fetches' must be a string array or an object.");if(-1===this.outputNames.indexOf(t))throw RangeError(`'fetches' contains invalid output name: ${t}.`);n[t]=null}if("object"==typeof i&&null!==i)a=i;else if("u">typeof i)throw TypeError("'options' must be an object.")}else{let t=!1,o=Object.getOwnPropertyNames(r);for(let i of this.outputNames)if(-1!==o.indexOf(i)){let a=r[i];(null===a||a instanceof qe)&&(t=!0,s=!1,n[i]=a)}if(t){if("object"==typeof i&&null!==i)a=i;else if("u">typeof i)throw TypeError("'options' must be an object.")}else a=r}}else if("u">typeof r)throw TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let r of this.inputNames)if(typeof t[r]>"u")throw Error(`input '${r}' is missing in 'feeds'.`);if(s)for(let t of this.outputNames)n[t]=null;let o=await this.handler.run(t,n,a),l={};for(let t in o)if(Object.hasOwnProperty.call(o,t)){let r=o[t];r instanceof qe?l[t]=r:l[t]=new qe(r.type,r.data,r.dims)}return vt("InferenceSession.run"),Me(),l}async release(){return this.handler.dispose()}static async create(r,i,n,a){Ne(),wt("InferenceSession.create");let s,o={};if("string"==typeof r){if(s=r,"object"==typeof i&&null!==i)o=i;else if("u">typeof i)throw TypeError("'options' must be an object.")}else if(r instanceof Uint8Array){if(s=r,"object"==typeof i&&null!==i)o=i;else if("u">typeof i)throw TypeError("'options' must be an object.")}else if(r instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&r instanceof SharedArrayBuffer){let t=r,l=0,u=r.byteLength;if("object"==typeof i&&null!==i)o=i;else if("number"==typeof i){if(!Number.isSafeInteger(l=i))throw RangeError("'byteOffset' must be an integer.");if(l<0||l>=t.byteLength)throw RangeError(`'byteOffset' is out of range [0, ${t.byteLength}).`);if(u=r.byteLength-l,"number"==typeof n){if(!Number.isSafeInteger(u=n))throw RangeError("'byteLength' must be an integer.");if(u<=0||l+u>t.byteLength)throw RangeError(`'byteLength' is out of range (0, ${t.byteLength-l}].`);if("object"==typeof a&&null!==a)o=a;else if("u">typeof a)throw TypeError("'options' must be an object.")}else if("u">typeof n)throw TypeError("'byteLength' must be a number.")}else if("u">typeof i)throw TypeError("'options' must be an object.");s=new Uint8Array(t,l,u)}else throw TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[l,u]=await Qi(o),h=await l.createInferenceSessionHandler(s,u);return vt("InferenceSession.create"),Me(),new t(h)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),_a=L1(()=>{ba(),Kp=xr}),wa=L1(()=>{}),va=L1(()=>{}),$a=L1(()=>{}),xa=L1(()=>{}),Kn={};Wt(Kn,{InferenceSession:()=>Kp,TRACE:()=>$r,TRACE_EVENT_BEGIN:()=>wt,TRACE_EVENT_END:()=>vt,TRACE_FUNC_BEGIN:()=>Ne,TRACE_FUNC_END:()=>Me,Tensor:()=>qe,env:()=>we,registerBackend:()=>Pt});var Ve=L1(()=>{Yi(),ta(),_a(),qn(),wa(),va(),jn(),$a(),xa()}),Sr=L1(()=>{}),Ia={};Wt(Ia,{default:()=>Zp});var Ta,Ca,Zp,Aa=L1(()=>{Zn(),$t(),Tr(),Ta="ort-wasm-proxy-worker",(Ca=globalThis.self?.name===Ta)&&(self.onmessage=t=>{let{type:r,in:i}=t.data;try{switch(r){case"init-wasm":Cr(i.wasm).then(()=>{Ir(i).then(()=>{postMessage({type:r})},t=>{postMessage({type:r,err:t})})},t=>{postMessage({type:r,err:t})});break;case"init-ep":{let{epName:t,env:n}=i;Ar(n,t).then(()=>{postMessage({type:r})},t=>{postMessage({type:r,err:t})});break}case"copy-from":{let{buffer:t}=i,n=er(t);postMessage({type:r,out:n});break}case"create":{let{model:t,options:n}=i;Er(t,n).then(t=>{postMessage({type:r,out:t})},t=>{postMessage({type:r,err:t})});break}case"release":kr(i),postMessage({type:r});break;case"run":{let{sessionId:t,inputIndices:n,inputs:a,outputIndices:s,options:o}=i;Pr(t,n,a,s,Array(s.length).fill(null),o).then(t=>{t.some(t=>"cpu"!==t[3])?postMessage({type:r,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:r,out:t},zr([...a,...t]))},t=>{postMessage({type:r,err:t})});break}case"end-profiling":Or(i),postMessage({type:r})}}catch(t){postMessage({type:r,err:t})}}),Zp=Ca?null:t=>new Worker(t??Le,{type:"module",name:Ta})}),ka={};Wt(ka,{default:()=>Qp});var Ea,Qp,Da,Yn,Le,Ba,Qn,Jp,em,Ma,tm,Oa,Ra,za,Ua,Xn,Jn,Dr,Na,rm,nm,om,Cr,_e,We,tr,ye,Va,im,am,sm,Mr,um,Wa,xt,Je,St,Gt,rr,Rr,Ur,eo,nr,lm,dm,Ha,Fa,Nr,cm,le,ro,tt,E1,Dt,Vr,qa,ja,Lr,Za,io,Qa,pm,Ka,mm,Ya,Wr,Gr,oo,Xa,Hr,fm,Fr,ts,ao,so,hm,gm,rs,lo,uo,os,co,te,Bt,mo,ve,ke,W,he,fo,Mt,je,K,jr,P,N1,as,Kr,po,ss,ym,us,bm,_m,wm,vm,Pe,ls,ds,$m,xm,Sm,Tm,Cm,Im,Am,Em,km,Pm,rt,cs,ps,ms,fs,hs,gs,ys,bs,_s,ws,nt,Om,Qr,ho,ot,zm,Dm,Bm,Mm,Rm,Um,Nm,Vm,Lm,Wm,it,$s,xs,Ss,Ts,Cs,Is,As,Es,ks,Ps,Os,zs,Ds,go,Gm,yo,Hm,Fm,qm,Ht,jm,Ms,Km,Zm,Qm,Rs,Ym,Xm,Ns,Jm,be,Ls,Ws,Gs,Hs,Fs,qs,js,Ks,Zs,ef,Qs,Ys,Xs,Js,or,eu,Xr,tu,ru,nu,ou,iu,au,su,uu,lu,du,cu,pu,mu,fu,hu,gu,yu,bu,bo,_o,_u,wu,vu,tf,rf,$u,nf,of,Su,af,sf,at,Cu,Iu,Au,Eu,ku,Pu,Ou,zu,Du,Bu,lf,df,cf,pf,Ru,Uu,Ke,Ze,Qe,en,Ae,Vu,Lu,ir,rn,mf,ff,wo,Gu,hf,vo,gf,ar,yf,Hu,bf,qu,an,_f,ju,wf,Ku,Zu,Yu,Xu,vf,$o,$f,xo,So,el,xf,Sf,To,rl,Tf,Cf,If,ol,il,Af,al,Ef,sl,kf,ll,dl,Pf,Of,zf,pl,ml,Co,sn,hl,Bf,Io,Ao,gl,Mf,yl,bl,Rf,wl,Uf,Nf,vl,Vf,xl,Lf,Wf,Tl,Cl,Gf,Al,El,Hf,Ff,Pl,Ol,qf,jf,Dl,Bl,Kf,Zf,Rl,Ul,pt,Ct,Ft,qt,Qf,Yf,Xf,Jf,eh,th,rh,nh,Vl,Ll,Re,ah,Hl,Gl,sh,sr,Fl,uh,lh,dh,ch,ko,ql,jl,ph,un,Kl,mh,fh,Zl,hh,Ql,Xl,gh,yh,Jl,bh,_h,td,wh,nd,vh,$h,xh,id,ad,Sh,Th,Ch,Ih,Ah,Eh,kh,Ph,ud,ln,dd,cd,pd,md,Oh,zh,fd,hd,gd,yd,bd,_d,wd,vd,$d,xd,Sd,Td,Bh,Mh,Id,Ad,Rh,Uh,kd,Nh,Vh,Od,zd,Lh,Wh,Gh,Bd,Hh,Fh,qh,jh,Kh,Zh,Qh,Yh,Md,Xh,Jh,eg,tg,rg,Rd,Ud,ng,og,Vd,ig,dn,ag,Wd,sg,ug,Gd,Hd,lg,dg,qd,jd,Zd,cg,pg,mg,Qd,fg,hg,Xd,ec,cn,Pa=L1(()=>{Qp=Ea=async function(t={}){var r,i,n=t,a=new Promise((t,n)=>{r=t,i=n}),s="object"==typeof window,o="u">typeof WorkerGlobalScope,l=o&&self.name?.startsWith("em-pthread");n.mountExternalData=(t,r)=>{t.startsWith("./")&&(t=t.substring(2)),(n.Fb||(n.Fb=new Map)).set(t,r)},n.unmountExternalData=()=>{delete n.Fb};var u=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,qc:!0}).buffer.constructor;let h=t=>async(...r)=>{try{if(n.Gb)throw Error("Session already started");let i=n.Gb={ec:r[0],errors:[]},a=await t(...r);if(n.Gb!==i)throw Error("Session mismatch");n.Kb?.flush();let s=i.errors;if(0<s.length){let t=await Promise.all(s);if(t=t.filter(t=>t),0<t.length)throw Error(t.join(`
`))}return a}finally{n.Gb=null}};n.jsepInit=(t,r)=>{if("webgpu"===t){[n.Kb,n.Vb,n.Zb,n.Lb,n.Yb,n.Ab,n.$b,n.bc,n.Wb,n.Xb,n.ac]=r;let t=n.Kb;n.jsepRegisterBuffer=(r,i,n,a)=>t.registerBuffer(r,i,n,a),n.jsepGetBuffer=r=>t.getBuffer(r),n.jsepCreateDownloader=(r,i,n)=>t.createDownloader(r,i,n),n.jsepOnCreateSession=r=>{t.onCreateSession(r)},n.jsepOnReleaseSession=r=>{t.onReleaseSession(r)},n.jsepOnRunStart=r=>t.onRunStart(r),n.cc=(r,i)=>{t.upload(r,i)}}else if("webnn"===t){let t=r[0];[n.oc,n.Ob,n.webnnEnsureTensor,n.Pb,n.webnnDownloadTensor,n.nc,n.webnnEnableTraceEvent]=r.slice(1),n.webnnReleaseTensorId=n.Ob,n.webnnUploadTensor=n.Pb,n.webnnRegisterMLContext=n.nc,n.webnnOnRunStart=r=>t.onRunStart(r),n.webnnOnRunEnd=t.onRunEnd.bind(t),n.webnnOnReleaseSession=r=>{t.onReleaseSession(r)},n.webnnCreateMLTensorDownloader=(r,i)=>t.createMLTensorDownloader(r,i),n.webnnRegisterMLTensor=(r,i,n,a)=>t.registerMLTensor(r,i,n,a),n.webnnCreateMLContext=r=>t.createMLContext(r),n.webnnRegisterMLConstant=(r,i,a,s,o,l)=>t.registerMLConstant(r,i,a,s,o,n.Fb,l),n.webnnRegisterGraphInput=t.registerGraphInput.bind(t),n.webnnIsGraphInput=t.isGraphInput.bind(t),n.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),n.webnnIsGraphOutput=t.isGraphOutput.bind(t),n.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),n.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)}};let f=()=>{let t=(t,r,i)=>(...n)=>{let a=tA,s=r?.();n=t(...n);let o=r?.();return s!==o&&(t=o,i(s),r=i=null),tA!=a?new Promise((t,r)=>{tB={resolve:t,reject:r}}):n};(()=>{for(let r of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])n[r]=t(n[r],()=>n[r],t=>n[r]=t)})(),void 0!==h&&(n._OrtRun=h(n._OrtRun),n._OrtRunWithBinding=h(n._OrtRunWithBinding)),f=void 0};n.asyncInit=()=>{f?.()};var d,c,p=(t,r)=>{throw r},m=__TURBOPACK__import$2e$meta__.url,g="";if(s||o){try{g=new URL(".",m).href}catch{}o&&(c=t=>{var r=new XMLHttpRequest;return r.open("GET",t,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),d=async t=>{if(D(t))return new Promise((r,i)=>{var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?r(n.response):i(n.status)},n.onerror=i,n.send(null)});var r=await fetch(t,{credentials:"same-origin"});if(r.ok)return r.arrayBuffer();throw Error(r.status+" : "+r.url)}}var _,b,y,v,w,x,k,E,S,$,I,A,M,T,C,z=console.log.bind(console),R=console.error.bind(console),B=z,O=R,P=!1,D=t=>t.startsWith("file://");function N(){return b.buffer!=w.buffer&&V(),w}function L(){return b.buffer!=w.buffer&&V(),x}function U(){return b.buffer!=w.buffer&&V(),k}function j(){return b.buffer!=w.buffer&&V(),E}function F(){return b.buffer!=w.buffer&&V(),S}function G(){return b.buffer!=w.buffer&&V(),$}function W(){return b.buffer!=w.buffer&&V(),I}function q(){return b.buffer!=w.buffer&&V(),T}if(l){let t=function(r){try{var i=r.data,a=i.Db;if("load"===a){let r=[];for(let a of(self.onmessage=t=>r.push(t),self.startWorker=()=>{for(let i of(postMessage({Db:"loaded"}),r))t(i);self.onmessage=t},i.Sb))n[a]&&!n[a].proxy||(n[a]=(...t)=>{postMessage({Db:"callHandler",Rb:a,args:t})},"print"==a&&(B=n[a]),"printErr"==a&&(O=n[a]));b=i.kc,V(),C(i.lc)}else if("run"===a){eb(i.Bb),rV(i.Bb,0,0,1,0,0),em(),tp(i.Bb),H||(rG(),H=!0);try{ey(i.hc,i.Jb)}catch(t){if("unwind"!=t)throw t}}else"setimmediate"!==i.target&&("checkMailbox"===a?H&&tm():a&&(O(`worker: received unknown command ${a}`),O(i)))}catch(t){throw rZ(),t}};var H=!1;self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=t}function V(){var t=b.buffer;n.HEAP8=w=new Int8Array(t),k=new Int16Array(t),n.HEAPU8=x=new Uint8Array(t),E=new Uint16Array(t),n.HEAP32=S=new Int32Array(t),n.HEAPU32=$=new Uint32Array(t),I=new Float32Array(t),T=new Float64Array(t),A=new BigInt64Array(t),M=new BigUint64Array(t)}function Z(){l?startWorker(n):rj.Da()}var K,Y=0,X=null;function Q(){if(0==--Y&&X){var t=X;X=null,t()}}function J(t){throw O(t="Aborted("+t+")"),P=!0,t=new WebAssembly.RuntimeError(t+". Build with -sASSERTIONS for more info."),i(t),t}function ee(){return{a:{L:rU,Aa:rL,b:ew,$:ek,A:eI,pa:eA,X:eM,Z:eT,qa:eC,na:ez,ga:eR,ma:eB,J:eO,Y:eP,V:eD,oa:eN,W:eL,va:ej,E:eK,Q:eX,O:e4,D:e6,v:e7,s:e9,P:tr,z:th,R:tf,ja:td,T:tg,aa:tb,M:ty,F:tv,ia:tp,sa:tw,r:tE,Ca:tS,w:tD,o:tL,m:tF,c:e0,Ba:tG,n:tq,j:tZ,u:tK,p:tY,f:tX,t:tQ,l:tJ,e:t0,k:t1,h:t2,g:t3,d:t5,da:t4,ea:t9,fa:re,ba:rt,ca:rr,N:ra,xa:rs,ua:rl,i:rf,C:rd,G:rc,ta:ro,x:rp,ra:rm,U:rg,q:rn,y:r_,K:rb,S:ry,za:rk,ya:rE,ka:rA,la:rM,_:eu,B:rT,I:rC,ha:rz,H:rB,a:b,wa:eo}}}class et{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var er=t=>{t.terminate(),t.onmessage=()=>{}},ei=[],en=t=>{0==eh.length&&(e_(),eg(eh[0]));var r=eh.pop();if(!r)return 6;ef.push(r),ec[t.Bb]=r,r.Bb=t.Bb;var i={Db:"run",hc:t.fc,Jb:t.Jb,Bb:t.Bb};return r.postMessage(i,t.Nb),0},ea=0,es=(t,r,...i)=>{for(var n=2*i.length,a=r3(),s=r2(8*n),o=s>>>3,l=0;l<i.length;l++){var u=i[l];"bigint"==typeof u?(A[o+2*l]=1n,A[o+2*l+1]=u):(A[o+2*l]=0n,q()[o+2*l+1>>>0]=u)}return t=rK(t,0,n,s,r),r1(a),t};function eo(t){if(l)return es(0,1,t);if(v=t,!(0<ea)){for(var r of ef)er(r);for(r of eh)er(r);eh=[],ef=[],ec={},P=!0}p(0,new et(t))}function el(t){if(l)return es(1,0,t);eu(t)}var eu=t=>{if(v=t,l)throw el(t),"unwind";eo(t)},eh=[],ef=[],ed=[],ec={},ep=t=>{var r=t.Bb;delete ec[r],eh.push(t),ef.splice(ef.indexOf(t),1),t.Bb=0,rY(r)};function em(){ed.forEach(t=>t())}var eg=t=>new Promise(r=>{t.onmessage=i=>{var a=(i=i.data).Db;if(i.Hb&&i.Hb!=rW()){var s=ec[i.Hb];s?s.postMessage(i,i.Nb):O(`Internal error! Worker sent a message "${a}" to target pthread ${i.Hb}, but that thread no longer exists!`)}else"checkMailbox"===a?tm():"spawnThread"===a?en(i):"cleanupThread"===a?ep(ec[i.ic]):"loaded"===a?(t.loaded=!0,r(t)):"setimmediate"===i.target?t.postMessage(i):"callHandler"===a?n[i.Rb](...i.args):a&&O(`worker sent an unknown command ${a}`)},t.onerror=t=>{throw O(`worker sent an error! ${t.filename}:${t.lineno}: ${t.message}`),t};var i,a=[];for(i of[])n.propertyIsEnumerable(i)&&a.push(i);t.postMessage({Db:"load",Sb:a,kc:b,lc:y})});function e_(){var t=new Worker((URL,__TURBOPACK__import$2e$meta__.url>"file:"&&__TURBOPACK__import$2e$meta__.url<"file;"?new __turbopack_context__.U(__turbopack_context__.r(19489)):new URL(__TURBOPACK__import$2e$meta__.url)),{type:"module",workerData:"em-pthread",name:"em-pthread"});eh.push(t)}var eb=t=>{V();var r=G()[t+52>>>2>>>0];t=G()[t+56>>>2>>>0],r0(r,r-t),r1(r)},ey=(t,r)=>{ea=0,t=r5(t,r),0<ea?v=t:rX(t)};class ev{constructor(t){this.Ib=t-24}}function ew(t,r,i){var n=new ev(t>>>=0);throw r>>>=0,i>>>=0,G()[n.Ib+16>>>2>>>0]=0,G()[n.Ib+4>>>2>>>0]=r,G()[n.Ib+8>>>2>>>0]=i,t}function ex(t,r,i,n){return l?es(2,1,t,r,i,n):ek(t,r,i,n)}function ek(t,r,i,n){if(t>>>=0,i>>>=0,n>>>=0,void 0===u)return 6;var a=[];return l&&0===a.length?ex(t,r>>>=0,i,n):(t={fc:i,Bb:t,Jb:n,Nb:a},l?(t.Db="spawnThread",postMessage(t,a),0):en(t))}var eE="u">typeof TextDecoder?new TextDecoder:void 0,eS=(t,r=0,i=NaN)=>{var n=(r>>>=0)+i;for(i=r;t[i]&&!(i>=n);)++i;if(16<i-r&&t.buffer&&eE)return eE.decode(t.buffer instanceof ArrayBuffer?t.subarray(r,i):t.slice(r,i));for(n="";r<i;){var a=t[r++];if(128&a){var s=63&t[r++];if((224&a)==192)n+=String.fromCharCode((31&a)<<6|s);else{var o=63&t[r++];65536>(a=(240&a)==224?(15&a)<<12|s<<6|o:(7&a)<<18|s<<12|o<<6|63&t[r++])?n+=String.fromCharCode(a):(a-=65536,n+=String.fromCharCode(55296|a>>10,56320|1023&a))}}else n+=String.fromCharCode(a)}return n},e$=(t,r)=>"";function eI(t,r,i){return l?es(3,1,t,r,i):0}function eA(t,r){if(l)return es(4,1,t,r)}function eM(t,r){if(l)return es(5,1,t,r)}function eT(t,r,i){if(l)return es(6,1,t,r,i)}function eC(t,r,i){return l?es(7,1,t,r,i):0}function ez(t,r){if(l)return es(8,1,t,r)}function eR(t,r,i){if(l)return es(9,1,t,r,i)}function eB(t,r,i,n){if(l)return es(10,1,t,r,i,n)}function eO(t,r,i,n){if(l)return es(11,1,t,r,i,n)}function eP(t,r,i,n){if(l)return es(12,1,t,r,i,n)}function eD(t){if(l)return es(13,1,t)}function eN(t,r){if(l)return es(14,1,t,r)}function eL(t,r,i){if(l)return es(15,1,t,r,i)}var eU,ej=()=>J(""),eF=t=>{for(var r="";L()[t>>>0];)r+=eU[L()[t++>>>0]];return r},eG={},eW={},eq={},eH=n.BindingError=class extends Error{constructor(t){super(t),this.name="BindingError"}};function eV(t,r,i={}){return function(t,r,i={}){var n=r.name;if(!t)throw new eH(`type "${n}" must have a positive integer typeid pointer`);if(eW.hasOwnProperty(t)){if(i.Tb)return;throw new eH(`Cannot register type '${n}' twice`)}eW[t]=r,delete eq[t],eG.hasOwnProperty(t)&&(r=eG[t],delete eG[t],r.forEach(t=>t()))}(t,r,i)}var eZ=(t,r,i)=>{switch(r){case 1:return i?t=>N()[t>>>0]:t=>L()[t>>>0];case 2:return i?t=>U()[t>>>1>>>0]:t=>j()[t>>>1>>>0];case 4:return i?t=>F()[t>>>2>>>0]:t=>G()[t>>>2>>>0];case 8:return i?t=>A[t>>>3]:t=>M[t>>>3];default:throw TypeError(`invalid integer width (${r}): ${t}`)}};function eK(t,r,i){i>>>=0,eV(t>>>=0,{name:r=eF(r>>>0),fromWireType:t=>t,toWireType:function(t,r){if("bigint"!=typeof r&&"number"!=typeof r)throw r=null===r?"null":"object"==(t=typeof r)||"array"===t||"function"===t?r.toString():""+r,TypeError(`Cannot convert "${r}" to ${this.name}`);return"number"==typeof r&&(r=BigInt(r)),r},Cb:eY,readValueFromPointer:eZ(r,i,-1==r.indexOf("u")),Eb:null})}var eY=8;function eX(t,r,i,n){eV(t>>>=0,{name:r=eF(r>>>0),fromWireType:function(t){return!!t},toWireType:function(t,r){return r?i:n},Cb:eY,readValueFromPointer:function(t){return this.fromWireType(L()[t>>>0])},Eb:null})}var eQ=[],eJ=[];function e0(t){9<(t>>>=0)&&0==--eJ[t+1]&&(eJ[t]=void 0,eQ.push(t))}var e1=t=>{if(!t)throw new eH(`Cannot use deleted val. handle = ${t}`);return eJ[t]},e2=t=>{switch(t){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let r=eQ.pop()||eJ.length;return eJ[r]=t,eJ[r+1]=1,r}};function e3(t){return this.fromWireType(G()[t>>>2>>>0])}var e5={name:"emscripten::val",fromWireType:t=>{var r=e1(t);return e0(t),r},toWireType:(t,r)=>e2(r),Cb:8,readValueFromPointer:e3,Eb:null};function e4(t){return eV(t>>>0,e5)}var e8=(t,r)=>{switch(r){case 4:return function(t){return this.fromWireType(W()[t>>>2>>>0])};case 8:return function(t){return this.fromWireType(q()[t>>>3>>>0])};default:throw TypeError(`invalid float width (${r}): ${t}`)}};function e6(t,r,i){i>>>=0,eV(t>>>=0,{name:r=eF(r>>>0),fromWireType:t=>t,toWireType:(t,r)=>r,Cb:eY,readValueFromPointer:e8(r,i),Eb:null})}function e7(t,r,i,n,a){if(t>>>=0,i>>>=0,r=eF(r>>>0),-1===a&&(a=0xffffffff),a=t=>t,0===n){var s=32-8*i;a=t=>t<<s>>>s}var o=r.includes("unsigned")?function(t,r){return r>>>0}:function(t,r){return r};eV(t,{name:r,fromWireType:a,toWireType:o,Cb:eY,readValueFromPointer:eZ(r,i,0!==n),Eb:null})}function e9(t,r,i){function n(t){var r=G()[t>>>2>>>0];return t=G()[t+4>>>2>>>0],new a(N().buffer,t,r)}var a=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][r];eV(t>>>=0,{name:i=eF(i>>>0),fromWireType:n,Cb:eY,readValueFromPointer:n},{Tb:!0})}var te=(t,r,i)=>{var n=L();if(r>>>=0,0<i){var a=r;i=r+i-1;for(var s=0;s<t.length;++s){var o=t.charCodeAt(s);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&t.charCodeAt(++s)),127>=o){if(r>=i)break;n[r++>>>0]=o}else{if(2047>=o){if(r+1>=i)break;n[r++>>>0]=192|o>>6}else{if(65535>=o){if(r+2>=i)break;n[r++>>>0]=224|o>>12}else{if(r+3>=i)break;n[r++>>>0]=240|o>>18,n[r++>>>0]=128|o>>12&63}n[r++>>>0]=128|o>>6&63}n[r++>>>0]=128|63&o}}n[r>>>0]=0,t=r-a}else t=0;return t},tt=t=>{for(var r=0,i=0;i<t.length;++i){var n=t.charCodeAt(i);127>=n?r++:2047>=n?r+=2:55296<=n&&57343>=n?(r+=4,++i):r+=3}return r};function tr(t,r){eV(t>>>=0,{name:r=eF(r>>>0),fromWireType:function(t){for(var r,i=G()[t>>>2>>>0],n=t+4,a=n,s=0;s<=i;++s){var o=n+s;s!=i&&0!=L()[o>>>0]||(a=e$(a,o-a),void 0===r?r=a:(r+="\0",r+=a),a=o+1)}return rq(t),r},toWireType:function(t,r){r instanceof ArrayBuffer&&(r=new Uint8Array(r));var i="string"==typeof r;if(!(i||ArrayBuffer.isView(r)&&1==r.BYTES_PER_ELEMENT))throw new eH("Cannot pass non-string to std::string");var n=i?tt(r):r.length,a=rH(4+n+1),s=a+4;return G()[a>>>2>>>0]=n,i?te(r,s,n+1):L().set(r,s>>>0),null!==t&&t.push(rq,a),a},Cb:eY,readValueFromPointer:e3,Eb(t){rq(t)}})}var ti="u">typeof TextDecoder?new TextDecoder("utf-16le"):void 0,tn=(t,r)=>{for(var i=t>>1,n=i+r/2;!(i>=n)&&j()[i>>>0];)++i;if(32<(i<<=1)-t&&ti)return ti.decode(L().slice(t,i));for(i="",n=0;!(n>=r/2);++n){var a=U()[t+2*n>>>1>>>0];if(0==a)break;i+=String.fromCharCode(a)}return i},ta=(t,r,i)=>{if(2>(i??=0x7fffffff))return 0;var n=r;i=(i-=2)<2*t.length?i/2:t.length;for(var a=0;a<i;++a){var s=t.charCodeAt(a);U()[r>>>1>>>0]=s,r+=2}return U()[r>>>1>>>0]=0,r-n},ts=t=>2*t.length,to=(t,r)=>{for(var i=0,n="";!(i>=r/4);){var a=F()[t+4*i>>>2>>>0];if(0==a)break;++i,65536<=a?(a-=65536,n+=String.fromCharCode(55296|a>>10,56320|1023&a)):n+=String.fromCharCode(a)}return n},tl=(t,r,i)=>{if(r>>>=0,4>(i??=0x7fffffff))return 0;var n=r;i=n+i-4;for(var a=0;a<t.length;++a){var s=t.charCodeAt(a);if(55296<=s&&57343>=s&&(s=65536+((1023&s)<<10)|1023&t.charCodeAt(++a)),F()[r>>>2>>>0]=s,(r+=4)+4>i)break}return F()[r>>>2>>>0]=0,r-n},tu=t=>{for(var r=0,i=0;i<t.length;++i){var n=t.charCodeAt(i);55296<=n&&57343>=n&&++i,r+=4}return r};function th(t,r,i){if(t>>>=0,r>>>=0,i=eF(i>>>=0),2===r)var n=tn,a=ta,s=ts,o=t=>j()[t>>>1>>>0];else 4===r&&(n=to,a=tl,s=tu,o=t=>G()[t>>>2>>>0]);eV(t,{name:i,fromWireType:t=>{for(var i,a=G()[t>>>2>>>0],s=t+4,l=0;l<=a;++l){var u=t+4+l*r;l!=a&&0!=o(u)||(s=n(s,u-s),void 0===i?i=s:(i+="\0",i+=s),s=u+r)}return rq(t),i},toWireType:(t,n)=>{if("string"!=typeof n)throw new eH(`Cannot pass non-string to C++ string type ${i}`);var o=s(n),l=rH(4+o+r);return G()[l>>>2>>>0]=o/r,a(n,l+4,o+r),null!==t&&t.push(rq,l),l},Cb:eY,readValueFromPointer:e3,Eb(t){rq(t)}})}function tf(t,r){eV(t>>>=0,{Ub:!0,name:r=eF(r>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function td(t){rV(t>>>0,!o,1,!s,131072,!1),em()}var tc=t=>{if(!P)try{if(t(),!(0<ea))try{l?rX(v):eu(v)}catch(t){t instanceof et||"unwind"==t||p(0,t)}}catch(t){t instanceof et||"unwind"==t||p(0,t)}};function tp(t){t>>>=0,"function"==typeof Atomics.jc&&(Atomics.jc(F(),t>>>2,t).value.then(tm),t+=128,Atomics.store(F(),t>>>2,1))}var tm=()=>{var t=rW();t&&(tp(t),tc(rJ))};function tg(t,r){(t>>>=0)==r>>>0?setTimeout(tm):l?postMessage({Hb:t,Db:"checkMailbox"}):(t=ec[t])&&t.postMessage({Db:"checkMailbox"})}var t_=[];function tb(t,r,i,n,a){for(r>>>=0,t_.length=n/=2,i=a>>>0>>>3,a=0;a<n;a++)t_[a]=A[i+2*a]?A[i+2*a+1]:q()[i+2*a+1>>>0];return(r?rN[r]:rD[t])(...t_)}var ty=()=>{ea=0};function tv(t){t>>>=0,l?postMessage({Db:"cleanupThread",ic:t}):ep(ec[t])}function tw(t){}var tx=(t,r)=>{var i=eW[t];if(void 0===i)throw i=eF(t=rF(t)),rq(t),new eH(`${r} has unknown type ${i}`);return i},tk=(t,r,i)=>{var n=[];return t=t.toWireType(n,i),n.length&&(G()[r>>>2>>>0]=e2(n)),t};function tE(t,r,i){return r>>>=0,i>>>=0,t=e1(t>>>0),tk(r=tx(r,"emval::as"),i,t)}function tS(t,r){return r>>>=0,t=e1(t>>>0),(r=tx(r,"emval::as")).toWireType(null,t)}var t$=t=>{try{t()}catch(t){J(t)}},tI=0,tA=null,tM=0,tT=[],tC={},tz={},tR=0,tB=null,tO=[];function tP(t){return function(t){if(!P){if(0===tI){var r=!1,i=!1;t((t=0)=>{if(!P&&(tM=t,r=!0,i)){tI=2,t$(()=>r6(tA)),"u">typeof MainLoop&&MainLoop.Qb&&MainLoop.resume(),t=!1;try{var n=function(){var t=F()[tA+8>>>2>>>0];return t=rj[tz[t]],--ea,t()}()}catch(r){n=r,t=!0}var a=!1;if(!tA){var s=tB;s&&(tB=null,(t?s.reject:s.resolve)(n),a=!0)}if(t&&!a)throw n}}),i=!0,r||(tI=1,tA=function(){var t=rH(65548),r=t+12;G()[t>>>2>>>0]=r,G()[t+4>>>2>>>0]=r+65536;var i=tC[r=tT[0]];return void 0===i&&(i=tR++,tC[r]=i,tz[i]=r),r=i,F()[t+8>>>2>>>0]=r,t}(),"u">typeof MainLoop&&MainLoop.Qb&&MainLoop.pause(),t$(()=>r4(tA)))}else 2===tI?(tI=0,t$(r7),rq(tA),tA=null,tO.forEach(tc)):J(`invalid state: ${tI}`);return tM}}(r=>{t().then(r)})}function tD(t){return t>>>=0,tP(async()=>e2(await e1(t)))}var tN=[];function tL(t,r,i,n){return i>>>=0,n>>>=0,(t=tN[t>>>0])(null,r=e1(r>>>0),i,n)}var tU={},tj=t=>{var r=tU[t];return void 0===r?eF(t):r};function tF(t,r,i,n,a){return i>>>=0,n>>>=0,a>>>=0,(t=tN[t>>>0])(r=e1(r>>>0),r[i=tj(i)],n,a)}function tG(t,r){return r>>>=0,(t=e1(t>>>0))==e1(r)}var tW=()=>"object"==typeof globalThis?globalThis:Function("return this")();function tq(t){return e2(tW())}var tH=t=>{var r=tN.length;return tN.push(t),r},tV=(t,r)=>{for(var i=Array(t),n=0;n<t;++n)i[n]=tx(G()[r+4*n>>>2>>>0],`parameter ${n}`);return i};function tZ(t,r,i){var n=(r=tV(t,r>>>0)).shift();t--;var a=`return function (obj, func, destructorsRef, args) {
`,s=0,o=[];0===i&&o.push("obj");for(var l=["retType"],u=[n],h=0;h<t;++h)o.push(`arg${h}`),l.push(`argType${h}`),u.push(r[h]),a+=`  var arg${h} = argType${h}.readValueFromPointer(args${s?"+"+s:""});
`,s+=r[h].Cb;return a+=`  var rv = ${1===i?"new func":"func.call"}(${o.join(", ")});
`,n.Ub||(l.push("emval_returnValue"),u.push(tk),a+=`  return emval_returnValue(retType, destructorsRef, rv);
`),tH(Object.defineProperty(t=Function(...l,a+`};
`)(...u),"name",{value:i=`methodCaller<(${r.map(t=>t.name).join(", ")}) => ${n.name}>`}))}function tK(t){return e2(n[t=tj(t>>>0)])}function tY(t,r){return r>>>=0,e2((t=e1(t>>>0))[r=e1(r)])}function tX(t){9<(t>>>=0)&&(eJ[t+1]+=1)}function tQ(){return e2([])}function tJ(t){t=e1(t>>>0);for(var r=Array(t.length),i=0;i<t.length;i++)r[i]=t[i];return e2(r)}function t0(t){return e2(tj(t>>>0))}function t1(){return e2({})}function t2(t){for(var r=e1(t>>>=0);r.length;){var i=r.pop();r.pop()(i)}e0(t)}function t3(t,r,i){r>>>=0,i>>>=0,t=e1(t>>>0),r=e1(r),i=e1(i),t[r]=i}function t5(t,r){return r>>>=0,e2(t=(t=tx(t>>>0,"_emval_take_value")).readValueFromPointer(r))}function t4(t,r){t=-0x20000000000000>t||0x20000000000000<t?NaN:Number(t),r>>>=0,t=new Date(1e3*t),F()[r>>>2>>>0]=t.getUTCSeconds(),F()[r+4>>>2>>>0]=t.getUTCMinutes(),F()[r+8>>>2>>>0]=t.getUTCHours(),F()[r+12>>>2>>>0]=t.getUTCDate(),F()[r+16>>>2>>>0]=t.getUTCMonth(),F()[r+20>>>2>>>0]=t.getUTCFullYear()-1900,F()[r+24>>>2>>>0]=t.getUTCDay(),t=(t.getTime()-Date.UTC(t.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,F()[r+28>>>2>>>0]=t}var t8=t=>t%4==0&&(t%100!=0||t%400==0),t6=[0,31,60,91,121,152,182,213,244,274,305,335],t7=[0,31,59,90,120,151,181,212,243,273,304,334];function t9(t,r){t=-0x20000000000000>t||0x20000000000000<t?NaN:Number(t),r>>>=0,t=new Date(1e3*t),F()[r>>>2>>>0]=t.getSeconds(),F()[r+4>>>2>>>0]=t.getMinutes(),F()[r+8>>>2>>>0]=t.getHours(),F()[r+12>>>2>>>0]=t.getDate(),F()[r+16>>>2>>>0]=t.getMonth(),F()[r+20>>>2>>>0]=t.getFullYear()-1900,F()[r+24>>>2>>>0]=t.getDay();var i=(t8(t.getFullYear())?t6:t7)[t.getMonth()]+t.getDate()-1|0;F()[r+28>>>2>>>0]=i,F()[r+36>>>2>>>0]=-60*t.getTimezoneOffset(),i=new Date(t.getFullYear(),6,1).getTimezoneOffset();var n=new Date(t.getFullYear(),0,1).getTimezoneOffset();t=0|(i!=n&&t.getTimezoneOffset()==Math.min(n,i)),F()[r+32>>>2>>>0]=t}function re(t){t>>>=0;var r=new Date(F()[t+20>>>2>>>0]+1900,F()[t+16>>>2>>>0],F()[t+12>>>2>>>0],F()[t+8>>>2>>>0],F()[t+4>>>2>>>0],F()[t>>>2>>>0],0),i=F()[t+32>>>2>>>0],n=r.getTimezoneOffset(),a=new Date(r.getFullYear(),6,1).getTimezoneOffset(),s=new Date(r.getFullYear(),0,1).getTimezoneOffset(),o=Math.min(s,a);return 0>i?F()[t+32>>>2>>>0]=+(a!=s&&o==n):0<i!=(o==n)&&(a=Math.max(s,a),r.setTime(r.getTime()+6e4*((0<i?o:a)-n))),F()[t+24>>>2>>>0]=r.getDay(),i=(t8(r.getFullYear())?t6:t7)[r.getMonth()]+r.getDate()-1|0,F()[t+28>>>2>>>0]=i,F()[t>>>2>>>0]=r.getSeconds(),F()[t+4>>>2>>>0]=r.getMinutes(),F()[t+8>>>2>>>0]=r.getHours(),F()[t+12>>>2>>>0]=r.getDate(),F()[t+16>>>2>>>0]=r.getMonth(),F()[t+20>>>2>>>0]=r.getYear(),BigInt(isNaN(t=r.getTime())?-1:t/1e3)}function rt(t,r,i,n,a,s,o){return l?es(16,1,t,r,i,n,a,s,o):-52}function rr(t,r,i,n,a,s){if(l)return es(17,1,t,r,i,n,a,s)}var ri={},rn=()=>performance.timeOrigin+performance.now();function ra(t,r){if(l)return es(18,1,t,r);if(ri[t]&&(clearTimeout(ri[t].id),delete ri[t]),!r)return 0;var i=setTimeout(()=>{delete ri[t],tc(()=>rQ(t,performance.timeOrigin+performance.now()))},r);return ri[t]={id:i,rc:r},0}function rs(t,r,i,n){t>>>=0,r>>>=0,i>>>=0,n>>>=0;var a=new Date().getFullYear(),s=new Date(a,0,1).getTimezoneOffset(),o=Math.max(s,a=new Date(a,6,1).getTimezoneOffset());G()[t>>>2>>>0]=60*o,F()[r>>>2>>>0]=+(s!=a),t=(r=t=>{var r=Math.abs(t);return`UTC${0<=t?"-":"+"}${String(Math.floor(r/60)).padStart(2,"0")}${String(r%60).padStart(2,"0")}`})(s),r=r(a),a<s?(te(t,i,17),te(r,n,17)):(te(t,n,17),te(r,i,17))}var ro=()=>Date.now();function rl(t,r,i){return 0<=t&&3>=t?(t=0===t?Date.now():performance.timeOrigin+performance.now(),A[i>>>0>>>3]=BigInt(Math.round(1e6*t)),0):28}var ru=[],rh=(t,r)=>{ru.length=0;for(var i;i=L()[t++>>>0];){var n=105!=i;r+=(n&=112!=i)&&r%8?4:0,ru.push(112==i?G()[r>>>2>>>0]:106==i?A[r>>>3]:105==i?F()[r>>>2>>>0]:q()[r>>>3>>>0]),r+=n?8:4}return ru};function rf(t,r,i){return t>>>=0,r=rh(r>>>0,i>>>0),rN[t](...r)}function rd(t,r,i){return t>>>=0,r=rh(r>>>0,i>>>0),rN[t](...r)}var rc=()=>{};function rp(t,r){return O(e$(t>>>0,r>>>0))}var rm=()=>{throw ea+=1,"unwind"};function rg(){return 0xffff0000}var r_=()=>navigator.hardwareConcurrency;function rb(){return J("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function ry(t){t>>>=0;var r=L().length;if(t<=r||0xffff0000<t)return!1;for(var i=1;4>=i;i*=2){var n=r*(1+.2/i);n=Math.min(n,t+0x6000000);t:{n=(Math.min(0xffff0000,65536*Math.ceil(Math.max(t,n)/65536))-b.buffer.byteLength+65535)/65536|0;try{b.grow(n),V();var a=1;break t}catch{}a=void 0}if(a)return!0}return!1}var rv=()=>(J("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),rw={},rx=t=>{t.forEach(t=>{var r=rv();r&&(rw[r]=t)})};function rk(){var t=Error().stack.toString().split(`
`);return"Error"==t[0]&&t.shift(),rx(t),rw.Mb=rv(),rw.dc=t,rw.Mb}function rE(t,r,i){if(t>>>=0,r>>>=0,rw.Mb==t)var n=rw.dc;else"Error"==(n=Error().stack.toString().split(`
`))[0]&&n.shift(),rx(n);for(var a=3;n[a]&&rv()!=t;)++a;for(t=0;t<i&&n[t+a];++t)F()[r+4*t>>>2>>>0]=rv();return t}var rS,r$={},rI=()=>{if(!rS){var t,r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(t in r$)void 0===r$[t]?delete r[t]:r[t]=r$[t];var i=[];for(t in r)i.push(`${t}=${r[t]}`);rS=i}return rS};function rA(t,r){if(l)return es(19,1,t,r);t>>>=0,r>>>=0;var i,n=0,a=0;for(i of rI()){var s=r+n;G()[t+a>>>2>>>0]=s,n+=te(i,s,1/0)+1,a+=4}return 0}function rM(t,r){if(l)return es(20,1,t,r);t>>>=0,r>>>=0;var i=rI();for(var n of(G()[t>>>2>>>0]=i.length,t=0,i))t+=tt(n)+1;return G()[r>>>2>>>0]=t,0}function rT(t){return l?es(21,1,t):52}function rC(t,r,i,n){return l?es(22,1,t,r,i,n):52}function rz(t,r,i,n){return l?es(23,1,t,r,i,n):70}var rR=[null,[],[]];function rB(t,r,i,n){if(l)return es(24,1,t,r,i,n);r>>>=0,i>>>=0,n>>>=0;for(var a=0,s=0;s<i;s++){var o=G()[r>>>2>>>0],u=G()[r+4>>>2>>>0];r+=8;for(var h=0;h<u;h++){var f=t,d=L()[o+h>>>0],c=rR[f];0===d||10===d?((1===f?B:O)(eS(c)),c.length=0):c.push(d)}a+=u}return G()[n>>>2>>>0]=a,0}l||function(){for(var t=n.numThreads-1;t--;)e_();ei.push(()=>{Y++,function(t){l?t():Promise.all(eh.map(eg)).then(t)}(()=>Q())})}();for(var rO=Array(256),rP=0;256>rP;++rP)rO[rP]=String.fromCharCode(rP);eU=rO,eJ.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=()=>eJ.length/2-5-eQ.length,l||(b=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),V()),n.wasmBinary&&(_=n.wasmBinary),n.stackSave=()=>r3(),n.stackRestore=t=>r1(t),n.stackAlloc=t=>r2(t),n.setValue=function(t,r,i="i8"){switch(i.endsWith("*")&&(i="*"),i){case"i1":case"i8":N()[t>>>0]=r;break;case"i16":U()[t>>>1>>>0]=r;break;case"i32":F()[t>>>2>>>0]=r;break;case"i64":A[t>>>3]=BigInt(r);break;case"float":W()[t>>>2>>>0]=r;break;case"double":q()[t>>>3>>>0]=r;break;case"*":G()[t>>>2>>>0]=r;break;default:J(`invalid type for setValue: ${i}`)}},n.getValue=function(t,r="i8"){switch(r.endsWith("*")&&(r="*"),r){case"i1":case"i8":return N()[t>>>0];case"i16":return U()[t>>>1>>>0];case"i32":return F()[t>>>2>>>0];case"i64":return A[t>>>3];case"float":return W()[t>>>2>>>0];case"double":return q()[t>>>3>>>0];case"*":return G()[t>>>2>>>0];default:J(`invalid type for getValue: ${r}`)}},n.UTF8ToString=e$,n.stringToUTF8=te,n.lengthBytesUTF8=tt;var rD=[eo,el,ex,eI,eA,eM,eT,eC,ez,eR,eB,eO,eP,eD,eN,eL,rt,rr,ra,rA,rM,rT,rC,rz,rB],rN={893836:(t,r,i,a,s)=>{if(void 0===n||!n.Fb)return 1;if((t=e$(Number(t>>>0))).startsWith("./")&&(t=t.substring(2)),!(t=n.Fb.get(t)))return 2;if(r=Number(r>>>0),i=Number(i>>>0),a=Number(a>>>0),r+i>t.byteLength)return 3;try{let o=t.subarray(r,r+i);switch(s){case 0:L().set(o,a>>>0);break;case 1:n.mc?n.mc(a,o):n.cc(a,o);break;default:return 4}return 0}catch{return 4}},894660:(t,r,i)=>{n.Pb(t,L().subarray(r>>>0,r+i>>>0))},894724:()=>n.oc(),894766:t=>{n.Ob(t)},894803:()=>{n.Wb()},894834:()=>{n.Xb()},894863:()=>{n.ac()},894888:t=>n.Vb(t),894921:t=>n.Zb(t),894953:(t,r,i)=>{n.Lb(Number(t),Number(r),Number(i),!0)},895016:(t,r,i)=>{n.Lb(Number(t),Number(r),Number(i))},895073:()=>"u">typeof wasmOffsetConverter,895130:t=>{n.Ab("Abs",t,void 0)},895181:t=>{n.Ab("Neg",t,void 0)},895232:t=>{n.Ab("Floor",t,void 0)},895285:t=>{n.Ab("Ceil",t,void 0)},895337:t=>{n.Ab("Reciprocal",t,void 0)},895395:t=>{n.Ab("Sqrt",t,void 0)},895447:t=>{n.Ab("Exp",t,void 0)},895498:t=>{n.Ab("Erf",t,void 0)},895549:t=>{n.Ab("Sigmoid",t,void 0)},895604:(t,r,i)=>{n.Ab("HardSigmoid",t,{alpha:r,beta:i})},895683:t=>{n.Ab("Log",t,void 0)},895734:t=>{n.Ab("Sin",t,void 0)},895785:t=>{n.Ab("Cos",t,void 0)},895836:t=>{n.Ab("Tan",t,void 0)},895887:t=>{n.Ab("Asin",t,void 0)},895939:t=>{n.Ab("Acos",t,void 0)},895991:t=>{n.Ab("Atan",t,void 0)},896043:t=>{n.Ab("Sinh",t,void 0)},896095:t=>{n.Ab("Cosh",t,void 0)},896147:t=>{n.Ab("Asinh",t,void 0)},896200:t=>{n.Ab("Acosh",t,void 0)},896253:t=>{n.Ab("Atanh",t,void 0)},896306:t=>{n.Ab("Tanh",t,void 0)},896358:t=>{n.Ab("Not",t,void 0)},896409:(t,r,i)=>{n.Ab("Clip",t,{min:r,max:i})},896478:t=>{n.Ab("Clip",t,void 0)},896530:(t,r)=>{n.Ab("Elu",t,{alpha:r})},896588:t=>{n.Ab("Gelu",t,void 0)},896640:t=>{n.Ab("Relu",t,void 0)},896692:(t,r)=>{n.Ab("LeakyRelu",t,{alpha:r})},896756:(t,r)=>{n.Ab("ThresholdedRelu",t,{alpha:r})},896826:(t,r)=>{n.Ab("Cast",t,{to:r})},896884:t=>{n.Ab("Add",t,void 0)},896935:t=>{n.Ab("Sub",t,void 0)},896986:t=>{n.Ab("Mul",t,void 0)},897037:t=>{n.Ab("Div",t,void 0)},897088:t=>{n.Ab("Pow",t,void 0)},897139:t=>{n.Ab("Equal",t,void 0)},897192:t=>{n.Ab("Greater",t,void 0)},897247:t=>{n.Ab("GreaterOrEqual",t,void 0)},897309:t=>{n.Ab("Less",t,void 0)},897361:t=>{n.Ab("LessOrEqual",t,void 0)},897420:(t,r,i,a,s)=>{n.Ab("ReduceMean",t,{keepDims:!!r,noopWithEmptyAxes:!!i,axes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},897595:(t,r,i,a,s)=>{n.Ab("ReduceMax",t,{keepDims:!!r,noopWithEmptyAxes:!!i,axes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},897769:(t,r,i,a,s)=>{n.Ab("ReduceMin",t,{keepDims:!!r,noopWithEmptyAxes:!!i,axes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},897943:(t,r,i,a,s)=>{n.Ab("ReduceProd",t,{keepDims:!!r,noopWithEmptyAxes:!!i,axes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},898118:(t,r,i,a,s)=>{n.Ab("ReduceSum",t,{keepDims:!!r,noopWithEmptyAxes:!!i,axes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},898292:(t,r,i,a,s)=>{n.Ab("ReduceL1",t,{keepDims:!!r,noopWithEmptyAxes:!!i,axes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},898465:(t,r,i,a,s)=>{n.Ab("ReduceL2",t,{keepDims:!!r,noopWithEmptyAxes:!!i,axes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},898638:(t,r,i,a,s)=>{n.Ab("ReduceLogSum",t,{keepDims:!!r,noopWithEmptyAxes:!!i,axes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},898815:(t,r,i,a,s)=>{n.Ab("ReduceSumSquare",t,{keepDims:!!r,noopWithEmptyAxes:!!i,axes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},898995:(t,r,i,a,s)=>{n.Ab("ReduceLogSumExp",t,{keepDims:!!r,noopWithEmptyAxes:!!i,axes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},899175:t=>{n.Ab("Where",t,void 0)},899228:(t,r,i)=>{n.Ab("Transpose",t,{perm:r?Array.from(F().subarray(Number(r)>>>0,Number(i)>>>0)):[]})},899352:(t,r,i,a)=>{n.Ab("DepthToSpace",t,{blocksize:r,mode:e$(i),format:a?"NHWC":"NCHW"})},899485:(t,r,i,a)=>{n.Ab("DepthToSpace",t,{blocksize:r,mode:e$(i),format:a?"NHWC":"NCHW"})},899618:(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g)=>{n.Ab("ConvTranspose",t,{format:h?"NHWC":"NCHW",autoPad:r,dilations:[i],group:a,kernelShape:[s],pads:[o,l],strides:[u],wIsConst:()=>!!N()[f>>>0],outputPadding:d?Array.from(F().subarray(Number(d)>>>0,Number(c)>>>0)):[],outputShape:p?Array.from(F().subarray(Number(p)>>>0,Number(m)>>>0)):[],activation:e$(g)})},900051:(t,r,i,a,s,o,l,u,h,f,d,c,p,m)=>{n.Ab("ConvTranspose",t,{format:u?"NHWC":"NCHW",autoPad:r,dilations:Array.from(F().subarray(Number(i)>>>0,2+(Number(i)>>>0)>>>0)),group:a,kernelShape:Array.from(F().subarray(Number(s)>>>0,2+(Number(s)>>>0)>>>0)),pads:Array.from(F().subarray(Number(o)>>>0,4+(Number(o)>>>0)>>>0)),strides:Array.from(F().subarray(Number(l)>>>0,2+(Number(l)>>>0)>>>0)),wIsConst:()=>!!N()[h>>>0],outputPadding:f?Array.from(F().subarray(Number(f)>>>0,Number(d)>>>0)):[],outputShape:c?Array.from(F().subarray(Number(c)>>>0,Number(p)>>>0)):[],activation:e$(m)})},900712:(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g)=>{n.Ab("ConvTranspose",t,{format:h?"NHWC":"NCHW",autoPad:r,dilations:[i],group:a,kernelShape:[s],pads:[o,l],strides:[u],wIsConst:()=>!!N()[f>>>0],outputPadding:d?Array.from(F().subarray(Number(d)>>>0,Number(c)>>>0)):[],outputShape:p?Array.from(F().subarray(Number(p)>>>0,Number(m)>>>0)):[],activation:e$(g)})},901145:(t,r,i,a,s,o,l,u,h,f,d,c,p,m)=>{n.Ab("ConvTranspose",t,{format:u?"NHWC":"NCHW",autoPad:r,dilations:Array.from(F().subarray(Number(i)>>>0,2+(Number(i)>>>0)>>>0)),group:a,kernelShape:Array.from(F().subarray(Number(s)>>>0,2+(Number(s)>>>0)>>>0)),pads:Array.from(F().subarray(Number(o)>>>0,4+(Number(o)>>>0)>>>0)),strides:Array.from(F().subarray(Number(l)>>>0,2+(Number(l)>>>0)>>>0)),wIsConst:()=>!!N()[h>>>0],outputPadding:f?Array.from(F().subarray(Number(f)>>>0,Number(d)>>>0)):[],outputShape:c?Array.from(F().subarray(Number(c)>>>0,Number(p)>>>0)):[],activation:e$(m)})},901806:(t,r)=>{n.Ab("GlobalAveragePool",t,{format:r?"NHWC":"NCHW"})},901897:(t,r,i,a,s,o,l,u,h,f,d,c,p,m)=>{n.Ab("AveragePool",t,{format:m?"NHWC":"NCHW",auto_pad:r,ceil_mode:i,count_include_pad:a,storage_order:s,dilations:o?Array.from(F().subarray(Number(o)>>>0,Number(l)>>>0)):[],kernel_shape:u?Array.from(F().subarray(Number(u)>>>0,Number(h)>>>0)):[],pads:f?Array.from(F().subarray(Number(f)>>>0,Number(d)>>>0)):[],strides:c?Array.from(F().subarray(Number(c)>>>0,Number(p)>>>0)):[]})},902376:(t,r)=>{n.Ab("GlobalAveragePool",t,{format:r?"NHWC":"NCHW"})},902467:(t,r,i,a,s,o,l,u,h,f,d,c,p,m)=>{n.Ab("AveragePool",t,{format:m?"NHWC":"NCHW",auto_pad:r,ceil_mode:i,count_include_pad:a,storage_order:s,dilations:o?Array.from(F().subarray(Number(o)>>>0,Number(l)>>>0)):[],kernel_shape:u?Array.from(F().subarray(Number(u)>>>0,Number(h)>>>0)):[],pads:f?Array.from(F().subarray(Number(f)>>>0,Number(d)>>>0)):[],strides:c?Array.from(F().subarray(Number(c)>>>0,Number(p)>>>0)):[]})},902946:(t,r)=>{n.Ab("GlobalMaxPool",t,{format:r?"NHWC":"NCHW"})},903033:(t,r,i,a,s,o,l,u,h,f,d,c,p,m)=>{n.Ab("MaxPool",t,{format:m?"NHWC":"NCHW",auto_pad:r,ceil_mode:i,count_include_pad:a,storage_order:s,dilations:o?Array.from(F().subarray(Number(o)>>>0,Number(l)>>>0)):[],kernel_shape:u?Array.from(F().subarray(Number(u)>>>0,Number(h)>>>0)):[],pads:f?Array.from(F().subarray(Number(f)>>>0,Number(d)>>>0)):[],strides:c?Array.from(F().subarray(Number(c)>>>0,Number(p)>>>0)):[]})},903508:(t,r)=>{n.Ab("GlobalMaxPool",t,{format:r?"NHWC":"NCHW"})},903595:(t,r,i,a,s,o,l,u,h,f,d,c,p,m)=>{n.Ab("MaxPool",t,{format:m?"NHWC":"NCHW",auto_pad:r,ceil_mode:i,count_include_pad:a,storage_order:s,dilations:o?Array.from(F().subarray(Number(o)>>>0,Number(l)>>>0)):[],kernel_shape:u?Array.from(F().subarray(Number(u)>>>0,Number(h)>>>0)):[],pads:f?Array.from(F().subarray(Number(f)>>>0,Number(d)>>>0)):[],strides:c?Array.from(F().subarray(Number(c)>>>0,Number(p)>>>0)):[]})},904070:(t,r,i,a,s)=>{n.Ab("Gemm",t,{alpha:r,beta:i,transA:a,transB:s})},904174:t=>{n.Ab("MatMul",t,void 0)},904228:(t,r,i,a)=>{n.Ab("ArgMax",t,{keepDims:!!r,selectLastIndex:!!i,axis:a})},904336:(t,r,i,a)=>{n.Ab("ArgMin",t,{keepDims:!!r,selectLastIndex:!!i,axis:a})},904444:(t,r)=>{n.Ab("Softmax",t,{axis:r})},904507:(t,r)=>{n.Ab("Concat",t,{axis:r})},904567:(t,r,i,a,s)=>{n.Ab("Split",t,{axis:r,numOutputs:i,splitSizes:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},904723:t=>{n.Ab("Expand",t,void 0)},904777:(t,r)=>{n.Ab("Gather",t,{axis:Number(r)})},904848:(t,r)=>{n.Ab("GatherElements",t,{axis:Number(r)})},904927:(t,r)=>{n.Ab("GatherND",t,{batch_dims:Number(r)})},905006:(t,r,i,a,s,o,l,u,h,f,d)=>{n.Ab("Resize",t,{antialias:r,axes:i?Array.from(F().subarray(Number(i)>>>0,Number(a)>>>0)):[],coordinateTransformMode:e$(s),cubicCoeffA:o,excludeOutside:l,extrapolationValue:u,keepAspectRatioPolicy:e$(h),mode:e$(f),nearestMode:e$(d)})},905368:(t,r,i,a,s,o,l)=>{n.Ab("Slice",t,{starts:r?Array.from(F().subarray(Number(r)>>>0,Number(i)>>>0)):[],ends:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[],axes:o?Array.from(F().subarray(Number(o)>>>0,Number(l)>>>0)):[]})},905632:t=>{n.Ab("Tile",t,void 0)},905684:(t,r,i)=>{n.Ab("InstanceNormalization",t,{epsilon:r,format:i?"NHWC":"NCHW"})},905798:(t,r,i)=>{n.Ab("InstanceNormalization",t,{epsilon:r,format:i?"NHWC":"NCHW"})},905912:t=>{n.Ab("Range",t,void 0)},905965:(t,r)=>{n.Ab("Einsum",t,{equation:e$(r)})},906046:(t,r,i,a,s)=>{n.Ab("Pad",t,{mode:r,value:i,pads:a?Array.from(F().subarray(Number(a)>>>0,Number(s)>>>0)):[]})},906189:(t,r,i,a,s,o)=>{n.Ab("BatchNormalization",t,{epsilon:r,momentum:i,spatial:!!s,trainingMode:!!a,format:o?"NHWC":"NCHW"})},906358:(t,r,i,a,s,o)=>{n.Ab("BatchNormalization",t,{epsilon:r,momentum:i,spatial:!!s,trainingMode:!!a,format:o?"NHWC":"NCHW"})},906527:(t,r,i)=>{n.Ab("CumSum",t,{exclusive:Number(r),reverse:Number(i)})},906624:(t,r,i)=>{n.Ab("DequantizeLinear",t,{axis:r,blockSize:i})},906714:(t,r,i,a,s)=>{n.Ab("GridSample",t,{align_corners:r,mode:e$(i),padding_mode:e$(a),format:s?"NHWC":"NCHW"})},906884:(t,r,i,a,s)=>{n.Ab("GridSample",t,{align_corners:r,mode:e$(i),padding_mode:e$(a),format:s?"NHWC":"NCHW"})},907054:(t,r)=>{n.Ab("ScatterND",t,{reduction:e$(r)})},907139:(t,r,i,a,s,o,l,u,h)=>{n.Ab("Attention",t,{numHeads:r,isUnidirectional:i,maskFilterValue:a,scale:s,doRotary:o,qkvHiddenSizes:l?Array.from(F().subarray(Number(u)>>>0,Number(u)+l>>>0)):[],pastPresentShareBuffer:!!h})},907411:t=>{n.Ab("BiasAdd",t,void 0)},907466:t=>{n.Ab("BiasSplitGelu",t,void 0)},907527:t=>{n.Ab("FastGelu",t,void 0)},907583:(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_)=>{n.Ab("Conv",t,{format:c?"NHWC":"NCHW",auto_pad:r,dilations:i?Array.from(F().subarray(Number(i)>>>0,Number(a)>>>0)):[],group:s,kernel_shape:o?Array.from(F().subarray(Number(o)>>>0,Number(l)>>>0)):[],pads:u?Array.from(F().subarray(Number(u)>>>0,Number(h)>>>0)):[],strides:f?Array.from(F().subarray(Number(f)>>>0,Number(d)>>>0)):[],w_is_const:()=>!!N()[Number(p)>>>0],activation:e$(m),activation_params:g?Array.from(W().subarray(Number(g)>>>0,Number(_)>>>0)):[]})},908167:t=>{n.Ab("Gelu",t,void 0)},908219:(t,r,i,a,s,o,l,u,h)=>{n.Ab("GroupQueryAttention",t,{numHeads:r,kvNumHeads:i,scale:a,softcap:s,doRotary:o,rotaryInterleaved:l,smoothSoftmax:u,localWindowSize:h})},908436:(t,r,i,a)=>{n.Ab("LayerNormalization",t,{axis:r,epsilon:i,simplified:!!a})},908547:(t,r,i,a)=>{n.Ab("LayerNormalization",t,{axis:r,epsilon:i,simplified:!!a})},908658:(t,r,i,a,s,o)=>{n.Ab("MatMulNBits",t,{k:r,n:i,accuracyLevel:a,bits:s,blockSize:o})},908785:(t,r,i,a,s,o)=>{n.Ab("MultiHeadAttention",t,{numHeads:r,isUnidirectional:i,maskFilterValue:a,scale:s,doRotary:o})},908944:(t,r)=>{n.Ab("QuickGelu",t,{alpha:r})},909008:(t,r,i,a,s)=>{n.Ab("RotaryEmbedding",t,{interleaved:!!r,numHeads:i,rotaryEmbeddingDim:a,scale:s})},909147:(t,r,i)=>{n.Ab("SkipLayerNormalization",t,{epsilon:r,simplified:!!i})},909249:(t,r,i)=>{n.Ab("SkipLayerNormalization",t,{epsilon:r,simplified:!!i})},909351:(t,r,i,a)=>{n.Ab("GatherBlockQuantized",t,{gatherAxis:r,quantizeAxis:i,blockSize:a})},909472:t=>{n.$b(t)},909506:(t,r)=>n.bc(Number(t),Number(r),n.Gb.ec,n.Gb.errors)};function rL(t,r,i){return tP(async()=>{await n.Yb(Number(t),Number(r),Number(i))})}function rU(){return"u">typeof wasmOffsetConverter}var rj=await async function(){function t(t,r){return rj=t.exports,rj=function(){var t={};for(let[r,i]of Object.entries(rj))t[r]="function"==typeof i?(...t)=>{tT.push(r);try{return i(...t)}finally{P||(tT.pop(),tA&&1===tI&&0===tT.length&&(tI=0,ea+=1,t$(r8),"u">typeof Fibers&&Fibers.sc()))}}:i;return t}(),rj=function(){var t=rj,r=t=>r=>t(r)>>>0,i=t=>()=>t()>>>0;return(t=Object.assign({},t)).Ea=r(t.Ea),t.gb=i(t.gb),t.ib=r(t.ib),t.tb=r(t.tb),t.ub=i(t.ub),t.__cxa_get_exception_ptr=r(t.__cxa_get_exception_ptr),t}(),ed.push(rj.jb),y=r,Q(),rj}Y++;var r=ee();if(n.instantiateWasm)return new Promise(i=>{n.instantiateWasm(r,(r,n)=>{i(t(r,n))})});if(l)return new Promise(r=>{C=i=>{r(t(new WebAssembly.Instance(i,ee()),i))}});K??=n.locateFile?n.locateFile?n.locateFile("ort-wasm-simd-threaded.jsep.wasm",g):g+"ort-wasm-simd-threaded.jsep.wasm":new __turbopack_context__.U(__turbopack_context__.r(3789)).href;try{var a=await async function(t){var r=K;if(!_&&"function"==typeof WebAssembly.instantiateStreaming&&!D(r))try{var i=fetch(r,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(i,t)}catch(t){O(`wasm streaming compile failed: ${t}`),O("falling back to ArrayBuffer instantiation")}return async function(t,r){try{var i=await async function(t){if(!_)try{var r=await d(t);return new Uint8Array(r)}catch{}if(t==K&&_)t=new Uint8Array(_);else{if(!c)throw"both async and sync fetching of the wasm failed";t=c(t)}return t}(t);return await WebAssembly.instantiate(i,r)}catch(t){O(`failed to asynchronously prepare wasm: ${t}`),J(t)}}(r,t)}(r);return t(a.instance,a.module)}catch(t){return i(t),Promise.reject(t)}}(),rF=t=>(rF=rj.Ea)(t),rG=()=>(rG=rj.Fa)();n._OrtInit=(t,r)=>(n._OrtInit=rj.Ga)(t,r),n._OrtGetLastError=(t,r)=>(n._OrtGetLastError=rj.Ha)(t,r),n._OrtCreateSessionOptions=(t,r,i,a,s,o,l,u,h,f)=>(n._OrtCreateSessionOptions=rj.Ia)(t,r,i,a,s,o,l,u,h,f),n._OrtAppendExecutionProvider=(t,r,i,a,s)=>(n._OrtAppendExecutionProvider=rj.Ja)(t,r,i,a,s),n._OrtAddFreeDimensionOverride=(t,r,i)=>(n._OrtAddFreeDimensionOverride=rj.Ka)(t,r,i),n._OrtAddSessionConfigEntry=(t,r,i)=>(n._OrtAddSessionConfigEntry=rj.La)(t,r,i),n._OrtReleaseSessionOptions=t=>(n._OrtReleaseSessionOptions=rj.Ma)(t),n._OrtCreateSession=(t,r,i)=>(n._OrtCreateSession=rj.Na)(t,r,i),n._OrtReleaseSession=t=>(n._OrtReleaseSession=rj.Oa)(t),n._OrtGetInputOutputCount=(t,r,i)=>(n._OrtGetInputOutputCount=rj.Pa)(t,r,i),n._OrtGetInputOutputMetadata=(t,r,i,a)=>(n._OrtGetInputOutputMetadata=rj.Qa)(t,r,i,a),n._OrtFree=t=>(n._OrtFree=rj.Ra)(t),n._OrtCreateTensor=(t,r,i,a,s,o)=>(n._OrtCreateTensor=rj.Sa)(t,r,i,a,s,o),n._OrtGetTensorData=(t,r,i,a,s)=>(n._OrtGetTensorData=rj.Ta)(t,r,i,a,s),n._OrtReleaseTensor=t=>(n._OrtReleaseTensor=rj.Ua)(t),n._OrtCreateRunOptions=(t,r,i,a)=>(n._OrtCreateRunOptions=rj.Va)(t,r,i,a),n._OrtAddRunConfigEntry=(t,r,i)=>(n._OrtAddRunConfigEntry=rj.Wa)(t,r,i),n._OrtReleaseRunOptions=t=>(n._OrtReleaseRunOptions=rj.Xa)(t),n._OrtCreateBinding=t=>(n._OrtCreateBinding=rj.Ya)(t),n._OrtBindInput=(t,r,i)=>(n._OrtBindInput=rj.Za)(t,r,i),n._OrtBindOutput=(t,r,i,a)=>(n._OrtBindOutput=rj._a)(t,r,i,a),n._OrtClearBoundOutputs=t=>(n._OrtClearBoundOutputs=rj.$a)(t),n._OrtReleaseBinding=t=>(n._OrtReleaseBinding=rj.ab)(t),n._OrtRunWithBinding=(t,r,i,a,s)=>(n._OrtRunWithBinding=rj.bb)(t,r,i,a,s),n._OrtRun=(t,r,i,a,s,o,l,u)=>(n._OrtRun=rj.cb)(t,r,i,a,s,o,l,u),n._OrtEndProfiling=t=>(n._OrtEndProfiling=rj.db)(t),n._JsepOutput=(t,r,i)=>(n._JsepOutput=rj.eb)(t,r,i),n._JsepGetNodeName=t=>(n._JsepGetNodeName=rj.fb)(t);var rW=()=>(rW=rj.gb)(),rq=n._free=t=>(rq=n._free=rj.hb)(t),rH=n._malloc=t=>(rH=n._malloc=rj.ib)(t),rV=(t,r,i,n,a,s)=>(rV=rj.kb)(t,r,i,n,a,s),rZ=()=>(rZ=rj.lb)(),rK=(t,r,i,n,a)=>(rK=rj.mb)(t,r,i,n,a),rY=t=>(rY=rj.nb)(t),rX=t=>(rX=rj.ob)(t),rQ=(t,r)=>(rQ=rj.pb)(t,r),rJ=()=>(rJ=rj.qb)(),r0=(t,r)=>(r0=rj.rb)(t,r),r1=t=>(r1=rj.sb)(t),r2=t=>(r2=rj.tb)(t),r3=()=>(r3=rj.ub)(),r5=n.dynCall_ii=(t,r)=>(r5=n.dynCall_ii=rj.vb)(t,r);n.dynCall_vii=(t,r,i)=>(n.dynCall_vii=rj.dynCall_vii)(t,r,i),n.dynCall_iiiii=(t,r,i,a,s)=>(n.dynCall_iiiii=rj.dynCall_iiiii)(t,r,i,a,s),n.dynCall_iii=(t,r,i)=>(n.dynCall_iii=rj.dynCall_iii)(t,r,i),n.dynCall_iiiiii=(t,r,i,a,s,o)=>(n.dynCall_iiiiii=rj.dynCall_iiiiii)(t,r,i,a,s,o),n.dynCall_iiiiiiii=(t,r,i,a,s,o,l,u)=>(n.dynCall_iiiiiiii=rj.dynCall_iiiiiiii)(t,r,i,a,s,o,l,u),n.dynCall_iiiiiii=(t,r,i,a,s,o,l)=>(n.dynCall_iiiiiii=rj.dynCall_iiiiiii)(t,r,i,a,s,o,l),n.dynCall_vi=(t,r)=>(n.dynCall_vi=rj.dynCall_vi)(t,r),n.dynCall_iiii=(t,r,i,a)=>(n.dynCall_iiii=rj.dynCall_iiii)(t,r,i,a),n.dynCall_i=t=>(n.dynCall_i=rj.dynCall_i)(t),n.dynCall_viiiiiiii=(t,r,i,a,s,o,l,u,h)=>(n.dynCall_viiiiiiii=rj.dynCall_viiiiiiii)(t,r,i,a,s,o,l,u,h),n.dynCall_viii=(t,r,i,a)=>(n.dynCall_viii=rj.dynCall_viii)(t,r,i,a),n.dynCall_viijj=(t,r,i,a,s)=>(n.dynCall_viijj=rj.dynCall_viijj)(t,r,i,a,s),n.dynCall_viiiiii=(t,r,i,a,s,o,l)=>(n.dynCall_viiiiii=rj.dynCall_viiiiii)(t,r,i,a,s,o,l),n.dynCall_viiii=(t,r,i,a,s)=>(n.dynCall_viiii=rj.dynCall_viiii)(t,r,i,a,s),n.dynCall_viiiii=(t,r,i,a,s,o)=>(n.dynCall_viiiii=rj.dynCall_viiiii)(t,r,i,a,s,o),n.dynCall_vfiii=(t,r,i,a,s)=>(n.dynCall_vfiii=rj.dynCall_vfiii)(t,r,i,a,s),n.dynCall_viiiiff=(t,r,i,a,s,o,l)=>(n.dynCall_viiiiff=rj.dynCall_viiiiff)(t,r,i,a,s,o,l),n.dynCall_viiiiiff=(t,r,i,a,s,o,l,u)=>(n.dynCall_viiiiiff=rj.dynCall_viiiiiff)(t,r,i,a,s,o,l,u),n.dynCall_ffff=(t,r,i,a)=>(n.dynCall_ffff=rj.dynCall_ffff)(t,r,i,a),n.dynCall_viiff=(t,r,i,a,s)=>(n.dynCall_viiff=rj.dynCall_viiff)(t,r,i,a,s),n.dynCall_fffffff=(t,r,i,a,s,o,l)=>(n.dynCall_fffffff=rj.dynCall_fffffff)(t,r,i,a,s,o,l),n.dynCall_jjjjjjj=(t,r,i,a,s,o,l)=>(n.dynCall_jjjjjjj=rj.dynCall_jjjjjjj)(t,r,i,a,s,o,l),n.dynCall_jjjjjj=(t,r,i,a,s,o)=>(n.dynCall_jjjjjj=rj.dynCall_jjjjjj)(t,r,i,a,s,o),n.dynCall_iijjii=(t,r,i,a,s,o)=>(n.dynCall_iijjii=rj.dynCall_iijjii)(t,r,i,a,s,o),n.dynCall_viiiiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c,p,m)=>(n.dynCall_viiiiiiiiiiiii=rj.dynCall_viiiiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c,p,m),n.dynCall_viiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d)=>(n.dynCall_viiiiiiiiii=rj.dynCall_viiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d),n.dynCall_viiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c)=>(n.dynCall_viiiiiiiiiii=rj.dynCall_viiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c),n.dynCall_viiiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c,p)=>(n.dynCall_viiiiiiiiiiii=rj.dynCall_viiiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c,p),n.dynCall_viiiiiiiiiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_,b,y,v)=>(n.dynCall_viiiiiiiiiiiiiiiiii=rj.dynCall_viiiiiiiiiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_,b,y,v),n.dynCall_viiiiiiiii=(t,r,i,a,s,o,l,u,h,f)=>(n.dynCall_viiiiiiiii=rj.dynCall_viiiiiiiii)(t,r,i,a,s,o,l,u,h,f),n.dynCall_viiiiiiiiiiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_,b,y,v,w)=>(n.dynCall_viiiiiiiiiiiiiiiiiii=rj.dynCall_viiiiiiiiiiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_,b,y,v,w),n.dynCall_viiiiiii=(t,r,i,a,s,o,l,u)=>(n.dynCall_viiiiiii=rj.dynCall_viiiiiii)(t,r,i,a,s,o,l,u),n.dynCall_viiiiiiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_)=>(n.dynCall_viiiiiiiiiiiiiii=rj.dynCall_viiiiiiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_),n.dynCall_jiji=(t,r,i,a)=>(n.dynCall_jiji=rj.dynCall_jiji)(t,r,i,a),n.dynCall_v=t=>(n.dynCall_v=rj.dynCall_v)(t),n.dynCall_iidiiii=(t,r,i,a,s,o,l)=>(n.dynCall_iidiiii=rj.dynCall_iidiiii)(t,r,i,a,s,o,l),n.dynCall_iiiiiiiii=(t,r,i,a,s,o,l,u,h)=>(n.dynCall_iiiiiiiii=rj.dynCall_iiiiiiiii)(t,r,i,a,s,o,l,u,h),n.dynCall_iiij=(t,r,i,a)=>(n.dynCall_iiij=rj.dynCall_iiij)(t,r,i,a),n.dynCall_iiiiiiiiii=(t,r,i,a,s,o,l,u,h,f)=>(n.dynCall_iiiiiiiiii=rj.dynCall_iiiiiiiiii)(t,r,i,a,s,o,l,u,h,f),n.dynCall_iiiiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c,p)=>(n.dynCall_iiiiiiiiiiiii=rj.dynCall_iiiiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c,p),n.dynCall_iiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d)=>(n.dynCall_iiiiiiiiiii=rj.dynCall_iiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d),n.dynCall_ji=(t,r)=>(n.dynCall_ji=rj.dynCall_ji)(t,r),n.dynCall_iijii=(t,r,i,a,s)=>(n.dynCall_iijii=rj.dynCall_iijii)(t,r,i,a,s),n.dynCall_vij=(t,r,i)=>(n.dynCall_vij=rj.dynCall_vij)(t,r,i),n.dynCall_viiijii=(t,r,i,a,s,o,l)=>(n.dynCall_viiijii=rj.dynCall_viiijii)(t,r,i,a,s,o,l),n.dynCall_viijiiiiiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_,b,y)=>(n.dynCall_viijiiiiiiiiiiiiii=rj.dynCall_viijiiiiiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_,b,y),n.dynCall_viiiji=(t,r,i,a,s,o)=>(n.dynCall_viiiji=rj.dynCall_viiiji)(t,r,i,a,s,o),n.dynCall_fiii=(t,r,i,a)=>(n.dynCall_fiii=rj.dynCall_fiii)(t,r,i,a),n.dynCall_viijii=(t,r,i,a,s,o)=>(n.dynCall_viijii=rj.dynCall_viijii)(t,r,i,a,s,o),n.dynCall_viij=(t,r,i,a)=>(n.dynCall_viij=rj.dynCall_viij)(t,r,i,a),n.dynCall_jiij=(t,r,i,a)=>(n.dynCall_jiij=rj.dynCall_jiij)(t,r,i,a),n.dynCall_fi=(t,r)=>(n.dynCall_fi=rj.dynCall_fi)(t,r),n.dynCall_fii=(t,r,i)=>(n.dynCall_fii=rj.dynCall_fii)(t,r,i),n.dynCall_jii=(t,r,i)=>(n.dynCall_jii=rj.dynCall_jii)(t,r,i),n.dynCall_dii=(t,r,i)=>(n.dynCall_dii=rj.dynCall_dii)(t,r,i),n.dynCall_fiiii=(t,r,i,a,s)=>(n.dynCall_fiiii=rj.dynCall_fiiii)(t,r,i,a,s),n.dynCall_fif=(t,r,i)=>(n.dynCall_fif=rj.dynCall_fif)(t,r,i),n.dynCall_jfi=(t,r,i)=>(n.dynCall_jfi=rj.dynCall_jfi)(t,r,i),n.dynCall_viiiiiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g)=>(n.dynCall_viiiiiiiiiiiiii=rj.dynCall_viiiiiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g),n.dynCall_viiiiiiiiiiiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_,b,y,v,w,x)=>(n.dynCall_viiiiiiiiiiiiiiiiiiii=rj.dynCall_viiiiiiiiiiiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_,b,y,v,w,x),n.dynCall_viiiiiiiiiiiiiiii=(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_,b)=>(n.dynCall_viiiiiiiiiiiiiiii=rj.dynCall_viiiiiiiiiiiiiiii)(t,r,i,a,s,o,l,u,h,f,d,c,p,m,g,_,b),n.dynCall_iif=(t,r,i)=>(n.dynCall_iif=rj.dynCall_iif)(t,r,i),n.dynCall_jiiii=(t,r,i,a,s)=>(n.dynCall_jiiii=rj.dynCall_jiiii)(t,r,i,a,s),n.dynCall_jiii=(t,r,i,a)=>(n.dynCall_jiii=rj.dynCall_jiii)(t,r,i,a),n.dynCall_viif=(t,r,i,a)=>(n.dynCall_viif=rj.dynCall_viif)(t,r,i,a),n.dynCall_viiij=(t,r,i,a,s)=>(n.dynCall_viiij=rj.dynCall_viiij)(t,r,i,a,s),n.dynCall_viiiijii=(t,r,i,a,s,o,l,u)=>(n.dynCall_viiiijii=rj.dynCall_viiiijii)(t,r,i,a,s,o,l,u),n.dynCall_iiiiij=(t,r,i,a,s,o)=>(n.dynCall_iiiiij=rj.dynCall_iiiiij)(t,r,i,a,s,o),n.dynCall_iiiiid=(t,r,i,a,s,o)=>(n.dynCall_iiiiid=rj.dynCall_iiiiid)(t,r,i,a,s,o),n.dynCall_iiiiijj=(t,r,i,a,s,o,l)=>(n.dynCall_iiiiijj=rj.dynCall_iiiiijj)(t,r,i,a,s,o,l),n.dynCall_iiiiiijj=(t,r,i,a,s,o,l,u)=>(n.dynCall_iiiiiijj=rj.dynCall_iiiiiijj)(t,r,i,a,s,o,l,u);var r4=t=>(r4=rj.wb)(t),r8=()=>(r8=rj.xb)(),r6=t=>(r6=rj.yb)(t),r7=()=>(r7=rj.zb)();return function t(){if(0<Y)X=t;else if(l)r(n),Z();else{for(;0<ei.length;)ei.shift()(n);0<Y?X=t:(n.calledRun=!0,P||(Z(),r(n)))}}(),n.PTR_SIZE=4,a},globalThis.self?.name?.startsWith("em-pthread")&&Ea()}),Tr=L1(()=>{Sr(),Da=typeof location>"u"?void 0:location.origin,Yn=__TURBOPACK__import$2e$meta__.url>"file:"&&__TURBOPACK__import$2e$meta__.url<"file;",Le=Yn?(URL,new URL(new __turbopack_context__.U(__turbopack_context__.r(19489)).href,Da).href):__TURBOPACK__import$2e$meta__.url,Ba=()=>{if(Le&&!Le.startsWith("blob:"))return Le.substring(0,Le.lastIndexOf("/")+1)},Qn=(t,r)=>{try{let i=r??Le;return(i?new URL(t,i):new URL(t)).origin===Da}catch{return!1}},Jp=(t,r)=>{let i=r??Le;try{return(i?new URL(t,i):new URL(t)).href}catch{return}},em=(t,r)=>`${r??"./"}${t}`,Ma=async t=>{let r=await (await fetch(t,{credentials:"same-origin"})).blob();return URL.createObjectURL(r)},tm=async t=>(await import(t)).default,Oa=(Aa(),Xt(Ia)).default,Ra=async()=>{if(!Le)throw Error("Failed to load proxy worker: cannot determine the script source URL.");if(Qn(Le))return[void 0,Oa()];let t=await Ma(Le);return[t,Oa(t)]},za=(Pa(),Xt(ka)).default,Ua=async(t,r,i,n)=>{let a=za&&!(t||r);if(a)if(Le)a=Qn(Le);else if(n&&!i)a=!0;else throw Error("cannot determine the script source URL.");if(a)return[void 0,za];{let n="ort-wasm-simd-threaded.jsep.mjs",a=t??Jp(n,r),s=i&&a&&!Qn(a,r),o=s?await Ma(a):a??em(n,r);return[s?o:void 0,await tm(o)]}}}),$t=L1(()=>{Tr(),Jn=!1,Dr=!1,Na=!1,rm=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return"u">typeof MessageChannel&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},nm=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},om=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},Cr=async t=>{if(Jn)return Promise.resolve();if(Dr)throw Error("multiple calls to 'initializeWebAssembly()' detected.");if(Na)throw Error("previous call to 'initializeWebAssembly()' failed.");Dr=!0;let r=t.initTimeout,i=t.numThreads;if(!1!==t.simd){if("relaxed"===t.simd){if(!om())throw Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!nm())throw Error("WebAssembly SIMD is not supported in the current environment.")}let n=rm();i>1&&!n&&("u">typeof self&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+i+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),t.numThreads=i=1);let a=t.wasmPaths,s="string"==typeof a?a:void 0,o=a?.mjs,l=o?.href??o,u=a?.wasm,h=u?.href??u,f=t.wasmBinary,[d,c]=await Ua(l,s,i>1,!!f||!!h),p=!1,m=[];if(r>0&&m.push(new Promise(t=>{setTimeout(()=>{p=!0,t()},r)})),m.push(new Promise((t,r)=>{let n={numThreads:i};if(f)n.wasmBinary=f;else if(h||s)n.locateFile=t=>h??s+t;else if(l&&0!==l.indexOf("blob:"))n.locateFile=t=>new URL(t,l).href;else if(d){let t=Ba();t&&(n.locateFile=r=>t+r)}c(n).then(r=>{Dr=!1,Jn=!0,Xn=r,t(),d&&URL.revokeObjectURL(d)},t=>{Dr=!1,Na=!0,r(t)})})),await Promise.race(m),p)throw Error(`WebAssembly backend initializing failed due to timeout: ${r}ms`)},_e=()=>{if(Jn&&Xn)return Xn;throw Error("WebAssembly is not initialized yet.")}}),Br=L1(()=>{$t(),We=(t,r)=>{let i=_e(),n=i.lengthBytesUTF8(t)+1,a=i._malloc(n);return i.stringToUTF8(t,a,n),r.push(a),a},tr=(t,r,i,n)=>{if("object"==typeof t&&null!==t){if(i.has(t))throw Error("Circular reference in options");i.add(t)}Object.entries(t).forEach(([t,a])=>{let s=r?r+t:t;if("object"==typeof a)tr(a,s+".",i,n);else if("string"==typeof a||"number"==typeof a)n(s,a.toString());else if("boolean"==typeof a)n(s,a?"1":"0");else throw Error(`Can't handle extra config type: ${typeof a}`)})},ye=t=>{let r=_e(),i=r.stackSave();try{let i=r.PTR_SIZE,n=r.stackAlloc(2*i);r._OrtGetLastError(n,n+i);let a=Number(r.getValue(n,4===i?"i32":"i64")),s=r.getValue(n+i,"*"),o=s?r.UTF8ToString(s):"";throw Error(`${t} ERROR_CODE: ${a}, ERROR_MESSAGE: ${o}`)}finally{r.stackRestore(i)}}}),La=L1(()=>{$t(),Br(),Va=t=>{let r=_e(),i=0,n=[],a=t||{};try{if(t?.logSeverityLevel===void 0)a.logSeverityLevel=2;else if("number"!=typeof t.logSeverityLevel||!Number.isInteger(t.logSeverityLevel)||t.logSeverityLevel<0||t.logSeverityLevel>4)throw Error(`log severity level is not valid: ${t.logSeverityLevel}`);if(t?.logVerbosityLevel===void 0)a.logVerbosityLevel=0;else if("number"!=typeof t.logVerbosityLevel||!Number.isInteger(t.logVerbosityLevel))throw Error(`log verbosity level is not valid: ${t.logVerbosityLevel}`);t?.terminate===void 0&&(a.terminate=!1);let s=0;return t?.tag!==void 0&&(s=We(t.tag,n)),i=r._OrtCreateRunOptions(a.logSeverityLevel,a.logVerbosityLevel,!!a.terminate,s),0===i&&ye("Can't create run options."),t?.extra!==void 0&&tr(t.extra,"",new WeakSet,(t,a)=>{let s=We(t,n),o=We(a,n);0!==r._OrtAddRunConfigEntry(i,s,o)&&ye(`Can't set a run config entry: ${t} - ${a}.`)}),[i,n]}catch(t){throw 0!==i&&r._OrtReleaseRunOptions(i),n.forEach(t=>r._free(t)),t}}}),Ga=L1(()=>{$t(),Br(),im=t=>{switch(t){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw Error(`unsupported graph optimization level: ${t}`)}},am=t=>{switch(t){case"sequential":return 0;case"parallel":return 1;default:throw Error(`unsupported execution mode: ${t}`)}},sm=t=>{t.extra||(t.extra={}),t.extra.session||(t.extra.session={});let r=t.extra.session;r.use_ort_model_bytes_directly||(r.use_ort_model_bytes_directly="1"),t.executionProviders&&t.executionProviders.some(t=>("string"==typeof t?t:t.name)==="webgpu")&&(t.enableMemPattern=!1)},Mr=(t,r,i,n)=>{let a=We(r,n),s=We(i,n);0!==_e()._OrtAddSessionConfigEntry(t,a,s)&&ye(`Can't set a session config entry: ${r} - ${i}.`)},um=async(t,r,i)=>{for(let n of r){let r="string"==typeof n?n:n.name,a=[];switch(r){case"webnn":if(r="WEBNN","string"!=typeof n){let r=n?.deviceType;r&&Mr(t,"deviceType",r,i)}break;case"webgpu":if(r="JS","string"!=typeof n){let r=n;if(r?.preferredLayout){if("NCHW"!==r.preferredLayout&&"NHWC"!==r.preferredLayout)throw Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${r.preferredLayout}`);Mr(t,"preferredLayout",r.preferredLayout,i)}}break;case"wasm":case"cpu":continue;default:throw Error(`not supported execution provider: ${r}`)}let s=We(r,i),o=a.length,l=0,u=0;if(o>0){l=_e()._malloc(o*_e().PTR_SIZE),i.push(l),u=_e()._malloc(o*_e().PTR_SIZE),i.push(u);for(let t=0;t<o;t++)_e().setValue(l+t*_e().PTR_SIZE,a[t][0],"*"),_e().setValue(u+t*_e().PTR_SIZE,a[t][1],"*")}await _e()._OrtAppendExecutionProvider(t,s,l,u,o)!==0&&ye(`Can't append execution provider: ${r}.`)}},Wa=async t=>{let r=_e(),i=0,n=[],a=t||{};sm(a);try{let t=im(a.graphOptimizationLevel??"all"),s=am(a.executionMode??"sequential"),o="string"==typeof a.logId?We(a.logId,n):0,l=a.logSeverityLevel??2;if(!Number.isInteger(l)||l<0||l>4)throw Error(`log severity level is not valid: ${l}`);let u=a.logVerbosityLevel??0;if(!Number.isInteger(u)||u<0||u>4)throw Error(`log verbosity level is not valid: ${u}`);let h="string"==typeof a.optimizedModelFilePath?We(a.optimizedModelFilePath,n):0;if(i=r._OrtCreateSessionOptions(t,!!a.enableCpuMemArena,!!a.enableMemPattern,s,!!a.enableProfiling,0,o,l,u,h),0===i&&ye("Can't create session options."),a.executionProviders&&await um(i,a.executionProviders,n),void 0!==a.enableGraphCapture){if("boolean"!=typeof a.enableGraphCapture)throw Error(`enableGraphCapture must be a boolean value: ${a.enableGraphCapture}`);Mr(i,"enableGraphCapture",a.enableGraphCapture.toString(),n)}if(a.freeDimensionOverrides)for(let[t,s]of Object.entries(a.freeDimensionOverrides)){if("string"!=typeof t)throw Error(`free dimension override name must be a string: ${t}`);if("number"!=typeof s||!Number.isInteger(s)||s<0)throw Error(`free dimension override value must be a non-negative integer: ${s}`);let a=We(t,n);0!==r._OrtAddFreeDimensionOverride(i,a,s)&&ye(`Can't set a free dimension override: ${t} - ${s}.`)}return void 0!==a.extra&&tr(a.extra,"",new WeakSet,(t,r)=>{Mr(i,t,r,n)}),[i,n]}catch(t){throw 0!==i&&0!==r._OrtReleaseSessionOptions(i)&&ye("Can't release session options."),n.forEach(t=>r._free(t)),t}}}),ee=L1(()=>{xt=t=>{switch(t){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw Error(`unsupported data type: ${t}`)}},Je=t=>{switch(t){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw Error(`unsupported data type: ${t}`)}},St=(t,r)=>{let i=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][t],n="number"==typeof r?r:r.reduce((t,r)=>t*r,1);return i>0?Math.ceil(n*i):void 0},Gt=t=>{switch(t){case"float16":return"u">typeof Float16Array&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":case"bool":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw Error(`unsupported type: ${t}`)}},rr=t=>{switch(t){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw Error(`unsupported logging level: ${t}`)}},Rr=t=>"float32"===t||"float16"===t||"int32"===t||"int64"===t||"uint32"===t||"uint8"===t||"bool"===t||"uint4"===t||"int4"===t,Ur=t=>"float32"===t||"float16"===t||"int32"===t||"int64"===t||"uint32"===t||"uint64"===t||"int8"===t||"uint8"===t||"bool"===t||"uint4"===t||"int4"===t,eo=t=>{switch(t){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw Error(`unsupported data location: ${t}`)}}}),to1=L1(()=>{Sr(),nr=async t=>{if("string"!=typeof t)return t instanceof Blob?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:new Uint8Array(t);{let r=await fetch(t);if(!r.ok)throw Error(`failed to load external data file: ${t}`);let i=r.headers.get("Content-Length"),n=i?parseInt(i,10):0;if(n<0x40000000)return new Uint8Array(await r.arrayBuffer());{if(!r.body)throw Error(`failed to load external data file: ${t}, no response body.`);let i=r.body.getReader(),a;try{a=new ArrayBuffer(n)}catch(t){if(t instanceof RangeError){let t=Math.ceil(n/65536);a=new WebAssembly.Memory({initial:t,maximum:t}).buffer}else throw t}let s=0;for(;;){let{done:t,value:r}=await i.read();if(t)break;let n=r.byteLength;new Uint8Array(a,s,n).set(r),s+=n}return new Uint8Array(a,0,n)}}}}),et=L1(()=>{ee(),lm=["V","I","W","E","F"],dm=(t,r)=>{console.log(`[${lm[t]},${new Date().toISOString()}]${r}`)},Nr=(t,r)=>{Ha=t,Fa=r},cm=(t,r)=>{let i=rr(t);i>=rr(Ha)&&dm(i,"function"==typeof r?r():r)},le=(...t)=>{Fa&&cm(...t)}}),ae=L1(()=>{ro=class{static calcMatMulShape(t,r){return t[1]!==r[0]?void 0:[t[0],r[1]]}},tt=class{static calcShape(t,r,i=!1){let n=t.length,a=r.length;if(0===n)return r;if(0===a)return t;let s=Math.max(t.length,r.length),o=Array(s);if(i){if(n<2||a<2)return;let i=ro.calcMatMulShape([t[n-2],t[n-1]],[r[a-2],r[a-1]]);if(void 0===i)return;[o[s-2],o[s-1]]=i}for(let l=i?3:1;l<=s;l++){let i=n-l<0?1:t[n-l],u=a-l<0?1:r[a-l];if(i!==u&&i>1&&u>1)return;let h=Math.max(i,u);if(i&&u)o[s-l]=Math.max(i,u);else{if(h>1)return;o[s-l]=0}}return o}static isValidBroadcast(t,r){let i=t.length,n=r.length;if(i>n)return!1;for(let a=1;a<=i;a++)if(1!==t[i-a]&&t[i-a]!==r[n-a])return!1;return!0}},E1=class t{static size(r){return t.getSizeFromDimensionRange(r,0,r.length)}static convertShape(t,r=4){let i=t.length;if(0===i)return[];let n=Array(i),a=i-1;for(;a>=0;){if(t[a]%r==0){n[a]=t[a]/r;break}if(r%t[a]!=0)throw Error("cannot convert shape");n[a]=1,r/=t[a],a--}for(a--;a>=0;a--)n[a]=t[a];return n}static sizeFromDimension(r,i){if(i<0||i>r.length)throw Error(`invalid dimension of ${i} for sizeFromDimension as Tensor has ${r.length} dimensions.`);return t.getSizeFromDimensionRange(r,i,r.length)}static sizeToDimension(r,i){if(i<0||i>r.length)throw Error(`invalid dimension of ${i} for sizeToDimension as Tensor has ${r.length} dimensions.`);return t.getSizeFromDimensionRange(r,0,i)}static getSizeFromDimensionRange(t,r,i){let n=1;for(let a=r;a<i;a++){if(t[a]<0)throw Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");n*=Number(t[a])}return n}static computeStrides(t){let r=t.length;if(0===r)return[];if(1===r)return[1];let i=Array(r);i[r-1]=1,i[r-2]=t[r-1];for(let n=r-3;n>=0;--n)i[n]=i[n+1]*t[n+1];return i}static normalizeAxis(t,r){if(t<-r&&t>=r)throw Error("unsupported axis for this operation.");return t<0?t+r:t}static normalizeAxes(t,r){return t.map(i=>this.normalizeAxis(i,r??t.length))}static sortBasedOnPerm(t,r){return r?r.map(r=>t[r]):t.slice().reverse()}static padShape(t,r){let i=t.length;return t.map((t,n)=>t+r[n]+r[n+i])}static areEqual(t,r){return t.length===r.length&&t.every((t,i)=>t===r[i])}},Dt=class t{static adjustPoolAttributes(t,r,i,n,a,s){if(!t&&i.length!==r.length-2)throw Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(t)for(let t=0;t<r.length-2;t++)t>=i.length?i.push(r[t+2]):i[t]=r[t+2];for(let t=0;t<i.length;t++)if(t<n.length){if(n[t]<0)throw Error("strides should be greater than or equal to 1")}else n.push(1);for(let t=0;t<i.length;t++)if(t<a.length){if(a[t]<0)throw Error("dilations should be greater than or equal to 1")}else a.push(1);for(let t=0;t<2*i.length;t++)if(t<s.length){if(s[t]<0)throw Error("pad should be greater than or equal to 1")}else s.push(0);for(let t=0;t<i.length;t++){if(i[t]<=0)throw Error("kernel shapes need to be greater than 0");if(s[t]>=i[t]||s[t+i.length]>=i[t])throw Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(r,i,n,a,s,o,l){if(l){if(s.length!==2*(r.length-2))throw Error("length of pads should be twice the length of data dimensions");if(i.length!==r.length-2)throw Error("length of strides should be the length of data dimensions");if(a.length!==r.length-2)throw Error("length of kernel shapes should be the length of data dimensions");for(let u=0;u<r.length-2;u++)t.adjustPadAndReturnShape(r[u+(o?1:2)],i[u],n[u],a[u],s,u,u+r.length-2,l)}}static computePoolOutputShape(r,i,n,a,s,o,l){if(i.length<=0)throw Error("input shape must be of size greater than 0");let u=[i[0],i[1]];return t.computeShapeHelper(r,i,u,n,a,s,o,l),u}static computeConvOutputShape(r,i,n,a,s,o,l){if(r.length<=0||i.length<=0)throw Error("invalid input tensor dims or invalid filter tensor dims");let u=[r[0],i[0]];return t.computeShapeHelper(!1,r,u,n,a,s,o,l),u}static computeShapeHelper(r,i,n,a,s,o,l,u){if(r)for(let t=0;t<i.length-2;t++)n.push(1);else for(let r=0;r<i.length-2;r++)n.push(t.adjustPadAndReturnShape(i[r+2],a[r],s[r],o[r],l,r,r+i.length-2,u))}static adjustPadAndReturnShape(t,r,i,n,a,s,o,l){let u=i*(n-1)+1;if(!l||"NOTSET"===l)return Math.floor((t+a[s]+a[o]-u)/r+1);switch(l){case"VALID":return a[s]=0,a[o]=0,Math.floor((t-u)/r+1);case"SAME_LOWER":case"SAME_UPPER":if(1!==i)throw Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let i=((t+r-1)/r-1)*r+n-t;return a[s]=Math.floor("SAME_LOWER"===l?(i+1)/2:i/2),a[o]=i-a[s],Math.floor((t+i-n)/r+1)}default:throw Error("Unsupported AutoPad type")}}},Vr=class{static getShapeOfGemmResult(t,r,i,n,a){let s,o,l;if(2!==t.length||2!==i.length)throw Error("shape need to be of size 2");r?(s=t[1],o=t[0]):(s=t[0],o=t[1]);let u=-1;if(n?(l=i[0],u=1):(l=i[1],u=0),i[u]!==o)throw Error("dimension mismatch");if(s<=0||l<=0||o<=0)throw Error("invalid shape specified");if(a&&!tt.isValidBroadcast(a,[s,l]))throw Error("gemm: invalid bias shape for broadcast");return[s,l,o]}},qa=-34028234663852886e22,ja=34028234663852886e22}),no=L1(()=>{ee(),Lr=(t,r)=>new(Gt(r))(t)}),Ja=L1(()=>{ee(),et(),Za=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),io=(t,r)=>{if("int32"===r)return t;let i=Za.get(r);if(!i)throw Error(`WebNN backend does not support data type: ${r}`);let n=i/8;if(t.byteLength%n!=0)throw Error(`Invalid Uint8Array length - must be a multiple of ${n}.`);let a=t.byteLength/n,s=new(Gt(r))(t.buffer,t.byteOffset,a);switch(r){case"int64":case"uint64":{let t=new Int32Array(a);for(let r=0;r<a;r++){let i=s[r];if(i>2147483647n||i<-2147483648n)throw Error("Can not convert int64 data to int32 - value out of range.");t[r]=Number(i)}return new Uint8Array(t.buffer)}case"int8":case"uint8":case"uint32":if("uint32"===r&&s.some(t=>t>0x7fffffff))throw Error("Can not convert uint32 data to int32 - value out of range.");return new Uint8Array(Int32Array.from(s,Number).buffer);default:throw Error(`Unsupported data conversion from ${r} to 'int32'`)}},Qa=(t,r)=>{if("int32"===r)return t;if(t.byteLength%4!=0)throw Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let i=t.byteLength/4,n=new Int32Array(t.buffer,t.byteOffset,i);switch(r){case"int64":return new Uint8Array(BigInt64Array.from(n,BigInt).buffer);case"uint64":if(n.some(t=>t<0))throw Error("Can not convert int32 data to uin64 - negative value found.");return new Uint8Array(BigUint64Array.from(n,BigInt).buffer);case"int8":if(n.some(t=>t<-128||t>127))throw Error("Can not convert int32 data to int8 - value out of range.");return new Uint8Array(Int8Array.from(n,Number).buffer);case"uint8":if(n.some(t=>t<0||t>255))throw Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(n,Number);case"uint32":if(n.some(t=>t<0))throw Error("Can not convert int32 data to uint32 - negative value found.");return new Uint8Array(Uint32Array.from(n,Number).buffer);default:throw Error(`Unsupported data conversion from 'int32' to ${r}`)}},pm=1,Ka=()=>pm++,mm=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),Ya=(t,r)=>{let i=Za.get(t);if(!i)throw Error(`WebNN backend does not support data type: ${t}`);return r.length>0?Math.ceil(r.reduce((t,r)=>t*r)*i/8):0},Wr=class{constructor(t){this.isDataConverted=!1;let{sessionId:r,context:i,tensor:n,dataType:a,shape:s,fallbackDataType:o}=t;this.sessionId=r,this.mlContext=i,this.mlTensor=n,this.dataType=a,this.tensorShape=s,this.fallbackDataType=o}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return Ya(this.dataType,this.tensorShape)}destroy(){le("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(t){this.mlContext.writeTensor(this.mlTensor,t)}async read(t){if(!this.fallbackDataType)return t?this.mlContext.readTensor(this.mlTensor,t):this.mlContext.readTensor(this.mlTensor);{let r=Qa(new Uint8Array(await this.mlContext.readTensor(this.mlTensor)),this.dataType);return t?void(t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)).set(r):r.buffer}}canReuseTensor(t,r,i){return this.mlContext===t&&this.dataType===r&&this.tensorShape.length===i.length&&this.tensorShape.every((t,r)=>t===i[r])}setIsDataConverted(t){this.isDataConverted=t}},Gr=class{constructor(t,r){this.tensorManager=t,this.wrapper=r}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(t,r,i,n){let a=this.tensorManager.getMLContext(t),s;if(!a.opSupportLimits().input.dataTypes.includes(r)){if(!(s=mm.get(r))||!a.opSupportLimits().input.dataTypes.includes(s))throw Error(`WebNN backend does not support data type: ${r}`);le("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${r} to ${s}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(a,r,i))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==Ya(r,i))throw Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let o=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(t,r,i,o,!0,!0,s),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(t){let r=t;if(this.wrapper){if(this.wrapper.fallbackType)if("int32"===this.wrapper.fallbackType)r=io(t,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(t.byteLength===this.wrapper.byteLength)return void this.wrapper.write(r);le("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(r):this.activeUpload=new Uint8Array(r)}async download(t){if(this.activeUpload){let r=this.wrapper?.isDataConverted?Qa(this.activeUpload,this.wrapper?.type):this.activeUpload;return t?void(t instanceof ArrayBuffer?new Uint8Array(t).set(r):new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(r)):r.buffer}if(!this.wrapper)throw Error("Tensor has not been created.");return t?this.wrapper.read(t):this.wrapper.read()}},oo=class{constructor(t){this.backend=t,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(t){let r=this.backend.getMLContext(t);if(!r)throw Error("MLContext not found for session.");return r}reserveTensorId(){let t=Ka();return this.tensorTrackersById.set(t,new Gr(this)),t}releaseTensorId(t){let r=this.tensorTrackersById.get(t);r&&(this.tensorTrackersById.delete(t),r.tensorWrapper&&this.releaseTensor(r.tensorWrapper))}async ensureTensor(t,r,i,n,a){le("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${r}, dataType: ${i}, shape: ${n}, copyOld: ${a}}`);let s=this.tensorTrackersById.get(r);if(!s)throw Error("Tensor not found.");return s.ensureTensor(t,i,n,a)}upload(t,r){let i=this.tensorTrackersById.get(t);if(!i)throw Error("Tensor not found.");i.upload(r)}async download(t,r){le("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${t}, dstBuffer: ${r?.byteLength}}`);let i=this.tensorTrackersById.get(t);if(!i)throw Error("Tensor not found.");return i.download(r)}releaseTensorsForSession(t){for(let r of this.freeTensors)r.sessionId===t&&r.destroy();this.freeTensors=this.freeTensors.filter(r=>r.sessionId!==t)}registerTensor(t,r,i,n){let a=this.getMLContext(t),s=Ka(),o=new Wr({sessionId:t,context:a,tensor:r,dataType:i,shape:n});return this.tensorTrackersById.set(s,new Gr(this,o)),this.externalTensors.add(o),s}async getCachedTensor(t,r,i,n,a,s,o){let l=this.getMLContext(t);for(let[n,a]of this.freeTensors.entries())if(a.canReuseTensor(l,r,i)){le("verbose",()=>`[WebNN] Reusing tensor {dataType: ${r}, ${o?`fallbackDataType: ${o},`:""} shape: ${i}`);let a=this.freeTensors.splice(n,1)[0];return a.sessionId=t,a}le("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${r}, ${o?`fallbackDataType: ${o},`:""} shape: ${i}}`);let u=await l.createTensor({dataType:o??r,shape:i,dimensions:i,usage:n,writable:a,readable:s});return new Wr({sessionId:t,context:l,tensor:u,dataType:r,shape:i,fallbackDataType:o})}releaseTensor(t){this.externalTensors.has(t)&&this.externalTensors.delete(t),this.freeTensors.push(t)}},Xa=(...t)=>new oo(...t)}),es=L1(()=>{ee(),$t(),no(),Ja(),et(),Hr=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),fm=(t,r)=>{if(t===r)return!0;if(void 0===t||void 0===r)return!1;let i=Object.keys(t).sort(),n=Object.keys(r).sort();return i.length===n.length&&i.every((i,a)=>i===n[a]&&t[i]===r[i])},Fr=class{constructor(t){this.tensorManager=Xa(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,Nr(t.logLevel,!!t.debug)}get currentSessionId(){if(void 0===this.activeSessionId)throw Error("No active session");return this.activeSessionId}onRunStart(t){le("verbose",()=>`[WebNN] onRunStart {sessionId: ${t}}`),this.activeSessionId=t}onRunEnd(t){le("verbose",()=>`[WebNN] onRunEnd {sessionId: ${t}}`);let r=this.temporarySessionTensorIds.get(t);if(r){for(let t of r)le("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t);this.temporarySessionTensorIds.delete(t),this.activeSessionId=void 0}}async createMLContext(t){if(t instanceof GPUDevice){let r=this.mlContextCache.findIndex(r=>r.gpuDevice===t);if(-1!==r)return this.mlContextCache[r].mlContext;{let r=await navigator.ml.createContext(t);return this.mlContextCache.push({gpuDevice:t,mlContext:r}),r}}if(void 0===t){let t=this.mlContextCache.findIndex(t=>void 0===t.options&&void 0===t.gpuDevice);if(-1!==t)return this.mlContextCache[t].mlContext;{let t=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:t}),t}}let r=this.mlContextCache.findIndex(r=>fm(r.options,t));if(-1!==r)return this.mlContextCache[r].mlContext;{let r=await navigator.ml.createContext(t);return this.mlContextCache.push({options:t,mlContext:r}),r}}registerMLContext(t,r){this.mlContextBySessionId.set(t,r);let i=this.sessionIdsByMLContext.get(r);i||(i=new Set,this.sessionIdsByMLContext.set(r,i)),i.add(t),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(t,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(t,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(t){this.sessionGraphInputs.delete(t),this.sessionGraphOutputs.delete(t);let r=this.mlContextBySessionId.get(t);if(!r)return;this.tensorManager.releaseTensorsForSession(t),this.mlContextBySessionId.delete(t);let i=this.sessionIdsByMLContext.get(r);if(i.delete(t),0===i.size){this.sessionIdsByMLContext.delete(r);let t=this.mlContextCache.findIndex(t=>t.mlContext===r);-1!==t&&this.mlContextCache.splice(t,1)}}getMLContext(t){return this.mlContextBySessionId.get(t)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(t){le("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t)}async ensureTensor(t,r,i,n,a){let s=Hr.get(i);if(!s)throw Error(`Unsupported ONNX data type: ${i}`);return this.tensorManager.ensureTensor(t??this.currentSessionId,r,s,n,a)}async createTemporaryTensor(t,r,i){le("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${r}, shape: ${i}}`);let n=Hr.get(r);if(!n)throw Error(`Unsupported ONNX data type: ${r}`);let a=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(t,a,n,i,!1);let s=this.temporarySessionTensorIds.get(t);return s?s.push(a):this.temporarySessionTensorIds.set(t,[a]),a}uploadTensor(t,r){if(!_e().shouldTransferToMLTensor)throw Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");le("verbose",()=>`[WebNN] uploadTensor {tensorId: ${t}, data: ${r.byteLength}}`),this.tensorManager.upload(t,r)}async downloadTensor(t,r){return this.tensorManager.download(t,r)}createMLTensorDownloader(t,r){return async()=>{let i=await this.tensorManager.download(t);return Lr(i,r)}}registerMLTensor(t,r,i,n){let a=Hr.get(i);if(!a)throw Error(`Unsupported ONNX data type: ${i}`);let s=this.tensorManager.registerTensor(t,r,a,n);return le("verbose",()=>`[WebNN] registerMLTensor {tensor: ${r}, dataType: ${a}, dimensions: ${n}} -> {tensorId: ${s}}`),s}registerMLConstant(t,r,i,n,a,s,o=!1){if(!s)throw Error("External mounted files are not available.");let l=t;t.startsWith("./")&&(l=t.substring(2));let u=s.get(l);if(!u)throw Error(`File with name ${l} not found in preloaded files.`);if(r+i>u.byteLength)throw Error("Out of bounds: data offset and length exceed the external file data size.");let h=u.slice(r,r+i).buffer,f;switch(a.dataType){case"float32":f=new Float32Array(h);break;case"float16":f="u">typeof Float16Array&&Float16Array.from?new Float16Array(h):new Uint16Array(h);break;case"int32":f=new Int32Array(h);break;case"uint32":f=new Uint32Array(h);break;case"int64":o?(f=new Int32Array(io(new Uint8Array(h),"int64").buffer),a.dataType="int32"):f=new BigInt64Array(h);break;case"uint64":f=new BigUint64Array(h);break;case"int8":f=new Int8Array(h);break;case"int4":case"uint4":case"uint8":f=new Uint8Array(h);break;default:throw Error(`Unsupported data type: ${a.dataType} in creating WebNN Constant from external data.`)}return le("verbose",()=>`[WebNN] registerMLConstant {dataType: ${a.dataType}, shape: ${a.shape}}} ${o?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),n.constant(a,f)}registerGraphInput(t){this.temporaryGraphInputs.push(t)}registerGraphOutput(t){this.temporaryGraphOutputs.push(t)}isGraphInput(t,r){let i=this.sessionGraphInputs.get(t);return!!i&&i.includes(r)}isGraphOutput(t,r){let i=this.sessionGraphOutputs.get(t);return!!i&&i.includes(r)}isGraphInputOutputTypeSupported(t,r,i=!0){let n=this.mlContextBySessionId.get(t),a=Hr.get(xt(r));return!(typeof a>"u")&&(i?!!n?.opSupportLimits().input.dataTypes.includes(a):!!n?.opSupportLimits().output.dataTypes.includes(a))}flush(){}}}),qr=L1(()=>{}),is=L1(()=>{et(),qr(),ts=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[0xc00000,10],[0x1000000,10],[0x1900000,15],[0x2000000,22],[0x2a30000,2],[0x3840000,6],[0x4000000,6],[0x8000000,6],[0xa000000,6]]),ao=[],so=t=>16*Math.ceil(Number(t)/16),hm=t=>{for(let r=0;r<ao.length;r++){let i=ao[r];if(t<=i)return i}return 16*Math.ceil(t/16)},gm=1,rs=()=>gm++,lo=async(t,r,i,n)=>{let a=so(i),s=t.device.createBuffer({size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let o=t.getCommandEncoder();t.endComputePass(),o.copyBufferToBuffer(r,0,s,0,a),t.flush(),await s.mapAsync(GPUMapMode.READ);let l=s.getMappedRange();if(!n)return new Uint8Array(l.slice(0,i));{let t=n();return t.set(new Uint8Array(l,0,i)),t}}finally{s.destroy()}},uo=class{constructor(t){for(let[r]of(this.backend=t,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map,ts))ao.push(r),this.freeBuffers.set(r,[]),this.freeUniformBuffers.set(r,[]);this.sessionCount=0}upload(t,r){let i=r.buffer,n=r.byteOffset,a=r.byteLength,s=so(a),o=this.storageCache.get(t);if(!o)throw Error("gpu data for uploading does not exist");if(Number(o.originalSize)!==a)throw Error(`inconsistent data size. gpu data size=${o.originalSize}, data size=${a}`);let l=this.backend.device.createBuffer({mappedAtCreation:!0,size:s,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC});new Uint8Array(l.getMappedRange()).set(new Uint8Array(i,n,a)),l.unmap();let u=this.backend.device.createCommandEncoder();u.copyBufferToBuffer(l,0,o.gpuData.buffer,0,s),this.backend.device.queue.submit([u.finish()]),l.destroy(),le("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${t})`)}memcpy(t,r){let i=this.storageCache.get(t);if(!i)throw Error("source gpu data for memcpy does not exist");let n=this.storageCache.get(r);if(!n)throw Error("destination gpu data for memcpy does not exist");if(i.originalSize!==n.originalSize)throw Error("inconsistent source and destination gpu data size");let a=so(i.originalSize),s=this.backend.getCommandEncoder();this.backend.endComputePass(),s.copyBufferToBuffer(i.gpuData.buffer,0,n.gpuData.buffer,0,a)}registerExternalBuffer(t,r,i){let n;if(i){if(n=i[0],t===i[1])return le("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${r}) => id=${n}, buffer is the same, skip.`),n;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else n=rs();return this.storageCache.set(n,{gpuData:{id:n,type:0,buffer:t},originalSize:r}),le("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${r}) => id=${n}, registered.`),n}unregisterExternalBuffer(t){void 0!==t&&(this.storageCache.delete(t),le("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${t}`))}create(t,r=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let i=hm(t),n,a=(r&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,s=(r&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(a||s){let t=(a?this.freeBuffers:this.freeUniformBuffers).get(i);n=t&&t.length>0?t.pop():this.backend.device.createBuffer({size:i,usage:r})}else n=this.backend.device.createBuffer({size:i,usage:r});let o={id:rs(),type:0,buffer:n};return this.storageCache.set(o.id,{gpuData:o,originalSize:Number(t)}),le("verbose",()=>`[WebGPU] GpuDataManager.create(size=${t}) => id=${o.id}`),o}get(t){return this.storageCache.get(t)?.gpuData}release(t){let r="bigint"==typeof t?Number(t):t,i=this.storageCache.get(r);if(!i){if(0===this.storageCache.size)return 0;throw Error("releasing data does not exist")}return le("verbose",()=>`[WebGPU] GpuDataManager.release(id=${r}), gpuDataId=${i.gpuData.id}`),this.storageCache.delete(r),this.buffersPending.push(i.gpuData.buffer),i.originalSize}async download(t,r){let i=this.storageCache.get(Number(t));if(!i)throw Error("data does not exist");await lo(this.backend,i.gpuData.buffer,i.originalSize,r)}refreshPendingBuffers(){if(0!==this.buffersPending.length)if("default"===this.backend.sessionStatus){for(let t of this.buffersPending){let r=ts.get(t.size);if((t.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let i=this.freeBuffers.get(t.size)||[];void 0===r||i.length>=r?t.destroy():i.push(t)}else if((t.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let i=this.freeUniformBuffers.get(t.size)||[];void 0===r||i.length>=r?t.destroy():i.push(t)}else t.destroy()}this.buffersPending=[]}else{let t=this.capturedPendingBuffers.get(this.backend.currentSessionId);for(let r of(t||(t=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,t)),this.buffersPending))t.push(r);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(t=>{t.forEach(t=>{t.destroy()})}),this.freeUniformBuffers.forEach(t=>{t.forEach(t=>{t.destroy()})}),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(t=>{t.forEach(t=>{t.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(t){let r=this.capturedPendingBuffers.get(t);r&&(r.forEach(t=>{t.destroy()}),this.capturedPendingBuffers.delete(t)),this.sessionCount-=1,0===this.sessionCount&&(le("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.storageCache=new Map)}},os=(...t)=>new uo(...t)}),Se=L1(()=>{co=class{constructor(t){Object.assign(this,t)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(t=>`${this[t]}`).join(";")),this.key}},te=t=>new co(t)}),ue=L1(()=>{ee(),ae(),Bt=64,mo=(t,r)=>{if(3===r)throw Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(t)){case 10:return r>1?`vec${r}<f16>`:"f16";case 1:return r>1?`vec${r}<f32>`:"f32";case 6:return r>1?`vec${r}<i32>`:"i32";case 12:return r>1?`vec${r}<u32>`:"u32";case 7:if(r>1)throw Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(r>1)throw Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(4!==r)throw Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw Error(`Unknown data type: ${t}`)}},ve=(t,r=1)=>{let i=mo(t,r);return"string"==typeof i?i:i[0]},ke=(t,r=1)=>{let i=mo(t,r);return"string"==typeof i?i:i[1]},W=(...t)=>{let r=[];return t.forEach(t=>{0!==t.length&&r.push({type:12,data:t},{type:12,data:E1.computeStrides(t)})}),r},he=t=>t%4==0?4:t%2==0?2:1,fo=(t="f32",r,i="0")=>r&&1!==r?`vec${r}<${t}>(${i})`:`${t}(${i})`,Mt=(t,r,i)=>"f32"===t?i:1===r?`f32(${i})`:`vec${r}<f32>(${i})`,je=(t,r)=>4===r?`(${t}.x + ${t}.y + ${t}.z + ${t}.w)`:2===r?`(${t}.x + ${t}.y)`:3===r?`(${t}.x + ${t}.y + ${t}.z)`:t,K=(t,r,i,n)=>t.startsWith("uniforms.")&&i>4?"string"==typeof r?"f16"===n?`${t}[(${r}) / 8][(${r}) % 8 / 4][(${r}) % 8 % 4]`:`${t}[(${r}) / 4][(${r}) % 4]`:"f16"===n?`${t}[${Math.floor(r/8)}][${Math.floor(r%8/4)}][${r%8%4}]`:`${t}[${Math.floor(r/4)}][${r%4}]`:i>1?`${t}[${r}]`:t,jr=(t,r,i,n,a)=>{let s="number"==typeof i,o=s?i:i.length,l=[...Array(o).keys()],u=o<2?"u32":o<=4?`vec${o}<u32>`:`array<u32, ${o}>`,h=mo(r,a),f="string"==typeof h?h:h[1],d={indices:u,value:f,storage:"string"==typeof h?h:h[0],tensor:r},c=t=>"string"==typeof t?t:`${t}u`,p={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},m=s?"uniforms.":"",g=`${m}${t}_shape`,_=`${m}${t}_strides`,b="";for(let t=0;t<o-1;t++)b+=`
    let dim${t} = current / ${K(_,t,o)};
    let rest${t} = current % ${K(_,t,o)};
    indices[${t}] = dim${t};
    current = rest${t};
    `;b+=`indices[${o-1}] = current;`;let y=o<2?"":`
  fn o2i_${t}(offset: u32) -> ${d.indices} {
    var indices: ${d.indices};
    var current = offset;
    ${b}
    return indices;
  }`,v=r=>(p.offsetToIndices=!0,o<2?r:`o2i_${t}(${r})`),w=[];if(o>=2)for(let t=o-1;t>=0;t--)w.push(`${K(_,t,o)} * (indices[${t}])`);let x=o<2?"":`
  fn i2o_${t}(indices: ${d.indices}) -> u32 {
    return ${w.join("+")};
  }`,k=r=>(p.indicesToOffset=!0,o<2?r:`i2o_${t}(${r})`),E=(...t)=>0===o?"0u":`${d.indices}(${t.map(c).join(",")})`,S=(t,r)=>o<2?`${t}`:`${K(t,r,o)}`,$=(t,r,i)=>o<2?`${t}=${i};`:`${K(t,r,o)}=${i};`,I={},A=(r,i)=>{p.broadcastedIndicesToOffset=!0;let n=`${i.name}broadcastedIndicesTo${t}Offset`;if(n in I)return`${n}(${r})`;let a=[];for(let t=o-1;t>=0;t--){let r=i.indicesGet("outputIndices",t+i.rank-o);a.push(`${S(_,t)} * (${r} % ${S(g,t)})`)}return I[n]=`fn ${n}(outputIndices: ${i.type.indices}) -> u32 {
             return ${a.length>0?a.join("+"):"0u"};
           }`,`${n}(${r})`},M=(r,i)=>(()=>{if(d.storage===d.value)return`${t}[${r}]=${i};`;if("vec2<u32>"===d.storage&&"i32"===d.value)return`${t}[${r}]=vec2<u32>(u32(${i}), select(0u, 0xFFFFFFFFu, ${i} < 0));`;if("vec2<u32>"===d.storage&&"u32"===d.value)return`${t}[${r}]=vec2<u32>(u32(${i}), 0u);`;if("u32"===d.storage&&"vec4<bool>"===d.value)return`${t}[${r}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${i}));`;throw Error(`not supported combination of storage type ${d.storage} and value type ${d.value} yet`)})(),T=r=>(()=>{if(d.storage===d.value)return`${t}[${r}]`;if("vec2<u32>"===d.storage&&"i32"===d.value)return`i32(${t}[${r}].x)`;if("vec2<u32>"===d.storage&&"u32"===d.value)return`u32(${t}[${r}].x)`;if("u32"===d.storage&&"vec4<bool>"===d.value)return`vec4<bool>(bool(${t}[${r}] & 0xFFu), bool(${t}[${r}] & 0xFF00u), bool(${t}[${r}] & 0xFF0000u), bool(${t}[${r}] & 0xFF000000u))`;throw Error(`not supported combination of storage type ${d.storage} and value type ${d.value} yet`)})(),C=o<2?"":`
  fn get_${t}ByIndices(indices: ${d.indices}) -> ${f} {
    return ${T(`i2o_${t}(indices)`)};
  }`,z=o<2?"":(()=>{let r=l.map(t=>`d${t}: u32`).join(", "),i=l.map(t=>`d${t}`).join(", ");return`
  fn get_${t}(${r}) -> ${f} {
    return get_${t}ByIndices(${E(i)});
  }`})(),R=(...r)=>{if(r.length!==o)throw Error(`indices length must be ${o}`);let i=r.map(c).join(",");return 0===o?T("0u"):1===o?T(i[0]):(p.get=!0,p.getByIndices=!0,p.indicesToOffset=!0,`get_${t}(${i})`)},B=r=>o<2?T(r):(p.getByIndices=!0,p.indicesToOffset=!0,`get_${t}ByIndices(${r})`),O=o<2?"":`
  fn set_${t}ByIndices(indices: ${d.indices}, value: ${f}) {
    ${M(`i2o_${t}(indices)`,"value")}
  }`,D=o<2?"":(()=>{let r=l.map(t=>`d${t}: u32`).join(", "),i=l.map(t=>`d${t}`).join(", ");return`
  fn set_${t}(${r}, value: ${f}) {
    set_${t}ByIndices(${E(i)}, value);
  }`})();return{impl:()=>{let t=[],r=!1;return p.offsetToIndices&&(t.push(y),r=!0),p.indicesToOffset&&(t.push(x),r=!0),p.broadcastedIndicesToOffset&&(Object.values(I).forEach(r=>t.push(r)),r=!0),p.set&&(t.push(D),r=!0),p.setByIndices&&(t.push(O),r=!0),p.get&&(t.push(z),r=!0),p.getByIndices&&(t.push(C),r=!0),!s&&r&&t.unshift(`const ${g} = ${d.indices}(${i.join(",")});`,`const ${_} = ${d.indices}(${E1.computeStrides(i).join(",")});`),t.join(`
`)},type:d,offsetToIndices:v,indicesToOffset:k,broadcastedIndicesToOffset:A,indices:E,indicesGet:S,indicesSet:$,set:(...r)=>{if(r.length!==o+1)throw Error(`indices length must be ${o}`);let i=r[o];if("string"!=typeof i)throw Error("value must be string");let n=r.slice(0,o).map(c).join(",");return 0===o?M("0u",i):1===o?M(n[0],i):(p.set=!0,p.setByIndices=!0,p.indicesToOffset=!0,`set_${t}(${n}, ${i})`)},setByOffset:M,setByIndices:(r,i)=>o<2?M(r,i):(p.setByIndices=!0,p.indicesToOffset=!0,`set_${t}ByIndices(${r}, ${i});`),get:R,getByOffset:T,getByIndices:B,usage:n,name:t,strides:_,shape:g,rank:o}},P=(t,r,i,n=1)=>jr(t,r,i,"input",n),N1=(t,r,i,n=1)=>jr(t,r,i,"output",n),as=(t,r,i)=>jr(t,r,i,"atomicOutput",1),Kr=(t,r,i,n=1)=>jr(t,r,i,"internal",n),po=class{constructor(t,r){this.normalizedDispatchGroup=t,this.limits=r,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(t){return`if (global_idx >= ${"number"==typeof t?`${t}u`:t}) { return; }`}mainStart(t=Bt){let r="number"==typeof t?t:t[0],i="number"==typeof t?1:t[1],n="number"==typeof t?1:t[2];if(r>this.limits.maxComputeWorkgroupSizeX||i>this.limits.maxComputeWorkgroupSizeY||n>this.limits.maxComputeWorkgroupSizeZ)throw Error(`workgroup size [${r}, ${i}, ${n}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(r*i*n>this.limits.maxComputeInvocationsPerWorkgroup)throw Error(`workgroup size [${r}, ${i}, ${n}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let a=1===this.normalizedDispatchGroup[1]&&1===this.normalizedDispatchGroup[2],s=a?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,o=a?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${r*i*n}u + local_idx;`;return`@compute @workgroup_size(${r}, ${i}, ${n})
  fn main(${s}) {
    ${o}
  `}appendVariableUniforms(t){0!==t.rank&&(t.shape.startsWith("uniforms.")&&this.uniforms.push({name:t.shape.replace("uniforms.",""),type:"u32",length:t.rank}),t.strides.startsWith("uniforms.")&&this.uniforms.push({name:t.strides.replace("uniforms.",""),type:"u32",length:t.rank}))}declareVariable(t,r){if("internal"===t.usage)throw Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(t),this.appendVariableUniforms(t);let i="input"===t.usage?"read":"read_write",n="atomicOutput"===t.usage?"atomic<i32>":t.type.storage;return`@group(0) @binding(${r}) var<storage, ${i}> ${t.name}: array<${n}>;`}declareVariables(...t){return t.map(t=>this.declareVariable(t,this.variableIndex++)).join(`
`)}registerInternalVariable(t){if("internal"!==t.usage)throw Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(t),this.appendVariableUniforms(t)}registerInternalVariables(...t){return t.forEach(t=>this.registerInternalVariable(t)),this}registerUniform(t,r,i=1){return this.uniforms.push({name:t,type:r,length:i}),this}registerUniforms(t){return this.uniforms=this.uniforms.concat(t),this}uniformDeclaration(){if(0===this.uniforms.length)return"";let t=[];for(let{name:r,type:i,length:n}of this.uniforms)if(n&&n>4)"f16"===i?t.push(`@align(16) ${r}:array<mat2x4<${i}>, ${Math.ceil(n/8)}>`):t.push(`${r}:array<vec4<${i}>, ${Math.ceil(n/4)}>`);else{let a=null==n||1===n?i:`vec${n}<${i}>`;t.push(`${r}:${a}`)}return`
      struct Uniforms { ${t.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(t=>t.impl()).join(`
`)+this.internalVariables.map(t=>t.impl()).join(`
`)}get variablesInfo(){if(0===this.uniforms.length)return;let t=t=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(t)];return this.uniforms.map(r=>[t(r.type),r.length??1])}},ss=(t,r)=>new po(t,r)}),ct=L1(()=>{ee(),ae(),Se(),ue(),ym=(t,r)=>{if(!t||1!==t.length)throw Error("Transpose requires 1 input.");if(0!==r.length&&r.length!==t[0].dims.length)throw Error(`perm size ${r.length} does not match input rank ${t[0].dims.length}`)},us=(t,r)=>0!==r.length?r:[...Array(t).keys()].reverse(),bm=(t,r)=>E1.sortBasedOnPerm(t,us(t.length,r)),_m=(t,r,i,n)=>{let a=`fn perm(i: ${n.type.indices}) -> ${i.type.indices} {
    var a: ${i.type.indices};`;for(let i=0;i<r;++i)a+=`a[${t[i]}]=i[${i}];`;return a+"return a;}"},wm=(t,r)=>{let i=[],n=[];for(let a=0;a<t.length;++a)1!==t[a]&&i.push(t[a]),1!==t[r[a]]&&n.push(r[a]);return{newShape:i,newPerm:n}},vm=(t,r)=>{let i=0;for(let n=0;n<t.length;++n)if(1!==r[t[n]]){if(t[n]<i)return!1;i=t[n]}return!0},Pe=(t,r)=>{let i=t.dataType,n=t.dims.length,a=us(n,r),s=bm(t.dims,a),o=t.dims,l=s,u;if(n<2||vm(a,t.dims))return{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let r=E1.size(s);return{outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(r/64/4)},programUniforms:[{type:12,data:Math.ceil(r/4)}]}},getShaderSource:u=t=>{let r=P("input",i,o,4),n=N1("output",i,l,4);return`
  ${t.registerUniform("output_size","u32").declareVariables(r,n)}
  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`}};let{newShape:h,newPerm:f}=wm(t.dims,a),d=E1.areEqual(f,[2,3,1]),c=E1.areEqual(f,[3,1,2]);if(2===h.length||d||c){l=[(o=d?[h[0],h[1]*h[2]]:c?[h[0]*h[1],h[2]]:h)[1],o[0]];let r=16;return{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let i=E1.size(s);return{outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(l[1]/r),y:Math.ceil(l[0]/r)},programUniforms:[{type:12,data:i},...W(o,l)]}},getShaderSource:u=t=>{let n=P("a",i,o.length),a=N1("output",i,l.length);return`
  ${t.registerUniform("output_size","u32").declareVariables(n,a)}
  var<workgroup> tile : array<array<${a.type.value}, ${r+1}>, ${r}>;
  ${t.mainStart([r,r,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${r} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${r}u + local_id.x;
    let input_row = workgroup_id_x * ${r}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${n.getByIndices(`${n.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${r}u + local_id.x;
    let output_row = workgroup_id_y * ${r}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${a.setByIndices(`${a.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`}}}return{name:"Transpose",shaderCache:{hint:`${r}`,inputDependencies:["rank"]},getRunData:()=>{let r=E1.size(s);return{outputs:[{dims:s,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:[{type:12,data:r},...W(o,l)]}},getShaderSource:u=t=>{let r=P("a",i,o.length),s=N1("output",i,l.length);return`
  ${t.registerUniform("output_size","u32").declareVariables(r,s)}

  ${_m(a,n,r,s)}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${s.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${s.setByOffset("global_idx",r.getByIndices("aIndices"))}
  }`}}},ls=(t,r)=>{ym(t.inputs,r.perm),t.compute(Pe(t.inputs[0],r.perm))},ds=t=>te({perm:t.perm})}),vs=L1(()=>{ee(),ae(),ue(),Zr(),ct(),$m={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},xm={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},Sm={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},Tm={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},Cm=(t,r)=>{let i=[];for(let n=r-t;n<r;++n)i.push(n);return i},Im=(t,r)=>{let i=[],n=t.length;for(let a=0;a<n;a++)-1===r.indexOf(a)&&i.push(t[a]);return[i,r.map(r=>t[r])]},Am=(t,r)=>{let i=t.length+r.length,n=[],a=0;for(let s=0;s<i;s++)-1===r.indexOf(s)?n.push(t[a++]):n.push(1);return n},Em=(t,r)=>{for(let i=0;i<t.length;++i)if(t[t.length-i-1]!==r-1-i)return!1;return!0},km=(t,r)=>{let i=[];if(!Em(t,r)){for(let n=0;n<r;++n)-1===t.indexOf(n)&&i.push(n);t.forEach(t=>i.push(t))}return i},Pm=(t,r,i,n,a,s,o)=>{let l=i[0].dims,u=E1.size(s),h=E1.size(o),f=P("_A",i[0].dataType,l),d=N1("output",a,s),c=64;1===u&&(c=256);let p=`
          var<workgroup> aBestValues : array<f32, ${c}>;
       `,m=t=>`
        ${t.registerUniform("reduceSize","u32").declareVariables(f,d)}
        ${p}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${t.mainStart(c)}

          let outputIndex = global_idx / ${c};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${Sm[n]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${c}) {
           let candidate = f32(${f.getByOffset("offset + k")});
           bestValue = ${$m[n]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${c}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${xm[n]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${d.setByOffset("outputIndex",`${"mean"===n?`${d.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${d.type.storage}(${Tm[n]})`}`)};
         }
        }`;return{name:t,shaderCache:{hint:`${r};${c}`,inputDependencies:["type"]},getShaderSource:m,getRunData:()=>({outputs:[{dims:s,dataType:a}],dispatchGroup:{x:u},programUniforms:[{type:12,data:h}]})}},rt=(t,r,i,n)=>{let a=1===t.inputs.length?i:ho(t.inputs,i),s=a.axes;0!==s.length||a.noopWithEmptyAxes||(s=t.inputs[0].dims.map((t,r)=>r));let o=E1.normalizeAxes(s,t.inputs[0].dims.length),l=o,u=t.inputs[0],h=km(l,t.inputs[0].dims.length);h.length>0&&(u=t.compute(Pe(t.inputs[0],h),{inputs:[0],outputs:[-1]})[0],l=Cm(l.length,u.dims.length));let[f,d]=Im(u.dims,l),c=f;a.keepDims&&(c=Am(f,o)),t.compute(Pm(r,a.cacheKey,[u],n,t.inputs[0].dataType,c,d),{inputs:[u]})},cs=(t,r)=>{rt(t,"ReduceMeanShared",r,"mean")},ps=(t,r)=>{rt(t,"ReduceL1Shared",r,"l1")},ms=(t,r)=>{rt(t,"ReduceL2Shared",r,"l2")},fs=(t,r)=>{rt(t,"ReduceLogSumExpShared",r,"logSumExp")},hs=(t,r)=>{rt(t,"ReduceMaxShared",r,"max")},gs=(t,r)=>{rt(t,"ReduceMinShared",r,"min")},ys=(t,r)=>{rt(t,"ReduceProdShared",r,"prod")},bs=(t,r)=>{rt(t,"ReduceSumShared",r,"sum")},_s=(t,r)=>{rt(t,"ReduceSumSquareShared",r,"sumSquare")},ws=(t,r)=>{rt(t,"ReduceLogSumShared",r,"logSum")}}),Zr=L1(()=>{ee(),ae(),Se(),ue(),vs(),nt=t=>{if(!t||0===t.length||t.length>2)throw Error("Reduce op requires 1 or 2 inputs.");if(2===t.length&&1!==t[1].dims.length)throw Error("Invalid axes input dims.")},Om=t=>["","",`var value = ${t.getByIndices("input_indices")};`,""],Qr=(t,r,i,n,a,s,o=!1,l=!1)=>{let u=[],h=i[0].dims,f=h.length,d=E1.normalizeAxes(a,f),c=!l&&0===d.length;h.forEach((t,r)=>{c||d.indexOf(r)>=0?o&&u.push(1):u.push(t)});let p=u.length,m=E1.size(u);return{name:t,shaderCache:r,getShaderSource:t=>{let r=[],a=P("_A",i[0].dataType,f),l=N1("output",s,p),u=n(a,l,d),m=u[2];for(let t=0,i=0;t<f;t++)c||d.indexOf(t)>=0?(o&&i++,m=`for(var j${t}: u32 = 0; j${t} < ${h[t]}; j${t}++) {
                  ${u[2].includes("last_index")?`let last_index = j${t};`:""}
                  ${a.indicesSet("input_indices",t,`j${t}`)}
                  ${m}
                }`):(r.push(`${a.indicesSet("input_indices",t,l.indicesGet("output_indices",i))};`),i++);return`

        ${t.registerUniform("output_size","u32").declareVariables(a,l)}

        ${t.mainStart()}
          ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${a.type.indices};
          let output_indices = ${l.offsetToIndices("global_idx")};

          ${r.join(`
`)}
          ${u[0]}       // init ops for reduce max/min
          ${u[1]}
          ${m}
          ${u[3]}
          ${4===u.length?l.setByOffset("global_idx","value"):u.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:u,dataType:s}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},...W(h,u)]})}},ho=(t,r)=>{let i=[];return t[1].dims[0]>0&&t[1].getBigInt64Array().forEach(t=>i.push(Number(t))),te({axes:i,keepDims:r.keepDims,noopWithEmptyAxes:r.noopWithEmptyAxes})},ot=(t,r,i,n)=>{let a=t.inputs,s=1===a.length?i:ho(a,i);t.compute(Qr(r,{hint:s.cacheKey,inputDependencies:["rank"]},[a[0]],s.noopWithEmptyAxes&&0===s.axes.length?Om:n,s.axes,a[0].dataType,s.keepDims,s.noopWithEmptyAxes),{inputs:[0]})},zm=(t,r)=>{nt(t.inputs),ot(t,"ReduceLogSum",r,(t,r)=>[`var value = ${r.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,"value = log(value);"])},Dm=(t,r)=>{nt(t.inputs),ot(t,"ReduceL1",r,(t,r)=>[`var value = ${r.type.storage}(0);`,"",`value += abs(${t.getByIndices("input_indices")});`,""])},Bm=(t,r)=>{nt(t.inputs),ot(t,"ReduceL2",r,(t,r)=>[`var t = ${r.type.value}(0); var value = ${r.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},Mm=(t,r)=>{nt(t.inputs),ot(t,"ReduceLogSumExp",r,(t,r)=>[`var value = ${r.type.storage}(0);`,"",`value += exp(${t.getByIndices("input_indices")});`,"value = log(value);"])},Rm=(t,r)=>{nt(t.inputs),ot(t,"ReduceMax",r,(t,r,i)=>{let n=[];for(let r=0;r<t.rank;r++)(i.indexOf(r)>=0||0===i.length)&&n.push(t.indicesSet("input_indices",r,0));return[`${n.join(`
`)}`,`var value = ${t.getByIndices("input_indices")};`,`value = max(value, ${t.getByIndices("input_indices")});`,""]})},Um=(t,r)=>{nt(t.inputs),ot(t,"ReduceMean",r,(r,i,n)=>{let a=1;for(let i=0;i<r.rank;i++)(n.indexOf(i)>=0||0===n.length)&&(a*=t.inputs[0].dims[i]);return["var sum = f32(0);","",`sum += f32(${r.getByIndices("input_indices")});`,`let value = ${i.type.value}(sum / ${a});`]})},Nm=(t,r)=>{nt(t.inputs),ot(t,"ReduceMin",r,(t,r,i)=>{let n=[];for(let r=0;r<t.rank;r++)(i.indexOf(r)>=0||0===i.length)&&n.push(`input_indices[${r}] = 0;`);return[`${n.join(`
`)}`,`var value = ${t.getByIndices("input_indices")};`,`value = min(value, ${t.getByIndices("input_indices")});`,""]})},Vm=(t,r)=>{nt(t.inputs),ot(t,"ReduceProd",r,(t,r)=>[`var value = ${r.type.storage}(1);`,"",`value *= ${t.getByIndices("input_indices")};`,""])},Lm=(t,r)=>{nt(t.inputs),ot(t,"ReduceSum",r,(t,r)=>[`var value = ${r.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,""])},Wm=(t,r)=>{nt(t.inputs),ot(t,"ReduceSumSquare",r,(t,r)=>[`var t = ${r.type.value}(0); var value = ${r.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += t * t;`,""])},it=(t,r,i)=>{if(0===r.length)return i;let n=1,a=1;for(let i=0;i<r.length;i++)-1===r.indexOf(i)?n*=t[i]:a*=t[i];return a<32&&n>1024},$s=(t,r)=>{it(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Um(t,r):cs(t,r)},xs=(t,r)=>{it(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Dm(t,r):ps(t,r)},Ss=(t,r)=>{it(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Bm(t,r):ms(t,r)},Ts=(t,r)=>{it(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Mm(t,r):fs(t,r)},Cs=(t,r)=>{it(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Rm(t,r):hs(t,r)},Is=(t,r)=>{it(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Nm(t,r):gs(t,r)},As=(t,r)=>{it(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Vm(t,r):ys(t,r)},Es=(t,r)=>{it(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Lm(t,r):bs(t,r)},ks=(t,r)=>{it(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?Wm(t,r):_s(t,r)},Ps=(t,r)=>{it(t.inputs[0].dims,r.axes,r.noopWithEmptyAxes)?zm(t,r):ws(t,r)}}),Bs=L1(()=>{ee(),Se(),Zr(),Os=t=>{if(!t||0===t.length||t.length>2)throw Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(1!==t[0].dataType)throw Error("Invalid input type.")},zs=(t,r)=>{Os(t.inputs);let i=(t,i,n)=>{let a=[];for(let r=0;r<t.rank;r++)(n.indexOf(r)>=0||0===n.length)&&a.push(`input_indices[${r}] = 0;`);return[`${a.join(`
`)}`,`var value = ${t.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${t.getByIndices("input_indices")} ${r.selectLastIndex>0?"<=":"<"} value) {
         value = ${t.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};t.compute(Qr("ArgMin",{hint:r.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],i,[r.axis],7,r.keepDims),{inputs:[0]})},Ds=(t,r)=>{Os(t.inputs);let i=(t,i,n)=>{let a=[];for(let r=0;r<t.rank;r++)(n.indexOf(r)>=0||0===n.length)&&a.push(`input_indices[${r}] = 0;`);return[`${a.join(`
`)}`,`var value = ${t.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${t.getByIndices("input_indices")} ${r.selectLastIndex>0?">=":">"} value) {
         value = ${t.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};t.compute(Qr("argMax",{hint:r.cacheKey,inputDependencies:["rank"]},[t.inputs[0]],i,[r.axis],7,r.keepDims),{inputs:[0]})},go=t=>te(t)}),Yr=L1(()=>{ee(),ae(),qr(),ue(),Gm=(t,r)=>{let i=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5];if(o&&l)throw Error("Attention cannot have both past and attention_bias");if(3!==i.dims.length)throw Error('Input "input" must have 3 dimensions');let u=i.dims[0],h=i.dims[1],f=i.dims[2];if(1!==a.dims.length)throw Error('Input "bias" is expected to have 1 dimensions');if(2!==n.dims.length)throw Error('Input "weights" is expected to have 2 dimensions');if(n.dims[0]!==f)throw Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(a.dims[0]!==n.dims[1])throw Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let d=a.dims[0]/3,c=d,p=c;if(r.qkvHiddenSizes.length>0){if(3!==r.qkvHiddenSizes.length)throw Error("qkv_hidden_sizes attribute should have 3 elements");for(let t of r.qkvHiddenSizes)if(t%r.numHeads!=0)throw Error("qkv_hidden_sizes should be divisible by num_heads");d=r.qkvHiddenSizes[0],c=r.qkvHiddenSizes[1],p=r.qkvHiddenSizes[2]}let m=h;if(d!==c)throw Error("qkv_hidden_sizes first element should be same as the second");if(a.dims[0]!==d+c+p)throw Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let g=0;if(o){if(c!==p)throw Error('Input "past" expect k_hidden_size == v_hidden_size');if(5!==o.dims.length)throw Error('Input "past" must have 5 dimensions');if(2!==o.dims[0])throw Error('Input "past" first dimension must be 2');if(o.dims[1]!==u)throw Error('Input "past" second dimension must be batch_size');if(o.dims[2]!==r.numHeads)throw Error('Input "past" third dimension must be num_heads');if(o.dims[4]!==c/r.numHeads)throw Error('Input "past" fifth dimension must be k_hidden_size / num_heads');r.pastPresentShareBuffer||(g=o.dims[3])}let _=m+g,b=-1,y=0;if(s)throw Error("Mask not supported");if(o)throw Error("past is not supported");if(l){if(4!==l.dims.length)throw Error('Input "attention_bias" must have 4 dimensions');if(l.dims[0]!==u||l.dims[1]!==r.numHeads||l.dims[2]!==h||l.dims[3]!==_)throw Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:u,sequenceLength:h,pastSequenceLength:g,kvSequenceLength:m,totalSequenceLength:_,maxSequenceLength:b,inputHiddenSize:f,hiddenSize:d,vHiddenSize:p,headSize:Math.floor(d/r.numHeads),vHeadSize:Math.floor(p/r.numHeads),numHeads:r.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:r.maskFilterValue,maskType:y,scale:r.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},yo=(t,r,i)=>r&&t?`
      let total_sequence_length_input = u32(${r.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${t?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${i?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,Hm=(t,r,i,n,a,s,o,l)=>{let u=he(o?1:s),h=64,f=s/u;f<64&&(h=32);let d=[{type:12,data:r},{type:12,data:i},{type:12,data:n},{type:12,data:a},{type:12,data:f},{type:12,data:Math.ceil(s/u/h)}],c=ve(t.dataType,u),p=ke(1,u),m=["type"];o&&m.push("type"),l&&m.push("type");let g=r=>{let i=N1("x",t.dataType,t.dims,u),n=[i],a=o?P("seq_lens",o.dataType,o.dims):void 0;a&&n.push(a);let s=l?P("total_sequence_length_input",l.dataType,l.dims):void 0;s&&n.push(s);let f=ke(t.dataType),d=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${h}>;
  var<workgroup> thread_sum: array<f32, ${h}>;
  ${r.registerUniforms(d).declareVariables(...n)}
  ${r.mainStart([h,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${yo(a,s,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${h}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${o?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${p}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${p}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(u){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw Error(`Unsupported components: ${u}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${h}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${p}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${p}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(u){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw Error(`Unsupported components: ${u}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${h}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${i.type.value}(${f}(1.0) / ${f}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${p}(x[offset + i]);
        x[offset + i] = ${i.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${o?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${i.type.value}(${f}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${h};${c};${u}`,inputDependencies:m},getShaderSource:g,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:a,z:r*i},programUniforms:d})}},Fm=(t,r,i,n,a,s,o,l,u)=>{let h=o+s.kvSequenceLength,f=[s.batchSize,s.numHeads,s.sequenceLength,h],d=t>1&&n,c=s.kvNumHeads?s.kvNumHeads:s.numHeads,p=d?[s.batchSize,c,h,s.headSize]:void 0,m=s.nReps?s.nReps:1,g=0===s.scale?1/Math.sqrt(s.headSize):s.scale,_=he(s.headSize),b=s.headSize/_,y=12,v={x:Math.ceil(h/12),y:Math.ceil(s.sequenceLength/y),z:s.batchSize*s.numHeads},w=[{type:12,data:s.sequenceLength},{type:12,data:b},{type:12,data:h},{type:12,data:s.numHeads},{type:12,data:s.headSize},{type:1,data:g},{type:12,data:o},{type:12,data:s.kvSequenceLength},{type:12,data:m}],x=d&&n&&E1.size(n.dims)>0,k=["type","type"];x&&k.push("type"),a&&k.push("type"),l&&k.push("type"),u&&k.push("type");let E=[{dims:f,dataType:r.dataType,gpuDataType:0}];d&&E.push({dims:p,dataType:r.dataType,gpuDataType:0});let S=t=>{let s=P("q",r.dataType,r.dims,_),o=[s,P("key",i.dataType,i.dims,_)];if(x){let t=P("past_key",n.dataType,n.dims,_);o.push(t)}a&&o.push(P("attention_bias",a.dataType,a.dims));let h=l?P("seq_lens",l.dataType,l.dims):void 0;h&&o.push(h);let c=u?P("total_sequence_length_input",u.dataType,u.dims):void 0;c&&o.push(c);let g=N1("output",r.dataType,f),b=[g];d&&b.push(N1("present_key",r.dataType,p,_));let v=ke(1,_),w=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${y}u;

  var<workgroup> tileQ: array<${s.type.storage}, ${y*y}>;
  var<workgroup> tileK: array<${s.type.storage}, ${y*y}>;
  ${t.registerUniforms(w).declareVariables(...o,...b)}
  ${t.mainStart([y,y,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${1===m?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${1===m?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${yo(h,c,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${x&&d?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${d?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${v}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${x&&d?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${d?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${v}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(_){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw Error(`Unsupported components: ${_}`)}})()};
        output[outputIdx] = ${g.type.value} (sum * uniforms.alpha) + ${a?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${_};${void 0!==a};${void 0!==n};${t}`,inputDependencies:k},getRunData:()=>({outputs:E,dispatchGroup:v,programUniforms:w}),getShaderSource:S}},qm=(t,r,i,n,a,s,o,l)=>{let u=s+a.kvSequenceLength,h=a.nReps?a.nReps:1,f=a.vHiddenSize*h,d=t>1&&n,c=a.kvNumHeads?a.kvNumHeads:a.numHeads,p=d?[a.batchSize,c,u,a.headSize]:void 0,m=[a.batchSize,a.sequenceLength,f],g=12,_={x:Math.ceil(a.vHeadSize/g),y:Math.ceil(a.sequenceLength/g),z:a.batchSize*a.numHeads},b=[{type:12,data:a.sequenceLength},{type:12,data:u},{type:12,data:a.vHeadSize},{type:12,data:a.numHeads},{type:12,data:a.headSize},{type:12,data:f},{type:12,data:s},{type:12,data:a.kvSequenceLength},{type:12,data:h}],y=d&&n&&E1.size(n.dims)>0,v=["type","type"];y&&v.push("type"),o&&v.push("type"),l&&v.push("type");let w=[{dims:m,dataType:r.dataType,gpuDataType:0}];d&&w.push({dims:p,dataType:r.dataType,gpuDataType:0});let x=t=>{let a=P("probs",r.dataType,r.dims),s=[a,P("v",i.dataType,i.dims)];y&&s.push(P("past_value",n.dataType,n.dims));let u=o?P("seq_lens",o.dataType,o.dims):void 0;o&&s.push(u);let f=l?P("total_sequence_length_input",l.dataType,l.dims):void 0;l&&s.push(f);let c=[N1("output",r.dataType,m)];d&&c.push(N1("present_value",r.dataType,p));let _=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${g}u;
  var<workgroup> tileQ: array<${a.type.value}, ${g*g}>;
  var<workgroup> tileV: array<${a.type.value}, ${g*g}>;
  ${t.registerUniforms(_).declareVariables(...s,...c)}
  ${t.mainStart([g,g,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${1===h?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${1===h?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${yo(u,f,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${y&&d?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${d?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${a.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${y&&d?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${d?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${void 0!==n};${t}`,inputDependencies:v},getRunData:()=>({outputs:w,dispatchGroup:_,programUniforms:b}),getShaderSource:x}},Ht=(t,r,i,n,a,s,o,l,u,h,f,d)=>{let c=Math.min(t.outputCount,1+ +!!o+ +!!l),p=c>1?h.pastSequenceLength:0,m=p+h.kvSequenceLength,g=u&&E1.size(u.dims)>0?u:void 0,_=[r,i];c>1&&o&&E1.size(o.dims)>0&&_.push(o),g&&_.push(g),f&&_.push(f),d&&_.push(d);let b=t.compute(Fm(c,r,i,o,g,h,p,f,d),{inputs:_,outputs:c>1?[-1,1]:[-1]})[0];t.compute(Hm(b,h.batchSize,h.numHeads,p,h.sequenceLength,m,f,d),{inputs:f&&d?[b,f,d]:[b],outputs:[]});let y=[b,n];c>1&&l&&E1.size(l.dims)>0&&y.push(l),f&&y.push(f),d&&y.push(d),t.compute(qm(c,b,n,l,h,p,f,d),{inputs:y,outputs:c>1?[0,2]:[0]})},jm=(t,r)=>{let i=[r.batchSize,r.numHeads,r.sequenceLength,r.headSize],n=r.sequenceLength,a=r.inputHiddenSize,s=r.headSize,o=12,l={x:Math.ceil(r.headSize/o),y:Math.ceil(r.sequenceLength/o),z:r.batchSize*r.numHeads},u=[t.inputs[0],t.inputs[1],t.inputs[2]],h=[{type:12,data:n},{type:12,data:a},{type:12,data:s},{type:12,data:r.numHeads},{type:12,data:r.headSize},{type:12,data:r.hiddenSize},{type:12,data:r.hiddenSize+r.hiddenSize+r.vHiddenSize}],f=t=>{let r=N1("output_q",u[0].dataType,i),n=N1("output_k",u[0].dataType,i),a=N1("output_v",u[0].dataType,i),s=P("input",u[0].dataType,u[0].dims),l=P("weight",u[1].dataType,u[1].dims),h=P("bias",u[2].dataType,u[2].dims),f=s.type.storage,d=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${o}u;
  var<workgroup> tileInput: array<${f}, ${o*o}>;
  var<workgroup> tileWeightQ: array<${f}, ${o*o}>;
  var<workgroup> tileWeightK: array<${f}, ${o*o}>;
  var<workgroup> tileWeightV: array<${f}, ${o*o}>;
  ${t.registerUniforms(d).declareVariables(s,l,h,r,n,a)}
  ${t.mainStart([o,o,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${f}(0);
    var valueK = ${f}(0);
    var valueV = ${f}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return t.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:i,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:i,dataType:t.inputs[0].dataType,gpuDataType:0},{dims:i,dataType:t.inputs[0].dataType,gpuDataType:0}],dispatchGroup:l,programUniforms:h}),getShaderSource:f},{inputs:u,outputs:[-1,-1,-1]})},Ms=(t,r)=>{let i=Gm(t.inputs,r),[n,a,s]=jm(t,i);return Ht(t,n,a,s,t.inputs[4],void 0,void 0,void 0,t.inputs[5],i)}}),Us=L1(()=>{Ve(),ee(),ae(),Se(),ue(),Km=(t,r)=>{if(!t||5!==t.length)throw Error("BatchNormalization requires 5 inputs");let i=(t,r,i)=>{let n=r.length;if(n!==t.length)throw Error(`${i}: num dimensions != ${n}`);r.forEach((r,n)=>{if(r!==t[n])throw Error(`${i}: dim[${n}] do not match`)})};if(t[0].dims.length>1){let n="NHWC"===r.format?r.spatial?t[0].dims.slice(-1):t[0].dims.slice(-1).concat(t[0].dims.slice(1,t[0].dims.length-1)):t[0].dims.slice(1,r.spatial?2:void 0);i(t[1].dims,n,"Invalid input scale"),i(t[2].dims,n,"Invalid input B"),i(t[3].dims,n,"Invalid input mean"),i(t[4].dims,n,"Invalid input var")}else i(t[1].dims,[1],"Invalid input scale"),i(t[2].dims,[1],"Invalid input B"),i(t[3].dims,[1],"Invalid input mean"),i(t[4].dims,[1],"Invalid input var")},Zm=(t,r)=>{let{epsilon:i,spatial:n,format:a}=r,s=t[0].dims,o=n?he(s[s.length-1]):1,l="NHWC"===a&&s.length>1?o:1,u=E1.size(s)/o,h=n,f=h?s.length:s,d=P("x",t[0].dataType,t[0].dims,o),c=P("scale",t[1].dataType,t[1].dims,l),p=P("bias",t[2].dataType,t[2].dims,l),m=P("inputMean",t[3].dataType,t[3].dims,l),g=P("inputVar",t[4].dataType,t[4].dims,l),_=N1("y",t[0].dataType,f,o),b=()=>{let t="";if(n)t=`let cOffset = ${1===s.length?"0u":"NHWC"===a?`outputIndices[${s.length-1}] / ${o}`:"outputIndices[1]"};`;else if("NCHW"===a)t=`
            ${_.indicesSet("outputIndices","0","0")}
            let cOffset = ${_.indicesToOffset("outputIndices")};`;else{t=`var cIndices = ${c.type.indices}(0);
                       cIndices[0] = outputIndices[${s.length-1}];`;for(let r=1;r<c.rank;r++)t+=`cIndices[${r}] = outputIndices[${r}];`;t+=`let cOffset = ${c.indicesToOffset("cIndices")};`}return t},y=t=>`
  const epsilon = ${i};
  ${t.registerUniform("outputSize","u32").declareVariables(d,c,p,m,g,_)}
  ${t.mainStart()}
  ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${_.offsetToIndices(`global_idx * ${o}`)};
    ${b()}
    let scale = ${c.getByOffset("cOffset")};
    let bias = ${p.getByOffset("cOffset")};
    let inputMean = ${m.getByOffset("cOffset")};
    let inputVar = ${g.getByOffset("cOffset")};
    let x = ${d.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${_.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${r.epsilon}_${r.format}_${n}_${o}`,inputDependencies:h?["rank","type","type","type","type"]:void 0},getShaderSource:y,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h?[{type:12,data:u},...W(s)]:[{type:12,data:u}]})}},Qm=t=>te(t),Rs=(t,r)=>{let{inputs:i,outputCount:n}=t,a=Qm({...r,outputCount:n});if(we.webgpu.validateInputContent&&Km(i,a),r.trainingMode)throw Error("BatchNormalization trainingMode is not supported yet.");t.compute(Zm(i,a))}}),Vs=L1(()=>{ae(),ue(),Ym=t=>{if(3!==t[0].dims.length)throw Error("input should have 3 dimensions");if(![320,640,1280].includes(t[0].dims[2]))throw Error("number of channels should be 320, 640 or 1280");if(1!==t[1].dims.length)throw Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw Error("last dimension of input and bias are not the same")},Xm=t=>{let r=t[0].dims,i=t[0].dims[2],n=E1.size(r)/4,a=t[0].dataType,s=P("input",a,r,4),o=P("bias",a,[i],4),l=P("residual",a,r,4),u=N1("output",a,r,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(n/64)}}),getShaderSource:t=>`
  const channels = ${i}u / 4;
  ${t.declareVariables(s,o,l,u)}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes(n)}
    let value = ${s.getByOffset("global_idx")}
      + ${o.getByOffset("global_idx % channels")} + ${l.getByOffset("global_idx")};
    ${u.setByOffset("global_idx","value")}
  }`}},Ns=t=>{Ym(t.inputs),t.compute(Xm(t.inputs))}}),Jr=L1(()=>{ee(),ae(),Se(),ue(),Jm=(t,r,i,n,a,s,o)=>{let l=Math.ceil(r/4),u="";u="string"==typeof a?`${a}(a)`:a("a");let h=P("inputData",i,[l],4),f=N1("outputData",n,[l],4),d=[{name:"vec_size",type:"u32"}];return o&&d.push(...o),`
      ${t.registerUniforms(d).declareVariables(h,f)}

  ${s??""}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${h.getByOffset("global_idx")};
    ${f.setByOffset("global_idx",u)}
  }`},be=(t,r,i,n,a,s=t.dataType,o,l)=>{let u=[{type:12,data:Math.ceil(E1.size(t.dims)/4)}];return o&&u.push(...o),{name:r,shaderCache:{hint:a,inputDependencies:["type"]},getShaderSource:r=>Jm(r,E1.size(t.dims),t.dataType,s,i,n,l),getRunData:r=>({outputs:[{dims:t.dims,dataType:s}],dispatchGroup:{x:Math.ceil(E1.size(r[0].dims)/64/4)},programUniforms:u})}},Ls=t=>{t.compute(be(t.inputs[0],"Abs","abs"))},Ws=t=>{t.compute(be(t.inputs[0],"Acos","acos"))},Gs=t=>{t.compute(be(t.inputs[0],"Acosh","acosh"))},Hs=t=>{t.compute(be(t.inputs[0],"Asin","asin"))},Fs=t=>{t.compute(be(t.inputs[0],"Asinh","asinh"))},qs=t=>{t.compute(be(t.inputs[0],"Atan","atan"))},js=t=>{t.compute(be(t.inputs[0],"Atanh","atanh"))},Ks=t=>te(t),Zs=(t,r)=>{let i;switch(r.to){case 10:i="vec4<f16>";break;case 1:i="vec4<f32>";break;case 12:i="vec4<u32>";break;case 6:i="vec4<i32>";break;case 9:i="vec4<bool>";break;default:throw RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${r.to}`)}t.compute(be(t.inputs[0],"Cast",i,void 0,r.cacheKey,r.to))},ef=t=>{let r,i,n=t.length>=2&&0!==t[1].data,a=t.length>=3&&0!==t[2].data;switch(t[0].dataType){case 1:r=n?t[1].getFloat32Array()[0]:-34028234663852886e22,i=a?t[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:r=n?t[1].getUint16Array()[0]:64511,i=a?t[2].getUint16Array()[0]:31743;break;default:throw Error("Unsupport data type")}return te({min:r,max:i})},Qs=(t,r)=>{let i=r||ef(t.inputs),n=ke(t.inputs[0].dataType);t.compute(be(t.inputs[0],"Clip",t=>`clamp(${t}, vec4<${n}>(uniforms.min), vec4<${n}>(uniforms.max))`,void 0,i.cacheKey,void 0,[{type:t.inputs[0].dataType,data:i.min},{type:t.inputs[0].dataType,data:i.max}],[{name:"min",type:n},{name:"max",type:n}]),{inputs:[0]})},Ys=t=>{t.compute(be(t.inputs[0],"Ceil","ceil"))},Xs=t=>{t.compute(be(t.inputs[0],"Cos","cos"))},Js=t=>{t.compute(be(t.inputs[0],"Cosh","cosh"))},or=t=>te(t),eu=(t,r)=>{let i=ke(t.inputs[0].dataType);t.compute(be(t.inputs[0],"Elu",t=>`elu_vf32(${t})`,`
  const elu_alpha_ = ${i}(${r.alpha});

  fn elu_f32(a: ${i}) -> ${i} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${i}>) -> vec4<${i}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,r.cacheKey))},Xr=(t="f32")=>`
const r0: ${t} = 0.3275911;
const r1: ${t} = 0.254829592;
const r2: ${t} = -0.284496736;
const r3: ${t} = 1.421413741;
const r4: ${t} = -1.453152027;
const r5: ${t} = 1.061405429;

fn erf_vf32(v: vec4<${t}>) -> vec4<${t}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,tu=t=>{let r=ke(t.inputs[0].dataType);t.compute(be(t.inputs[0],"Erf",t=>`erf_vf32(${t})`,Xr(r)))},ru=t=>{t.compute(be(t.inputs[0],"Exp","exp"))},nu=t=>{t.compute(be(t.inputs[0],"Floor","floor"))},ou=t=>{let r=ke(t.inputs[0].dataType);t.compute(be(t.inputs[0],"Gelu",t=>`0.5 * ${t} * (1.0 + erf_vf32(${t} * 0.7071067811865475))`,Xr(r)))},iu=(t,r)=>{let i=ke(t.inputs[0].dataType);t.compute(be(t.inputs[0],"LeakyRelu",t=>`select(leaky_relu_alpha_ * ${t}, ${t}, ${t} >= vec4<${i}>(0.0))`,`const leaky_relu_alpha_ = ${i}(${r.alpha});`,r.cacheKey))},au=t=>{t.compute(be(t.inputs[0],"Not",t=>`!${t}`))},su=t=>{t.compute(be(t.inputs[0],"Neg",t=>`-${t}`))},uu=t=>{t.compute(be(t.inputs[0],"Reciprocal",t=>`1.0/${t}`))},lu=t=>{let r=ke(t.inputs[0].dataType);t.compute(be(t.inputs[0],"Relu",t=>`select(vec4<${r}>(0.0), ${t}, ${t} > vec4<${r}>(0.0))`))},du=t=>{t.compute(be(t.inputs[0],"Sigmoid",t=>`(1.0 / (1.0 + exp(-${t})))`))},cu=t=>te(t),pu=(t,r)=>{let i=ke(t.inputs[0].dataType);t.compute(be(t.inputs[0],"HardSigmoid",t=>`max(vec4<${i}>(0.0), min(vec4<${i}>(1.0), ${r.alpha} * ${t} + vec4<${i}>(${r.beta})))`,void 0,r.cacheKey))},mu=t=>{t.compute(be(t.inputs[0],"Sin","sin"))},fu=t=>{t.compute(be(t.inputs[0],"Sinh","sinh"))},hu=t=>{t.compute(be(t.inputs[0],"Sqrt","sqrt"))},gu=t=>{t.compute(be(t.inputs[0],"Tan","tan"))},yu=t=>`sign(${t}) * (1 - exp(-2 * abs(${t}))) / (1 + exp(-2 * abs(${t})))`,bu=t=>{t.compute(be(t.inputs[0],"Tanh",yu))},bo=(t="f32")=>`
const fast_gelu_a: ${t} = 0.5;
const fast_gelu_b: ${t} = 0.7978845608028654;
const fast_gelu_c: ${t} = 0.035677408136300125;

fn tanh_v(v: vec4<${t}>) -> vec4<${t}> {
  return ${yu("v")};
}
`,_o=t=>`(fast_gelu_a + fast_gelu_a * tanh_v(${t} * (fast_gelu_c * ${t} * ${t} + fast_gelu_b))) * ${t}`,_u=t=>{let r=ke(t.inputs[0].dataType);t.compute(be(t.inputs[0],"FastGelu",_o,bo(r),void 0,t.inputs[0].dataType))},wu=(t,r)=>{let i=ke(t.inputs[0].dataType);return t.compute(be(t.inputs[0],"ThresholdedRelu",t=>`select(vec4<${i}>(0.0), ${t}, ${t} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${i}>(${r.alpha});`,r.cacheKey)),0},vu=t=>{t.compute(be(t.inputs[0],"Log","log"))},tf=(t,r)=>`
const alpha = vec4<${t}>(${r});
const one = ${t}(1.0);
const zero = ${t}(0.0);

fn quick_gelu_impl(x: vec4<${t}>) -> vec4<${t}> {
  let v = x *alpha;
  var x1 : vec4<${t}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,rf=t=>`quick_gelu_impl(${t})`,$u=(t,r)=>{let i=ke(t.inputs[0].dataType);t.compute(be(t.inputs[0],"QuickGelu",rf,tf(i,r.alpha),r.cacheKey,t.inputs[0].dataType))}}),Tu=L1(()=>{ae(),ue(),Jr(),nf=t=>{if(3!==t[0].dims.length)throw Error("input should have 3 dimensions");if(![2560,5120,10240].includes(t[0].dims[2]))throw Error("hidden state should be 2560, 5120 or 10240");if(1!==t[1].dims.length)throw Error("bias is expected to have 1 dimensions");if(t[0].dims[2]!==t[1].dims[0])throw Error("last dimension of input and bias are not the same")},of=t=>{let r=t[0].dims.slice();r[2]=r[2]/2;let i=P("input",t[0].dataType,t[0].dims,4),n=P("bias",t[0].dataType,[t[0].dims[2]],4),a=N1("output",t[0].dataType,r,4),s=E1.size(r)/4,o=ve(t[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)}}),getShaderSource:r=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${t[0].dims[2]/4/2}u;

  ${r.declareVariables(i,n,a)}

  ${Xr(o)}

  ${r.mainStart()}
    ${r.guardAgainstOutOfBoundsWorkgroupSizes(s)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${a.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},Su=t=>{nf(t.inputs),t.compute(of(t.inputs))}}),Mu=L1(()=>{ee(),ae(),ue(),af=(t,r,i,n,a,s,o,l,u,h,f,d)=>{let c,p;"string"==typeof l?c=p=(t,r)=>`${l}((${t}),(${r}))`:"function"==typeof l?c=p=l:(c=l.scalar,p=l.vector);let m=N1("outputData",f,n.length,4),g=P("aData",u,r.length,4),_=P("bData",h,i.length,4),b;if(a)if(s){let t=1===E1.size(r),n=1===E1.size(i),a=r.length>0&&r[r.length-1]%4==0,s=i.length>0&&i[i.length-1]%4==0;b=t||n?m.setByOffset("global_idx",p(t?`${g.type.value}(${g.getByOffset("0")}.x)`:g.getByOffset("global_idx"),n?`${_.type.value}(${_.getByOffset("0")}.x)`:_.getByOffset("global_idx"))):`
            let outputIndices = ${m.offsetToIndices("global_idx * 4u")};
            let offsetA = ${g.broadcastedIndicesToOffset("outputIndices",m)};
            let offsetB = ${_.broadcastedIndicesToOffset("outputIndices",m)};
            ${m.setByOffset("global_idx",p(o||a?g.getByOffset("offsetA / 4u"):`${g.type.value}(${g.getByOffset("offsetA / 4u")}[offsetA % 4u])`,o||s?_.getByOffset("offsetB / 4u"):`${_.type.value}(${_.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else b=m.setByOffset("global_idx",p(g.getByOffset("global_idx"),_.getByOffset("global_idx")));else{if(!s)throw Error("no necessary to use scalar implementation for element-wise binary op implementation.");let t=(t,r,i="")=>{let n=`aData[indexA${r}][componentA${r}]`,a=`bData[indexB${r}][componentB${r}]`;return`
            let outputIndices${r} = ${m.offsetToIndices(`global_idx * 4u + ${r}u`)};
            let offsetA${r} = ${g.broadcastedIndicesToOffset(`outputIndices${r}`,m)};
            let offsetB${r} = ${_.broadcastedIndicesToOffset(`outputIndices${r}`,m)};
            let indexA${r} = offsetA${r} / 4u;
            let indexB${r} = offsetB${r} / 4u;
            let componentA${r} = offsetA${r} % 4u;
            let componentB${r} = offsetB${r} % 4u;
            ${t}[${r}] = ${i}(${c(n,a)});
          `};b=9===f?`
            var data = vec4<u32>(0);
            ${t("data",0,"u32")}
            ${t("data",1,"u32")}
            ${t("data",2,"u32")}
            ${t("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:`
            ${t("outputData[global_idx]",0)}
            ${t("outputData[global_idx]",1)}
            ${t("outputData[global_idx]",2)}
            ${t("outputData[global_idx]",3)}
          `}return`
        ${t.registerUniform("vec_size","u32").declareVariables(g,_,m)}

        ${d??""}

        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${b}
      }`},sf=(t,r,i,n,a,s,o=i.dataType)=>{let l=i.dims.map(t=>Number(t)??1),u=n.dims.map(t=>Number(t)??1),h=!E1.areEqual(l,u),f=l,d=E1.size(l),c=!1,p=!1,m=[h];if(h){let t=tt.calcShape(l,u,!1);if(!t)throw Error("Can't perform binary op on the given tensors");f=t.slice(),d=E1.size(f);let r=1===E1.size(l),i=1===E1.size(u),n=l.length>0&&l[l.length-1]%4==0,a=u.length>0&&u[u.length-1]%4==0;m.push(r),m.push(i),m.push(n),m.push(a);let s=1;for(let t=1;t<f.length;t++){let r=l[l.length-t];if(r===u[u.length-t])s*=r;else break}s%4==0?(p=!0,c=!0):(r||i||n||a)&&(c=!0)}else c=!0;return m.push(c),{name:t,shaderCache:{hint:r+m.map(t=>t.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:t=>af(t,l,u,f,c,h,p,a,i.dataType,n.dataType,o,s),getRunData:()=>({outputs:[{dims:f,dataType:o}],dispatchGroup:{x:Math.ceil(d/64/4)},programUniforms:[{type:12,data:Math.ceil(E1.size(f)/4)},...W(l,u,f)]})}},at=(t,r,i,n,a,s)=>{t.compute(sf(r,a??"",t.inputs[0],t.inputs[1],i,n,s))},Cu=t=>{at(t,"Add",(t,r)=>`${t}+${r}`)},Iu=t=>{at(t,"Div",(t,r)=>`${t}/${r}`)},Au=t=>{at(t,"Equal",{scalar:(t,r)=>`u32(${t}==${r})`,vector:(t,r)=>`vec4<u32>(${t}==${r})`},void 0,void 0,9)},Eu=t=>{at(t,"Mul",(t,r)=>`${t}*${r}`)},ku=t=>{let r=P("input",t.inputs[0].dataType,t.inputs[0].dims).type.value;at(t,"Pow",{scalar:(t,r)=>`pow_custom(${t},${r})`,vector:(t,r)=>`pow_vector_custom(${t},${r})`},`
    fn pow_custom(a : ${r}, b : ${r}) -> ${r} {
      if (b == ${r}(0.0)) {
        return ${r}(1.0);
      } else if (a < ${r}(0.0) && f32(b) != floor(f32(b))) {
        return ${r}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${r}(1.0), round(f32(abs(b) % ${r}(2.0))) != 1.0) * ${r}(${"i32"===r?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${r}>, b : vec4<${r}>) -> vec4<${r}> {
      // TODO: implement vectorized pow
      return vec4<${r}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},Pu=t=>{at(t,"Sub",(t,r)=>`${t}-${r}`)},Ou=t=>{at(t,"Greater",{scalar:(t,r)=>`u32(${t}>${r})`,vector:(t,r)=>`vec4<u32>(${t}>${r})`},void 0,void 0,9)},zu=t=>{at(t,"Less",{scalar:(t,r)=>`u32(${t}<${r})`,vector:(t,r)=>`vec4<u32>(${t}<${r})`},void 0,void 0,9)},Du=t=>{at(t,"GreaterOrEqual",{scalar:(t,r)=>`u32(${t}>=${r})`,vector:(t,r)=>`vec4<u32>(${t}>=${r})`},void 0,void 0,9)},Bu=t=>{at(t,"LessOrEqual",{scalar:(t,r)=>`u32(${t}<=${r})`,vector:(t,r)=>`vec4<u32>(${t}<=${r})`},void 0,void 0,9)}}),Nu=L1(()=>{ee(),ae(),Se(),ue(),lf=(t,r)=>{if(!t||t.length<1)throw Error("too few inputs");let i=0,n=t[0],a=n.dataType,s=n.dims.length;t.forEach((t,o)=>{if(o!==i){if(t.dataType!==a)throw Error("input tensors should be one type");if(t.dims.length!==s)throw Error("input tensors should have the same shape");t.dims.forEach((t,i)=>{if(i!==r&&t!==n.dims[i])throw Error("non concat dimensions must match")})}})},df=(t,r)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${t}u>(${r});
    for (var i: u32 = 0u; i < ${t}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${t}u;
  }`,cf=(t,r)=>{let i=t.length,n=[];for(let a=0;a<i;++a){let s=r.setByOffset("global_idx",t[a].getByIndices("indices"));1===i?n.push(s):0===a?n.push(`if (inputIndex == ${a}u) { ${s} }`):a===i-1?n.push(`else { ${s} }`):n.push(`else if (inputIndex == ${a}) { ${s} }`)}return n.join(`
`)},pf=(t,r,i,n)=>{let a=E1.size(i),s=Array(t.length),o=Array(t.length),l=0,u=[],h=[],f=[{type:12,data:a}];for(let i=0;i<t.length;++i)l+=t[i].dims[r],s[i]=l,h.push(t[i].dims.length),o[i]=P(`input${i}`,n,h[i]),u.push("rank"),f.push({type:12,data:s[i]});for(let r=0;r<t.length;++r)f.push(...W(t[r].dims));f.push(...W(i));let d=N1("output",n,i.length),c=d.indicesGet("indices",r),p=Array.from(Array(s.length).keys()).map(t=>`uniforms.sizeInConcatAxis${t}`).join(",");return{name:"Concat",shaderCache:{hint:`${r}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:i,dataType:n}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:f}),getShaderSource:r=>`

  ${(()=>{r.registerUniform("outputSize","u32");for(let i=0;i<t.length;i++)r.registerUniform(`sizeInConcatAxis${i}`,"u32");return r.declareVariables(...o,d)})()}

  ${df(s.length,p)}

  ${r.mainStart()}
    ${r.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${d.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${c});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${s.length}u>(${p});
      ${c} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${cf(o,d)}
  }`}},Ru=(t,r)=>{let i=t.inputs,n=i[0].dims,a=E1.normalizeAxis(r.axis,n.length);lf(i,a);let s=n.slice();s[a]=i.reduce((t,r)=>t+(r.dims.length>a?r.dims[a]:0),0);let o=i.filter(t=>E1.size(t.dims)>0);t.compute(pf(o,a,s,i[0].dataType),{inputs:o})},Uu=t=>te({axis:t.axis})}),Tt=L1(()=>{ee(),ae(),Ke=(t,r,i="f32")=>{switch(t.activation){case"Relu":return`value = max(value, ${r}(0.0));`;case"Sigmoid":return`value = (${r}(1.0) / (${r}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${r}(${i}(uniforms.clip_min)), ${r}(${i}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${r}(0.0), min(${r}(1.0), ${i}(uniforms.alpha) * value + ${i}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${i}(uniforms.alpha) * value, value, value >= ${r}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw Error(`Unsupported activation ${t.activation}`)}},Ze=(t,r)=>{"Clip"===t.activation?r.push({type:1,data:t.clipMax},{type:1,data:t.clipMin}):"HardSigmoid"===t.activation?r.push({type:1,data:t.alpha},{type:1,data:t.beta}):"LeakyRelu"===t.activation&&r.push({type:1,data:t.alpha})},Qe=(t,r)=>{"Clip"===t.activation?r.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):"HardSigmoid"===t.activation?r.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):"LeakyRelu"===t.activation&&r.push({name:"alpha",type:"f32"})},en=t=>{let r=t?.activation||"";if("HardSigmoid"===r){let[i,n]=t?.activation_params||[.2,.5];return{activation:r,alpha:i,beta:n}}if("Clip"===r){let[i,n]=t?.activation_params||[qa,ja];return{activation:r,clipMax:n,clipMin:i}}if("LeakyRelu"===r){let[i]=t?.activation_params||[.01];return{activation:r,alpha:i}}return{activation:r}}}),tn=L1(()=>{Ae=(t,r)=>{switch(t){case 1:return r;case 2:return`vec2<${r}>`;case 3:return`vec3<${r}>`;case 4:return`vec4<${r}>`;default:throw Error(`${t}-component is not supported.`)}},Vu=t=>`
      ${t?"value = value + getBiasByOutputCoords(coords);":""}
      `}),Wu=L1(()=>{Lu=t=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${t}.x), i32(${t}.y), i32(${t}.z), 1));
}
`}),nn=L1(()=>{ee(),ae(),ue(),Tt(),ir=(t,r,i,n,a)=>{let s=n-i;return`
      ${Array.from({length:i}).map((i,o)=>`
      if (${K(r.shape,o,r.rank)} != 1) {
        ${r.indicesSet(t,o,K(a,o+s,n))}
      } else {
        ${r.indicesSet(t,o,0)}
      }`).join("")}
`},rn=(t,r,i,n,a=!1,s)=>{let o=t[0].dims,l=t[1].dims,u=o[o.length-2],h=l[l.length-1],f=o[o.length-1],d=he(h),c=he(f),p=he(u),m=E1.size(i)/d/p,g=t.length>2,_=n?n.slice(0,-2):i.slice(0,-2),b=[E1.size(_),u,h],y=[{type:12,data:m},{type:12,data:u},{type:12,data:h},{type:12,data:f}];Ze(r,y),y.push(...W(_,o,l)),g&&y.push(...W(t[2].dims)),y.push(...W(b));let v=n=>{let s=Kr("batch_dims",t[0].dataType,_.length),u=P("a",t[0].dataType,o.length,c),h=P("b",t[1].dataType,l.length,d),f=N1("output",t[0].dataType,b.length,d),m=ve(f.type.tensor),y=Ke(r,f.type.value,m),v=[u,h],w="";if(g){let r=a?d:1;v.push(P("bias",t[2].dataType,t[2].dims.length,r)),w=`${a?`value += bias[col / ${r}];`:`value += ${f.type.value}(bias[row + i]);`}`}let x=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Qe(r,x);let k=()=>{let t=`var a_data: ${u.type.value};`;for(let r=0;r<c;r++)t+=`
              let b_data${r} = b[(b_offset + (k + ${r}) * uniforms.N + col) / ${d}];`;for(let r=0;r<p;r++){t+=`a_data = a[(a_offset + (row + ${r}) * uniforms.K + k) / ${c}];`;for(let i=0;i<c;i++)t+=`
            values[${r}] = fma(${h.type.value}(a_data${1===c?"":`[${i}]`}), b_data${i}, values[${r}]);
`}return t};return`
  ${n.registerUniforms(x).registerInternalVariables(s).declareVariables(...v,f)}
  ${n.mainStart()}
    ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${d})) * ${d};
    var index1 = global_idx / (uniforms.N / ${d});
    let stride1 = uniforms.M / ${p};
    let row = (index1 % stride1) * ${p};
    let batch = index1 / stride1;

    ${2===i.length?"":`let batch_indices = ${s.offsetToIndices("batch")};`}

    var a_indices: ${u.type.indices};
    ${ir("a_indices",u,u.rank-2,s.rank,"batch_indices")}
    ${u.indicesSet("a_indices",u.rank-2,0)}
    ${u.indicesSet("a_indices",u.rank-1,0)}
    let a_offset = ${u.indicesToOffset("a_indices")};

    var b_indices: ${h.type.indices};
    ${ir("b_indices",h,h.rank-2,s.rank,"batch_indices")}
    ${h.indicesSet("b_indices",h.rank-2,0)}
    ${h.indicesSet("b_indices",h.rank-1,0)}
    let b_offset = ${h.indicesToOffset("b_indices")};
    var values: array<${f.type.value}, ${p}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${c}) {
      ${k()}
    }
    for (var i = 0u; i < ${p}u; i++) {
      var value = values[i];
      ${w}
      ${y}
      let cur_indices = ${f.type.indices}(batch, row + i, col);
      let offset = ${f.indicesToOffset("cur_indices")};
      ${f.setByOffset(`offset / ${d}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${r.activation};${d};${c};${p};${a}`,inputDependencies:g?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:s?s(i):i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:y}),getShaderSource:v}}}),on=L1(()=>{ee(),ae(),ue(),Tt(),nn(),tn(),mf=(t,r)=>t?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${r?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${r?", batchIndices":""});
        `,ff=(t,r)=>t?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${3===r?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${3===r?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${3===r?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,wo=(t,r,i="f32",n,a=!1,s=32,o=!1,l=32)=>{let u=r[1]*t[1],h=r[0]*t[0],f=a?u:s,d=a?s:u,c=f/r[0],p=s/r[1];if(!((a&&4===c&&4===t[1]||!a&&(3===c||4===c))&&f%r[0]==0&&s%r[1]==0&&4===t[0]))throw Error(`If transposeA ${a} is true, innerElementSize ${c} and workPerThread[1] ${t[1]} must be 4.
      Otherwise, innerElementSize ${c} must be 3 or 4.
  tileAWidth ${f} must be divisible by workgroupSize[0]${r[0]}. tileInner ${s} must be divisible by workgroupSize[1] ${r[1]}. colPerThread ${t[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${c}<${i}>, ${f/c}>, ${d}>;
var<workgroup> mm_Bsub: array<array<vec4<${i}>, ${h/t[0]}>, ${s}>;

const rowPerThread = ${t[1]};
const colPerThread = ${t[0]};
const innerElementSize = ${c};
const tileInner = ${s};

@compute @workgroup_size(${r[0]}, ${r[1]}, ${r[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${o?"0":"i32(globalId.z)"};
  ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${u};

  let num_tiles = ${o?`${Math.ceil(l/s)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${o?`i32(globalId.z) * ${l}`:"0"};

  var acc: array<vec4<${i}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${p};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${mf(a,n)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${p}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${n?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${3===c?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${ff(a,c)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Gu=(t,r)=>t?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${r?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${r?", batchIndices":""});
            `,hf=t=>t?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",vo=(t,r,i="f32",n,a=!1,s=32,o=!1,l=32,u=!1)=>{let h=t[1]*r[1],f=t[0]*r[0],d=a?h:s,c=a?s:h;if(c%r[1]!=0||d%r[0]!=0||s%r[1]!=0)throw Error(`tileAHight ${c} must be divisible by workgroupSize[1]${r[1]}, tileAWidth ${d} must be divisible by workgroupSize[0]${r[0]}, tileInner ${s} must be divisible by workgroupSize[1]${r[1]}`);let p=c/r[1],m=d/r[0],g=s/r[1],_=u?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${h};
    let globalColStart = i32(workgroupId.x) * ${f};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${c}; inputRow = inputRow + ${r[1]}) {
        for (var inputCol = localCol; inputCol < ${d}; inputCol = inputCol + ${r[0]}) {
          ${Gu(a,n)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${s}; inputRow = inputRow + ${r[1]}) {
            for (var inputCol = localCol; inputCol < ${f}; inputCol = inputCol + ${r[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${n?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${i}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${r[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${a?`mm_Asub[k][localRow + innerRow * ${r[1]}];`:`mm_Asub[localRow + innerRow * ${r[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${r[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${r[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${h};

let tileRowA = i32(localId.y) * ${p};
let tileColA = i32(localId.x) * ${m};
let tileRowB = i32(localId.y) * ${g};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${p}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${m}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Gu(a,n)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${g}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${n?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${i}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${hf(a)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${i}, ${d}>, ${c}>;
  var<workgroup> mm_Bsub : array<array<${i}, ${f}>, ${s}>;
  const rowPerThread = ${t[1]};
  const colPerThread = ${t[0]};
  const tileInner = ${s};

@compute @workgroup_size(${r[0]}, ${r[1]}, ${r[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${o?"0":"i32(globalId.z)"};
    ${n?`let batchIndices = ${n.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${o?`${Math.ceil(l/s)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${o?`i32(globalId.z) * ${l}`:"0"};

    var acc : array<array<${i}, colPerThread>, rowPerThread>;
    ${_}
  }
`},gf=(t,r,i,n,a=!1)=>{let[s,o,l,u]=n,h=ve(n[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${s.type.indices}) -> ${Ae(t,h)} {
      var value = ${Ae(t,h)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${o.type.indices};
        ${ir("aIndices",o,o.rank-2,s.rank,"batchIndices")}
        ${o.indicesSet("aIndices",o.rank-2,"u32(row)")}
        ${o.indicesSet("aIndices",o.rank-1,"u32(colIn)")}
        value = ${o.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${s.type.indices}) -> ${Ae(t,h)} {
      var value = ${Ae(t,h)}(0.0);
      let col = colIn * ${t};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${l.type.indices};
        ${ir("bIndices",l,l.rank-2,s.rank,"batchIndices")}
        ${l.indicesSet("bIndices",l.rank-2,"u32(row)")}
        ${l.indicesSet("bIndices",l.rank-1,"u32(colIn)")}
        value = ${l.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${Ae(t,h)}) {
      let col = colIn * ${t};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${r?`value = value + ${a?"bias[colIn]":`${Ae(t,h)}(bias[row])`};`:""}
        ${i}
        ${u.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},ar=(t,r,i,n,a=!1,s)=>{let o=t[0].dims,l=t[1].dims,u=o.slice(0,-2),h=l.slice(0,-2),f=n?n.slice(0,-2):i.slice(0,-2),d=E1.size(f),c=o[o.length-2],p=o[o.length-1],m=l[l.length-1],g=p%4==0&&m%4==0,_=c<=8?[4,1,1]:[4,4,1],b=[8,8,1],y=[Math.ceil(m/b[0]/_[0]),Math.ceil(c/b[1]/_[1]),Math.ceil(d/b[2]/_[2])],v=g?4:1,w=[...u,c,p/v],x=w.length,k=[...h,p,m/v],E=k.length,S=[d,c,m/v],$=[{type:6,data:c},{type:6,data:m},{type:6,data:p}];Ze(r,$),$.push(...W(f,w,k));let I=["rank","rank"],A=t.length>2;A&&($.push(...W(t[2].dims)),I.push("rank")),$.push(...W(S));let M=i=>{let n=f.length,s=Kr("batchDims",t[0].dataType,n,1),o=ve(t[0].dataType),l=P("a",t[0].dataType,x,v),u=P("b",t[1].dataType,E,v),h=N1("result",t[0].dataType,S.length,v),d=[l,u];if(A){let r=a?v:1;d.push(P("bias",t[2].dataType,t[2].dims.length,r))}let c=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Qe(r,c);let p=ve(h.type.tensor),m=gf(v,A,Ke(r,h.type.value,p),[s,l,u,h],a);return`
  ${i.registerUniforms(c).registerInternalVariables(s).declareVariables(...d,h)}
  ${m}
  ${g?wo(_,b,o,s):vo(_,b,o,s)}
                   `};return{name:"MatMul",shaderCache:{hint:`${_};${r.activation};${g};${a}`,inputDependencies:I},getRunData:()=>({outputs:[{dims:s?s(i):i,dataType:t[0].dataType}],dispatchGroup:{x:y[0],y:y[1],z:y[2]},programUniforms:$}),getShaderSource:M}}}),Fu=L1(()=>{ee(),et(),ue(),Tt(),tn(),Wu(),on(),yf=(t,r,i,n,a=!1,s,o=4,l=4,u=4,h="f32")=>{let f=t=>{switch(t){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${h}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw Error(`innerElementSize ${t} is not supported.`)}},d=t=>{switch(t){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw Error(`innerElementSize ${t} is not supported.`)}},c=t?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,p=t?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,m=t?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",g=t?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",_=t?"row":"col",b=t?"col":"row",y=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${_} / outWidth;
    let outCol = ${_} % outWidth;

    let WRow = ${b} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${b} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${b} % inChannels;
    var resData = ${Ae(o,h)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${m} && xCol >= 0 && xCol < ${g}) {
      ${c}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${f(o)}
    }
    return resData;`,v=t?r&&n?`
    let col = colIn * ${o};
    ${y}`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${y}
    }
    return ${Ae(o,h)}(0.0);`:n&&i?`
    let col = colIn * ${o};
    ${y}`:`
    let col = colIn * ${o};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${y}
    }
    return ${Ae(o,h)}(0.0);`,w=t?n&&i?d(l):`
    let col = colIn * ${l};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${d(l)}
    }
    return ${Ae(l,h)}(0.0);`:`
    let col = colIn * ${l};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${d(l)}
    }
    return ${Ae(l,h)}(0.0);`,x=Ae(u,h),k=t?Ae(o,h):Ae(l,h),E=t?Ae(l,h):Ae(o,h),S=Ke(s,x,h);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${k} {
      ${t?v:w}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${E} {
      ${t?w:v}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${x}) {
      let col = colIn * ${u};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${t?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${p}
      ${Vu(a)}
      ${S}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},Hu=(t,r,i,n,a,s,o,l,u)=>{let h="NHWC"===r.format,f=h?t[0].dims[3]:t[0].dims[1],d=i[0],c=h?i[2]:i[3],p=h?i[1]:i[2],m=h?i[3]:i[1],g=h&&(f%4==0||f%3==0)&&m%4==0,_=h?m:c*p,b=h?c*p:m,y=[8,8,1],v=n<=8?[4,1,1]:[4,4,1],w=[Math.ceil(_/y[0]/v[0]),Math.ceil(b/y[1]/v[1]),Math.ceil(d/y[2]/v[2])];le("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${w}`);let x=g?h&&f%4!=0?3:4:1,k=y[1]*v[1],E=y[0]*v[0],S=Math.max(y[0]*x,y[1]),$=n%k==0,I=a%E==0,A=s%S==0,M=g?[x,4,4]:[1,1,1],T=[{type:6,data:n},{type:6,data:a},{type:6,data:s},{type:6,data:[r.pads[0],r.pads[1]]},{type:6,data:r.strides},{type:6,data:r.dilations}];Ze(r,T),T.push(...W(t[0].dims,t[1].dims));let C=["rank","rank"];o&&(T.push(...W(t[2].dims)),C.push("rank")),T.push(...W(i));let z=n=>{let a=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Qe(r,a);let s=g?4:1,u=ve(t[0].dataType),f=`
      fn setOutputAtIndex(flatIndex : i32, value : ${g?`vec4<${u}>`:u}) {
        result[flatIndex] = ${g?`vec4<${u}>`:u}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${g?`vec4<${u}>`:u}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${g?"/ 4":""}, value);
      }`,d=[P("x",t[0].dataType,t[0].dims.length,3===x?1:x),P("w",t[1].dataType,t[1].dims.length,s)],c=N1("result",t[0].dataType,i.length,s);if(o){let r=P("bias",t[2].dataType,t[2].dims.length,s);d.push(r),f+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${g?`vec4<${u}>`:u} {
          return bias[coords.${h?"w":"y"}${g?"/ 4":""}];
        }`}return`
        ${Lu("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${n.registerUniforms(a).declareVariables(...d,c)}
        ${f}
        ${yf(h,$,I,A,o,r,M[0],M[1],M[2],u)}
        ${g?wo(v,y,u,void 0,!h,S):vo(v,y,u,void 0,!h,S,!1,void 0,l)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${r.cacheKey};${x};${g};${$};${I};${A};${k};${E};${S}`,inputDependencies:C},getRunData:()=>({outputs:[{dims:u?u(i):i,dataType:t[0].dataType}],dispatchGroup:{x:w[0],y:w[1],z:w[2]},programUniforms:T}),getShaderSource:z}}}),Qu=L1(()=>{ee(),et(),ae(),ue(),Tt(),tn(),bf=t=>{let r=1;for(let i=0;i<t.length;i++)r*=t[i];return r},qu=t=>"number"==typeof t?[t,t,t]:t,an=(t,r)=>r<=1?t:t+(t-1)*(r-1),_f=(t,r,i,n=1)=>{let a=an(r,n);return Math.floor((t[0]*(i-1)-i+a)/2)},ju=(t,r,i,n,a)=>{null==a&&(a=_f(t,r[0],n[0]));let s=[0,0,0,i];for(let i=0;i<3;i++)t[i]+2*a>=r[i]&&(s[i]=Math.trunc((t[i]-r[i]+2*a)/n[i]+1));return s},wf=(t,r,i,n,a,s,o,l,u,h)=>{let f,d,c,p;if("VALID"===t&&(t=0),"number"==typeof t){f={top:t,bottom:t,left:t,right:t,front:t,back:t};let m=ju([r,i,n,1],[l,u,h],1,[a,s,o],t);d=m[0],c=m[1],p=m[2]}else if(Array.isArray(t)){if(!t.every((t,r,i)=>t===i[0]))throw Error(`Unsupported padding parameter: ${t}`);f={top:t[0],bottom:t[1],left:t[2],right:t[3],front:t[4],back:t[5]};let m=ju([r,i,n,1],[l,u,h],1,[a,s,o],t[0]);d=m[0],c=m[1],p=m[2]}else if("SAME_UPPER"===t){d=Math.ceil(r/a),c=Math.ceil(i/s),p=Math.ceil(n/o);let t=(d-1)*a+l-r,m=(c-1)*s+u-i,g=(p-1)*o+h-n,_=Math.floor(t/2),b=t-_,y=Math.floor(m/2),v=m-y,w=Math.floor(g/2),x=g-w;f={top:y,bottom:v,left:w,right:x,front:_,back:b}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:f,outDepth:d,outHeight:c,outWidth:p}},Ku=(t,r,i,n,a,s=!1,o="channelsLast")=>{let l,u,h,f,d;if("channelsLast"===o)[l,u,h,f,d]=t;else if("channelsFirst"===o)[l,d,u,h,f]=t;else throw Error(`Unknown dataFormat ${o}`);let[c,,p,m,g]=r,[_,b,y]=qu(i),[v,w,x]=qu(n),k=an(p,v),E=an(m,w),S=an(g,x),{padInfo:$,outDepth:I,outHeight:A,outWidth:M}=wf(a,u,h,f,_,b,y,k,E,S),T=s?c*d:c,C=[0,0,0,0,0];return"channelsFirst"===o?C=[l,T,I,A,M]:"channelsLast"===o&&(C=[l,I,A,M,T]),{batchSize:l,dataFormat:o,inDepth:u,inHeight:h,inWidth:f,inChannels:d,outDepth:I,outHeight:A,outWidth:M,outChannels:T,padInfo:$,strideDepth:_,strideHeight:b,strideWidth:y,filterDepth:p,filterHeight:m,filterWidth:g,effectiveFilterDepth:k,effectiveFilterHeight:E,effectiveFilterWidth:S,dilationDepth:v,dilationHeight:w,dilationWidth:x,inShape:t,outShape:C,filterShape:r}},Zu=(t,r,i,n,a,s)=>{let o="channelsLast"===s,l=(o?t[0].dims[3]:t[0].dims[1],[64,1,1]),u=[Math.ceil(bf(({x:i.map((t,r)=>r)}).x.map(t=>i[t]))/l[0]),1,1];le("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${u}`);let h=1,f=[{type:12,data:E1.size(i)},{type:12,data:n},{type:12,data:a},{type:12,data:r.strides},{type:12,data:r.dilations}];Ze(r,f),f.push(...W(t[0].dims,t[1].dims));let d=["rank","rank"],c=3===t.length;c&&(f.push(...W(t[2].dims)),d.push("rank")),f.push(...W(i));let p=s=>{let l=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:n.length},{name:"pads",type:"u32",length:a.length},{name:"strides",type:"u32",length:r.strides.length},{name:"dilations",type:"u32",length:r.dilations.length}];Qe(r,l);let u=1,f=ve(t[0].dataType),d=P("x",t[0].dataType,t[0].dims.length,h),p=P("W",t[1].dataType,t[1].dims.length,u),m=[d,p],g=N1("result",t[0].dataType,i.length,u),_="";if(c){let r=P("bias",t[2].dataType,t[2].dims.length,u);m.push(r),_+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${f} {
          return bias[${o?K("coords",4,5):K("coords",1,5)}];
        }`}let b=Ae(h,f),y=Ke(r,b,f);return`
            ${_}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${d.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${p.getByIndices("aIndices")};
            }
          ${s.registerUniforms(l).declareVariables(...m,g)}
          ${s.mainStart()}
          ${s.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${g.offsetToIndices("global_idx")};
              let batch = ${K("coords",0,d.rank)};
              let d2 = ${o?K("coords",d.rank-1,d.rank):K("coords",1,d.rank)};
              let xFRCCorner = vec3<u32>(${o?K("coords",1,d.rank):K("coords",2,d.rank)},
              ${o?K("coords",2,d.rank):K("coords",3,d.rank)},
              ${o?K("coords",3,d.rank):K("coords",4,d.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${o?K("uniforms.x_shape",1,d.rank):K("uniforms.x_shape",2,d.rank)};
              let xShapeZ = ${o?K("uniforms.x_shape",2,d.rank):K("uniforms.x_shape",3,d.rank)};
              let xShapeW = ${o?K("uniforms.x_shape",3,d.rank):K("uniforms.x_shape",4,d.rank)};
              let xShapeU = ${o?K("uniforms.x_shape",4,d.rank):K("uniforms.x_shape",1,d.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${o?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${o?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${o?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${o?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${c?"value = value + getBiasByOutputCoords(coords)":""};
              ${y}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${r.cacheKey};${o};${h};${c}`,inputDependencies:d},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:u[0],y:u[1],z:u[2]},programUniforms:f}),getShaderSource:p}}}),Ju=L1(()=>{ee(),ae(),ue(),Tt(),Yu=(t,r,i,n)=>{let a=t.length>2,s=a?"value += b[output_channel];":"",o=t[0].dims,l=t[1].dims,u="NHWC"===r.format,h=u?i[3]:i[1],f=h/r.group,d=u&&f>=4?he(h):1,c=E1.size(i)/d,p=[{type:12,data:c},{type:12,data:r.dilations},{type:12,data:[r.strides[0],r.strides[1]]},{type:12,data:[r.pads[0],r.pads[1]]},{type:12,data:f}];Ze(r,p),p.push(...W(o,[l[0],l[1],l[2],l[3]/d]));let m=a?["rank","rank","rank"]:["rank","rank"];p.push(...W([i[0],i[1],i[2],i[3]/d]));let g=n=>{let h=N1("output",t[0].dataType,i.length,d),f=ve(h.type.tensor),c=Ke(r,h.type.value,f),p=P("x",t[0].dataType,o.length),m=P("w",t[1].dataType,l.length,d),g=[p,m];a&&g.push(P("b",t[2].dataType,t[2].dims,d));let _=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:r.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Qe(r,_);let b=u?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${p.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${m.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${p.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${m.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${n.registerUniforms(_).declareVariables(...g,h)}

  ${n.mainStart()}
    ${n.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${h.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${u?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${u?1:2}], outputIndices[${u?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${d} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${u?2:1}];

    var value: ${h.type.value} = ${h.type.value}(0);
    ${b}
    ${s}
    ${c}
    ${h.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${r.cacheKey}_${d}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:n?n(i):i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:p}),getShaderSource:g}},Xu=(t,r,i,n)=>{let a=t.length>2,s=he(i[3]),o=he(i[2]),l=E1.size(i)/s/o,u=[t[0].dims[0],t[0].dims[1],t[0].dims[2],t[0].dims[3]/s],h=[t[1].dims[0],t[1].dims[1],t[1].dims[2],t[1].dims[3]/s],f=[i[0],i[1],i[2],i[3]/s],d=[{type:12,data:l},{type:6,data:[r.strides[0],r.strides[1]]},{type:6,data:[r.pads[0],r.pads[1]]}];Ze(r,d),d.push(...W(u,h,f));let c=(o-1)*r.strides[1]+h[1],p=i=>{let n=N1("output",t[0].dataType,f.length,s),l=ve(n.type.tensor),d=Ke(r,n.type.value,l),p=P("x",t[0].dataType,u.length,s),m=P("w",t[1].dataType,h.length,s),g=[p,m];a&&g.push(P("b",t[2].dataType,t[2].dims,s));let _=a?"value += b[output_channel];":"",b=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Qe(r,b),`
  ${i.registerUniforms(b).declareVariables(...g,n)}
  ${i.mainStart()}
    ${i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${o}u;
    let col = (index1 % width1) * ${o}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${p.type.value}, ${c}>;
    var values: array<${n.type.value}, ${o}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${h[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${c}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${p.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${p.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${h[1]}; w_width++) {
          let w_val = ${m.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${o}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${o}u; i++) {
      var value = values[i];
      ${_}
      ${d}
      ${n.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${r.cacheKey};${s};${o};${c};${h[0]};${h[1]}`,inputDependencies:a?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:n?n(i):i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:d}),getShaderSource:p}}}),tl=L1(()=>{ae(),Fu(),Qu(),on(),Ju(),Tt(),nn(),ct(),vf=(t,r,i,n,a,s)=>{let o=t[0],l=t.slice(s?1:2,s?3:4),u=l.length,h=r[0],f=r.slice(2).map((t,r)=>t+(t-1)*(i[r]-1)),d=l.map((t,r)=>t+n[r]+n[r+u]).map((t,r)=>Math.floor((t-f[r]+a[r])/a[r]));return d.splice(0,0,o),d.splice(s?3:1,0,h),d},$o=[2,3,1,0],$f=(t,r)=>{if(!t||2!==t.length&&3!==t.length)throw Error("Conv requires 2 or 3 inputs");if(t[0].dims.length>5)throw Error("greater than 5D is not supported");if(t[0].dims.length!==t[1].dims.length)throw Error("filter does not have same dimension as input");if(t[0].dims["NHWC"===r.format?t[0].dims.length-1:1]!==t[1].dims[1]*r.group)throw Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(3===t.length&&(1!==t[2].dims.length||t[1].dims[0]!==t[2].dims[0]))throw Error("invalid bias");let i=t[0].dims.length-2;if(r.dilations.length!==i)throw Error(`dilations should be ${i}D`);if(r.strides.length!==i)throw Error(`strides should be ${i}D`);if(r.pads.length!==2*i)throw Error(`pads should be ${2*i}D`);if(0!==r.kernelShape.length&&r.kernelShape.length!==t[1].dims.length-2)throw Error("invalid kernel shape")},xo=(t,r)=>{let i=t.kernelShape.slice();i.length<r[1].dims.length-2&&i.push(...Array(r[1].dims.length-2-i.length).fill(0));for(let t=2;t<r[1].dims.length;++t)0===i[t-2]&&(i[t-2]=r[1].dims[t]);let n=t.pads.slice();Dt.adjustPadsBasedOnAutoPad(r[0].dims,t.strides,t.dilations,i,n,"NHWC"===t.format,t.autoPad);let a=Object.assign({},t);return Object.assign(a,{kernelShape:i,pads:n}),a},So=t=>{let r=en(t),i=t.format;return{autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],format:i,dilations:t.dilations,group:t.group,kernelShape:t.kernel_shape,pads:t.pads,strides:t.strides,wIsConst:t.w_is_const(),...r,cacheKey:`${t.format};${r.activation};`}},el=(t,r,i,n)=>{let a="NHWC"===i.format,s=vf(r[0].dims,r[1].dims,i.dilations,i.pads,i.strides,a);if(1!==i.group){let o=[r[0]];if(a){let n=t.kernelCustomData.wT??t.compute(Pe(r[1],$o),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=n),o.push(n)}else o.push(r[1]);3===r.length&&o.push(r[2]),!t.adapterInfo.isArchitecture("ampere")&&a&&r[1].dims[0]===i.group&&1===r[1].dims[1]&&1===i.dilations[0]&&1===i.dilations[1]?t.compute(Xu(o,i,s,n),{inputs:o}):t.compute(Yu(o,i,s,n),{inputs:o});return}let o=3===r.length,l=r[0].dims[a?1:2],u=r[0].dims[a?2:3],h=r[0].dims[a?3:1],f=r[1].dims[2],d=r[1].dims[3],c=s[a?1:2],p=s[a?2:3],m=s[a?3:1],g=a&&f===l&&d===u&&0===i.pads[0]&&0===i.pads[1];if(g||1===f&&1===d&&1===i.dilations[0]&&1===i.dilations[1]&&1===i.strides[0]&&1===i.strides[1]&&0===i.pads[0]&&0===i.pads[1]){let f=s[0],d,_,b,y=[];if(a){let n=t.kernelCustomData.wT??t.compute(Pe(r[1],$o),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];if(i.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=n),g){let t=l*u*h;d=r[0].reshape([1,f,t]),_=n.reshape([1,t,m]),b=[1,f,m]}else d=r[0].reshape([f,l*u,h]),_=n.reshape([1,h,m]),b=[f,c*p,m];y.push(d),y.push(_)}else d=r[0].reshape([f,h,l*u]),_=r[1].reshape([1,m,h]),b=[f,m,c*p],y.push(_),y.push(d);o&&y.push(r[2]);let v=b[2],w=y[0].dims[y[0].dims.length-1];v<8&&w<8?t.compute(rn(y,i,s,b,a,n),{inputs:y}):t.compute(ar(y,i,s,b,a,n),{inputs:y});return}let _=!0,b=t.kernelCustomData.wT??t.compute(Pe(r[1],$o),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=b);let y=[r[0],b];o&&y.push(r[2]);let v=a?c*p:m,w=a?m:c*p,x=f*d*h;t.compute(Hu(y,i,s,v,w,x,o,_,n),{inputs:y})},xf=(t,r)=>{let i="NHWC"===r.format,n=[t.inputs[0].reshape(i?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];3===t.inputs.length&&n.push(t.inputs[2]);let a=[0,r.pads[0],0,r.pads[1]],s=[1].concat(r.strides),o=[1].concat(r.dilations),l=[1].concat(r.kernelShape),u=xo({...r,pads:a,strides:s,dilations:o,kernelShape:l},n);el(t,n,u,t=>i?[t[0],t[2],t[3]]:[t[0],t[1],t[3]])},Sf=(t,r,i)=>{let n="NHWC"===i.format?"channelsLast":"channelsFirst",a=xo(i,r),s="NOTSET"===i.autoPad?i.pads:i.autoPad,o=Ku(r[0].dims,r[1].dims,i.strides,i.dilations,s,!1,n);t.compute(Zu(r,a,o.outShape,[o.filterDepth,o.filterHeight,o.filterWidth],[o.padInfo.front,o.padInfo.top,o.padInfo.left],n))},To=(t,r)=>{if($f(t.inputs,r),3===t.inputs[0].dims.length)xf(t,r);else if(5===t.inputs[0].dims.length)Sf(t,t.inputs,r);else{let i=xo(r,t.inputs);el(t,t.inputs,i)}}}),nl=L1(()=>{ee(),et(),ae(),ue(),rl=(t,r,i)=>{let n=t.length>2,a=r.outputShape,s="NHWC"===r.format,o=r.group,l=t[1].dims,u=l[2]/o,h=l[3],f=s?he(u):1,d=s&&1===h&&u>=4,c=d?4*Math.floor(u/4):Math.floor(u/f)*f,p=u-c,m=s?he(h):1,g=s?1===h?f:m:1,_=E1.size(a)/m,b=[Math.ceil(_/64),1,1];le("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${b}`);let y=["rank","rank"],v=[r.strides[0],r.strides[1]],w=[r.kernelShape[s?1:2],r.kernelShape[s?2:3]],x=[r.dilations[0],r.dilations[1]],k=[w[0]+(r.dilations[0]<=1?0:(r.kernelShape[s?1:2]-1)*(r.dilations[0]-1)),w[1]+(r.dilations[1]<=1?0:(r.kernelShape[s?2:3]-1)*(r.dilations[1]-1))],E=[k[0]-1-Math.floor((r.pads[0]+r.pads[2])/2),k[1]-1-Math.floor((r.pads[1]+r.pads[3])/2)],S=[{type:12,data:_},{type:12,data:v},{type:12,data:w},{type:12,data:x},{type:12,data:k},{type:6,data:E},{type:12,data:c},{type:12,data:u},{type:12,data:h},...W(t[0].dims,t[1].dims)];n&&(S.push(...W(t[2].dims)),y.push("rank")),S.push(...W(a));let $=r=>{let i=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:v.length},{name:"filter_dims",type:"u32",length:w.length},{name:"dilations",type:"u32",length:w.length},{name:"effective_filter_dims",type:"u32",length:k.length},{name:"pads",type:"i32",length:E.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],o=ve(t[0].dataType),l=s?1:2,u=s?2:3,h=s?3:1,c=P("W",t[1].dataType,t[1].dims.length,g),_=P("Dy",t[0].dataType,t[0].dims.length,f),b=[_,c];n&&b.push(P("bias",t[2].dataType,[a[h]].length,m));let y=N1("result",t[0].dataType,a.length,m),x=()=>{let t="";if(d)4===f?t+=`
        let xValue = ${_.getByOffset("x_offset")};
        let wValue = ${c.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:2===f?t+=`
          dotProd = dotProd + dot(vec4<${o}>(${_.getByOffset("x_offset")}, ${_.getByOffset("x_offset + 1u")}), vec4<${o}>(${c.getByOffset("w_offset")}, ${c.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:1===f&&(t+=`
          dotProd = dotProd + dot(vec4<${o}>(${_.getByOffset("x_offset")}, ${_.getByOffset("x_offset + 1u")}, ${_.getByOffset("x_offset + 2u")}, ${_.getByOffset("x_offset + 3u")}), vec4<${o}>(${c.getByOffset("w_offset")}, ${c.getByOffset("w_offset + 1u")}, ${c.getByOffset("w_offset + 2u")}, ${c.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(t+=`
                  let xValue = ${s?_.getByOffset(`${_.indicesToOffset(`${_.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${f}`):_.get("batch","inputChannel","idyR","idyC")};
        `,1===f)t+=`
          let w_offset = ${c.indicesToOffset(`${c.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${c.getByOffset(`w_offset / ${g}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let r=0;r<f;r++)t+=`
            let wValue${r} = ${c.getByOffset(`${c.indicesToOffset(`${c.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${r}, wOutChannel)`)} / ${g}`)};
            dotProd = dotProd + xValue[${r}] * wValue${r};`;return t},S=()=>{if(0===p)return"";if(!d)throw Error(`packInputAs4 ${d} is not true.`);let t="";if(1===f){t+="dotProd = dotProd";for(let r=0;r<p;r++)t+=`
            + ${_.getByOffset(`x_offset + ${r}`)} * ${c.getByOffset(`w_offset + ${r}`)}`;t+=";"}else if(2===f){if(2!==p)throw Error(`Invalid inputChannelsRemainder ${p}.`);t+=`
          let xValue = ${_.getByOffset("x_offset")};
          let wValue = ${c.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return t},$=`
            let outputIndices = ${y.offsetToIndices(`global_idx * ${m}`)};
            let batch = ${y.indicesGet("outputIndices",0)};
            let d1 = ${y.indicesGet("outputIndices",h)};
            let r = ${y.indicesGet("outputIndices",l)};
            let c = ${y.indicesGet("outputIndices",u)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${y.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${o}(dyRCorner) + ${o}(wR)) / ${o}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${o}(uniforms.Dy_shape[${l}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${o}(dyCCorner) + ${o}(wC)) / ${o}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${o}(uniforms.Dy_shape[${u}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${d?`
                var x_offset = ${_.indicesToOffset(`${_.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${f};
                var w_offset = ${c.indicesToOffset(`${c.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${g};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${d?4:f}) {
                  ${x()}
                  inputChannel = inputChannel + ${d?4:f};
                }
                ${S()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${n?` + bias[d1 / ${m}]`:""};
            ${y.setByOffset("global_idx","value")};
          `;return`
    ${r.registerUniforms(i).declareVariables(...b,y)}
      ${r.mainStart()}
      ${r.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${$}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${r.cacheKey};${f}${g}${m}${d}${p}`,inputDependencies:y},getRunData:()=>({dispatchGroup:{x:b[0],y:b[1],z:b[2]},outputs:[{dims:i?i(a):a,dataType:t[0].dataType}],programUniforms:S}),getShaderSource:$}}}),ul=L1(()=>{nl(),Tt(),ct(),Tf=(t,r,i,n,a,s)=>(t-1)*r+i+(n-1)*a+1-s,Cf=(t,r,i,n,a)=>{let s=Math.floor(t/2);"SAME_UPPER"===r?(i[n]=s,i[a]=t-s):"SAME_LOWER"===r&&(i[n]=t-s,i[a]=s)},If=(t,r,i,n,a,s,o,l,u,h)=>{let f=t.length-2,d=0===h.length;u.length<f&&u.push(...Array(f-u.length).fill(0));let c=t[0],p=r[l?3:1]*a;for(let a=0,c=t.length-f-!!l;a<f;++a,++c){let l=t[c],p=d?l*o[a]:h[a];Cf(Tf(l,o[a],s[a],r[c],i[a],p),n,s,a,a+f),d&&h.push(o[a]*(l-1)+u[a]+(r[c]-1)*i[a]+1-s[a]-s[a+f])}h.splice(0,0,c),h.splice(l?3:1,0,p)},ol=(t,r)=>{let i=t.kernelShape.slice();if(0===t.kernelShape.length||0===t.kernelShape.reduce((t,r)=>t*r,1)){i.length=0;for(let t=2;t<r[1].dims.length;++t)i.push(r[1].dims[t])}let n="NHWC"===t.format;i.splice(0,0,r[1].dims[0]),i.splice(n?3:1,0,r[1].dims[1]);let a=t.pads.slice(),s=t.outputShape.slice(),o=t.outputPadding.slice(),l=r[0].dims,u=t.dilations.slice();0===u.reduce((t,r)=>t+r,0)&&(u=Array(r[0].dims.length-2).fill(1));let h=t.strides.slice();0===h.reduce((t,r)=>t+r,0)&&(h=Array(r[0].dims.length-2).fill(1)),If(l,i,u,t.autoPad,t.group,a,h,n,o,s);let f=Object.assign({},t);return Object.assign(f,{kernelShape:i,pads:a,outputPadding:o,outputShape:s,dilations:u,strides:h}),f},il=t=>{let r=en(t),i=t.format,n=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof t.autoPad>"u"?0:t.autoPad],a=t.dilations,s=t.group,o=t.kernelShape,l=t.pads,u=t.strides,h=t.wIsConst();return{autoPad:n,format:i,dilations:a,group:s,kernelShape:o,outputPadding:t.outputPadding,outputShape:t.outputShape,pads:l,strides:u,wIsConst:h,...r,cacheKey:`${t.format};${r.activation};`}},Af=(t,r)=>{if(!t||2!==t.length&&3!==t.length)throw Error("Conv requires 2 or 3 inputs");if(4!==t[0].dims.length&&3!==t[0].dims.length)throw Error("currently only support 2-dimensional conv");if(t[0].dims.length!==t[1].dims.length)throw Error("filter does not have same dimension as input");if(t[0].dims["NHWC"===r.format?t[0].dims.length-1:1]!==t[1].dims[0])throw Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let i=t[1].dims[1]*r.group;if(3===t.length&&(1!==t[2].dims.length||t[2].dims[0]!==i))throw Error("invalid bias");let n=t[0].dims.length-2;if(r.dilations.reduce((t,r)=>t+r,0)>0&&r.dilations.length!==n)throw Error(`dilations should be ${n}D`);if(r.strides.reduce((t,r)=>t+r,0)>0&&r.strides.length!==n)throw Error(`strides should be ${n}D`);if(r.pads.reduce((t,r)=>t+r,0)>0&&r.pads.length!==2*n)throw Error(`pads should be ${2*n}D`);if(r.outputPadding.length!==n&&0!==r.outputPadding.length)throw Error(`output_padding should be ${n}D`);if(r.kernelShape.reduce((t,r)=>t+r,0)>0&&0!==r.kernelShape.length&&r.kernelShape.length!==t[1].dims.length-2)throw Error("invalid kernel shape");if(0!==r.outputShape.length&&r.outputShape.length!==t[0].dims.length-2)throw Error("invalid output shape")},al=(t,r,i,n)=>{let a=t.kernelCustomData.wT??t.compute(Pe(r[1],[2,3,0,1]),{inputs:[1],outputs:[i.wIsConst?-2:-1]})[0];i.wIsConst&&!t.kernelCustomData.wT&&(t.kernelCustomData.wT=a);let s=[r[0],a];3===r.length&&s.push(r[2]),t.compute(rl(s,i,n),{inputs:s})},Ef=(t,r)=>{let i="NHWC"===r.format,n=[t.inputs[0].reshape(i?[t.inputs[0].dims[0],1,t.inputs[0].dims[1],t.inputs[0].dims[2]]:[t.inputs[0].dims[0],t.inputs[0].dims[1],1,t.inputs[0].dims[2]]),t.inputs[1].reshape([t.inputs[1].dims[0],t.inputs[1].dims[1],1,t.inputs[1].dims[2]])];3===t.inputs.length&&n.push(t.inputs[2]);let a=r.kernelShape;(0===a.length||0===a[0])&&(a=[t.inputs[1].dims[2]]);let s=r.dilations;(0===s.length||0===s[0])&&(s=[1]);let o=r.strides;(0===o.length||0===o[0])&&(o=[1]);let l=r.pads;0===l.length&&(l=[0,0]),l=[0,l[0],0,l[1]],o=[1].concat(o),s=[1].concat(s),a=[1].concat(a);let u=r.outputPadding;u=[0].concat(u);let h=ol({...r,pads:l,strides:o,dilations:s,kernelShape:a,outputPadding:u},n);al(t,n,h,t=>i?[t[0],t[2],t[3]]:[t[0],t[1],t[3]])},sl=(t,r)=>{if(Af(t.inputs,r),3===t.inputs[0].dims.length)Ef(t,r);else{let i=ol(r,t.inputs);al(t,t.inputs,i)}}}),cl=L1(()=>{ee(),ae(),Se(),ue(),kf=(t,r,i,n)=>{let a=E1.size(r),s=r.length,o=P("input",t,s),l=N1("output",t,s),u=6===i.dataType?i.getInt32Array()[0]:Number(i.getBigInt64Array()[0]),h=E1.normalizeAxis(u,s),f=t=>{let r=` i32(${o.indicesGet("inputIndices","uniforms.axis")}) `,i=K("uniforms.input_shape","uniforms.axis",s),a=n.reverse?r+(n.exclusive?" + 1":""):"0",u=n.reverse?i:r+(n.exclusive?"":" + 1");return`
                ${t.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(o,l)}
                ${t.mainStart()}
                  ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${l.offsetToIndices("global_idx")};
                  var sum = ${l.type.value}(0);
                  let first : i32 = ${a};
                  let last : i32 = ${u};
                  for (var i : i32 = first; i < last; i++) {
                    ${o.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${o.getByIndices("inputIndices")};
                  }
                  ${l.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:r,dataType:t}],dispatchGroup:{x:Math.ceil(a/64)},programUniforms:[{type:12,data:a},{type:12,data:h},...W(r,r)]}),getShaderSource:f}},ll=(t,r)=>{let i=t.inputs[0].dims,n=t.inputs[0].dataType,a=t.inputs[1];t.compute(kf(n,i,a,r),{inputs:[0]})},dl=t=>{let r=1===t.exclusive,i=1===t.reverse;return te({exclusive:r,reverse:i})}}),fl=L1(()=>{ee(),ae(),Se(),ue(),Pf=t=>{if(!t||1!==t.length)throw Error("DepthToSpace requires 1 input.");if(4!==t[0].dims.length)throw Error("DepthToSpace requires 4D input.")},Of=(t,r,i,n)=>{let a=[];a.push(`fn perm(i: ${n.type.indices}) -> ${i.type.indices} {
    var a: ${i.type.indices};`);for(let n=0;n<r;++n)a.push(i.indicesSet("a",t[n],`i[${n}]`));return a.push("return a;}"),a.join(`
`)},zf=(t,r)=>{let i,n,a,s,o,l,u="NHWC"===r.format,h=r.blocksize,f="DCR"===r.mode;u?([i,n,a,s]=t.dims,o=f?[i,n,a,h,h,s/h**2]:[i,n,a,s/h**2,h,h],l=f?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([i,n,a,s]=[t.dims[0],t.dims[2],t.dims[3],t.dims[1]],o=f?[i,h,h,s/h**2,n,a]:[i,s/h**2,h,h,n,a],l=f?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let d=t.reshape(o),c=d.dims.length,p=t.dataType,m=P("a",p,c),g=N1("output",p,c),_=t=>`
  ${t.registerUniform("output_size","u32").declareVariables(m,g)}

  ${Of(l,c,m,g)}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${g.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${g.setByOffset("global_idx",m.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${t.dims};${r.blocksize};${r.mode}`,inputDependencies:["rank"]},getRunData:t=>{let r=u?[i,n*h,a*h,s/h**2]:[i,s/h**2,n*h,a*h],o=E1.size(r),f=d.dims,c=E1.sortBasedOnPerm(f,l);return{outputs:[{dims:r,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:[{type:12,data:o},...W(f,c)]}},getShaderSource:_}},pl=(t,r)=>{Pf(t.inputs),t.compute(zf(t.inputs[0],r))},ml=t=>te({blocksize:t.blocksize,mode:t.mode,format:t.format})}),_l=L1(()=>{ee(),ae(),Se(),ue(),hl="^"+(sn="("+(Co="[a-zA-Z]|\\.\\.\\.")+")+")+"$",Bf="^"+("("+sn+",)*")+sn+"$",Io=class{constructor(t=-1){this.symbolToIndices=new Map,this.inputIndex=t}addSymbol(t,r){let i=this.symbolToIndices.get(t);void 0===i?i=[r]:i.push(r),this.symbolToIndices.set(t,i)}},Ao=class{constructor(t,r){this.equation=r,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=[],this.outputDims=[];let[i,n]=r.includes("->")?r.split("->",2):[r,""];if(!i.match(RegExp(Bf)))throw Error("Invalid LHS term");if(i.split(",").forEach((r,i)=>{let n=t[i].dims.slice();if(!r.match(RegExp(hl)))throw Error("Invalid LHS term");let a=this.processTerm(r,!0,n,i);this.lhs.push(a)}),""===n)n+=[...this.symbolToInfo.entries()].filter(([t,r])=>1===r.count||"..."===t).map(([t])=>t).join("");else if(!n.match(RegExp(sn)))throw Error("Invalid RHS");n.match(RegExp(Co,"g"))?.forEach(t=>{if("..."===t)this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let r=this.symbolToInfo.get(t);if(void 0===r)throw Error("Invalid RHS symbol");this.outputDims.push(r.dimValue)}}),this.rhs=this.processTerm(n,!1,this.outputDims)}addSymbol(t,r,i){let n=this.symbolToInfo.get(t);if(void 0!==n){if(n.dimValue!==r&&1!==n.count)throw Error("Dimension mismatch");n.count++,n.inputIndices.push(i)}else n={count:1,dimValue:r,inputIndices:[i]};this.symbolToInfo.set(t,n)}processTerm(t,r,i,n=-1){let a=i.length,s=!1,o=[],l=0;if(!t.match(RegExp(hl))&&!r&&""!==t)throw Error("Invalid LHS term");let u=t.match(RegExp(Co,"g")),h=new Io(n);return u?.forEach((t,f)=>{if("..."===t){if(s)throw Error("Only one ellipsis is allowed per input term");s=!0;let t=a-u.length+1;if(t<0)throw Error("Ellipsis out of bounds");if(o=i.slice(l,l+t),this.hasEllipsis){if(this.ellipsisDims.length!==o.length||this.ellipsisDims.toString()!==o.toString())throw Error("Ellipsis dimensions mismatch")}else if(r)this.hasEllipsis=!0,this.ellipsisDims=o;else throw Error("Ellipsis must be specified in the LHS");for(let t=0;t<o.length;t++){let r=String.fromCharCode(48+t);h.addSymbol(r,f+t),this.addSymbol(r,i[l++],n)}}else h.addSymbol(t,f+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(t,i[l++],n)}),h}},gl=t=>t+"_max",Mf=(t,r,i,n)=>{let a=t.map(t=>t.length).map((t,i)=>P(`input${i}`,r,t)),s=E1.size(n),o=N1("output",r,n.length),l=[...i.symbolToInfo.keys()].filter(t=>!i.rhs.symbolToIndices.has(t)),u=t=>{let r=[],n="var prod = 1.0;",s="var sum = 0.0;",u="sum += prod;",h=[],f=[],d=[],c=[],p=i.symbolToInfo.size===i.rhs.symbolToIndices.size;i.symbolToInfo.forEach((t,n)=>{if(i.rhs.symbolToIndices.has(n)){let s=i.rhs.symbolToIndices.get(n)?.[0];void 0!==s&&i.lhs.forEach((i,l)=>{if(t.inputIndices.includes(l)){let t=i.symbolToIndices.get(n);if(void 0===t)throw Error("Invalid symbol error");t.forEach(t=>{r.push(`${a[l].indicesSet(`input${l}Indices`,t,o.indicesGet("outputIndices",s))}`)})}})}else i.lhs.forEach((r,i)=>{if(t.inputIndices.includes(i)){let t=r.symbolToIndices.get(n);if(void 0===t)throw Error("Invalid symbol error");t.forEach(t=>{h.push(`${a[i].indicesSet(`input${i}Indices`,t,`${n}`)}`)}),c.push(`prod *= ${a[i].getByIndices(`input${i}Indices`)};`)}}),f.push(`for(var ${n}: u32 = 0; ${n} < uniforms.${gl(n)}; ${n}++) {`),d.push("}")});let m=p?[...r,`let sum = ${a.map((t,r)=>t.getByIndices(`input${r}Indices`)).join(" * ")};`]:[...r,s,...f,...h,n,...c,u,...d];return`
            ${t.registerUniforms(l.map(t=>({name:`${gl(t)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...a,o)}

            ${t.mainStart()}
            ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${o.offsetToIndices("global_idx")};
            ${a.map((t,r)=>`var input${r}Indices: ${a[r].type.indices};`).join(`
`)}
            ${m.join(`
`)};
            ${o.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:i.equation,inputDependencies:t.map(()=>"rank")},getRunData:()=>{let a=l.filter(t=>i.symbolToInfo.has(t)).map(t=>({type:12,data:i.symbolToInfo.get(t)?.dimValue||0}));a.push({type:12,data:s});let o=t.map((t,r)=>[...W(t)]).reduce((t,r)=>t.concat(r),a);return o.push(...W(n)),{outputs:[{dims:n,dataType:r}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:o}},getShaderSource:u}},yl=(t,r)=>{let i=new Ao(t.inputs,r.equation),n=i.outputDims,a=t.inputs.map((t,r)=>t.dims);t.compute(Mf(a,t.inputs[0].dataType,i,n))},bl=t=>{let r=t.equation.replace(/\s+/g,"");return te({equation:r})}}),$l=L1(()=>{ee(),ae(),ue(),Rf=t=>{if(!t||2!==t.length)throw Error("Expand requires 2 input.");let r=t[0].dims,i=Array.from(t[1].getBigInt64Array(),Number),n=i.length<r.length?0:i.length-r.length,a=r.length<i.length?0:r.length-i.length;for(;n<i.length&&a<r.length;++n,++a)if(i[n]!==r[a]&&1!==i[n]&&1!==r[a])throw Error("Expand requires shape to be broadcastable to input")},wl=(t,r)=>{let i=t.length-r.length,n=[];for(let r=0;r<i;++r)n.push(t[r]);for(let a=0;a<r.length;++a)n.push(1===r[a]?t[a+i]:r[a]);return n},Uf=(t,r)=>t.length>r.length?wl(t,r):wl(r,t),Nf=t=>{let r=t[0].dims,i=Uf(r,Array.from(t[1].getBigInt64Array(),Number)),n=t[0].dataType,a=9===n||1===E1.size(r),s=9===n||r.length>0&&r[r.length-1]%4==0?4:1,o=a||i.length>0&&i[i.length-1]%4==0?4:1,l=Math.ceil(E1.size(i)/o),u=t=>{let a=P("input",n,r.length,s),l=N1("output",n,i.length,o),u;if(9===n){let t=(t,r,i="")=>`
          let outputIndices${r} = ${l.offsetToIndices(`outputOffset + ${r}u`)};
          let offset${r} = ${a.broadcastedIndicesToOffset(`outputIndices${r}`,l)};
          let index${r} = offset${r} / 4u;
          let component${r} = offset${r} % 4u;
          ${t}[${r}] = ${i}(${a.getByOffset(`index${r}`)}[component${r}]);
        `;u=`
        let outputOffset = global_idx * ${o};
        var data = vec4<u32>(0);
        ${t("data",0,"u32")}
        ${t("data",1,"u32")}
        ${t("data",2,"u32")}
        ${t("data",3,"u32")}
        ${l.setByOffset("global_idx","data")}
      }`}else u=`
        let outputIndices = ${l.offsetToIndices(`global_idx * ${o}`)};
        let inputOffset = ${a.broadcastedIndicesToOffset("outputIndices",l)};
        let data = ${l.type.value}(${a.getByOffset(`inputOffset / ${s}`)});
        ${l.setByOffset("global_idx","data")}
      }`;return`
    ${t.registerUniform("vec_size","u32").declareVariables(a,l)}
    ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${u}`},h=[{type:12,data:l},...W(r,i)];return{name:"Expand",shaderCache:{hint:`${i.length};${s}${o}`,inputDependencies:["rank"]},getShaderSource:u,getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:h})}},vl=t=>{Rf(t.inputs),t.compute(Nf(t.inputs),{inputs:[0]})}}),Sl=L1(()=>{ee(),ae(),ue(),Jr(),Vf=t=>{let r=t[0].dataType,i=E1.size(t[0].dims),n=E1.size(t[1].dims),a=n%4==0,s=t=>{let i=P("x",r,[1],4),n=P("bias",r,[1],4),s=N1("y",r,[1],4),o=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],l=t=>`
      let bias${t}_offset: u32 = (global_idx * 4 + ${t}) % uniforms.bias_size;
      let bias${t} = ${n.getByOffset(`bias${t}_offset / 4`)}[bias${t}_offset % 4];`,u=a?`
      let bias = ${n.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${l(0)}${l(1)}${l(2)}${l(3)}
      let bias = ${i.type.value}(bias0, bias1, bias2, bias3);`;return`${t.registerUniforms(o).declareVariables(i,n,s)}

    ${bo(ke(r))}

    ${t.mainStart(Bt)}
      ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${i.getByOffset("global_idx")};
      ${u}
      let x_in = x + bias;
      ${s.setByOffset("global_idx",_o("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${a}`,inputDependencies:["type","type"]},getShaderSource:s,getRunData:t=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],programUniforms:[{type:12,data:Math.ceil(i/4)},{type:12,data:n}],dispatchGroup:{x:Math.ceil(i/Bt/4)}})}},xl=t=>{t.inputs.length<2||0===E1.size(t.inputs[1].dims)?_u(t):t.compute(Vf(t.inputs))}}),Il=L1(()=>{ee(),ae(),Se(),ue(),Lf=t=>{if(!t||2!==t.length)throw Error("Gather requires 2 inputs.")},Wf=(t,r)=>{let i=t[0].dims,n=t[1].dims,a=i.length,s=E1.normalizeAxis(r.axis,a),o=i.slice(0);o.splice(s,1,...n);let l=i[s],u=9===t[0].dataType?4:1,h=Math.ceil(E1.size(o)/u),f=[{type:12,data:h},{type:6,data:l},{type:12,data:s},...W(t[0].dims,t[1].dims,o)],d=r=>{let i=P("data",t[0].dataType,t[0].dims.length,u),l=P("inputIndices",t[1].dataType,t[1].dims.length),h=N1("output",t[0].dataType,o.length,u),f=t=>{let r=n.length,u=`var indicesIndices${t}  = ${l.type.indices}(0);`;for(let i=0;i<r;i++)u+=`${r>1?`indicesIndices${t}[${i}]`:`indicesIndices${t}`} = ${o.length>1?`outputIndices${t}[uniforms.axis + ${i}]`:`outputIndices${t}`};`;u+=`
          var idx${t} = ${l.getByIndices(`indicesIndices${t}`)};
          if (idx${t} < 0) {
            idx${t} = idx${t} + uniforms.axisDimLimit;
          }
          var dataIndices${t} : ${i.type.indices};
        `;for(let i=0,n=0;i<a;i++)i===s?(u+=`${a>1?`dataIndices${t}[${i}]`:`dataIndices${t}`} = u32(idx${t});`,n+=r):(u+=`${a>1?`dataIndices${t}[${i}]`:`dataIndices${t}`} = ${o.length>1?`outputIndices${t}[${n}]`:`outputIndices${t}`};`,n++);return u},d;if(9===t[0].dataType){let t=(t,r,n="")=>`
          let outputIndices${r} = ${h.offsetToIndices(`outputOffset + ${r}u`)};
          ${f(r)};
          let offset${r} = ${i.indicesToOffset(`dataIndices${r}`)};
          let index${r} = offset${r} / 4u;
          let component${r} = offset${r} % 4u;
          ${t}[${r}] = ${n}(${i.getByOffset(`index${r}`)}[component${r}]);
        `;d=`
        let outputOffset = global_idx * ${u};
        var value = vec4<u32>(0);
        ${t("value",0,"u32")}
        ${t("value",1,"u32")}
        ${t("value",2,"u32")}
        ${t("value",3,"u32")}
        ${h.setByOffset("global_idx","value")}
      `}else d=`
      let outputIndices = ${h.offsetToIndices("global_idx")};
      ${f("")};
      let value = ${i.getByIndices("dataIndices")};
      ${h.setByOffset("global_idx","value")};
      `;return`
      ${r.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(i,l,h)}
      ${r.mainStart()}
        ${r.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${d}
      }`};return{name:"Gather",shaderCache:{hint:r.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:o,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:f}),getShaderSource:d}},Tl=t=>te({axis:t.axis}),Cl=(t,r)=>{Lf(t.inputs),t.compute(Wf(t.inputs,r))}}),kl=L1(()=>{ee(),ae(),ue(),Gf=(t,r,i,n,a,s,o,l,u)=>{let h=[{type:12,data:s},{type:12,data:n},{type:12,data:a},{type:12,data:i},{type:12,data:o},{type:12,data:l},{type:12,data:u}],f=[s];h.push(...W(r.dims,f));let d=t=>{let n=[P("indices_data",r.dataType,r.dims.length),N1("input_slice_offsets_data",12,1,1)],s=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:a.length},{name:"sizes_from_slice_dims_data",type:"u32",length:i.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${t.registerUniforms(s).declareVariables(...n)}
  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${1===a.length?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${1===i.length?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return t.compute({name:"computeSliceOffsets",shaderCache:{hint:`${a.length}_${i.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:f,dataType:t.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:h}),getShaderSource:d},{inputs:[r],outputs:[-1]})[0]},Al=(t,r)=>{let i=t.inputs,n=i[0].dims,a=i[0].dataType,s=i[1].dims,o=s[s.length-1],l=E1.sizeToDimension(s,s.length-1),u=E1.sizeFromDimension(n,r.batchDims+o),h=E1.sizeToDimension(n,r.batchDims),f=E1.sizeFromDimension(n,r.batchDims),d=l/h,c=Array(o),p=u;for(let t=0;t<o;++t)c[o-1-t]=p,p*=n[r.batchDims+o-1-t];let m=Gf(t,i[1],c,r.batchDims,n,l,d,f,o),g=r.batchDims+o;if(g>n.length)throw Error("last dimension of indices must not be larger than rank of input tensor");let _=s.slice(0,-1).concat(n.slice(g)),b=E1.size(_),y=[{type:12,data:b},{type:12,data:u},...W(i[0].dims,m.dims,_)],v=t=>{let r=P("data",i[0].dataType,i[0].dims.length),n=P("slice_offsets",12,m.dims.length),a=N1("output",i[0].dataType,_.length);return`
          ${t.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(r,n,a)}
            ${t.mainStart()}
            ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};t.compute({name:"GatherND",shaderCache:{hint:r.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:_,dataType:a}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:y}),getShaderSource:v},{inputs:[i[0],m]})},El=t=>({batchDims:t.batch_dims,cacheKey:""})}),zl=L1(()=>{ee(),ae(),Se(),ue(),Hf=(t,r)=>{if(t.length<3||t.length>4)throw Error("GatherBlockQuantized requires 3 or 4 inputs.");let i=E1.normalizeAxis(r.quantizeAxis,t[0].dims.length),n=r.blockSize,a=t[0],s=t[2],o=4===t.length?t[3]:void 0;if(s.dims.length!==a.dims.length||!a.dims.map((t,r)=>r===i?Math.ceil(t/n)===s.dims[r]:t===s.dims[r]).reduce((t,r)=>t&&r,!0))throw Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(o){if(o.dataType!==a.dataType)throw Error("Zero point must have the same data type as the input tensor.");if(o.dims.length!==s.dims.length||!o.dims.map((t,r)=>t===s.dims[r]).reduce((t,r)=>t&&r,!0))throw Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},Ff=(t,r)=>{let i=t[0].dims,n=t[1].dims,a=i.length,s=E1.normalizeAxis(r.gatherAxis,a),o=E1.normalizeAxis(r.quantizeAxis,a),l=i.slice(0);l.splice(s,1,...n);let u=E1.size(l),h=t[2].dataType,f=22===t[0].dataType,d=[{type:12,data:u},{type:12,data:o},{type:12,data:s},{type:12,data:r.blockSize},...W(...t.map((t,r)=>t.dims),l)],c=r=>{let a=P("data",t[0].dataType,t[0].dims.length),o=P("inputIndices",t[1].dataType,t[1].dims.length),u=P("scales",t[2].dataType,t[2].dims.length),d=t.length>3?P("zeroPoint",t[3].dataType,t[3].dims.length):void 0,c=N1("output",h,l.length),p=[a,o,u];d&&p.push(d);let m=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${r.registerUniforms(m).declareVariables(...p,c)}
        ${r.mainStart()}
        let output_indices = ${c.offsetToIndices("global_idx")};
        var indices_indices = ${o.type.indices}(0);
        ${n.length>1?`
          for (var i: u32 = 0; i < ${n.length}; i++) {
            let index = ${c.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${o.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${c.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${a.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${c.indicesGet("output_indices","i")};
          ${a.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${o.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${i[s]};
        }
        ${a.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${l.length}; i++) {
          let index = ${c.indicesGet("output_indices",`i + ${n.length} - 1`)};
          ${a.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${a.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${a.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${f?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${u.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${u.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${u.getByIndices("scale_indices")};
        ${d?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${d.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${d.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${f?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${ke(h)}(quantized_data - zero_point) * scale;
        ${c.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${r.cacheKey};${t.filter((t,r)=>1!==r).map(t=>t.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:t.length},(t,r)=>"rank")},getRunData:()=>({outputs:[{dims:l,dataType:h}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:d}),getShaderSource:c}},Pl=(t,r)=>{Hf(t.inputs,r),t.compute(Ff(t.inputs,r))},Ol=t=>te({blockSize:t.blockSize,gatherAxis:t.gatherAxis,quantizeAxis:t.quantizeAxis})}),Ml=L1(()=>{ee(),ae(),Se(),ue(),qf=t=>{if(!t||2!==t.length)throw Error("GatherElements requires 2 inputs.");if(t[0].dims.length<1)throw Error("GatherElements requires that the data input be rank >= 1.");if(t[0].dims.length!==t[1].dims.length)throw Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},jf=(t,r)=>{let i=t[0].dims,n=t[0].dataType,a=i.length,s=t[1].dims,o=t[1].dataType,l=E1.normalizeAxis(r.axis,a),u=i[l],h=s.slice(0),f=E1.size(h),d=P("input",n,a),c=P("indicesInput",o,s.length),p=N1("output",n,h.length),m=[{type:12,data:f},{type:6,data:u},{type:12,data:l}];return m.push(...W(i,s,h)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:h,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:t=>`
      ${t.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(d,c,p)}
      ${t.mainStart()}
      ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${p.offsetToIndices("global_idx")};

      var idx = ${c.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${d.type.indices}(outputIndices);
      ${d.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${d.getByIndices("inputIndices")};

      ${p.setByOffset("global_idx","value")};
  }`}},Dl=t=>te({axis:t.axis}),Bl=(t,r)=>{qf(t.inputs),t.compute(jf(t.inputs,r))}}),Nl=L1(()=>{ee(),ae(),ue(),Kf=t=>{if(!t)throw Error("Input is missing");if(t.length<2||t.length>3)throw Error("Invaid input number.");if(3===t.length&&t[2].dims.length>2)throw Error("Invalid input shape of C");if(t[0].dataType!==t[1].dataType||3===t.length&&t[0].dataType!==t[2].dataType)throw Error("Input types are mismatched")},Zf=(t,r)=>{let i=t[0].dims.slice(),n=t[1].dims.slice(),[a,s,o]=Vr.getShapeOfGemmResult(i,r.transA,n,r.transB,3===t.length?t[2].dims:void 0),l=[a,s],u=16,h=Math.ceil(s/16),f=Math.ceil(a/16),d=(E1.size(l),[{type:12,data:h},{type:12,data:a},{type:12,data:s},{type:12,data:o},{type:1,data:r.alpha},{type:1,data:r.beta}]),c=["type","type"];3===t.length&&(d.push(...W(t[2].dims)),c.push("rank")),d.push(...W(l));let p=i=>{let n=P("a",t[0].dataType,t[0].dims),a=P("b",t[1].dataType,t[1].dims),s=null,o=[n,a];3===t.length&&(s=P("c",t[2].dataType,t[2].dims.length),o.push(s));let h=N1("output",t[0].dataType,l.length);o.push(h);let f=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],d="",c="";r.transA&&r.transB?(c=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${n.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${a.type.value}(0);
      }
      `,d="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):r.transA&&!r.transB?(c=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${n.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${a.type.value}(0);
      }
      `,d="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!r.transA&&r.transB?(c=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${n.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${a.type.value}(0);
      }
      `,d="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):r.transA||r.transB||(c=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${n.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${a.type.value}(0);
      }
      `,d="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let p=1===r.alpha?"":"value *= uniforms.alpha;";return`
  ${i.registerUniforms(f).declareVariables(...o)}
  var<workgroup> tile_a: array<array<${n.type.storage}, ${u}>, ${u}>;
  var<workgroup> tile_b: array<array<${a.type.storage}, ${u}>, ${u}>;
  ${i.mainStart([u,u,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${u};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${u};
    let num_tiles = (uniforms.K - 1) / ${u} + 1;
    var k_start = 0u;
    var value = ${h.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${c}
      k_start = k_start + ${u};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${u}; k++) {
        ${d}
      }
      workgroupBarrier();
    }

    ${p}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${null!=s?`let cOffset = ${s.broadcastedIndicesToOffset("vec2(m, n)",h)}; value += ${h.type.value}(uniforms.beta) * ${s.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return{name:"GemmShared",shaderCache:{hint:`${r.cacheKey}`,inputDependencies:c},getRunData:()=>({outputs:[{dims:l,dataType:t[0].dataType}],dispatchGroup:{x:h*f},programUniforms:d}),getShaderSource:p}},Rl=t=>({transA:t.transA,transB:t.transB,alpha:t.alpha,beta:t.beta,cacheKey:`${t.transA};${t.transB};${1===t.alpha}`}),Ul=(t,r)=>{Kf(t.inputs),t.compute(Zf(t.inputs,r))}}),Wl=L1(()=>{ee(),ae(),Se(),ue(),[pt,Ct,Ft,qt]=[0,1,2,3],Qf=t=>{if(4!==t[0].dims.length)throw Error("only 4-D tensor is supported.");if(t[0].dims.length!==t[1].dims.length)throw Error("input dimensions must be equal to grid dimensions");if(t[0].dims.length-2!==t[1].dims[t[1].dims.length-1])throw Error(`last dimension of grid must be equal to ${t[0].dims.length-2}`);if(t[0].dims[0]!==t[1].dims[0])throw Error("grid batch size must match input batch size")},Yf=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,Xf=t=>`
  fn gs_bicubic_interpolate(p: mat4x4<${t}>, x: f32, y: f32) -> ${t} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${t}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,Jf=t=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${0===t.alignCorners?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,eh=t=>`
  ${"reflection"===t.paddingMode?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,th=(t,r,i)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${r} {
     var pixel = ${r}(0);
     var indices = vec4<u32>(0);
     indices[${pt}] = batch;
     indices[${Ct}] = channel;`+(()=>{switch(i.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${Ft}] = u32(r);
            indices[${qt}] = u32(c);
          } else {
            return ${r}(0);
          }
        `;case"border":return`
          indices[${Ft}] = u32(clamp(r, 0, H - 1));
          indices[${qt}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${Ft}] = gs_reflect(r, border[1], border[3]);
          indices[${qt}] = gs_reflect(c, border[0], border[2]);
        `;default:throw Error(`padding mode ${i.paddingMode} is not supported`)}})()+`
    return ${t.getByIndices("indices")};
  }
`,rh=(t,r,i)=>(()=>{switch(i.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${pt}], indices[${Ct}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${pt}], indices[${Ct}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${pt}], indices[${Ct}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${pt}], indices[${Ct}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${pt}], indices[${Ct}], border);

          let dx2 = ${r}(f32(x2) - x);
          let dx1 = ${r}(x - f32(x1));
          let dy2 = ${r}(f32(y2) - y);
          let dy1 = ${r}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${r}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${pt}], indices[${Ct}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw Error(`mode ${i.mode} is not supported`)}})()+`${t.setByOffset("global_idx","result")}`,nh=(t,r)=>{let i=P("x",t[0].dataType,t[0].dims.length),n=[t[1].dims[0],t[1].dims[1],t[1].dims[2]],a=P("grid",t[1].dataType,n.length,2),s=[t[0].dims[0],t[0].dims[1],t[1].dims[1],t[1].dims[2]];"NHWC"===r.format&&(s=[t[0].dims[0],t[1].dims[1],t[1].dims[2],t[0].dims[3]],[pt,Ct,Ft,qt]=[0,3,1,2]);let o=N1("output",t[0].dataType,s.length),l=i.type.value,u=[{type:12,data:E1.size(s)},...W(t[0].dims,n,s)],h=t=>`
  ${t.registerUniform("output_size","u32").declareVariables(i,a,o)}
  ${Yf}
  ${Xf(l)}
  ${Jf(r)}
  ${eh(r)}
  ${th(i,l,r)}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${Ft}]);
      let W_in = i32(uniforms.x_shape[${qt}]);

      ${0===r.alignCorners?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${o.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${pt}], indices[${Ft}], indices[${qt}]);
      let nxy = ${a.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${rh(o,l,r)}
  }`;return{name:"GridSample",shaderCache:{hint:`${r.cacheKey}`,inputDependencies:["type","type"]},getRunData:t=>{let r=E1.size(s);return{outputs:[{dims:s,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(r/64)},programUniforms:u}},getShaderSource:h}},Vl=(t,r)=>{Qf(t.inputs),t.compute(nh(t.inputs,r))},Ll=t=>te({alignCorners:t.align_corners,mode:t.mode,paddingMode:t.padding_mode,format:t.format})}),Eo=L1(()=>{ee(),ae(),Se(),qr(),Yr(),ue(),ct(),Re=(t,r)=>t.length>r&&t[r].dims.length>0?t[r]:void 0,ah=(t,r)=>{let i,n=t[0],a=Re(t,1),s=Re(t,2),o=Re(t,3),l=Re(t,4),u=Re(t,5),h=Re(t,6),f=Re(t,7);if(3!==n.dims.length&&5!==n.dims.length)throw Error("Input query is expected to have 3 or 5 dimensions");let d=n.dims[0],c=n.dims[1],p=3===n.dims.length?n.dims[2]:r.numHeads*n.dims[4],m=c,g=0,_=0,b=Math.floor(p/r.numHeads);if(h&&f&&E1.size(h.dims)&&E1.size(f.dims)){if(4!==h.dims.length)throw Error('Input "past_key" is expected to have 4 dimensions');if(h.dims[0]!==d||h.dims[1]!==r.numHeads||h.dims[3]!==b)throw Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(f.dims[0]!==d||f.dims[1]!==r.numHeads||f.dims[3]!==b)throw Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(h.dims[2]!==f.dims[2])throw Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(4!==f.dims.length)throw Error('Input "past_value" is expected to have 4 dimensions');g=h.dims[2],_=h.dims[2]}else if(h&&E1.size(h.dims)||f&&E1.size(f.dims))throw Error('Input "past_key" and "past_value" shall be both present or both absent');if(a&&E1.size(a.dims)>0){if(3!==n.dims.length)throw Error('Input "query" is expected to have 3 dimensions when key is given');if(a.dims.length<3||a.dims.length>5)throw Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(n.dims[0]!==a.dims[0])throw Error('Input "query" and "key" shall have same dim 0 (batch size)');if(3===a.dims.length){if(a.dims[2]!==n.dims[2])throw Error('Input "query" and "key" shall have same dim 2 (hidden_size)');i=2,m=a.dims[1]}else if(5===a.dims.length){if(a.dims[2]!==r.numHeads||2!==a.dims[3]||a.dims[4]!==b)throw Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(s)throw Error('Expect "value" be none when "key" has packed kv format.');i=5,m=a.dims[1]}else{if(a.dims[1]!==r.numHeads||a.dims[3]!==b)throw Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');i=0,m=a.dims[2]}}else{if(5!==n.dims.length)throw Error('Input "query" is expected to have 5 dimensions when key is empty');if(n.dims[2]!==r.numHeads||3!==n.dims[3])throw Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');i=3}if(o&&E1.size(o.dims)>0){if(1!==o.dims.length)throw Error('Input "bias" is expected to have 1 dimension');if(a&&5===a.dims.length&&2===a.dims[3])throw Error("bias is not allowed for packed kv.")}let y=g+m,v=0;if(l&&E1.size(l.dims)>0){v=8;let t=l.dims;throw 1===t.length?t[0]===d?v=1:t[0]===3*d+2&&(v=3):2===t.length&&t[0]===d&&t[1]===y&&(v=5),8===v?Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):Error("Mask not supported")}let w=!1,x=p;if(s&&E1.size(s.dims)>0){if(3!==s.dims.length&&4!==s.dims.length)throw Error('Input "value" is expected to have 3 or 4 dimensions');if(n.dims[0]!==s.dims[0])throw Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(3===s.dims.length){if(m!==s.dims[1])throw Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');x=s.dims[2]}else{if(m!==s.dims[2])throw Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');x=s.dims[1]*s.dims[3],w=!0}}let k=!1;if(l&&E1.size(l.dims)>0)throw Error("Key padding mask is not supported");if(u&&E1.size(u.dims)>0){if(4!==u.dims.length)throw Error('Input "attention_bias" is expected to have 4 dimensions');if(u.dims[0]!==d||u.dims[1]!==r.numHeads||u.dims[2]!==c||u.dims[3]!==y)throw Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:d,sequenceLength:c,pastSequenceLength:g,kvSequenceLength:m,totalSequenceLength:y,maxSequenceLength:_,inputHiddenSize:0,hiddenSize:p,vHiddenSize:x,headSize:b,vHeadSize:Math.floor(x/r.numHeads),numHeads:r.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:r.maskFilterValue,maskType:v,scale:r.scale,broadcastResPosBias:k,passPastInKv:w,qkvFormat:i}},Hl=t=>te({...t}),Gl=te({perm:[0,2,1,3]}),sh=(t,r,i,n,a,s,o)=>{let l=[n,a,s],u=E1.size(l),h=[{type:12,data:u},{type:12,data:o},{type:12,data:s}],f=t=>{let n=N1("qkv_with_bias",r.dataType,l),a=P("qkv",r.dataType,l),s=P("bias",i.dataType,l),o=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${t.registerUniforms(o).declareVariables(a,s,n)}
  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return t.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:l,dataType:r.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:h}),getShaderSource:f},{inputs:[r,i],outputs:[-1]})[0]},sr=(t,r,i,n,a,s,o,l)=>{let u=s;if(!(o&&E1.size(o.dims)>0))return 3===s.dims.length&&(u=s.reshape([r,n,i,a])),1===i||1===n?u:t.compute(Pe(u,Gl.perm),{inputs:[u],outputs:[-1]})[0];if(1===n)throw Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return u=(u=sh(t,s,o,r,n,i*a,l)).reshape([r,n,i,a]),1===i||1===n?u:t.compute(Pe(u,Gl.perm),{inputs:[u],outputs:[-1]})[0]},Fl=(t,r)=>{let i=ah(t.inputs,r),n=t.inputs[0],a=Re(t.inputs,1),s=Re(t.inputs,2),o=Re(t.inputs,3),l=Re(t.inputs,4),u=Re(t.inputs,5),h=Re(t.inputs,6),f=Re(t.inputs,7);if(5===n.dims.length)throw Error("Packed QKV is not implemented");if(a?.dims.length===5)throw Error("Packed KV is not implemented");let d=a&&s&&4===a.dims.length&&4===s.dims.length,c=sr(t,i.batchSize,i.numHeads,i.sequenceLength,i.headSize,n,o,0);if(d)return Ht(t,c,a,s,l,void 0,h,f,u,i);if(!a||!s)throw Error("key and value must be provided");let p=sr(t,i.batchSize,i.numHeads,i.kvSequenceLength,i.headSize,a,o,i.hiddenSize),m=sr(t,i.batchSize,i.numHeads,i.kvSequenceLength,i.vHeadSize,s,o,2*i.hiddenSize);Ht(t,c,p,m,l,void 0,h,f,u,i)}}),Po=L1(()=>{ee(),ae(),Se(),ue(),uh=t=>{if(!t||t.length<1)throw Error("too few inputs")},lh=(t,r)=>{let i=[],n=r.numOutputs;return t[1].dims[0]>0&&(t[1].getBigInt64Array().forEach(t=>i.push(Number(t))),n=i.length),te({numOutputs:n,axis:r.axis,splitSizes:i})},dh=t=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${t}u; i += 1u ) {
    if (index < ${K("uniforms.size_in_split_axis","i",t)}) {
        return i;
    }
    }
    return ${t}u;
}`,ch=t=>{let r=t.length,i=[];for(let n=0;n<r;++n){let a=t[n].setByIndices("indices","input[global_idx]");1===r?i.push(a):0===n?i.push(`if (output_number == ${n}u) { ${a} }`):n===r-1?i.push(`else { ${a} }`):i.push(`else if (output_number == ${n}) { ${a} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${t[0].type.indices}, global_idx: u32) {
        ${i.join(`
`)}
      }`},ko=(t,r)=>{let i=t[0].dims,n=E1.size(i),a=t[0].dataType,s=E1.normalizeAxis(r.axis,i.length),o=Array(r.numOutputs),l=P("input",a,i.length),u=Array(r.numOutputs),h=[],f=[],d=0,c=[{type:12,data:n}];for(let n=0;n<r.numOutputs;n++){d+=r.splitSizes[n],u[n]=d;let l=i.slice();l[s]=r.splitSizes[n],f.push(l),o[n]=N1(`output${n}`,a,l.length),h.push({dims:f[n],dataType:t[0].dataType})}c.push({type:12,data:u},...W(i,...f));let p=t=>`
  ${t.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",u.length).declareVariables(l,...o)}
  ${dh(u.length)}
  ${ch(o)}

  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${l.offsetToIndices("global_idx")};
    var index = ${l.indicesGet("indices",s)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${K("uniforms.size_in_split_axis","output_number - 1u",u.length)};
      ${l.indicesSet("indices",s,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:r.cacheKey,inputDependencies:["rank"]},getShaderSource:p,getRunData:()=>({outputs:h,dispatchGroup:{x:Math.ceil(n/64)},programUniforms:c})}},ql=(t,r)=>{uh(t.inputs);let i=1===t.inputs.length?r:lh(t.inputs,r);t.compute(ko(t.inputs,i),{inputs:[0]})},jl=t=>{let r=t.axis,i=t.splitSizes,n=t.numOutputs<0?i.length:t.numOutputs;if(n!==i.length)throw Error("numOutputs and splitSizes length must be equal");return te({axis:r,numOutputs:n,splitSizes:i})}}),Oo=L1(()=>{ee(),ae(),Se(),ue(),ph=(t,r)=>{let[i,n,a,s]=t,{numHeads:o,rotaryEmbeddingDim:l}=r;if(3!==i.dims.length&&4!==i.dims.length)throw Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${i.dims.length}`);if(!E1.areEqual(n.dims,[])&&!E1.areEqual(n.dims,[1])&&2!==n.dims.length)throw Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${n.dims.length}`);if(2!==a.dims.length)throw Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${a.dims.length}`);if(2!==s.dims.length)throw Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${s.dims.length}`);if(!E1.areEqual(a.dims,s.dims))throw Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(l>0&&0===o)throw Error("num_heads must be provided if rotary_embedding_dim is specified");let u=i.dims[0],h=i.dims[i.dims.length-2],f=a.dims[0],d=E1.sizeFromDimension(i.dims,1)/h,c=0===l?2*a.dims[1]:d/o;if(l>c)throw Error("rotary_embedding_dim must be less than or equal to head_size");if(2===n.dims.length){if(u!==n.dims[0])throw Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${n.dims[0]}`);if(h!==n.dims[1])throw Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${n.dims[1]}`)}if(c/2!==a.dims[1]&&l/2!==a.dims[1])throw Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${a.dims[1]}`);if(h>f)throw Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},un=(t,r)=>{let{interleaved:i,numHeads:n,rotaryEmbeddingDim:a,scale:s}=r,o=t[0].dims[0],l=E1.sizeFromDimension(t[0].dims,1),u=t[0].dims[t[0].dims.length-2],h=l/u,f=t[2].dims[1],d=0===a?2*f:h/n,c=[o,u,h/d,d-f],p=E1.computeStrides(c),m=[{type:1,data:s},{type:12,data:c},{type:12,data:p},...3===t[0].dims.length?Array({type:12,data:[l,h,d,1]}):[],...4===t[0].dims.length?Array({type:12,data:[l,d,u*d,1]}):[],...W(t[0].dims,t[1].dims,t[2].dims,t[3].dims,t[0].dims)],g=r=>{let n=P("input",t[0].dataType,t[0].dims.length),a=P("position_ids",t[1].dataType,t[1].dims.length),s=P("cos_cache",t[2].dataType,t[2].dims.length),o=P("sin_cache",t[3].dataType,t[3].dims.length),l=N1("output",t[0].dataType,t[0].dims.length);return r.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:c.length},{name:"global_strides",type:"u32",length:p.length},{name:"input_output_strides",type:"u32",length:p.length}]),`
        ${r.declareVariables(n,a,s,o,l)}

        ${r.mainStart(Bt)}
          let half_rotary_emb_dim = uniforms.${s.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${r.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${a.broadcastedIndicesToOffset("bsnh.xy",N1("",a.type.tensor,2))};
            let position_id =
                u32(${a.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${i});
            let j = i + select(half_rotary_emb_dim, 1, ${i});
            let re = ${n.getByOffset("i")} * ${s.get("position_id","bsnh[3]")} -
                ${n.getByOffset("j")} * ${o.get("position_id","bsnh[3]")};
            ${l.setByOffset("i","re")}
            let im = ${n.getByOffset("i")} * ${o.get("position_id","bsnh[3]")} +
                ${n.getByOffset("j")} * ${s.get("position_id","bsnh[3]")};
            ${l.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${l.setByOffset("k",n.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:te({interleaved:i}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:g,getRunData:()=>({outputs:[{dims:t[0].dims,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(E1.size(c)/Bt)},programUniforms:m})}},Kl=(t,r)=>{ph(t.inputs,r),t.compute(un(t.inputs,r))}}),Yl=L1(()=>{Se(),ee(),Yr(),Eo(),Po(),ct(),Oo(),ue(),mh=(t,r)=>{if(r.doRotary&&t.length<=7)throw Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let i=t[0],n=t[1],a=t[2],s=t[3],o=t[4];if(0!==r.doRotary&&t.length<=7)throw Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(-1!==r.localWindowSize)throw Error("Local attention is not supported");if(0!==r.softcap)throw Error("Softcap is not supported");if(0!==r.rotaryInterleaved)throw Error("Rotary interleaved is not supported");if(r.smoothSoftmax)throw Error("Smooth softmax is not supported");if(3!==i.dims.length&&5!==i.dims.length)throw Error("Input query is expected to have 3 or 5 dimensions");let l=i.dims[0],u=i.dims[1],h=3===i.dims.length?i.dims[2]:r.numHeads*i.dims[4],f=u,d=0,c=!n||0===n.dims.length,p=Math.floor(c?h/(r.numHeads+2*r.kvNumHeads):h/r.numHeads);c&&(h=p*r.numHeads);let m=s&&0!==s.dims.length,g=o&&0!==o.dims.length;if(m&&4===s.dims.length&&s.dims[0]===l&&s.dims[1]!==r.kvNumHeads&&s.dims[2]===r.kvNumHeads&&s.dims[3]===p)throw Error("BSNH pastKey/pastValue is not supported");if(m&&g){if(4!==s.dims.length)throw Error('Input "past_key" is expected to have 4 dimensions');if(4!==o.dims.length)throw Error('Input "past_value" is expected to have 4 dimensions');d=s.dims[2]}else if(m||g)throw Error('Input "past_key" and "past_value" shall be both present or both absent');let _=1;if(n&&n.dims.length>0){if(3!==i.dims.length)throw Error('Input "query" is expected to have 3 dimensions when key is given');if(n.dims.length<3||n.dims.length>5)throw Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(i.dims[0]!==n.dims[0])throw Error('Input "query" and "key" shall have same dim 0 (batch size)');if(3===n.dims.length){if(i.dims[2]%n.dims[2]!=0)throw Error('Dimension 2 of "query" should be a multiple of "key"');f=n.dims[1]}else if(5===n.dims.length){if(n.dims[2]!==r.numHeads||2!==n.dims[3]||n.dims[4]!==p)throw Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(a)throw Error('Expect "value" be none when "key" has packed kv format.');f=n.dims[1]}else{if(n.dims[1]!==r.numHeads||n.dims[3]!==p)throw Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');f=n.dims[2]}}else{if(3!==i.dims.length&&5!==i.dims.length)throw Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(5===i.dims.length&&(i.dims[2]!==r.numHeads||3!==i.dims[3]))throw Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');_=3}let b=0,y=!1,v=r.kvNumHeads?p*r.kvNumHeads:h;if(a&&a.dims.length>0){if(3!==a.dims.length&&4!==a.dims.length)throw Error('Input "value" is expected to have 3 or 4 dimensions');if(i.dims[0]!==a.dims[0])throw Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(3===a.dims.length){if(f!==a.dims[1])throw Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');v=a.dims[2]}else{if(f!==a.dims[2])throw Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');v=a.dims[1]*a.dims[3],y=!0}}let w=t.length>4?t[5]:void 0;if(w&&1!==w.dims.length&&w.dims[0]!==l)throw Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:l,sequenceLength:u,pastSequenceLength:d,kvSequenceLength:f,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:h,vHiddenSize:v,headSize:p,vHeadSize:Math.floor(v/r.kvNumHeads),numHeads:r.numHeads,kvNumHeads:r.kvNumHeads,nReps:r.numHeads/r.kvNumHeads,pastPresentShareBuffer:!1,maskType:b,scale:r.scale,broadcastResPosBias:!1,passPastInKv:y,qkvFormat:_}},fh=te({perm:[0,2,1,3]}),Zl=(t,r,i)=>{let n=r,a=i.kvNumHeads;return 3===r.dims.length&&0!==i.kvSequenceLength&&(n=r.reshape([i.batchSize,i.kvSequenceLength,a,i.headSize]),n=t.compute(Pe(n,fh.perm),{inputs:[n],outputs:[-1]})[0]),n},hh=(t,r,i,n)=>{let a=7,s=[t*r],o=t*r,l=[{type:12,data:o},{type:12,data:r},{type:12,data:t}];return{name:"GeneratePositionIds",shaderCache:{hint:`${t};${r}`,inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:s,dataType:a}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:l}),getShaderSource:t=>{let r=P("seq_lens",i.dataType,i.dims),o=P("total_seq_lens",n.dataType,n.dims),l=N1("pos_ids",a,s),u=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${t.registerUniforms(u).declareVariables(r,o,l)}
  ${t.mainStart()}
    ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${o.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${r.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${l.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${l.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${l.setByOffset("global_idx","seqlen")}
    };
  }
  `}}},Ql=(t,r)=>{let i=mh(t.inputs,r);if(5===t.inputs[0].dims.length)throw Error("Packed QKV is not implemented");if(t.inputs[1]?.dims.length===5)throw Error("Packed KV is not implemented");let n=t.inputs[0],a=t.inputs[1]&&t.inputs[1].dims.length>0?t.inputs[1]:void 0,s=t.inputs[2]&&t.inputs[2].dims.length>0?t.inputs[2]:void 0,o=t.inputs[3]&&0!==t.inputs[3].dims.length?t.inputs[3]:void 0,l=t.inputs[4]&&0!==t.inputs[4].dims.length?t.inputs[4]:void 0,u=t.inputs.length>4?t.inputs[5]:void 0,h=t.inputs.length>5?t.inputs[6]:void 0,f=i.kvNumHeads?i.kvNumHeads:i.numHeads,d=te({axis:2,numOutputs:3,splitSizes:[i.numHeads*i.headSize,f*i.headSize,f*i.headSize]}),[c,p,m]=a||s?[n,a,s]:t.compute(ko([n],d),{inputs:[n],outputs:[-1,-1,-1]}),g,_;if(r.doRotary){let n=t.compute(hh(i.batchSize,i.sequenceLength,u,h),{inputs:[u,h],outputs:[-1]})[0],a=t.inputs[7],s=t.inputs[8],o=te({interleaved:0!==r.rotaryInterleaved,numHeads:i.numHeads,rotaryEmbeddingDim:0,scale:r.scale}),l=[c,n,a,s],f=[-1];g=t.compute(un(l,o),{inputs:l,outputs:f})[0],l.splice(0,1,p);let d=te({interleaved:0!==r.rotaryInterleaved,numHeads:i.kvNumHeads,rotaryEmbeddingDim:0,scale:r.scale});_=t.compute(un(l,d),{inputs:l,outputs:f})[0]}let b=sr(t,i.batchSize,i.numHeads,i.sequenceLength,i.headSize,r.doRotary?g:c,void 0,0),y=Zl(t,r.doRotary?_:p,i),v=Zl(t,m,i);Ht(t,b,y,v,void 0,void 0,o,l,void 0,i,u,h)}}),ed=L1(()=>{ee(),ae(),ct(),ue(),Xl=(t,r,i,n,a,s,o,l)=>{let u=he(s),h=1===u?"f32":`vec${u}f`,f=1===u?"vec2f":`mat2x${u}f`,d=a*o,c=64;1===d&&(c=256);let p=[a,o,s/u],m=[a,o,2],g=["rank","type","type"],_=[];_.push(...W(p,m));let b=t=>{let a=P("x",r.dataType,3,u),s=[a,P("scale",i.dataType,i.dims),P("bias",n.dataType,n.dims),N1("output",1,3,2)];return`
  var<workgroup> workgroup_shared : array<${f}, ${c}>;
  const workgroup_size = ${c}u;
  ${t.declareVariables(...s)}
  ${t.mainStart(c)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${h}(0);
    var squared_sum = ${h}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${h}(${a.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${f}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${je("workgroup_shared[0][0]",u)} / f32(hight * ${u});
      let squared_sum_final = ${je("workgroup_shared[0][1]",u)} / f32(hight * ${u});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${l}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return t.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${u};${l};${c}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:m,dataType:1}],dispatchGroup:{x:d},programUniforms:_}),getShaderSource:b},{inputs:[r,i,n],outputs:[-1]})[0]},gh=(t,r,i)=>{let n=r[0].dims,a=n,s=2,o=n[0],l=n[1],u=E1.sizeFromDimension(n,s),h=he(u),f=E1.size(a)/h,d=Xl(t,r[0],r[1],r[2],o,u,l,i.epsilon),c=[o,l,u/h],p=[o,l],m=["type","none"],g=t=>{let i=P("x",r[0].dataType,c.length,h),n=P("scale_shift",1,p.length,2),a=N1("output",r[0].dataType,c.length,h),s=[i,n,a];return`
  ${t.registerUniform("output_size","u32").declareVariables(...s)}
  ${t.mainStart()}
  ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${a.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${n.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${i.getByOffset("global_idx")} * ${a.type.value}(scale_shift.x) + ${a.type.value}(scale_shift.y);
      ${a.setByOffset("global_idx","value")};
  }`};t.compute({name:"InstanceNormalization",shaderCache:{hint:`${h}`,inputDependencies:m},getRunData:()=>({outputs:[{dims:a,dataType:r[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:[{type:12,data:f},...W(c,p,c)]}),getShaderSource:g},{inputs:[r[0],d]})},yh=(t,r,i)=>{let n=r[0].dims,a=n,s=n[0],o=n[n.length-1],l=E1.sizeFromDimension(n,1)/o,u=he(o),h=E1.size(a)/u,f=[{type:12,data:l},{type:12,data:Math.floor(o/u)}],d=["type","type"],c=!1,p=[0,n.length-1];for(let t=0;t<n.length-2;t++)c=c||1!==n[t+1],p.push(t+1);let m=(c=c&&1!==n[n.length-1])?t.compute(Pe(t.inputs[0],p),{inputs:[t.inputs[0]],outputs:[-1]})[0]:t.inputs[0].reshape(Array.from({length:n.length},(t,r)=>n[p[r]])),g=Xl(t,m,r[1],r[2],s,l,o,i.epsilon),_=t=>{let i=ve(r[0].dataType),n=1===u?"vec2f":`mat${u}x2f`,s=t=>{let r=0===t?"x":"y",n=1===u?"f32":`vec${u}f`;switch(u){case 1:return`${i}(${n}(scale.${r}))`;case 2:return`vec2<${i}>(${n}(scale[0].${r}, scale[1].${r}))`;case 4:return`vec4<${i}>(${n}(scale[0].${r}, scale[1].${r}, scale[2].${r}, scale[3].${r}))`;default:throw Error(`Not supported compoents ${u}`)}},o=P("input",r[0].dataType,r[0].dims,u),l=N1("output",r[0].dataType,a,u);return`
  @group(0) @binding(0) var<storage, read> input : array<${o.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${n}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${l.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${t.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${s(0)}, ${s(1)});
  }`};t.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${u}`,inputDependencies:d},getRunData:()=>({outputs:[{dims:a,dataType:r[0].dataType}],dispatchGroup:{x:Math.ceil(h/64)},programUniforms:f}),getShaderSource:_},{inputs:[r[0],g]})},Jl=(t,r)=>{"NHWC"===r.format?yh(t,t.inputs,r):gh(t,t.inputs,r)}}),rd=L1(()=>{ee(),ae(),ue(),bh=t=>{if(!t||t.length<2)throw Error("layerNorm requires at least 2 inputs.")},_h=(t,r,i)=>{let n=r.simplified,a=t[0].dims,s=t[1],o=!n&&t[2],l=a,u=E1.normalizeAxis(r.axis,a.length),h=E1.sizeToDimension(a,u),f=E1.sizeFromDimension(a,u),d=E1.size(s.dims),c=o?E1.size(o.dims):0;if(d!==f||o&&c!==f)throw Error(`Size of X.shape()[axis:] == ${f}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${d} and bias size of ${c}`);let p=[];for(let t=0;t<a.length;++t)t<u?p.push(a[t]):p.push(1);let m=he(f),g=["type","type"],_=[{type:12,data:h},{type:1,data:f},{type:12,data:Math.floor(f/m)},{type:1,data:r.epsilon}];o&&g.push("type");let b=i>1,y=i>2,v=r=>{let i=ve(t[0].dataType),a=[P("x",t[0].dataType,t[0].dims,m),P("scale",s.dataType,s.dims,m)];o&&a.push(P("bias",o.dataType,o.dims,m)),a.push(N1("output",t[0].dataType,l,m)),b&&a.push(N1("mean_data_output",1,p)),y&&a.push(N1("inv_std_output",1,p));let u=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${r.registerUniforms(u).declareVariables(...a)}
  ${r.mainStart()}
    ${r.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${fo("f32",m)};
    var mean_square_vector = ${fo("f32",m)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${Mt(i,m,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${je("mean_vector",m)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${je("mean_square_vector",m)} / uniforms.norm_size ${n?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${Mt(i,m,"x[j + offset]")};
      let f32scale = ${Mt(i,m,"scale[j]")};
      output[j + offset] = ${a[0].type.value}((f32input ${n?"":"- mean"}) * inv_std_dev * f32scale
        ${o?`+ ${Mt(i,m,"bias[j]")}`:""}
      );
    }

    ${b?"mean_data_output[global_idx] = mean":""};
    ${y?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},w=[{dims:l,dataType:t[0].dataType}];return b&&w.push({dims:p,dataType:1}),y&&w.push({dims:p,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${m};${i};${n}`,inputDependencies:g},getRunData:()=>({outputs:w,dispatchGroup:{x:Math.ceil(h/64)},programUniforms:_}),getShaderSource:v}},td=(t,r)=>{bh(t.inputs),t.compute(_h(t.inputs,r,t.outputCount))}}),od=L1(()=>{ae(),nn(),on(),wh=t=>{if(!t||2!==t.length)throw Error("MatMul requires 2 inputs.");if(t[0].dims[t[0].dims.length-1]!==t[1].dims[t[1].dims.length-2])throw Error("shared dimension does not match.")},nd=t=>{wh(t.inputs);let r=tt.calcShape(t.inputs[0].dims,t.inputs[1].dims,!0);if(!r)throw Error("Can't use matmul on the given tensors");let i=r[r.length-1],n=t.inputs[0].dims[t.inputs[0].dims.length-1];if(i<8&&n<8)t.compute(rn(t.inputs,{activation:""},r));else{let a=r[r.length-2],s=E1.size(t.inputs[0].dims.slice(0,-2)),o=E1.size(t.inputs[1].dims.slice(0,-2));if(1!==s&&1===a&&1===o){let a=t.inputs[0].reshape([1,s,n]),o=t.inputs[1].reshape([1,n,i]),l=[1,s,i],u=[a,o];t.compute(ar(u,{activation:""},r,l),{inputs:u})}else t.compute(ar(t.inputs,{activation:""},r))}}}),sd=L1(()=>{ee(),ae(),Se(),ue(),vh=(t,r)=>{if(t.length<3||t.length>4)throw Error("MatMulNBits requires 3 or 4 inputs");let i=t[0],n=i.dims.length;if(i.dims[n-1]!==r.k)throw Error("The last dim of input shape does not match the k value");let a=Math.floor((r.k+r.blockSize-1)/r.blockSize),s=r.blockSize/8*r.bits,o=t[1];if(!E1.areEqual(o.dims,[r.n,a,s]))throw Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let l=t[2].dims;if(E1.size(l)!==r.n*a)throw Error("scales input size error.");if(4===t.length){let i=t[3].dims,n=r.n*(8===r.bits?a:Math.floor((a*r.bits+7)/8));if(E1.size(i)!==n)throw Error("zeroPoints input size error.")}},$h=(t,r)=>{let i=t[0].dims,n=i.length,a=i[n-2],s=r.k,o=r.n,l=i.slice(0,n-2),u=E1.size(l),h=t[1].dims[2]/4,f=t[0].dataType,d=he(r.k),c=he(h),p=he(o),m=l.concat([a,o]),g=a>1&&o/p%2==0?2:1,_=E1.size(m)/p/g,b=64,y=[],v=[u,a,s/d],w=E1.convertShape(t[1].dims).slice();w.splice(-1,1,h/c),y.push(...W(v)),y.push(...W(w)),y.push(...W(t[2].dims)),4===t.length&&y.push(...W(E1.convertShape(t[3].dims)));let x=[u,a,o/p];y.push(...W(x));let k=i=>{let n=v.length,a=P("a",t[0].dataType,n,d),s=P("b",12,w.length,c),o=P("scales",t[2].dataType,t[2].dims.length),l=[a,s,o],u=4===t.length?P("zero_points",12,t[3].dims.length):void 0;u&&l.push(u);let f=x.length,m=N1("output",t[0].dataType,f,p),_=ve(t[0].dataType),y=(()=>{switch(d){case 1:return`array<${_}, 8>`;case 2:return`mat4x2<${_}>`;case 4:return`mat2x4<${_}>`;default:throw Error(`${d}-component is not supported.`)}})(),k=()=>{let t=`
          // reuse a data
            var input_offset = ${a.indicesToOffset(`${a.type.indices}(batch, row, word_offset)`)};
            var a_data: ${y};
            for (var j: u32 = 0; j < ${8/d}; j++) {
              a_data[j] = ${a.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let r=0;r<p*g;r++)t+=`
            b_value = ${1===c?`b${r}_data`:`b${r}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${y}(${Array.from({length:4},(t,r)=>`${_}(b_value_lower[${r}]), ${_}(b_value_upper[${r}])`).join(", ")});
            b_dequantized_values = ${1===d?`${y}(${Array.from({length:8},(t,i)=>`(b_quantized_values[${i}] - ${u?`zero_point${r}`:"zero_point"}) * scale${r}`).join(", ")});`:`(b_quantized_values - ${y}(${Array(8).fill(`${u?`zero_point${r}`:"zero_point"}`).join(",")})) * scale${r};`};
            workgroup_shared[local_id.x * ${g} + ${Math.floor(r/p)}]${p>1?`[${r%p}]`:""} += ${Array.from({length:8/d},(t,r)=>`${1===d?`a_data[${r}] * b_dequantized_values[${r}]`:`dot(a_data[${r}], b_dequantized_values[${r}])`}`).join(" + ")};
          `;return t},E=()=>{let t=`
            var col_index = col * ${p};
            ${u?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${_}(8);`}
            `;for(let r=0;r<p*g;r++)t+=`
            let scale${r} = ${o.getByOffset("col_index * nBlocksPerCol + block")};
            ${u?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${u.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${r} = ${_}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return t},S=()=>{let t=`col_index = col * ${p};`;for(let r=0;r<p*g;r++)t+=`
            let b${r}_data = ${s.getByIndices(`${s.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return t+`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${y};
            var b_dequantized_values: ${y};`};return`
        var<workgroup> workgroup_shared: array<${m.type.value}, ${g*b}>;
        ${i.declareVariables(...l,m)}
        ${i.mainStart([b,1,1])}
          let output_indices = ${m.offsetToIndices(`(global_idx / ${b}) * ${g}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${b}) {
            //process one block
            var word_offset: u32 = block * ${r.blockSize/d};
            ${E()}
            for (var word: u32 = 0; word < ${h}; word += ${c}) {
              ${S()}
              for (var i: u32 = 0; i < ${c}; i++) {
                ${k()}
                word_offset += ${8/d};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${g}) {
            var output_value: ${m.type.value} = ${m.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${b}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${g};
            }
            ${m.setByIndices(`${m.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${r.blockSize};${r.bits};${d};${c};${p};${g};${b}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:m,dataType:f}],dispatchGroup:{x:_},programUniforms:y}),getShaderSource:k}},xh=(t,r)=>{let i=t[0].dims,n=i.length,a=i[n-2],s=r.k,o=r.n,l=i.slice(0,n-2),u=E1.size(l),h=t[1].dims[2]/4,f=t[0].dataType,d=he(r.k),c=he(h),p=l.concat([a,o]),m=128,g=o%8==0?8:o%4==0?4:1,_=128/g,b=_*c*8,y=b/d,v=b/r.blockSize,w=E1.size(p)/g,x=[],k=[u,a,s/d],E=E1.convertShape(t[1].dims).slice();E.splice(-1,1,h/c),x.push(...W(k)),x.push(...W(E)),x.push(...W(t[2].dims)),4===t.length&&x.push(...W(E1.convertShape(t[3].dims)));let S=[u,a,o];x.push(...W(S));let $=i=>{let n=k.length,a=P("a",t[0].dataType,n,d),s=P("b",12,E.length,c),o=P("scales",t[2].dataType,t[2].dims.length),l=[a,s,o],u=4===t.length?P("zero_points",12,t[3].dims.length):void 0;u&&l.push(u);let h=S.length,f=N1("output",t[0].dataType,h),p=ve(t[0].dataType),b=()=>{switch(d){case 1:return`
          let a_data0 = vec4<${p}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${p}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${p}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${p}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw Error(`${d}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${a.type.value}, ${y}>;
        var<workgroup> inter_results: array<array<${f.type.value}, ${_}>, ${g}>;
        ${i.declareVariables(...l,f)}
        ${i.mainStart([_,g,1])}
          let output_indices = ${f.offsetToIndices(`workgroup_index * ${g}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${v} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${y};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${y}; a_offset += ${m})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${a.getByIndices(`${a.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${a.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${v} + local_id.x;
            ${u?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${u.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${p}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${p}(8);`}
            let scale = ${o.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${s.getByIndices(`${s.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${r.blockSize/d};
            for (var i: u32 = 0; i < ${c}; i++) {
              ${b()}
              let b_value = ${1===c?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${p}>(${Array.from({length:4},(t,r)=>`${p}(b_value_lower[${r}]), ${p}(b_value_upper[${r}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${p}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(t,r)=>`dot(a_data${r}, b_dequantized_values[${r}])`).join(" + ")};
              word_offset += ${8/d};
            }
            workgroupBarrier();
          }

          if (local_idx < ${g}) {
            var output_value: ${f.type.value} = ${f.type.value}(0);
            for (var b = 0u; b < ${_}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${f.setByIndices(`${f.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${r.blockSize};${d};${c};${_};${g}`,inputDependencies:Array(t.length).fill("rank")},getRunData:()=>({outputs:[{dims:p,dataType:f}],dispatchGroup:{x:w},programUniforms:x}),getShaderSource:$}},id=(t,r)=>{vh(t.inputs,r),32===r.blockSize&&t.adapterInfo.isVendor("intel")&&t.adapterInfo.isArchitecture("gen-12lp")?t.compute(xh(t.inputs,r)):t.compute($h(t.inputs,r))},ad=t=>te(t)}),ld=L1(()=>{ee(),ae(),ue(),Sh=t=>{if(!t||t.length<1)throw Error("Too few inputs");if(1!==t[0].dataType&&10!==t[0].dataType)throw Error("Input type must be float or float16.");if(t.length>=2){let r=2*t[0].dims.length===t[1].dims[0];if(4===t.length&&(r=2*t[3].dims[0]===t[1].dims[0]),!r)throw Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},Th=(t,r,i)=>{let n="";for(let a=r-1;a>=0;--a)n+=`
            k = i32(${t.indicesGet("indices",a)}) - ${K("uniforms.pads",a,i)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${K("uniforms.x_shape",a,r)})) {
              break;
            }
            offset += k * i32(${K("uniforms.x_strides",a,r)});
        `;return`
          value = ${t.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${n}
            value = x[offset];
          }
      `},Ch=(t,r,i)=>{let n="";for(let a=r-1;a>=0;--a)n+=`
                k = i32(${t.indicesGet("indices",a)}) - ${K("uniforms.pads",a,i)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${K("uniforms.x_shape",a,r)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${K("uniforms.x_shape",a,r)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${K("uniforms.x_strides",a,r)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},Ih=(t,r,i)=>{let n="";for(let a=r-1;a>=0;--a)n+=`
                k = i32(${t.indicesGet("indices",a)}) - ${K("uniforms.pads",a,i)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${K("uniforms.x_shape",a,r)})) {
                  k = i32(${K("uniforms.x_shape",a,r)}) - 1;
                }
                offset += k * i32(${K("uniforms.x_strides",a,r)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},Ah=(t,r,i)=>{let n="";for(let a=r-1;a>=0;--a)n+=`
                k = i32(${t.indicesGet("indices",a)}) - ${K("uniforms.pads",a,i)};
                if (k < 0)  {
                  k += i32(${K("uniforms.x_shape",a,r)}]);
                }
                if (k >= i32(${K("uniforms.x_shape",a,r)})) {
                  k -= i32(${K("uniforms.x_shape",a,r)});
                }
                offset += k * i32(${K("uniforms.x_strides",a,r)});
            `;return`
              var offset = 0;
              var k = 0;
              ${n}
              value = x[offset];
          `},Eh=(t,r,i)=>{switch(i.mode){case 0:return Th(t,r,i.pads.length);case 1:return Ch(t,r,i.pads.length);case 2:return Ih(t,r,i.pads.length);case 3:return Ah(t,r,i.pads.length);default:throw Error("Invalid mode")}},kh=(t,r)=>{let i=E1.padShape(t[0].dims.slice(),r.pads),n=t[0].dims,a=[{type:12,data:E1.size(i)},{type:6,data:r.pads}],s=t.length>=3&&t[2].data;0===r.mode&&a.push({type:s?t[2].dataType:1,data:r.value}),a.push(...W(t[0].dims,i));let o=["rank"],l=a=>{let o=N1("output",t[0].dataType,i.length),l=P("x",t[0].dataType,n.length),u=l.type.value,h=Eh(o,n.length,r),f=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:r.pads.length}];return 0===r.mode&&f.push({name:"constant_value",type:s?u:"f32"}),`
            ${a.registerUniforms(f).declareVariables(l,o)}
            ${a.mainStart()}
            ${a.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${o.offsetToIndices("global_idx")};

            var value = ${u}(0);
            ${h}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${r.mode}${s}`,inputDependencies:o},getRunData:()=>({outputs:[{dims:i,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(E1.size(i)/64)},programUniforms:a}),getShaderSource:l}},Ph=(t,r)=>{if(!(t.length>1))return r;{let i=t[1].getBigInt64Array(),n=t.length>=3&&t[2].data?10===t[2].dataType?t[2].getUint16Array()[0]:t[2].getFloat32Array()[0]:0,a=t[0].dims.length,s=new Int32Array(2*a).fill(0);if(t.length>=4){let r=t[3].getBigInt64Array();for(let t=0;t<r.length;t++)s[Number(r[t])]=Number(i[t]),s[Number(r[t])+a]=Number(i[t+r.length])}else i.forEach((t,r)=>s[Number(r)]=Number(t));let o=[];return s.forEach(t=>o.push(t)),{mode:r.mode,value:n,pads:o}}},ud=(t,r)=>{Sh(t.inputs);let i=Ph(t.inputs,r);t.compute(kh(t.inputs,i),{inputs:[0]})}}),Cd=L1(()=>{Ve(),ee(),ae(),ue(),ln=t=>{if(we.webgpu.validateInputContent&&(!t||1!==t.length))throw Error("Pool ops requires 1 input.")},dd=(t,r,i)=>{let n="NHWC"===r.format,a=t.dims.slice();n&&a.splice(1,0,a.pop());let s=Object.hasOwnProperty.call(r,"dilations"),o=r.kernelShape.slice(),l=r.strides.slice(),u=s?r.dilations.slice():[],h=r.pads.slice();Dt.adjustPoolAttributes(i,a,o,l,u,h);let f=Dt.computePoolOutputShape(i,a,l,u,o,h,r.autoPad),d=Object.assign({},r);s?Object.assign(d,{kernelShape:o,strides:l,pads:h,dilations:u,cacheKey:r.cacheKey}):Object.assign(d,{kernelShape:o,strides:l,pads:h,cacheKey:r.cacheKey});let c=f.slice();return c.push(c.splice(1,1)[0]),[d,n?c:f]},cd=(t,r)=>{let i="NHWC"===r.format,n=[{type:12,data:E1.size(t)},{type:12,data:E1.size(r.kernelShape)}],a=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(r.kernelShape.length<=2){let t=r.kernelShape[r.kernelShape.length-1],i=r.strides[r.strides.length-1],s=r.pads[r.pads.length/2-1],o=r.pads[r.pads.length-1],l=!!(s+o);n.push({type:12,data:t},{type:12,data:i},{type:12,data:s},{type:12,data:o}),a.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let u=!1;if(2===r.kernelShape.length){let t=r.kernelShape[r.kernelShape.length-2],i=r.strides[r.strides.length-2],s=r.pads[r.pads.length/2-2],o=r.pads[r.pads.length-2];u=!!(s+o),n.push({type:12,data:t},{type:12,data:i},{type:12,data:s},{type:12,data:o}),a.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[n,a,!0,l,u]}{if(i)throw Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let t=E1.computeStrides(r.kernelShape);return n.push({type:12,data:t},{type:12,data:r.pads},{type:12,data:r.strides}),a.push({name:"kernelStrides",type:"u32",length:t.length},{name:"pads",type:"u32",length:r.pads.length},{name:"strides",type:"u32",length:r.strides.length}),[n,a,!!r.pads.reduce((t,r)=>t+r),!1,!1]}},pd=(t,r,i,n,a,s,o,l,u,h,f,d)=>{let c="NHWC"===a.format,p=r.type.value,m=N1("output",r.type.tensor,n);if(a.kernelShape.length<=2){let n="",h="",g="",_=i-(c?2:1);if(n=f?`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${_}] = indices[${_}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${_}] < 0 || xIndices[${_}]
                      >= uniforms.x_shape[${_}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${r.indicesToOffset("xIndices")}];
                  ${s}
                }`:`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${_}] = indices[${_}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${r.indicesToOffset("xIndices")}];
                  ${s}
                }`,2===a.kernelShape.length){let t=i-(c?3:2);h=d?`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${t}] = indices[${t}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${t}] < 0 || xIndices[${t}] >= uniforms.x_shape[${t}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${t}] = indices[${t}] * uniforms.sh - uniforms.phStart + j;
                `,g=`
              }
            `}return`
            ${t.registerUniforms(u).declareVariables(r,m)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${m.offsetToIndices("global_idx")};
              var xIndices = ${m.offsetToIndices("global_idx")};

              var value = ${p}(${l});
              var pad = 0;
              ${h}
              ${n}
              ${g}
              ${o}

              output[global_idx] = value;
            }`}{if(c)throw Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let n=a.kernelShape.length,f=a.pads.length,d="";return d=h?`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${r.indicesToOffset("xIndices")}];
                ${s}
              }`:`
              }
              let x_val = x[${r.indicesToOffset("xIndices")}];
              ${s}
            `,`
            ${t.registerUniforms(u).declareVariables(r,m)}

            ${t.mainStart()}
              ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${m.offsetToIndices("global_idx")};
              var xIndices = ${m.offsetToIndices("global_idx")};

              var offsets: array<u32, ${n}>;

              var value = ${p}(${l});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${n-1}u; j++) {
                  offsets[j] = offset / ${K("uniforms.kernelStrides","j",n)};
                  offset -= offsets[j] * ${K("uniforms.kernelStrides","j",n)};
                }
                offsets[${n-1}] = offset;

                isPad = false;
                for (var j = ${i-n}u; j < ${i}u; j++) {
                  xIndices[j] = indices[j] * ${K("uniforms.strides",`j - ${i-n}u`,n)}
                    + offsets[j - ${i-n}u] - ${K("uniforms.pads","j - 2u",f)};
                  ${d}
              }
              ${o}

              output[global_idx] = value;
            }`}},md=t=>`${t.format};${t.ceilMode};${t.autoPad};${t.kernelShape.length}`,Oh=t=>`${md(t)};${t.countIncludePad}`,zh=t=>`${md(t)};${t.storageOrder};${t.dilations}`,fd=t=>({format:t.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][t.auto_pad],ceilMode:t.ceil_mode,kernelShape:t.kernel_shape,strides:t.strides,pads:t.pads}),hd=(t,r,i,n)=>{let[a,s]=dd(r,n,i),o=P("x",r.dataType,r.dims.length),l=o.type.value,u="value += x_val;",h="";a.countIncludePad?h+=`value /= ${l}(uniforms.kernelSize);`:h+=`value /= ${l}(i32(uniforms.kernelSize) - pad);`;let[f,d,c,p,m]=cd(s,a);f.push(...W(r.dims,s));let g=["rank"];return{name:t,shaderCache:{hint:`${n.cacheKey};${c};${p};${m}`,inputDependencies:g},getRunData:()=>({outputs:[{dims:s,dataType:r.dataType}],dispatchGroup:{x:Math.ceil(E1.size(s)/64)},programUniforms:f}),getShaderSource:t=>pd(t,o,r.dims.length,s.length,a,u,h,0,d,c,p,m)}},gd=t=>{let r=0!==t.count_include_pad,i=fd(t);if(0!==i.ceilMode)throw Error("using ceil() in shape computation is not yet supported for AveragePool");let n={countIncludePad:r,...i,cacheKey:""};return{...n,cacheKey:Oh(n)}},yd=(t,r)=>{ln(t.inputs),t.compute(hd("AveragePool",t.inputs[0],!1,r))},bd={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},_d=t=>{let r=t.format;return{format:r,...bd,cacheKey:r}},wd=(t,r)=>{ln(t.inputs),t.compute(hd("GlobalAveragePool",t.inputs[0],!0,r))},vd=(t,r,i,n)=>{let[a,s]=dd(r,n,i),o=`
      value = max(x_val, value);
    `,l="",u=P("x",r.dataType,r.dims.length),h=["rank"],[f,d,c,p,m]=cd(s,a);return f.push(...W(r.dims,s)),{name:t,shaderCache:{hint:`${n.cacheKey};${c};${p};${m}`,inputDependencies:h},getRunData:()=>({outputs:[{dims:s,dataType:r.dataType}],dispatchGroup:{x:Math.ceil(E1.size(s)/64)},programUniforms:f}),getShaderSource:t=>pd(t,u,r.dims.length,s.length,a,o,l,10===r.dataType?-65504:-1e5,d,c,p,m)}},$d=(t,r)=>{ln(t.inputs),t.compute(vd("MaxPool",t.inputs[0],!1,r))},xd=t=>{let r=t.storage_order,i=t.dilations,n=fd(t);if(0!==r)throw Error("column major storage order is not yet supported for MaxPool");if(0!==n.ceilMode)throw Error("using ceil() in shape computation is not yet supported for MaxPool");let a={storageOrder:r,dilations:i,...n,cacheKey:""};return{...a,cacheKey:zh(a)}},Sd=t=>{let r=t.format;return{format:r,...bd,cacheKey:r}},Td=(t,r)=>{ln(t.inputs),t.compute(vd("GlobalMaxPool",t.inputs[0],!0,r))}}),Ed=L1(()=>{ee(),ae(),Se(),ue(),Bh=(t,r)=>{if(t.length<2||t.length>3)throw Error("DequantizeLinear requires 2 or 3 inputs.");if(3===t.length&&t[1].dims===t[2].dims)throw Error("x-scale and x-zero-point must have the same shape.");if(3===t.length&&t[0].dataType!==t[2].dataType)throw Error("x and x-zero-point must have the same data type.");if(6===t[0].dataType&&t.length>2)throw Error("In the case of dequantizing int32 there is no zero point.");if(0!==t[1].dims.length&&1!==t[1].dims.length&&t[1].dims.length!==t[0].dims.length)throw Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(t.length>2){if(t[0].dataType!==t[2].dataType)throw Error("x and x-zero-point must have the same data type.");if(t[1].dims.length!==t[2].dims.length)throw Error("scale and zero-point inputs must have the same rank.");if(!t[1].dims.map((r,i)=>r===t[2].dims[i]).reduce((t,r)=>t&&r,!0))throw Error("scale and zero-point inputs must have the same shape.")}if(r.blockSize>0){if(0===t[1].dims.length||1===t[1].dims.length&&1===t[1].dims[0])throw Error("blockSize must be set only for block quantization.");if(!t[1].dims.map((i,n)=>n===r.axis||i===t[0].dims[n]).reduce((t,r)=>t&&r,!0))throw Error("For block qunatization, scale input shape to match the input shape except for the axis");if(t[1].dims.length!==t[0].dims.length)throw Error("For block qunatization the scale input rank must be the same as the x rank.");let i=t[0].dims[r.axis],n=t[1].dims[r.axis];if(r.blockSize<Math.ceil(i/n)||r.blockSize>Math.ceil(i/(n-1)-1))throw Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},Mh=(t,r)=>{let i=E1.normalizeAxis(r.axis,t[0].dims.length),n=t[0].dataType,a=3===n,s=t[0].dims,o=t[1].dataType,l=E1.size(s),u=3===n||2===n,h=u?[Math.ceil(E1.size(t[0].dims)/4)]:t[0].dims,f=t[1].dims,d=t.length>2?t[2]:void 0,c=d?u?[Math.ceil(E1.size(d.dims)/4)]:d.dims:void 0,p=0===f.length||1===f.length&&1===f[0],m=!1===p&&1===f.length,g=he(l),_=p&&(!u||4===g),b=_?g:1,y=_&&!u?g:1,v=P("input",u?12:n,h.length,y),w=P("scale",o,f.length),x=d?P("zero_point",u?12:n,c.length):void 0,k=N1("output",o,s.length,b),E=[v,w];x&&E.push(x);let S=[h,f];d&&S.push(c);let $=[{type:12,data:l/b},{type:12,data:i},{type:12,data:r.blockSize},...W(...S,s)],I=t=>{let r=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${t.registerUniforms(r).declareVariables(...E,k)}
      ${t.mainStart()}
          ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${k.offsetToIndices("global_idx")};

          // Set input x
          ${u?`
            let input = ${v.getByOffset("global_idx / 4")};
            let x_vec = ${a?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${1===b?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${v.getByOffset("global_idx")};`};

          // Set scale input
          ${p?`let scale_value= ${w.getByOffset("0")}`:m?`
            let scale_index = ${k.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${w.getByOffset("scale_index")};`:`
            var scale_indices: ${w.type.indices} = output_indices;
            let index = ${w.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${w.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${w.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${x?p?u?`
                let zero_point_input = ${x.getByOffset("0")};
                let zero_point_vec =  ${a?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${x.getByOffset("0")}`:m?u?`
                let zero_point_index = ${k.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${x.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${a?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${k.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${x.getByOffset("zero_point_index")};`:u?`
                let zero_point_offset = ${w.indicesToOffset("scale_indices")};
                let zero_point_input = ${x.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${a?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${x.getByIndices("scale_indices")};`:`let zero_point_value = ${u?a?"i32":"u32":v.type.value}(0);`};
      // Compute and write output
      ${k.setByOffset("global_idx",`${k.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:r.cacheKey,inputDependencies:x?["rank","rank","rank"]:["rank","rank"]},getShaderSource:I,getRunData:()=>({outputs:[{dims:s,dataType:o}],dispatchGroup:{x:Math.ceil(l/b/64),y:1,z:1},programUniforms:$})}},Id=(t,r)=>{Bh(t.inputs,r),t.compute(Mh(t.inputs,r))},Ad=t=>te({axis:t.axis,blockSize:t.blockSize})}),Pd=L1(()=>{Ve(),ee(),ue(),Rh=(t,r,i)=>{let n=t===r,a=t<r&&i<0,s=t>r&&i>0;if(n||a||s)throw Error("Range these inputs' contents are invalid.")},Uh=(t,r,i,n)=>{let a=Math.abs(Math.ceil((r-t)/i)),s=[a],o=a,l=[{type:12,data:o},{type:n,data:t},{type:n,data:i},...W(s)],u=t=>{let r=N1("output",n,s.length),i=r.type.value,a=[{name:"outputSize",type:"u32"},{name:"start",type:i},{name:"delta",type:i}];return`
        ${t.registerUniforms(a).declareVariables(r)}
        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${i}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${n}`},getShaderSource:u,getRunData:()=>({outputs:[{dims:s,dataType:n}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:l})}},kd=t=>{let r=0,i=0,n=0;6===t.inputs[0].dataType?(r=t.inputs[0].getInt32Array()[0],i=t.inputs[1].getInt32Array()[0],n=t.inputs[2].getInt32Array()[0]):1===t.inputs[0].dataType&&(r=t.inputs[0].getFloat32Array()[0],i=t.inputs[1].getFloat32Array()[0],n=t.inputs[2].getFloat32Array()[0]),we.webgpu.validateInputContent&&Rh(r,i,n),t.compute(Uh(r,i,n,t.inputs[0].dataType),{inputs:[]})}}),Dd=L1(()=>{ee(),ae(),Se(),ue(),Nh=(t,r,i,n)=>{if("none"!==t&&"i32"!==n&&"u32"!==n&&"f32"!==n)throw Error(`Input ${n} is not supported with reduction ${t}.`);let a=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,s=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${r}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(t){case"none":return`${r}=${i};`;case"add":return"i32"===n||"u32"===n?`atomicAdd(&${r}, bitcast<${n}>(${i}));`:`
              ${a}bitcast<${n}>(oldValue) + (${i})${s}`;case"max":return"i32"===n||"u32"===n?`atomicMax(&${r}, bitcast<${n}>(${i}));`:`
                ${a}max(bitcast<f32>(oldValue), (${i}))${s}`;case"min":return"i32"===n||"u32"===n?`atomicMin(&${r}, bitcast<${n}>(${i}));`:`${a}min(bitcast<${n}>(oldValue), (${i}))${s}`;case"mul":return`${a}(bitcast<${n}>(oldValue) * (${i}))${s}`;default:throw Error(`Reduction ${t} is not supported.`)}},Vh=(t,r)=>{let i=t[0].dims,n=t[1].dims,a=i,s=1,o=Math.ceil(E1.sizeToDimension(n,n.length-1)/s),l=n[n.length-1],u=E1.sizeFromDimension(i,l),h=[{type:12,data:o},{type:12,data:l},{type:12,data:u},...W(t[1].dims,t[2].dims,a)],f=i=>{let n=P("indices",t[1].dataType,t[1].dims.length),o=P("updates",t[2].dataType,t[2].dims.length,s),l="none"!==r.reduction&&""!==r.reduction?as("output",t[0].dataType,a.length):N1("output",t[0].dataType,a.length,s);return`
      ${i.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(n,o,l)}
      ${i.mainStart()}
        ${i.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var data_offset = 0u;
  let indices_start = uniforms.last_index_dimension * global_idx;
  let indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${1===t[0].dims.length?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[i - indices_start];
    let dim_value = uniforms.output_shape[i - indices_start];`}
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));
  }

  for (var i = 0u; i < uniforms.num_updates_elements; i++) {
    let value = updates[uniforms.num_updates_elements * global_idx + i];
    ${Nh(r.reduction,"output[data_offset + i]","value",l.type.value)}
  }

      }`};return{name:"ScatterND",shaderCache:{hint:`${r.cacheKey}_${r.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:a,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(o/64)},programUniforms:h}),getShaderSource:f}},Od=t=>te({reduction:t.reduction}),zd=(t,r)=>{t.compute(Vh(t.inputs,r),{inputs:[t.inputs[1],t.inputs[2]],outputs:[]})}}),Nd=L1(()=>{ee(),ae(),Se(),ue(),Lh=(t,r)=>{if(t.every(t=>t>0||(()=>{throw Error("Resize requires scales input values to be positive")})),t.length>0){if("linear"===r.mode){if(2!==t.length&&3!==t.length&&(4!==t.length||1!==t[0]||1!==t[1])&&(4!==t.length||1!==t[0]||1!==t[3])&&(5!==t.length||1!==t[0]||1!==t[1]))throw Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if("cubic"===r.mode&&2!==t.length&&(4!==t.length||1!==t[0]||1!==t[1])&&(4!==t.length||1!==t[0]||1!==t[3]))throw Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},Wh=(t,r,i)=>{r.every(t=>t>=0&&t<i||(()=>{throw Error("Resize requires axes input values to be positive and less than rank")}));let n=Array(i).fill(1);return r.forEach((r,i)=>n[r]=t[i]),n},Gh=(t,r,i,n,a,s)=>{let[o,l,u]=i>10?[1,2,3]:[-1,t.length>1?1:-1,-1],h=t[0].dims.length;if(o>0&&t.length>o&&t[o].dims.length>0)t[o].getFloat32Array().forEach(t=>s.push(t));else if("tf_crop_and_resize"===r.coordinateTransformMode)throw Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(l>0&&t.length>l&&1===t[l].dims.length&&t[l].dims[0]>0){if(t[l].getFloat32Array().forEach(t=>n.push(t)),0!==n.length&&n.length!==h&&i>=18&&n.length!==r.axes.length)throw Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");Lh(n,r),r.axes.length>0&&Wh(n,r.axes,h).forEach((t,r)=>n[r]=t)}if(u>0&&t.length>u&&1===t[u].dims.length&&t[u].dims[0]>0&&(t[u].getBigInt64Array().forEach(t=>a.push(Number(t))),0!==a.length&&a.length!==h&&i>=18&&a.length!==r.axes.length))throw Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(r.axes.length>0){if(0!==n.length&&n.length!==r.axes.length)throw Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(0!==a.length&&a.length!==r.axes.length)throw Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if("u">typeof n&&"u">typeof a&&n.length>0&&a.length>h)throw Error("Resize requires only of scales or sizes to be specified")},Bd=(t,r,i,n)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${t}) * (${r});
  let whole = ${n}(big / (${i}));
  let fract = ${n}(big % (${i})) / ${n}(${i});
  return whole + fract;
`,Hh=(t,r)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${r} { `+(()=>{switch(t){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${r}(xResized) / ${r}(xScale);
          } else {
            ${Bd("xResized","lengthOriginal","lengthResized",r)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${r}(xResized) + 0.5) / ${r}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${r}(xResized) + 0.5) / ${r}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${Bd("xResized","lengthOriginal - 1","lengthResized - 1",r)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${r}(roiStart) * ${r}(lengthOriginal - 1) +
                        (${r}(xResized) * ${r}(roiEnd - roiStart) * ${r}(lengthOriginal - 1)) /
                        ${r}(lengthResized - 1);
                  } else {
                    return 0.5 * ${r}(roiStart + roiEnd) * ${r}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${r}xScale * ${r}(lengthResized);
                  const adjustment = ${r}(lengthResized) / outputWidth;
                  const center = ${r}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${r}(xResized) + 0.5) / ${r}(xScale)) - 0.5;`;case"half_pixel":return`return ((${r}(xResized) + 0.5) / ${r}(xScale)) - 0.5;`;default:throw Error(`Coordinate transform mode ${t} is not supported`)}})()+"}",Fh=(t,r,i)=>`fn getNearestPixelFromOriginal(xOriginal: ${i}, isDownSample: bool) -> ${i} {`+(()=>{switch(t){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";default:if(r<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw Error(`Nearest mode ${t} is not supported`)}})()+"}",qh=(t,r,i)=>{let n=Array(i).fill(0).concat(Array(i).fill(1)),a=0===t.length?n:t.slice();return r.length>0?(r.forEach((t,s)=>{n[t]=a[s],n[s+i]=a[r.length+s]}),n):a},jh=(t,r,i,n)=>{let a=[];if(i.length>0)if(n.length>0){if(t.forEach(t=>a.push(t)),Math.max(...n)>t.length)throw Error("axes is out of bound");n.forEach((t,r)=>a[t]=i[r])}else i.forEach(t=>a.push(t));else{if(0===r.length)throw Error("Resize requires either scales or sizes.");a=t.map((t,i)=>Math.round(t*r[i]))}return a},Kh=(t,r,i)=>{let n=(()=>{switch(i.keepAspectRatioPolicy){case"not_larger":return i.axes.length>0?Math.min(...i.axes.map(t=>r[t]),Number.MAX_VALUE):Math.min(...r,Number.MAX_VALUE);case"not_smaller":return i.axes.length>0?Math.max(...i.axes.map(t=>r[t]),5e-324):Math.max(...r,5e-324);default:throw Error(`Keep aspect ratio policy ${i.keepAspectRatioPolicy} is not supported`)}})();r.fill(1,0,r.length);let a=t.slice();return i.axes.length>0?(i.axes.forEach(t=>r[t]=n),i.axes.forEach(i=>a[i]=Math.round(t[i]*r[i]))):(r.fill(n,0,r.length),a.forEach((t,i)=>a[i]=Math.round(t*r[i]))),a},Zh=(t,r,i,n,a)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${t.type.indices}) -> array<${t.type.value}, ${i.length}> {
      var original_indices: array<${t.type.value}, ${i.length}>;
      for (var i:u32 = 0; i < ${i.length}; i++) {
        var output_index = ${t.indicesGet("output_indices","i")};
        var scale = ${K("uniforms.scales","i",n)};
        var roi_low = ${K("uniforms.roi","i",a)};
        var roi_hi = ${K("uniforms.roi",`i + ${r.length}`,a)};
        if (scale == 1.0) {
          original_indices[i] = ${t.type.value}(output_index);
        } else {
          var input_shape_i = ${K("uniforms.input_shape","i",r.length)};
          var output_shape_i = ${K("uniforms.output_shape","i",i.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,Qh=(t,r,i,n,a,s,o)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${r.type.indices}) -> ${t.type.indices} {
      var input_indices: ${t.type.indices};
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var output_index = ${r.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${K("uniforms.scales","i",a)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${K("uniforms.roi","i",s)};
          var roi_hi = ${K("uniforms.roi",`i + ${i.length}`,s)};
          var input_shape_i = ${K("uniforms.input_shape","i",i.length)};
          var output_shape_i = ${K("uniforms.output_shape","i",n.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${o} || (original_idx >= 0 && original_idx < ${r.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${r.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${t.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,Yh=(t,r)=>`
    fn checkInputIndices(input_indices: ${t.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${r.length}; i++) {
        var input_index = ${t.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${K("uniforms.input_shape","i",r.length)}) {
          return false;
        }
      }
      return true;
    }`,Md=(t,r,i,n)=>t.rank>n?`
    ${t.indicesSet("input_indices",r,"channel")};
    ${t.indicesSet("input_indices",i,"batch")};
`:"",Xh=(t,r,i,n,a)=>{let[s,o,l,u]=2===i.length?[-1,0,1,-1]:[0,2,3,1],h=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${h} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",o,`max(0, min(row, ${i[o]} - 1))`)};
      ${t.indicesSet("input_indices",l,`max(0, min(col, ${i[l]} - 1))`)};
      ${Md(t,u,s,2)}
      return ${t.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${r.type.indices}) -> ${h} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${h} = originalIndices[${o}];
      var col:${h} = originalIndices[${l}];
      ${n?`if (row < 0 || row > (${i[o]} - 1) || col < 0 || col > (${i[l]} - 1)) {
        return ${a};
      }`:""};
      row = max(0, min(row, ${i[o]} - 1));
      col = max(0, min(col, ${i[l]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${i.length>2?`u32(originalIndices[${u}])`:"0"};
      var batch: u32 =  ${i.length>2?`u32(originalIndices[${s}])`:"0"};
      var x11: ${h} = getInputValue(batch, channel, row1, col1);
      var x12: ${h} = getInputValue(batch, channel, row1, col2);
      var x21: ${h} = getInputValue(batch, channel, row2, col1);
      var x22: ${h} = getInputValue(batch, channel, row2, col2);
      var dx1: ${h} = abs(row - ${h}(row1));
      var dx2: ${h} = abs(${h}(row2) - row);
      var dy1: ${h} = abs(col - ${h}(col1));
      var dy2: ${h} = abs(${h}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},Jh=(t,r,i,n,a,s,o,l,u,h)=>{let[f,d]=2===i.length?[0,1]:[2,3],c=t.type.value,p=o=>{let d=o===f?"row":"col";return`
      fn ${d}CubicInterpolation(input_indices: ${t.type.indices}, output_indices: ${r.type.indices}) -> ${c} {
        var output_index = ${r.indicesGet("output_indices",o)};
        var originalIdx: ${c} = getOriginalCoordinateFromResizedCoordinate(output_index, ${a[o]},
        ${n[o]}, ${i[o]}, ${s[o]}, ${s[o]} + ${i.length});
        var fractOriginalIdx: ${c} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${l} && (originalIdx < 0 || originalIdx > (${i[o]} - 1))) {
          return ${u};
        }
        var data: array<${c}, 4> = array<${c}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${d}: ${c} = originalIdx + ${c}(i);
          if (${d} < 0 || ${d} >= ${i[o]}) {
            ${h?`coefs[i + 1] = 0.0;
                        continue;`:l?`return ${u};`:`${d} = max(0, min(${d}, ${i[o]} - 1));`};
          }
        var input_indices_copy: ${t.type.indices} = input_indices;
          ${t.indicesSet("input_indices_copy",o,`u32(${d})`)};
          data[i + 1] = ${o===f?t.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${p(f)};
    ${p(d)};
  fn getCubicInterpolationCoefs(s: ${c}) -> array<${c}, 4> {
    var absS = abs(s);
    var coeffs: array<${c}, 4> = array<${c}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${c} = 1.0 - absS;
    var twoMinusAbsS: ${c} = 2.0 - absS;
    var onePlusAbsS: ${c} = 1.0 + absS;
    coeffs[0] = ((${o} * onePlusAbsS - 5 * ${o}) * onePlusAbsS + 8 * ${o}) * onePlusAbsS - 4 * ${o};
    coeffs[1] = ((${o} + 2) * absS - (${o} + 3)) * absS * absS + 1;
    coeffs[2] = ((${o} + 2) * oneMinusAbsS - (${o} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${o} * twoMinusAbsS - 5 * ${o}) * twoMinusAbsS + 8 * ${o}) * twoMinusAbsS - 4 * ${o};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${c}, 4>, coefs: array<${c}, 4>) -> ${c} {
    var coefsSum: ${c} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${r.type.indices}) -> ${c} {
    var input_indices: ${t.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},eg=(t,r,i,n,a)=>{let[s,o,l,u,h]=3===i.length?[-1,0,1,2,-1]:[0,2,3,4,1],f=t.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${f} {
      var input_indices: ${t.type.indices};
      ${t.indicesSet("input_indices",o,`max(0, min(depth, ${i[o]} - 1))`)};
      ${t.indicesSet("input_indices",l,`max(0, min(height, ${i[l]} - 1))`)};
      ${t.indicesSet("input_indices",u,`max(0, min(width, ${i[u]} - 1))`)};
      ${Md(t,h,s,3)}
      return ${t.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${r.type.indices}) -> ${f} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${f} = originalIndices[${o}];
      var height:${f} = originalIndices[${l}];
      var width:${f} = originalIndices[${u}];
      ${n?`if (depth < 0 || depth > (${i[o]} - 1) || height < 0 || height > (${i[l]} - 1) || width < 0 || (width > ${i[u]} - 1)) {
      return ${a};
        }`:""};

    depth = max(0, min(depth, ${i[o]} - 1));
      height = max(0, min(height, ${i[l]} - 1));
      width = max(0, min(width, ${i[u]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${i.length>3?`u32(originalIndices[${h}])`:"0"};
      var batch: u32 =  ${i.length>3?`u32(originalIndices[${s}])`:"0"};

      var x111: ${f} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${f} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${f} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${f} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${f} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${f} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${f} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${f} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${f} = abs(depth - ${f}(depth1));
      var dx2: ${f} = abs(${f}(depth2) - depth);
      var dy1: ${f} = abs(height - ${f}(height1));
      var dy2: ${f} = abs(${f}(height2) - height);
      var dz1: ${f} = abs(width - ${f}(width1));
      var dz2: ${f} = abs(${f}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},tg=(t,r,i,n,a,s)=>{let o=t.dims,l=qh(s,r.axes,o.length),u=jh(o,n,a,r.axes),h=n.slice();0===n.length&&(h=o.map((t,r)=>0===t?1:u[r]/t),"stretch"!==r.keepAspectRatioPolicy&&(u=Kh(o,h,r)));let f=N1("output",t.dataType,u.length),d=P("input",t.dataType,o.length),c=E1.size(u),p=o.length===u.length&&o.every((t,r)=>t===u[r]),m="tf_crop_and_resize"===r.coordinateTransformMode,g=r.extrapolationValue,_=d.type.value,b=t=>`
      ${p?"":`
      ${Hh(r.coordinateTransformMode,_)};
      ${(()=>{switch(r.mode){case"nearest":return`
              ${Yh(d,o)};
              ${Fh(r.nearestMode,i,_)};
              ${Qh(d,f,o,u,h.length,l.length,m)};
              `;case"linear":return`
              ${Zh(f,o,u,h.length,l.length)};
              ${(()=>{if(2===o.length||4===o.length)return`${Xh(d,f,o,m,g)}`;if(3===o.length||5===o.length)return`${eg(d,f,o,m,g)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(2===o.length||4===o.length)return`${Jh(d,f,o,u,h,l,r.cubicCoeffA,m,r.extrapolationValue,r.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${t.registerUniform("output_size","u32").registerUniform("scales","f32",h.length).registerUniform("roi","f32",l.length).declareVariables(d,f)}
      ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${p?"output[global_idx] = input[global_idx];":`
        let output_indices = ${f.offsetToIndices("global_idx")};
        var input_indices: ${d.type.indices};
        ${(()=>{switch(r.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${d.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${r.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${2===o.length||4===o.length?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${r.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${r.cacheKey}|${i}|${h.length>0?"cubic"===r.mode?h:h.length:""}|${a.length>0?a:""}|${l.length>0?l:""}|${p}|${"nearest"===r.mode?o.length:o}`,inputDependencies:["rank"]},getShaderSource:b,getRunData:()=>({outputs:[{dims:u,dataType:t.dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:[{type:12,data:c},{type:1,data:h},{type:1,data:l},...W(o,u)]})}},rg=t=>{let r=t.customDataBuffer;return new Uint32Array(r,r.byteOffset,1)[0]},Rd=(t,r)=>{let i=[],n=[],a=[],s=rg(t);if(0!==r.antialias)throw Error("Only default value (0) for Antialias attribute is supported");Gh(t.inputs,r,s,i,n,a),t.compute(tg(t.inputs[0],r,s,i,n,a),{inputs:[0]})},Ud=t=>{let r=t.antialias,i=t.axes,n=t.coordinateTransformMode,a=t.cubicCoeffA,s=0!==t.excludeOutside,o=t.extrapolationValue,l=t.keepAspectRatioPolicy,u=t.mode,h=""===t.nearestMode?"simple":t.nearestMode;return te({antialias:r,axes:i,coordinateTransformMode:n,cubicCoeffA:a,excludeOutside:s,extrapolationValue:o,keepAspectRatioPolicy:l,mode:u,nearestMode:h})}}),Ld=L1(()=>{ee(),ae(),ue(),ng=t=>{if(!t||t.length<3)throw Error("layerNorm requires at least 3 inputs.");let r=t[0],i=t[1],n=t[2];if(r.dataType!==i.dataType||r.dataType!==n.dataType)throw Error("All inputs must have the same data type");if(3!==r.dims.length&&2!==r.dims.length)throw Error("Input must be 2D or 3D");if(3!==i.dims.length&&2!==i.dims.length)throw Error("Skip must be 2D or 3D");let a=r.dims[r.dims.length-1],s=r.dims[r.dims.length-2];if(i.dims[i.dims.length-1]!==a)throw Error("Skip must have the same hidden size as input");if(i.dims[i.dims.length-2]!==s)throw Error("Skip must have the same sequence length as input");if(1!==n.dims.length)throw Error("Gamma must be 1D");if(n.dims[n.dims.length-1]!==a)throw Error("Gamma must have the same hidden size as input");if(t.length>3){let r=t[3];if(1!==r.dims.length)throw Error("Beta must be 1D");if(r.dims[r.dims.length-1]!==a)throw Error("Beta must have the same hidden size as input")}if(t.length>4){let r=t[4];if(1!==r.dims.length)throw Error("Bias must be 1D");if(r.dims[r.dims.length-1]!==a)throw Error("Bias must have the same hidden size as input")}},og=(t,r,i,n)=>{let a=r.simplified,s=t[0].dims,o=E1.size(s),l=s,u=o,h=s.slice(-1)[0],f=n?s.slice(0,-1).concat(1):[],d=!a&&t.length>3,c=t.length>4,p=n&&i>1,m=n&&i>2,g=i>3,_=64,b=he(h),y=[{type:12,data:u},{type:12,data:b},{type:12,data:h},{type:1,data:r.epsilon}],v=r=>{let i=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],n=[P("x",t[0].dataType,t[0].dims,b),P("skip",t[1].dataType,t[1].dims,b),P("gamma",t[2].dataType,t[2].dims,b)];d&&n.push(P("beta",t[3].dataType,t[3].dims,b)),c&&n.push(P("bias",t[4].dataType,t[4].dims,b)),n.push(N1("output",t[0].dataType,l,b)),p&&n.push(N1("mean_output",1,f)),m&&n.push(N1("inv_std_output",1,f)),g&&n.push(N1("input_skip_bias_sum",t[0].dataType,l,b));let s=ve(t[0].dataType),o=ve(1,b);return`

      ${r.registerUniforms(i).declareVariables(...n)}
      var<workgroup> sum_shared : array<${o}, ${_}>;
      var<workgroup> sum_squared_shared : array<${o}, ${_}>;

      ${r.mainStart([_,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${_};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${_};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${_-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${c?"bias[offset1d + i]":s+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${g?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${Mt(s,b,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${_};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${je("sum",b)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${je("square_sum",b)} / f32(uniforms.hidden_size) ${a?"":"- mean * mean"} + uniforms.epsilon);
        ${p?"mean_output[global_idx] = mean;":""}
        ${m?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${a?"":`- ${s}(mean)`}) *
            ${s}(inv_std_dev) * gamma[offset1d + i]
            ${d?"+ beta[offset1d + i]":""};
        }
      }`},w=[{dims:l,dataType:t[0].dataType}];return i>1&&w.push({dims:f,dataType:1}),i>2&&w.push({dims:f,dataType:1}),i>3&&w.push({dims:s,dataType:t[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${b};${p};${m};${g}`,inputDependencies:t.map((t,r)=>"type")},getShaderSource:v,getRunData:()=>({outputs:w,dispatchGroup:{x:Math.ceil(u/h)},programUniforms:y})}},Vd=(t,r)=>{ng(t.inputs);let i=[0];t.outputCount>1&&i.push(-3),t.outputCount>2&&i.push(-3),t.outputCount>3&&i.push(3),t.compute(og(t.inputs,r,t.outputCount,!1),{outputs:i})}}),Fd=L1(()=>{ee(),ae(),Se(),ue(),ig=(t,r)=>{if(!t||t.length<1)throw Error("too few inputs");if(0!==r.axes.length){if(r.axes.length!==r.starts.length||r.axes.length!==r.ends.length)throw Error("axes, starts and ends must have the same length")}else if(r.starts.length!==r.ends.length)throw Error("starts and ends must have the same length");t.slice(1).forEach((r,i)=>{if(6!==t[i+1].dataType&&7!==t[i+1].dataType)throw Error(`Input ${i} must be an array of int32 or int64`)})},dn=(t,r)=>{let i=[];if(t.length>r)if(7===t[r].dataType)t[r].getBigInt64Array().forEach(t=>i.push(Number(t)));else if(6===t[r].dataType)t[r].getInt32Array().forEach(t=>i.push(Number(t)));else throw Error(`Input ${r} must be an array of int32 or int64`);return i},ag=(t,r)=>{if(!(t.length>1))return r;{let r=dn(t,1),i=dn(t,2),n=dn(t,3);return 0===n.length&&(n=[...Array(t[0].dims.length).keys()]),te({starts:r,ends:i,axes:n})}},Wd=(t,r,i,n,a)=>{let s=t;return t<0&&(s+=i[n[r]]),a[r]<0?Math.max(0,Math.min(s,i[n[r]]-1)):Math.max(0,Math.min(s,i[n[r]]))},sg=(t,r,i)=>`fn calculateInputIndices(output_indices: ${r.type.indices}) -> ${t.type.indices} {
          var input_indices: ${t.type.indices};
          var carry = 0u;
          for (var i = ${i.length-1}; i >= 0; i--) {
            let input_shape_i = ${K("uniforms.input_shape","i",i.length)};
            let steps_i = ${K("uniforms.steps","i",i.length)};
            let signs_i = ${K("uniforms.signs","i",i.length)};
            let starts_i = ${K("uniforms.starts","i",i.length)};
            var output_index = ${r.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${t.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,ug=(t,r)=>{let i=t[0].dims,n=E1.size(i),a=r.axes.length>0?E1.normalizeAxes(r.axes,i.length):[...Array(i.length).keys()],s=dn(t,4);s.forEach(t=>0!==t||(()=>{throw Error("step cannot be 0")})),0===s.length&&(s=Array(a.length).fill(1));let o=r.starts.map((t,r)=>Wd(t,r,i,a,s)),l=r.ends.map((t,r)=>Wd(t,r,i,a,s));if(a.length!==o.length||a.length!==l.length)throw Error("start, ends and axes should have the same number of elements");if(a.length!==i.length)for(let t=0;t<i.length;++t)a.includes(t)||(o.splice(t,0,0),l.splice(t,0,i[t]),s.splice(t,0,1));let u=s.map(t=>Math.sign(t));s.forEach((t,r,i)=>{if(t<0){let n=(l[r]-o[r])/t,a=o[r],u=a+n*s[r];o[r]=u,l[r]=a,i[r]=-t}});let h=i.slice(0);a.forEach((t,r)=>{h[t]=Math.ceil((l[t]-o[t])/s[t])});let f={dims:h,dataType:t[0].dataType},d=N1("output",t[0].dataType,h.length),c=P("input",t[0].dataType,t[0].dims.length),p=E1.size(h),m=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:o.length},{name:"signs",type:"i32",length:u.length},{name:"steps",type:"u32",length:s.length}],g=[{type:12,data:p},{type:12,data:o},{type:6,data:u},{type:12,data:s},...W(t[0].dims,h)],_=t=>`
      ${t.registerUniforms(m).declareVariables(c,d)}
        ${sg(c,d,i)}
        ${t.mainStart()}
          ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${d.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${d.setByOffset("global_idx",c.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${u.length}_${o.length}_${s.length}`,inputDependencies:["rank"]},getShaderSource:_,getRunData:()=>({outputs:[f],dispatchGroup:{x:Math.ceil(n/64)},programUniforms:g})}},Gd=(t,r)=>{ig(t.inputs,r);let i=ag(t.inputs,r);t.compute(ug(t.inputs,i),{inputs:[0]})},Hd=t=>{let r=t.starts,i=t.ends,n=t.axes;return te({starts:r,ends:i,axes:n})}}),Kd=L1(()=>{ee(),ae(),Se(),ct(),ue(),lg=t=>{if(!t||1!==t.length)throw Error("Softmax op requires 1 input.")},dg=(t,r)=>{let i=t.inputs[0],n=i.dims,a=E1.size(n),s=n.length,o=E1.normalizeAxis(r.axis,s),l=o<n.length-1,u,h=[];l?((h=Array.from({length:s},(t,r)=>r))[o]=s-1,h[s-1]=o,u=t.compute(Pe(i,h),{inputs:[i],outputs:[-1]})[0]):u=i;let f=u.dims,d=f[s-1],c=a/d,p=he(d),m=d/p,g=64;1===c&&(g=256);let _=(t,r)=>4===r?`max(max(${t}.x, ${t}.y), max(${t}.z, ${t}.w))`:2===r?`max(${t}.x, ${t}.y)`:3===r?`max(max(${t}.x, ${t}.y), ${t}.z)`:t,b=P("x",u.dataType,u.dims,p),y=N1("result",u.dataType,u.dims,p),v=b.type.value,w="f32"===ve(u.dataType)?`var threadMax = ${v}(-3.402823e+38f);`:`var threadMax = ${v}(-65504.0h);`,x=t=>`
      var<workgroup> rowMaxShared : ${v};
      var<workgroup> rowSumShared : ${v};
      var<workgroup> threadShared : array<${v}, ${g}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${v} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${v}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${t.registerUniform("packedCols","i32").declareVariables(b,y)}
      ${t.mainStart(g)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${g};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${w}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${v}(${_("threadShared[0]",p)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${v}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${v}(${je("threadShared[0]",p)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          var value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          // max operation protects against NaN since all values should be >=0
          value = max(value, ${v}(0.0));
          setValue(row, col, row_stride, value);
        }
      }`,k=t.compute({name:"Softmax",shaderCache:{hint:`${p};${g}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:f,dataType:u.dataType}],dispatchGroup:{x:c},programUniforms:[{type:6,data:m}]}),getShaderSource:x},{inputs:[u],outputs:[l?-1:0]})[0];l&&t.compute(Pe(k,h),{inputs:[k]})},qd=(t,r)=>{lg(t.inputs),dg(t,r)},jd=t=>te({axis:t.axis})}),Yd=L1(()=>{ee(),ae(),ue(),Zd=t=>Array.from(t.getBigInt64Array(),Number),cg=t=>{if(!t||2!==t.length)throw Error("Tile requires 2 inputs.");if(1!==t[0].dataType&&10!==t[0].dataType&&6!==t[0].dataType&&12!==t[0].dataType)throw Error("Tile only support float, float16, int32, and uint32 data types");if(7!==t[1].dataType)throw Error("Tile `repeats` input should be of int64 data type");if(1!==t[1].dims.length)throw Error("Tile `repeats` input should be 1-D");if(Zd(t[1]).length!==t[0].dims.length)throw Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},pg=(t,r)=>{let i=[];for(let n=0;n<t.length;++n)i.push(t[n]*r[n]);return i},mg=(t,r)=>{let i=t[0].dims,n=r??Zd(t[1]),a=pg(i,n),s=E1.size(a),o=t[0].dataType,l=P("input",o,i.length),u=N1("output",o,a.length);return{name:"Tile",shaderCache:{hint:`${n}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:a,dataType:t[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:[{type:12,data:s},...W(t[0].dims,a)]}),getShaderSource:t=>`
      const inputShape = ${l.indices(...i)};
      ${t.registerUniform("output_size","u32").declareVariables(l,u)}
      ${t.mainStart()}
      ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${u.offsetToIndices("global_idx")};
      var input_indices: ${l.type.indices};
      for (var i = 0; i < ${i.length}; i++) {
        let input_dim_i = ${l.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${u.indicesGet("output_indices","i")}  % input_dim_i;

        ${l.indicesSet("input_indices","i","input_dim_value")}
      }
      ${u.setByOffset("global_idx",l.getByIndices("input_indices"))}
    }`}},Qd=t=>{cg(t.inputs),t.compute(mg(t.inputs),{inputs:[0]})}}),Jd=L1(()=>{ee(),ae(),ue(),fg=(t,r,i,n,a)=>{let s=N1("output_data",a,i.length,4),o=P("a_data",r[1].dataType,r[1].dims.length,4),l=P("b_data",r[2].dataType,r[2].dims.length,4),u=P("c_data",r[0].dataType,r[0].dims.length,4),h,f=(t,r,i)=>`select(${r}, ${t}, ${i})`;if(n){let t=(t,r,i="")=>{let n=`a_data[index_a${r}][component_a${r}]`,a=`b_data[index_b${r}][component_b${r}]`,h=`bool(c_data[index_c${r}] & (0xffu << (component_c${r} * 8)))`;return`
            let output_indices${r} = ${s.offsetToIndices(`global_idx * 4u + ${r}u`)};
            let offset_a${r} = ${o.broadcastedIndicesToOffset(`output_indices${r}`,s)};
            let offset_b${r} = ${l.broadcastedIndicesToOffset(`output_indices${r}`,s)};
            let offset_c${r} = ${u.broadcastedIndicesToOffset(`output_indices${r}`,s)};
            let index_a${r} = offset_a${r} / 4u;
            let index_b${r} = offset_b${r} / 4u;
            let index_c${r} = offset_c${r} / 4u;
            let component_a${r} = offset_a${r} % 4u;
            let component_b${r} = offset_b${r} % 4u;
            let component_c${r} = offset_c${r} % 4u;
            ${t}[${r}] = ${i}(${f(n,a,h)});
          `};h=9===a?`
            var data = vec4<u32>(0);
            ${t("data",0,"u32")}
            ${t("data",1,"u32")}
            ${t("data",2,"u32")}
            ${t("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:`
            ${t("output_data[global_idx]",0)}
            ${t("output_data[global_idx]",1)}
            ${t("output_data[global_idx]",2)}
            ${t("output_data[global_idx]",3)}
          `}else h=s.setByOffset("global_idx",f(o.getByOffset("global_idx"),l.getByOffset("global_idx"),u.getByOffset("global_idx")));return`
        ${t.registerUniform("vec_size","u32").declareVariables(u,o,l,s)}
        ${t.mainStart()}
        ${t.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${h}
      }`},hg=t=>{let r=t[1].dims,i=t[2].dims,n=t[0].dims,a=t[1].dataType,s=!(E1.areEqual(r,i)&&E1.areEqual(i,n)),o=r,l=E1.size(r);if(s){let t=tt.calcShape(tt.calcShape(r,i,!1),n,!1);if(!t)throw Error("Can't perform where op on the given tensors");o=t,l=E1.size(o)}let u=Math.ceil(l/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:r=>fg(r,t,o,s,a),getRunData:()=>({outputs:[{dims:o,dataType:a}],dispatchGroup:{x:Math.ceil(l/64/4)},programUniforms:[{type:12,data:u},...W(n,r,i,o)]})}},Xd=t=>{t.compute(hg(t.inputs))}}),tc=L1(()=>{Bs(),Yr(),Us(),Vs(),Tu(),Mu(),Nu(),tl(),ul(),cl(),fl(),_l(),$l(),Sl(),Il(),kl(),zl(),Ml(),Nl(),Wl(),Yl(),ed(),rd(),od(),sd(),Eo(),ld(),Cd(),Ed(),Pd(),Dd(),Zr(),Nd(),Oo(),Ld(),Fd(),Kd(),Po(),Yd(),ct(),Jr(),Jd(),ec=new Map([["Abs",[Ls]],["Acos",[Ws]],["Acosh",[Gs]],["Add",[Cu]],["ArgMax",[Ds,go]],["ArgMin",[zs,go]],["Asin",[Hs]],["Asinh",[Fs]],["Atan",[qs]],["Atanh",[js]],["Attention",[Ms]],["AveragePool",[yd,gd]],["BatchNormalization",[Rs]],["BiasAdd",[Ns]],["BiasSplitGelu",[Su]],["Cast",[Zs,Ks]],["Ceil",[Ys]],["Clip",[Qs]],["Concat",[Ru,Uu]],["Conv",[To,So]],["ConvTranspose",[sl,il]],["Cos",[Xs]],["Cosh",[Js]],["CumSum",[ll,dl]],["DepthToSpace",[pl,ml]],["DequantizeLinear",[Id,Ad]],["Div",[Iu]],["Einsum",[yl,bl]],["Elu",[eu,or]],["Equal",[Au]],["Erf",[tu]],["Exp",[ru]],["Expand",[vl]],["FastGelu",[xl]],["Floor",[nu]],["FusedConv",[To,So]],["Gather",[Cl,Tl]],["GatherElements",[Bl,Dl]],["GatherBlockQuantized",[Pl,Ol]],["GatherND",[Al,El]],["Gelu",[ou]],["Gemm",[Ul,Rl]],["GlobalAveragePool",[wd,_d]],["GlobalMaxPool",[Td,Sd]],["Greater",[Ou]],["GreaterOrEqual",[Du]],["GridSample",[Vl,Ll]],["GroupQueryAttention",[Ql]],["HardSigmoid",[pu,cu]],["InstanceNormalization",[Jl]],["LayerNormalization",[td]],["LeakyRelu",[iu,or]],["Less",[zu]],["LessOrEqual",[Bu]],["Log",[vu]],["MatMul",[nd]],["MatMulNBits",[id,ad]],["MaxPool",[$d,xd]],["Mul",[Eu]],["MultiHeadAttention",[Fl,Hl]],["Neg",[su]],["Not",[au]],["Pad",[ud]],["Pow",[ku]],["QuickGelu",[$u,or]],["Range",[kd]],["Reciprocal",[uu]],["ReduceMin",[Is]],["ReduceMean",[$s]],["ReduceMax",[Cs]],["ReduceSum",[Es]],["ReduceProd",[As]],["ReduceL1",[xs]],["ReduceL2",[Ss]],["ReduceLogSum",[Ps]],["ReduceLogSumExp",[Ts]],["ReduceSumSquare",[ks]],["Relu",[lu]],["Resize",[Rd,Ud]],["RotaryEmbedding",[Kl]],["ScatterND",[zd,Od]],["Sigmoid",[du]],["Sin",[mu]],["Sinh",[fu]],["Slice",[Gd,Hd]],["SkipLayerNormalization",[Vd]],["Split",[ql,jl]],["Sqrt",[hu]],["Softmax",[qd,jd]],["Sub",[Pu]],["Tan",[gu]],["Tanh",[bu]],["ThresholdedRelu",[wu,or]],["Tile",[Qd]],["Transpose",[ls,ds]],["Where",[Xd]]])}),rc=L1(()=>{Ve(),et(),ue(),cn=class{constructor(t){this.backend=t,this.repo=new Map,this.attributesBound=!1}getArtifact(t){return this.repo.get(t)}setArtifact(t,r){this.repo.set(t,r)}run(t,r,i,n,a){Ne(t.programInfo.name);let s=this.backend.device,o=this.backend.getComputePassEncoder();this.backend.writeTimestamp(2*this.backend.pendingDispatchNumber);let l=[];for(let t of r)l.push({binding:l.length,resource:{buffer:t.buffer}});for(let t of i)l.push({binding:l.length,resource:{buffer:t.buffer}});a&&l.push({binding:l.length,resource:a});let u=s.createBindGroup({layout:t.computePipeline.getBindGroupLayout(0),entries:l,label:t.programInfo.name});if("capturing"===this.backend.sessionStatus){let r={kernelId:this.backend.currentKernelId,computePipeline:t.computePipeline,bindGroup:u,dispatchGroup:n};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(r)}o.setPipeline(t.computePipeline),o.setBindGroup(0,u),o.dispatchWorkgroups(...n),this.backend.writeTimestamp(2*this.backend.pendingDispatchNumber+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||"at-passes"===this.backend.queryType)&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Me(t.programInfo.name)}dispose(){}build(t,r){Ne(t.name);let i=this.backend.device,n=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(t=>{i.features.has(t.feature)&&n.push(`enable ${t.extension};`)});let a=ss(r,this.backend.device.limits),s=t.getShaderSource(a),o=`${n.join(`
`)}
${a.additionalImplementations}
${s}`,l=i.createShaderModule({code:o,label:t.name});le("verbose",()=>`[WebGPU] ${t.name} shader code: ${o}`);let u=i.createComputePipeline({compute:{module:l,entryPoint:"main"},layout:"auto",label:t.name});return Me(t.name),{programInfo:t,computePipeline:u,uniformVariablesInfo:a.variablesInfo}}normalizeDispatchGroupSize(t){let r="number"==typeof t?t:t.x,i="number"==typeof t?1:t.y||1,n="number"==typeof t?1:t.z||1,a=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(r<=a&&i<=a&&n<=a)return[r,i,n];let s=r*i*n,o=Math.ceil(Math.sqrt(s));if(!(o>a))return[o,o,1];if((o=Math.ceil(Math.cbrt(s)))>a)throw Error("Total dispatch size exceeds WebGPU maximum.");return[o,o,o]}}}),nc={};Wt(nc,{WebGpuBackend:()=>Do});var gg,yg,zo,Do,oc=L1(()=>{Ve(),ee(),et(),no(),is(),tc(),rc(),gg=(t,r)=>{if(r.length!==t.length)throw Error(`inputDependencies length ${r.length} is not equal to inputTensors length ${t.length}.`);let i=[];for(let n=0;n<t.length;++n){let a=t[n].dataType;switch(r[n]){case"none":i.push("");break;case"type":i.push(`${a}`);break;case"rank":{let r=t[n].dims.length;i.push(`${a};${r}`);break}case"dims":{let r=t[n].dims.join(",");i.push(`${a};${r}`);break}default:throw Error(`unsupported input dependency: ${r[n]}`)}}return i.join("|")},yg=(t,r,i)=>{let n=t.name;return t.shaderCache?.hint&&(n+="["+t.shaderCache.hint+"]"),n+=":"+i+`:${gg(r,t.shaderCache?.inputDependencies??Array(r.length).fill("dims"))}`},zo=class{constructor(t){t&&(this.architecture=t.architecture,this.vendor=t.vendor)}isArchitecture(t){return this.architecture===t}isVendor(t){return this.vendor===t}},Do=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(null===this.currentKernelId)throw Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let t=this.kernelCustomData.get(this.currentKernelId);return t||(t={},this.kernelCustomData.set(this.currentKernelId,t)),t}async initialize(t,r){this.env=t;let i=[],n={requiredLimits:{maxComputeWorkgroupStorageSize:r.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:r.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:r.limits.maxStorageBufferBindingSize,maxBufferSize:r.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:r.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:r.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:r.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:r.limits.maxComputeWorkgroupSizeZ},requiredFeatures:i},a=t=>r.features.has(t)&&i.push(t)&&!0;a("chromium-experimental-timestamp-query-inside-passes")||a("timestamp-query"),a("shader-f16"),a("subgroups"),this.device=await r.requestDevice(n),this.adapterInfo=new zo(r.info||await r.requestAdapterInfo()),this.gpuDataManager=os(this),this.programManager=new cn(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,Nr(t.logLevel,!!t.debug),this.device.onuncapturederror=t=>{t.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${t.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:r,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){"u">typeof this.querySet&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let t=this.getCommandEncoder(),r={};"at-passes"===this.queryType&&(r.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:2*this.pendingDispatchNumber,endOfPassWriteIndex:2*this.pendingDispatchNumber+1}),this.computePassEncoder=t.beginComputePass(r)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){let t;this.commandEncoder&&(Ne(),this.endComputePass(),"none"!==this.queryType&&(this.commandEncoder.resolveQuerySet(this.querySet,0,2*this.pendingDispatchNumber,this.queryResolveBuffer,0),t=this.device.createBuffer({size:2*this.pendingDispatchNumber*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(t,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,2*this.pendingDispatchNumber*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,"none"!==this.queryType&&t.mapAsync(GPUMapMode.READ).then(()=>{let r=new BigUint64Array(t.getMappedRange()),i=this.pendingQueries.get(t);for(let t=0;t<r.length/2;t++){let n=i[t],a=n.kernelId,s=this.kernels.get(a),o=s.kernelType,l=s.kernelName,u=n.programName,h=n.inputTensorViews,f=n.outputTensorViews,d=r[2*t],c=r[2*t+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=d);let p=Number(d-this.queryTimeBase),m=Number(c-this.queryTimeBase);if(!Number.isSafeInteger(p)||!Number.isSafeInteger(m))throw RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:h.map(t=>({dims:t.dims,dataType:Je(t.dataType)})),outputsMetadata:f.map(t=>({dims:t.dims,dataType:Je(t.dataType)})),kernelId:a,kernelType:o,kernelName:l,programName:u,startTime:p,endTime:m});else{let t="";h.forEach((r,i)=>{t+=`input[${i}]: [${r.dims}] | ${Je(r.dataType)}, `});let r="";f.forEach((t,i)=>{r+=`output[${i}]: [${t.dims}] | ${Je(t.dataType)}, `}),console.log(`[profiling] kernel "${a}|${o}|${l}|${u}" ${t}${r}start time: ${p} ns, execution time: ${m-p} ns`)}$r("GPU",`${u}::${d}::${c}`)}t.unmap(),this.pendingQueries.delete(t)}),Me())}run(t,r,i,n,a,s){let o;Ne(t.name);let l=[];for(let t=0;t<r.length;++t){let i=r[t].data;if(0===i)continue;let n=this.gpuDataManager.get(i);if(!n)throw Error(`no GPU data for input: ${i}`);l.push(n)}let{outputs:u,dispatchGroup:h,programUniforms:f}=t.getRunData(r),d=0===i.length?u.map((t,r)=>r):i;if(d.length!==u.length)throw Error(`Output size ${d.length} must be equal to ${u.length}.`);let c=[],p=[];for(let t=0;t<u.length;++t){if(!Number.isInteger(d[t])||d[t]<-3||d[t]>=s)throw Error(`Invalid output index: ${d[t]}`);if(-3===d[t])continue;let r=-1===d[t],i=-2===d[t],o=r||i?a(u[t].dataType,u[t].dims):n(d[t],u[t].dataType,u[t].dims);if(c.push(o),0===o.data)continue;let l=this.gpuDataManager.get(o.data);if(!l)throw Error(`no GPU data for output: ${o.data}`);if(r&&this.temporaryData.push(l),i){let t=this.kernelPersistentData.get(this.currentKernelId);t||(t=[],this.kernelPersistentData.set(this.currentKernelId,t)),t.push(l)}p.push(l)}if(l.length!==r.length||p.length!==c.length){if(0===p.length)return Me(t.name),c;throw Error(`Program ${t.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}if(f){let t=0,r=[];f.forEach(i=>{let n="number"==typeof i.data?[i.data]:i.data;if(0===n.length)return;let a=10===i.type?2:4,s,o;10===i.type?(o=n.length>4?16:n.length>2?8:n.length*a,s=n.length>4?16:a*n.length):(o=n.length<=2?n.length*a:16,s=16),t=Math.ceil(t/o)*o,r.push(t);let l=10===i.type?8:4;t+=n.length>4?Math.ceil(n.length/l)*s:n.length*a});let i=new ArrayBuffer(t=16*Math.ceil(t/16));f.forEach((t,n)=>{let a=r[n],s="number"==typeof t.data?[t.data]:t.data;if(6===t.type)new Int32Array(i,a,s.length).set(s);else if(12===t.type)new Uint32Array(i,a,s.length).set(s);else if(10===t.type)new Uint16Array(i,a,s.length).set(s);else if(1===t.type)new Float32Array(i,a,s.length).set(s);else throw Error(`Unsupported uniform type: ${Je(t.type)}`)});let n=this.gpuDataManager.create(t,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(n.buffer,0,i,0,t),this.gpuDataManager.release(n.id),o={offset:0,size:t,buffer:n.buffer}}let m=this.programManager.normalizeDispatchGroupSize(h),g=yg(t,r,1===m[1]&&1===m[2]),_=this.programManager.getArtifact(g);if(_||(_=this.programManager.build(t,m),this.programManager.setArtifact(g,_),le("info",()=>`[artifact] key: ${g}, programName: ${t.name}`)),f&&_.uniformVariablesInfo){if(f.length!==_.uniformVariablesInfo.length)throw Error(`Uniform variables count mismatch: expect ${_.uniformVariablesInfo.length}, got ${f.length} in program "${_.programInfo.name}".`);for(let t=0;t<f.length;t++){let r=f[t],i=r.type,n="number"==typeof r.data?1:r.data.length,[a,s]=_.uniformVariablesInfo[t];if(i!==a||n!==s)throw Error(`Uniform variable ${t} mismatch: expect type ${a} with size ${s}, got type ${i} with size ${n} in program "${_.programInfo.name}".`)}}if(le("info",()=>`[ProgramManager] run "${t.name}" (key=${g}) with ${m[0]}x${m[1]}x${m[2]}`),"none"!==this.queryType||"capturing"===this.sessionStatus){let t={kernelId:this.currentKernelId,programName:_.programInfo.name,inputTensorViews:r,outputTensorViews:c};this.pendingKernels.push(t),"capturing"===this.sessionStatus&&this.capturedPendingKernels.get(this.currentSessionId).push(t)}return this.programManager.run(_,l,p,m,o),Me(t.name),c}upload(t,r){this.gpuDataManager.upload(t,r)}memcpy(t,r){this.gpuDataManager.memcpy(t,r)}async download(t,r){await this.gpuDataManager.download(t,r)}alloc(t){return this.gpuDataManager.create(t).id}free(t){return this.gpuDataManager.release(t)}createKernel(t,r,i,n){let a=ec.get(t);if(!a)throw Error(`kernel not implemented: ${t}`);let s={kernelType:t,kernelName:n,kernelEntry:a[0],attributes:[a[1],i]};this.kernels.set(r,s)}releaseKernel(t){let r=this.kernelPersistentData.get(t);if(r){for(let t of r)this.gpuDataManager.release(t.id);this.kernelPersistentData.delete(t)}this.kernelCustomData.delete(t),this.kernels.delete(t)}computeKernel(t,r,i){let n=this.kernels.get(t);if(!n)throw Error(`kernel not created: ${t}`);let a=n.kernelType,s=n.kernelName,o=n.kernelEntry,l=n.attributes;if(null!==this.currentKernelId)throw Error(`kernel "[${a}] ${s}" is not allowed to be called recursively`);this.currentKernelId=t,l[0]&&(l[1]=l[0](l[1]),l[0]=void 0),le("info",()=>`[WebGPU] Start to run kernel "[${a}] ${s}"...`);let u=this.env.debug;this.temporaryData=[];try{return u&&this.device.pushErrorScope("validation"),o(r,l[1]),0}catch(t){return i.push(Promise.resolve(`[WebGPU] Kernel "[${a}] ${s}" failed. ${t}`)),1}finally{for(let t of(u&&i.push(this.device.popErrorScope().then(t=>t?`GPU validation error for kernel "[${a}] ${s}": ${t.message}`:null)),this.temporaryData))this.gpuDataManager.release(t.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(t,r,i,n){let a=this.sessionExternalDataMapping.get(t);a||(a=new Map,this.sessionExternalDataMapping.set(t,a));let s=a.get(r),o=this.gpuDataManager.registerExternalBuffer(i,n,s);return a.set(r,[o,i]),o}unregisterBuffers(t){let r=this.sessionExternalDataMapping.get(t);r&&(r.forEach(t=>this.gpuDataManager.unregisterExternalBuffer(t[0])),this.sessionExternalDataMapping.delete(t))}getBuffer(t){let r=this.gpuDataManager.get(t);if(!r)throw Error(`no GPU data for buffer: ${t}`);return r.buffer}createDownloader(t,r,i){return async()=>{let n=await lo(this,t,r);return Lr(n.buffer,i)}}writeTimestamp(t){"inside-passes"===this.queryType&&this.computePassEncoder.writeTimestamp(this.querySet,t)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),"none"!==this.queryType&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:2*this.maxDispatchNumber}),this.queryResolveBuffer=this.device.createBuffer({size:2*this.maxDispatchNumber*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){le("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){le("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){le("info","replay"),this.sessionStatus="replaying";let t=this.capturedCommandList.get(this.currentSessionId),r=this.capturedPendingKernels.get(this.currentSessionId),i=t.length;this.pendingKernels=[];for(let n=0;n<i;n++){let i=this.getComputePassEncoder(),a=t[n];this.writeTimestamp(2*this.pendingDispatchNumber),i.setPipeline(a.computePipeline),i.setBindGroup(0,a.bindGroup),i.dispatchWorkgroups(...a.dispatchGroup),this.writeTimestamp(2*this.pendingDispatchNumber+1),this.pendingDispatchNumber++,"none"!==this.queryType&&this.pendingKernels.push(r[n]),(this.pendingDispatchNumber>=this.maxDispatchNumber||"at-passes"===this.queryType)&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(t){this.unregisterBuffers(t),this.capturedCommandList.has(t)&&this.capturedCommandList.delete(t),this.capturedPendingKernels.has(t)&&this.capturedPendingKernels.delete(t),this.gpuDataManager.onReleaseSession(t)}onRunStart(t){this.currentSessionId=t,this.setQueryType()}}}),ic={};Wt(ic,{init:()=>bg});var ur,Bo,bg,_g,Ir,Ar,Rt,wg,sc,er,Er,kr,uc,Pr,Or,zr,Ut,He,lr,mn,fn,pn,Mo,Ro,jt,Kt,$g,lc,dc,cc,pc,mc,fc,hc,gc,xg,hn,ac=L1(()=>{ee(),et(),ae(),es(),ur=class t{constructor(t,r,i,n){this.module=t,this.dataType=r,this.data=i,this.dims=n}getFloat32Array(){if(1!==this.dataType)throw Error("Invalid data type");let t=E1.size(this.dims);return 0===t?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,t)}getBigInt64Array(){if(7!==this.dataType)throw Error("Invalid data type");let t=E1.size(this.dims);return 0===t?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,t)}getInt32Array(){if(6!==this.dataType)throw Error("Invalid data type");let t=E1.size(this.dims);return 0===t?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,t)}getUint16Array(){if(10!==this.dataType&&4!==this.dataType)throw Error("Invalid data type");let t=E1.size(this.dims);return 0===t?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,t)}reshape(r){if(E1.size(r)!==E1.size(this.dims))throw Error("Invalid new shape");return new t(this.module,this.dataType,this.data,r)}},Bo=class{constructor(t,r,i){this.module=t,this.backend=r,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=r.adapterInfo;let n=t.PTR_SIZE,a=i/t.PTR_SIZE,s=4===n?"i32":"i64";this.opKernelContext=Number(t.getValue(n*a++,s));let o=Number(t.getValue(n*a++,s));this.outputCount=Number(t.getValue(n*a++,s)),this.customDataOffset=Number(t.getValue(n*a++,"*")),this.customDataSize=Number(t.getValue(n*a++,s));let l=[];for(let r=0;r<o;r++){let r=Number(t.getValue(n*a++,s)),i=Number(t.getValue(n*a++,"*")),o=Number(t.getValue(n*a++,s)),u=[];for(let r=0;r<o;r++)u.push(Number(t.getValue(n*a++,s)));l.push(new ur(t,r,i,u))}this.inputs=l}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(t,r){let i=r?.inputs?.map(t=>"number"==typeof t?this.inputs[t]:t)??this.inputs,n=r?.outputs??[],a=(t,r,i)=>new ur(this.module,r,this.output(t,i),i),s=(t,r)=>{let i=St(t,r);if(!i)throw Error(`Unsupported data type: ${t}`);let n=i>0?this.backend.gpuDataManager.create(i).id:0;return new ur(this.module,t,n,r)};return this.backend.run(t,i,n,a,s,this.outputCount)}output(t,r){let i=this.module.stackSave();try{let i=this.module.PTR_SIZE,n=4===i?"i32":"i64",a=this.module.stackAlloc((1+r.length)*i);this.module.setValue(a,r.length,n);for(let t=0;t<r.length;t++)this.module.setValue(a+i*(t+1),r[t],n);return this.module._JsepOutput(this.opKernelContext,t,a)}catch(i){throw Error(`Failed to generate kernel's output[${t}] with dims [${r}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${i}`)}finally{this.module.stackRestore(i)}}},bg=async(t,r,i,n)=>{let a=r.jsepInit;if(!a)throw Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if("webgpu"===t){let t=new(oc(),Xt(nc)).WebGpuBackend;await t.initialize(i,n),a("webgpu",[t,r=>t.alloc(Number(r)),r=>t.free(r),(i,n,a,s=!1)=>{if(s)le("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(i)}, dst=${Number(n)}, size=${Number(a)}`),t.memcpy(Number(i),Number(n));else{le("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(i)}, gpuDataId=${Number(n)}, size=${Number(a)}`);let s=r.HEAPU8.subarray(Number(i>>>0),Number(i>>>0)+Number(a));t.upload(Number(n),s)}},async(i,n,a)=>{le("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${i}, dataOffset=${n}, size=${a}`),await t.download(Number(i),()=>r.HEAPU8.subarray(Number(n)>>>0,Number(n+a)>>>0))},(i,n,a)=>t.createKernel(i,Number(n),a,r.UTF8ToString(r._JsepGetNodeName(Number(n)))),r=>t.releaseKernel(r),(i,n,a,s)=>{le("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${a}, kernel=${i}, contextDataOffset=${n}`);let o=new Bo(r,t,Number(n));return t.computeKernel(Number(i),o,s)},()=>t.captureBegin(),()=>t.captureEnd(),()=>t.replay()])}else{let t=new Fr(i);a("webnn",[t,()=>t.reserveTensorId(),r=>t.releaseTensorId(r),async(r,i,n,a,s)=>t.ensureTensor(r,i,n,a,s),(r,i)=>{t.uploadTensor(r,i)},async(r,i)=>t.downloadTensor(r,i),(r,i)=>t.registerMLContext(r,i),!!i.trace])}}}),Zn=L1(()=>{Ve(),La(),Ga(),ee(),$t(),Br(),to1(),_g=(t,r)=>{0!==_e()._OrtInit(t,r)&&ye("Can't initialize onnxruntime.")},Ir=async t=>{_g(t.wasm.numThreads,rr(t.logLevel))},Ar=async(t,r)=>{_e().asyncInit?.();let i=t.webgpu.adapter;if("webgpu"===r){if(typeof navigator>"u"||!navigator.gpu)throw Error("WebGPU is not supported in current environment");if(i){if("object"!=typeof i.limits||"object"!=typeof i.features||"function"!=typeof i.requestDevice)throw Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let r=t.webgpu.powerPreference;if(void 0!==r&&"low-power"!==r&&"high-performance"!==r)throw Error(`Invalid powerPreference setting: "${r}"`);let n=t.webgpu.forceFallbackAdapter;if(void 0!==n&&"boolean"!=typeof n)throw Error(`Invalid forceFallbackAdapter setting: "${n}"`);if(!(i=await navigator.gpu.requestAdapter({powerPreference:r,forceFallbackAdapter:n})))throw Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if("webnn"===r&&(typeof navigator>"u"||!navigator.ml))throw Error("WebNN is not supported in current environment");{let n=(ac(),Xt(ic)).init;"webgpu"===r&&await n("webgpu",_e(),t,i),"webnn"===r&&await n("webnn",_e(),t)}},Rt=new Map,wg=t=>{let r=_e(),i=r.stackSave();try{let i=r.PTR_SIZE,n=r.stackAlloc(2*i);0!==r._OrtGetInputOutputCount(t,n,n+i)&&ye("Can't get session input/output count.");let a=4===i?"i32":"i64";return[Number(r.getValue(n,a)),Number(r.getValue(n+i,a))]}finally{r.stackRestore(i)}},sc=(t,r)=>{let i=_e(),n=i.stackSave(),a=0;try{let n=i.PTR_SIZE,s=i.stackAlloc(2*n);0!==i._OrtGetInputOutputMetadata(t,r,s,s+n)&&ye("Can't get session input/output metadata.");let o=Number(i.getValue(s,"*"));a=Number(i.getValue(s+n,"*"));let l=i.HEAP32[a/4];if(0===l)return[o,0];let u=i.HEAPU32[a/4+1],h=[];for(let t=0;t<u;t++){let r=Number(i.getValue(a+8+t*n,"*"));h.push(0!==r?i.UTF8ToString(r):Number(i.getValue(a+8+(t+u)*n,"*")))}return[o,l,h]}finally{i.stackRestore(n),0!==a&&i._OrtFree(a)}},er=t=>{let r=_e(),i=r._malloc(t.byteLength);if(0===i)throw Error(`Can't create a session. failed to allocate a buffer of size ${t.byteLength}.`);return r.HEAPU8.set(t,i),[i,t.byteLength]},Er=async(t,r)=>{let i,n,a=_e();Array.isArray(t)?[i,n]=t:t.buffer===a.HEAPU8.buffer?[i,n]=[t.byteOffset,t.byteLength]:[i,n]=er(t);let s=0,o=0,l=0,u=[],h=[],f=[];try{if([o,u]=await Wa(r),r?.externalData&&a.mountExternalData){let t=[];for(let i of r.externalData){let r="string"==typeof i?i:i.path;t.push(nr("string"==typeof i?i:i.data).then(t=>{a.mountExternalData(r,t)}))}await Promise.all(t)}for(let t of r?.executionProviders??[])if(("string"==typeof t?t:t.name)==="webnn"){if(a.shouldTransferToMLTensor=!1,"string"!=typeof t){let r=t,i=r?.context,n=r?.gpuDevice,s=r?.deviceType,o=r?.powerPreference;i?a.currentContext=i:n?a.currentContext=await a.webnnCreateMLContext(n):a.currentContext=await a.webnnCreateMLContext({deviceType:s,powerPreference:o})}else a.currentContext=await a.webnnCreateMLContext();break}s=await a._OrtCreateSession(i,n,o),a.webgpuOnCreateSession?.(s),0===s&&ye("Can't create a session."),a.jsepOnCreateSession?.(),a.currentContext&&(a.webnnRegisterMLContext(s,a.currentContext),a.currentContext=void 0,a.shouldTransferToMLTensor=!0);let[t,d]=wg(s),c=!!r?.enableGraphCapture,p=[],m=[],g=[],_=[],b=[];for(let r=0;r<t;r++){let[t,i,n]=sc(s,r);0===t&&ye("Can't get an input name."),h.push(t);let o=a.UTF8ToString(t);p.push(o),g.push(0===i?{name:o,isTensor:!1}:{name:o,isTensor:!0,type:Je(i),shape:n})}for(let i=0;i<d;i++){let[n,o,l]=sc(s,i+t);0===n&&ye("Can't get an output name."),f.push(n);let u=a.UTF8ToString(n);m.push(u),_.push(0===o?{name:u,isTensor:!1}:{name:u,isTensor:!0,type:Je(o),shape:l});{if(c&&r?.preferredOutputLocation===void 0){b.push("gpu-buffer");continue}let t="string"==typeof r?.preferredOutputLocation?r.preferredOutputLocation:r?.preferredOutputLocation?.[u]??"cpu",i=a.webnnIsGraphOutput;if("cpu"===t&&i&&i(s,u)){b.push("ml-tensor-cpu-output");continue}if("cpu"!==t&&"cpu-pinned"!==t&&"gpu-buffer"!==t&&"ml-tensor"!==t)throw Error(`Not supported preferred output location: ${t}.`);if(c&&"gpu-buffer"!==t)throw Error(`Not supported preferred output location: ${t}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);b.push(t)}}let y=null;return b.some(t=>"gpu-buffer"===t||"ml-tensor"===t||"ml-tensor-cpu-output"===t)&&(l=a._OrtCreateBinding(s),0===l&&ye("Can't create IO binding."),y={handle:l,outputPreferredLocations:b,outputPreferredLocationsEncoded:b.map(t=>"ml-tensor-cpu-output"===t?"ml-tensor":t).map(t=>eo(t))}),Rt.set(s,[s,h,f,y,c,!1]),[s,p,m,g,_]}catch(t){throw h.forEach(t=>a._OrtFree(t)),f.forEach(t=>a._OrtFree(t)),0!==l&&0!==a._OrtReleaseBinding(l)&&ye("Can't release IO binding."),0!==s&&0!==a._OrtReleaseSession(s)&&ye("Can't release session."),t}finally{a._free(i),0!==o&&0!==a._OrtReleaseSessionOptions(o)&&ye("Can't release session options."),u.forEach(t=>a._free(t)),a.unmountExternalData?.()}},kr=t=>{let r=_e(),i=Rt.get(t);if(!i)throw Error(`cannot release session. invalid session id: ${t}`);let[n,a,s,o,l]=i;o&&(l&&0!==r._OrtClearBoundOutputs(o.handle)&&ye("Can't clear bound outputs."),0!==r._OrtReleaseBinding(o.handle)&&ye("Can't release IO binding.")),r.jsepOnReleaseSession?.(t),r.webnnOnReleaseSession?.(t),r.webgpuOnReleaseSession?.(t),a.forEach(t=>r._OrtFree(t)),s.forEach(t=>r._OrtFree(t)),0!==r._OrtReleaseSession(n)&&ye("Can't release session."),Rt.delete(t)},uc=async(t,r,i,n,a,s,o=!1)=>{if(!t)return void r.push(0);let l=_e(),u=l.PTR_SIZE,h=t[0],f=t[1],d=t[3],c=d,p,m;if("string"===h&&("gpu-buffer"===d||"ml-tensor"===d))throw Error("String tensor is not supported on GPU.");if(o&&"gpu-buffer"!==d)throw Error(`External buffer must be provided for input/output index ${s} when enableGraphCapture is true.`);if("gpu-buffer"===d){let r=t[2].gpuBuffer;m=St(xt(h),f);{let t=l.jsepRegisterBuffer;if(!t)throw Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');p=t(n,s,r,m)}}else if("ml-tensor"===d){let r=t[2].mlTensor;m=St(xt(h),f);let i=l.webnnRegisterMLTensor;if(!i)throw Error('Tensor location "ml-tensor" is not supported without using WebNN.');p=i(n,r,xt(h),f)}else{let r=t[2];if(Array.isArray(r)){m=u*r.length,p=l._malloc(m),i.push(p);for(let t=0;t<r.length;t++){if("string"!=typeof r[t])throw TypeError(`tensor data at index ${t} is not a string`);l.setValue(p+t*u,We(r[t],i),"*")}}else{let t=l.webnnIsGraphInput,s=l.webnnIsGraphOutput;if("string"!==h&&t&&s){let o=l.UTF8ToString(a);if(t(n,o)||s(n,o)){let t=xt(h);m=St(t,f),c="ml-tensor";let i=l.webnnCreateTemporaryTensor,a=l.webnnUploadTensor;if(!i||!a)throw Error('Tensor location "ml-tensor" is not supported without using WebNN.');let s=await i(n,t,f);a(s,new Uint8Array(r.buffer,r.byteOffset,r.byteLength)),p=s}else m=r.byteLength,p=l._malloc(m),i.push(p),l.HEAPU8.set(new Uint8Array(r.buffer,r.byteOffset,m),p)}else m=r.byteLength,p=l._malloc(m),i.push(p),l.HEAPU8.set(new Uint8Array(r.buffer,r.byteOffset,m),p)}}let g=l.stackSave(),_=l.stackAlloc(4*f.length);try{f.forEach((t,r)=>l.setValue(_+r*u,t,4===u?"i32":"i64"));let t=l._OrtCreateTensor(xt(h),p,m,_,f.length,eo(c));0===t&&ye(`Can't create tensor for input/output. session=${n}, index=${s}.`),r.push(t)}finally{l.stackRestore(g)}},Pr=async(t,r,i,n,a,s)=>{let o=_e(),l=o.PTR_SIZE,u=Rt.get(t);if(!u)throw Error(`cannot run inference. invalid session id: ${t}`);let h=u[0],f=u[1],d=u[2],c=u[3],p=u[4],m=u[5],g=r.length,_=n.length,b=0,y=[],v=[],w=[],x=[],k=o.stackSave(),E=o.stackAlloc(g*l),S=o.stackAlloc(g*l),$=o.stackAlloc(_*l),I=o.stackAlloc(_*l);try{let u;[b,y]=Va(s),wt("wasm prepareInputOutputTensor");for(let n=0;n<g;n++)await uc(i[n],v,x,t,f[r[n]],r[n],p);for(let r=0;r<_;r++)await uc(a[r],w,x,t,d[n[r]],g+n[r],p);vt("wasm prepareInputOutputTensor");for(let t=0;t<g;t++)o.setValue(E+t*l,v[t],"*"),o.setValue(S+t*l,f[r[t]],"*");for(let t=0;t<_;t++)o.setValue($+t*l,w[t],"*"),o.setValue(I+t*l,d[n[t]],"*");if(c&&!m){let{handle:i,outputPreferredLocations:s,outputPreferredLocationsEncoded:l}=c;if(f.length!==g)throw Error(`input count from feeds (${g}) is expected to be always equal to model's input count (${f.length}).`);wt("wasm bindInputsOutputs");for(let n=0;n<g;n++){let a=r[n];await o._OrtBindInput(i,f[a],v[n])!==0&&ye(`Can't bind input[${n}] for session=${t}.`)}for(let r=0;r<_;r++){let u=n[r];a[r]?.[3]?0!==o._OrtBindOutput(i,d[u],w[r],0)&&ye(`Can't bind pre-allocated output[${r}] for session=${t}.`):0!==o._OrtBindOutput(i,d[u],0,l[u])&&ye(`Can't bind output[${r}] to ${s[r]} for session=${t}.`)}vt("wasm bindInputsOutputs"),Rt.set(t,[h,f,d,c,p,!0])}o.jsepOnRunStart?.(h),o.webnnOnRunStart?.(h),u=c?await o._OrtRunWithBinding(h,c.handle,_,$,b):await o._OrtRun(h,S,E,g,I,_,$,b),0!==u&&ye("failed to call OrtRun().");let k=[],A=[];wt("wasm ProcessOutputTensor");for(let r=0;r<_;r++){let i=Number(o.getValue($+r*l,"*"));if(i===w[r]){k.push(a[r]);continue}let s=o.stackSave(),u=o.stackAlloc(4*l),h=!1,f,d=0;try{0!==o._OrtGetTensorData(i,u,u+l,u+2*l,u+3*l)&&ye(`Can't access output tensor data on index ${r}.`);let a=4===l?"i32":"i64",s=Number(o.getValue(u,a));d=o.getValue(u+l,"*");let p=o.getValue(u+2*l,"*"),m=Number(o.getValue(u+3*l,a)),g=[];for(let t=0;t<m;t++)g.push(Number(o.getValue(p+t*l,a)));0!==o._OrtFree(p)&&ye("Can't free memory for tensor dims.");let _=g.reduce((t,r)=>t*r,1);f=Je(s);let b=c?.outputPreferredLocations[n[r]];if("string"===f){if("gpu-buffer"===b||"ml-tensor"===b)throw Error("String tensor is not supported on GPU.");let t=[];for(let r=0;r<_;r++){let i=o.getValue(d+r*l,"*"),n=o.getValue(d+(r+1)*l,"*"),a=r===_-1?void 0:n-i;t.push(o.UTF8ToString(i,a))}k.push([f,g,t,"cpu"])}else if("gpu-buffer"===b&&_>0){let t=o.jsepGetBuffer;if(!t)throw Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let r=t(d),n=St(s,_);if(void 0===n||!Rr(f))throw Error(`Unsupported data type: ${f}`);h=!0,k.push([f,g,{gpuBuffer:r,download:o.jsepCreateDownloader(r,n,f),dispose:()=>{0!==o._OrtReleaseTensor(i)&&ye("Can't release tensor.")}},"gpu-buffer"])}else if("ml-tensor"===b&&_>0){let r=o.webnnEnsureTensor,n=o.webnnIsGraphInputOutputTypeSupported;if(!r||!n)throw Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(void 0===St(s,_)||!Ur(f))throw Error(`Unsupported data type: ${f}`);if(!n(t,f,!1))throw Error(`preferredLocation "ml-tensor" for ${f} output is not supported by current WebNN Context.`);let a=await r(t,d,s,g,!1);h=!0,k.push([f,g,{mlTensor:a,download:o.webnnCreateMLTensorDownloader(d,f),dispose:()=>{o.webnnReleaseTensorId(d),o._OrtReleaseTensor(i)}},"ml-tensor"])}else if("ml-tensor-cpu-output"===b&&_>0){let t=o.webnnCreateMLTensorDownloader(d,f)(),r=k.length;h=!0,A.push((async()=>{let n=[r,await t];return o.webnnReleaseTensorId(d),o._OrtReleaseTensor(i),n})()),k.push([f,g,[],"cpu"])}else{let t=new(Gt(f))(_);new Uint8Array(t.buffer,t.byteOffset,t.byteLength).set(o.HEAPU8.subarray(d,d+t.byteLength)),k.push([f,g,t,"cpu"])}}finally{o.stackRestore(s),"string"===f&&d&&o._free(d),h||o._OrtReleaseTensor(i)}}for(let[r,i]of(c&&!p&&(0!==o._OrtClearBoundOutputs(c.handle)&&ye("Can't clear bound outputs."),Rt.set(t,[h,f,d,c,p,!1])),await Promise.all(A)))k[r][2]=i;return vt("wasm ProcessOutputTensor"),k}finally{o.webnnOnRunEnd?.(h),o.stackRestore(k),v.forEach(t=>o._OrtReleaseTensor(t)),w.forEach(t=>o._OrtReleaseTensor(t)),x.forEach(t=>o._free(t)),0!==b&&o._OrtReleaseRunOptions(b),y.forEach(t=>o._free(t))}},Or=t=>{let r=_e(),i=Rt.get(t);if(!i)throw Error("invalid session id");let n=i[0],a=r._OrtEndProfiling(n);0===a&&ye("Can't get an profile file name."),r._OrtFree(a)},zr=t=>{let r=[];for(let i of t){let t=i[2];!Array.isArray(t)&&"buffer"in t&&r.push(t.buffer)}return r}}),Uo=L1(()=>{Ve(),Zn(),$t(),Tr(),Ut=()=>!!we.wasm.proxy&&"u">typeof document,lr=!1,mn=!1,fn=!1,Ro=new Map,jt=(t,r)=>{let i=Ro.get(t);i?i.push(r):Ro.set(t,[r])},Kt=()=>{if(lr||!mn||fn||!He)throw Error("worker not ready")},$g=t=>{switch(t.data.type){case"init-wasm":lr=!1,t.data.err?(fn=!0,Mo[1](t.data.err)):(mn=!0,Mo[0]()),pn&&(URL.revokeObjectURL(pn),pn=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let r=Ro.get(t.data.type);t.data.err?r.shift()[1](t.data.err):r.shift()[0](t.data.out)}}},lc=async()=>{if(!mn){if(lr)throw Error("multiple calls to 'initWasm()' detected.");if(fn)throw Error("previous call to 'initWasm()' failed.");if(lr=!0,Ut())return new Promise((t,r)=>{He?.terminate(),Ra().then(([i,n])=>{try{(He=n).onerror=t=>r(t),He.onmessage=$g,Mo=[t,r];let a={type:"init-wasm",in:we};!a.in.wasm.wasmPaths&&(i||Yn)&&(a.in.wasm.wasmPaths={wasm:new __turbopack_context__.U(__turbopack_context__.r(3789)).href}),He.postMessage(a),pn=i}catch(t){r(t)}},r)});try{await Cr(we.wasm),await Ir(we),mn=!0}catch(t){throw fn=!0,t}finally{lr=!1}}},dc=async t=>{if(Ut())return Kt(),new Promise((r,i)=>{jt("init-ep",[r,i]);let n={type:"init-ep",in:{epName:t,env:we}};He.postMessage(n)});await Ar(we,t)},cc=async t=>Ut()?(Kt(),new Promise((r,i)=>{jt("copy-from",[r,i]);let n={type:"copy-from",in:{buffer:t}};He.postMessage(n,[t.buffer])})):er(t),pc=async(t,r)=>{if(!Ut())return Er(t,r);if(r?.preferredOutputLocation)throw Error('session option "preferredOutputLocation" is not supported for proxy.');return Kt(),new Promise((i,n)=>{jt("create",[i,n]);let a={type:"create",in:{model:t,options:{...r}}},s=[];t instanceof Uint8Array&&s.push(t.buffer),He.postMessage(a,s)})},mc=async t=>{if(Ut())return Kt(),new Promise((r,i)=>{jt("release",[r,i]);let n={type:"release",in:t};He.postMessage(n)});kr(t)},fc=async(t,r,i,n,a,s)=>{if(!Ut())return Pr(t,r,i,n,a,s);if(i.some(t=>"cpu"!==t[3]))throw Error("input tensor on GPU is not supported for proxy.");if(a.some(t=>t))throw Error("pre-allocated output tensor is not supported for proxy.");return Kt(),new Promise((a,o)=>{jt("run",[a,o]);let l=i,u={type:"run",in:{sessionId:t,inputIndices:r,inputs:l,outputIndices:n,options:s}};He.postMessage(u,zr(l))})},hc=async t=>{if(Ut())return Kt(),new Promise((r,i)=>{jt("end-profiling",[r,i]);let n={type:"end-profiling",in:t};He.postMessage(n)});Or(t)}}),yc=L1(()=>{Ve(),Uo(),ee(),Sr(),to1(),gc=(t,r)=>{switch(t.location){case"cpu":return[t.type,t.dims,t.data,"cpu"];case"gpu-buffer":return[t.type,t.dims,{gpuBuffer:t.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[t.type,t.dims,{mlTensor:t.mlTensor},"ml-tensor"];default:throw Error(`invalid data location: ${t.location} for ${r()}`)}},xg=t=>{switch(t[3]){case"cpu":return new qe(t[0],t[2],t[1]);case"gpu-buffer":{let r=t[0];if(!Rr(r))throw Error(`not supported data type: ${r} for deserializing GPU tensor`);let{gpuBuffer:i,download:n,dispose:a}=t[2];return qe.fromGpuBuffer(i,{dataType:r,dims:t[1],download:n,dispose:a})}case"ml-tensor":{let r=t[0];if(!Ur(r))throw Error(`not supported data type: ${r} for deserializing MLTensor tensor`);let{mlTensor:i,download:n,dispose:a}=t[2];return qe.fromMLTensor(i,{dataType:r,dims:t[1],download:n,dispose:a})}default:throw Error(`invalid data location: ${t[3]}`)}},hn=class{async fetchModelAndCopyToWasmMemory(t){return cc(await nr(t))}async loadModel(t,r){let i;Ne(),i="string"==typeof t?await this.fetchModelAndCopyToWasmMemory(t):t,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await pc(i,r),Me()}async dispose(){return mc(this.sessionId)}async run(t,r,i){Ne();let n=[],a=[];Object.entries(t).forEach(t=>{let r=t[0],i=t[1],s=this.inputNames.indexOf(r);if(-1===s)throw Error(`invalid input '${r}'`);n.push(i),a.push(s)});let s=[],o=[];Object.entries(r).forEach(t=>{let r=t[0],i=t[1],n=this.outputNames.indexOf(r);if(-1===n)throw Error(`invalid output '${r}'`);s.push(i),o.push(n)});let l=n.map((t,r)=>gc(t,()=>`input "${this.inputNames[a[r]]}"`)),u=s.map((t,r)=>t?gc(t,()=>`output "${this.outputNames[o[r]]}"`):null),h=await fc(this.sessionId,a,l,o,u,i),f={};for(let t=0;t<h.length;t++)f[this.outputNames[o[t]]]=s[t]??xg(h[t]);return Me(),f}startProfiling(){}endProfiling(){hc(this.sessionId)}}}),_c={};Wt(_c,{OnnxruntimeWebAssemblyBackend:()=>gn,initializeFlags:()=>bc,wasmBackend:()=>Sg});var bc,gn,Sg,wc=L1(()=>{Ve(),Uo(),yc(),bc=()=>{("number"!=typeof we.wasm.initTimeout||we.wasm.initTimeout<0)&&(we.wasm.initTimeout=0);let t=we.wasm.simd;if("boolean"!=typeof t&&void 0!==t&&"fixed"!==t&&"relaxed"!==t&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${t}". Reset it to \`false\` and ignore SIMD feature checking.`),we.wasm.simd=!1),"boolean"!=typeof we.wasm.proxy&&(we.wasm.proxy=!1),"boolean"!=typeof we.wasm.trace&&(we.wasm.trace=!1),"number"!=typeof we.wasm.numThreads||!Number.isInteger(we.wasm.numThreads)||we.wasm.numThreads<=0)if("u">typeof self&&!self.crossOriginIsolated)we.wasm.numThreads=1;else{let t=typeof navigator>"u"?Wn("node:os").cpus().length:navigator.hardwareConcurrency;we.wasm.numThreads=Math.min(4,Math.ceil((t||1)/2))}},Sg=new(gn=class{async init(t){bc(),await lc(),await dc(t)}async createInferenceSessionHandler(t,r){let i=new hn;return await i.loadModel(t,r),i}})});Ve(),Ve(),Ve();var Sa="1.23.2",BS=Kn;{let e1=(wc(),Xt(_c)).wasmBackend;Pt("webgpu",e1,5),Pt("webnn",e1,5),Pt("cpu",e1,10),Pt("wasm",e1,10)}async function getImageTensorFromPath(t,r=[1,3,224,224]){return imageDataToTensor(await loadImagefromPath(t,r[2],r[3]),r)}async function loadImagefromPath(t,r=224,i=224){return await Jimp.read(t).then(t=>t.resize({w:r,h:i}))}function imageDataToTensor(t,r){var i=t.bitmap.data;let[n,a,s]=[[],[],[]];for(let t=0;t<i.length;t+=4)n.push(i[t]),a.push(i[t+1]),s.push(i[t+2]);let o=n.concat(a).concat(s),l,u=o.length,h=new Float32Array(r[1]*r[2]*r[3]);for(l=0;l<u;l++)h[l]=o[l]/255;return new qe("float32",h,r)}Object.defineProperty(we.versions,"web",{value:Sa,enumerable:!0});var __TURBOPACK__imported__module__42778__=__turbopack_context__.i(42778);let imagenetClasses={0:["n01440764","tench"],1:["n01443537","goldfish"],2:["n01484850","great_white_shark"],3:["n01491361","tiger_shark"],4:["n01494475","hammerhead"],5:["n01496331","electric_ray"],6:["n01498041","stingray"],7:["n01514668","cock"],8:["n01514859","hen"],9:["n01518878","ostrich"],10:["n01530575","brambling"],11:["n01531178","goldfinch"],12:["n01532829","house_finch"],13:["n01534433","junco"],14:["n01537544","indigo_bunting"],15:["n01558993","robin"],16:["n01560419","bulbul"],17:["n01580077","jay"],18:["n01582220","magpie"],19:["n01592084","chickadee"],20:["n01601694","water_ouzel"],21:["n01608432","kite"],22:["n01614925","bald_eagle"],23:["n01616318","vulture"],24:["n01622779","great_grey_owl"],25:["n01629819","European_fire_salamander"],26:["n01630670","common_newt"],27:["n01631663","eft"],28:["n01632458","spotted_salamander"],29:["n01632777","axolotl"],30:["n01641577","bullfrog"],31:["n01644373","tree_frog"],32:["n01644900","tailed_frog"],33:["n01664065","loggerhead"],34:["n01665541","leatherback_turtle"],35:["n01667114","mud_turtle"],36:["n01667778","terrapin"],37:["n01669191","box_turtle"],38:["n01675722","banded_gecko"],39:["n01677366","common_iguana"],40:["n01682714","American_chameleon"],41:["n01685808","whiptail"],42:["n01687978","agama"],43:["n01688243","frilled_lizard"],44:["n01689811","alligator_lizard"],45:["n01692333","Gila_monster"],46:["n01693334","green_lizard"],47:["n01694178","African_chameleon"],48:["n01695060","Komodo_dragon"],49:["n01697457","African_crocodile"],50:["n01698640","American_alligator"],51:["n01704323","triceratops"],52:["n01728572","thunder_snake"],53:["n01728920","ringneck_snake"],54:["n01729322","hognose_snake"],55:["n01729977","green_snake"],56:["n01734418","king_snake"],57:["n01735189","garter_snake"],58:["n01737021","water_snake"],59:["n01739381","vine_snake"],60:["n01740131","night_snake"],61:["n01742172","boa_constrictor"],62:["n01744401","rock_python"],63:["n01748264","Indian_cobra"],64:["n01749939","green_mamba"],65:["n01751748","sea_snake"],66:["n01753488","horned_viper"],67:["n01755581","diamondback"],68:["n01756291","sidewinder"],69:["n01768244","trilobite"],70:["n01770081","harvestman"],71:["n01770393","scorpion"],72:["n01773157","black_and_gold_garden_spider"],73:["n01773549","barn_spider"],74:["n01773797","garden_spider"],75:["n01774384","black_widow"],76:["n01774750","tarantula"],77:["n01775062","wolf_spider"],78:["n01776313","tick"],79:["n01784675","centipede"],80:["n01795545","black_grouse"],81:["n01796340","ptarmigan"],82:["n01797886","ruffed_grouse"],83:["n01798484","prairie_chicken"],84:["n01806143","peacock"],85:["n01806567","quail"],86:["n01807496","partridge"],87:["n01817953","African_grey"],88:["n01818515","macaw"],89:["n01819313","sulphur-crested_cockatoo"],90:["n01820546","lorikeet"],91:["n01824575","coucal"],92:["n01828970","bee_eater"],93:["n01829413","hornbill"],94:["n01833805","hummingbird"],95:["n01843065","jacamar"],96:["n01843383","toucan"],97:["n01847000","drake"],98:["n01855032","red-breasted_merganser"],99:["n01855672","goose"],100:["n01860187","black_swan"],101:["n01871265","tusker"],102:["n01872401","echidna"],103:["n01873310","platypus"],104:["n01877812","wallaby"],105:["n01882714","koala"],106:["n01883070","wombat"],107:["n01910747","jellyfish"],108:["n01914609","sea_anemone"],109:["n01917289","brain_coral"],110:["n01924916","flatworm"],111:["n01930112","nematode"],112:["n01943899","conch"],113:["n01944390","snail"],114:["n01945685","slug"],115:["n01950731","sea_slug"],116:["n01955084","chiton"],117:["n01968897","chambered_nautilus"],118:["n01978287","Dungeness_crab"],119:["n01978455","rock_crab"],120:["n01980166","fiddler_crab"],121:["n01981276","king_crab"],122:["n01983481","American_lobster"],123:["n01984695","spiny_lobster"],124:["n01985128","crayfish"],125:["n01986214","hermit_crab"],126:["n01990800","isopod"],127:["n02002556","white_stork"],128:["n02002724","black_stork"],129:["n02006656","spoonbill"],130:["n02007558","flamingo"],131:["n02009229","little_blue_heron"],132:["n02009912","American_egret"],133:["n02011460","bittern"],134:["n02012849","crane"],135:["n02013706","limpkin"],136:["n02017213","European_gallinule"],137:["n02018207","American_coot"],138:["n02018795","bustard"],139:["n02025239","ruddy_turnstone"],140:["n02027492","red-backed_sandpiper"],141:["n02028035","redshank"],142:["n02033041","dowitcher"],143:["n02037110","oystercatcher"],144:["n02051845","pelican"],145:["n02056570","king_penguin"],146:["n02058221","albatross"],147:["n02066245","grey_whale"],148:["n02071294","killer_whale"],149:["n02074367","dugong"],150:["n02077923","sea_lion"],151:["n02085620","Chihuahua"],152:["n02085782","Japanese_spaniel"],153:["n02085936","Maltese_dog"],154:["n02086079","Pekinese"],155:["n02086240","Shih-Tzu"],156:["n02086646","Blenheim_spaniel"],157:["n02086910","papillon"],158:["n02087046","toy_terrier"],159:["n02087394","Rhodesian_ridgeback"],160:["n02088094","Afghan_hound"],161:["n02088238","basset"],162:["n02088364","beagle"],163:["n02088466","bloodhound"],164:["n02088632","bluetick"],165:["n02089078","black-and-tan_coonhound"],166:["n02089867","Walker_hound"],167:["n02089973","English_foxhound"],168:["n02090379","redbone"],169:["n02090622","borzoi"],170:["n02090721","Irish_wolfhound"],171:["n02091032","Italian_greyhound"],172:["n02091134","whippet"],173:["n02091244","Ibizan_hound"],174:["n02091467","Norwegian_elkhound"],175:["n02091635","otterhound"],176:["n02091831","Saluki"],177:["n02092002","Scottish_deerhound"],178:["n02092339","Weimaraner"],179:["n02093256","Staffordshire_bullterrier"],180:["n02093428","American_Staffordshire_terrier"],181:["n02093647","Bedlington_terrier"],182:["n02093754","Border_terrier"],183:["n02093859","Kerry_blue_terrier"],184:["n02093991","Irish_terrier"],185:["n02094114","Norfolk_terrier"],186:["n02094258","Norwich_terrier"],187:["n02094433","Yorkshire_terrier"],188:["n02095314","wire-haired_fox_terrier"],189:["n02095570","Lakeland_terrier"],190:["n02095889","Sealyham_terrier"],191:["n02096051","Airedale"],192:["n02096177","cairn"],193:["n02096294","Australian_terrier"],194:["n02096437","Dandie_Dinmont"],195:["n02096585","Boston_bull"],196:["n02097047","miniature_schnauzer"],197:["n02097130","giant_schnauzer"],198:["n02097209","standard_schnauzer"],199:["n02097298","Scotch_terrier"],200:["n02097474","Tibetan_terrier"],201:["n02097658","silky_terrier"],202:["n02098105","soft-coated_wheaten_terrier"],203:["n02098286","West_Highland_white_terrier"],204:["n02098413","Lhasa"],205:["n02099267","flat-coated_retriever"],206:["n02099429","curly-coated_retriever"],207:["n02099601","golden_retriever"],208:["n02099712","Labrador_retriever"],209:["n02099849","Chesapeake_Bay_retriever"],210:["n02100236","German_short-haired_pointer"],211:["n02100583","vizsla"],212:["n02100735","English_setter"],213:["n02100877","Irish_setter"],214:["n02101006","Gordon_setter"],215:["n02101388","Brittany_spaniel"],216:["n02101556","clumber"],217:["n02102040","English_springer"],218:["n02102177","Welsh_springer_spaniel"],219:["n02102318","cocker_spaniel"],220:["n02102480","Sussex_spaniel"],221:["n02102973","Irish_water_spaniel"],222:["n02104029","kuvasz"],223:["n02104365","schipperke"],224:["n02105056","groenendael"],225:["n02105162","malinois"],226:["n02105251","briard"],227:["n02105412","kelpie"],228:["n02105505","komondor"],229:["n02105641","Old_English_sheepdog"],230:["n02105855","Shetland_sheepdog"],231:["n02106030","collie"],232:["n02106166","Border_collie"],233:["n02106382","Bouvier_des_Flandres"],234:["n02106550","Rottweiler"],235:["n02106662","German_shepherd"],236:["n02107142","Doberman"],237:["n02107312","miniature_pinscher"],238:["n02107574","Greater_Swiss_Mountain_dog"],239:["n02107683","Bernese_mountain_dog"],240:["n02107908","Appenzeller"],241:["n02108000","EntleBucher"],242:["n02108089","boxer"],243:["n02108422","bull_mastiff"],244:["n02108551","Tibetan_mastiff"],245:["n02108915","French_bulldog"],246:["n02109047","Great_Dane"],247:["n02109525","Saint_Bernard"],248:["n02109961","Eskimo_dog"],249:["n02110063","malamute"],250:["n02110185","Siberian_husky"],251:["n02110341","dalmatian"],252:["n02110627","affenpinscher"],253:["n02110806","basenji"],254:["n02110958","pug"],255:["n02111129","Leonberg"],256:["n02111277","Newfoundland"],257:["n02111500","Great_Pyrenees"],258:["n02111889","Samoyed"],259:["n02112018","Pomeranian"],260:["n02112137","chow"],261:["n02112350","keeshond"],262:["n02112706","Brabancon_griffon"],263:["n02113023","Pembroke"],264:["n02113186","Cardigan"],265:["n02113624","toy_poodle"],266:["n02113712","miniature_poodle"],267:["n02113799","standard_poodle"],268:["n02113978","Mexican_hairless"],269:["n02114367","timber_wolf"],270:["n02114548","white_wolf"],271:["n02114712","red_wolf"],272:["n02114855","coyote"],273:["n02115641","dingo"],274:["n02115913","dhole"],275:["n02116738","African_hunting_dog"],276:["n02117135","hyena"],277:["n02119022","red_fox"],278:["n02119789","kit_fox"],279:["n02120079","Arctic_fox"],280:["n02120505","grey_fox"],281:["n02123045","tabby"],282:["n02123159","tiger_cat"],283:["n02123394","Persian_cat"],284:["n02123597","Siamese_cat"],285:["n02124075","Egyptian_cat"],286:["n02125311","cougar"],287:["n02127052","lynx"],288:["n02128385","leopard"],289:["n02128757","snow_leopard"],290:["n02128925","jaguar"],291:["n02129165","lion"],292:["n02129604","tiger"],293:["n02130308","cheetah"],294:["n02132136","brown_bear"],295:["n02133161","American_black_bear"],296:["n02134084","ice_bear"],297:["n02134418","sloth_bear"],298:["n02137549","mongoose"],299:["n02138441","meerkat"],300:["n02165105","tiger_beetle"],301:["n02165456","ladybug"],302:["n02167151","ground_beetle"],303:["n02168699","long-horned_beetle"],304:["n02169497","leaf_beetle"],305:["n02172182","dung_beetle"],306:["n02174001","rhinoceros_beetle"],307:["n02177972","weevil"],308:["n02190166","fly"],309:["n02206856","bee"],310:["n02219486","ant"],311:["n02226429","grasshopper"],312:["n02229544","cricket"],313:["n02231487","walking_stick"],314:["n02233338","cockroach"],315:["n02236044","mantis"],316:["n02256656","cicada"],317:["n02259212","leafhopper"],318:["n02264363","lacewing"],319:["n02268443","dragonfly"],320:["n02268853","damselfly"],321:["n02276258","admiral"],322:["n02277742","ringlet"],323:["n02279972","monarch"],324:["n02280649","cabbage_butterfly"],325:["n02281406","sulphur_butterfly"],326:["n02281787","lycaenid"],327:["n02317335","starfish"],328:["n02319095","sea_urchin"],329:["n02321529","sea_cucumber"],330:["n02325366","wood_rabbit"],331:["n02326432","hare"],332:["n02328150","Angora"],333:["n02342885","hamster"],334:["n02346627","porcupine"],335:["n02356798","fox_squirrel"],336:["n02361337","marmot"],337:["n02363005","beaver"],338:["n02364673","guinea_pig"],339:["n02389026","sorrel"],340:["n02391049","zebra"],341:["n02395406","hog"],342:["n02396427","wild_boar"],343:["n02397096","warthog"],344:["n02398521","hippopotamus"],345:["n02403003","ox"],346:["n02408429","water_buffalo"],347:["n02410509","bison"],348:["n02412080","ram"],349:["n02415577","bighorn"],350:["n02417914","ibex"],351:["n02422106","hartebeest"],352:["n02422699","impala"],353:["n02423022","gazelle"],354:["n02437312","Arabian_camel"],355:["n02437616","llama"],356:["n02441942","weasel"],357:["n02442845","mink"],358:["n02443114","polecat"],359:["n02443484","black-footed_ferret"],360:["n02444819","otter"],361:["n02445715","skunk"],362:["n02447366","badger"],363:["n02454379","armadillo"],364:["n02457408","three-toed_sloth"],365:["n02480495","orangutan"],366:["n02480855","gorilla"],367:["n02481823","chimpanzee"],368:["n02483362","gibbon"],369:["n02483708","siamang"],370:["n02484975","guenon"],371:["n02486261","patas"],372:["n02486410","baboon"],373:["n02487347","macaque"],374:["n02488291","langur"],375:["n02488702","colobus"],376:["n02489166","proboscis_monkey"],377:["n02490219","marmoset"],378:["n02492035","capuchin"],379:["n02492660","howler_monkey"],380:["n02493509","titi"],381:["n02493793","spider_monkey"],382:["n02494079","squirrel_monkey"],383:["n02497673","Madagascar_cat"],384:["n02500267","indri"],385:["n02504013","Indian_elephant"],386:["n02504458","African_elephant"],387:["n02509815","lesser_panda"],388:["n02510455","giant_panda"],389:["n02514041","barracouta"],390:["n02526121","eel"],391:["n02536864","coho"],392:["n02606052","rock_beauty"],393:["n02607072","anemone_fish"],394:["n02640242","sturgeon"],395:["n02641379","gar"],396:["n02643566","lionfish"],397:["n02655020","puffer"],398:["n02666196","abacus"],399:["n02667093","abaya"],400:["n02669723","academic_gown"],401:["n02672831","accordion"],402:["n02676566","acoustic_guitar"],403:["n02687172","aircraft_carrier"],404:["n02690373","airliner"],405:["n02692877","airship"],406:["n02699494","altar"],407:["n02701002","ambulance"],408:["n02704792","amphibian"],409:["n02708093","analog_clock"],410:["n02727426","apiary"],411:["n02730930","apron"],412:["n02747177","ashcan"],413:["n02749479","assault_rifle"],414:["n02769748","backpack"],415:["n02776631","bakery"],416:["n02777292","balance_beam"],417:["n02782093","balloon"],418:["n02783161","ballpoint"],419:["n02786058","Band_Aid"],420:["n02787622","banjo"],421:["n02788148","bannister"],422:["n02790996","barbell"],423:["n02791124","barber_chair"],424:["n02791270","barbershop"],425:["n02793495","barn"],426:["n02794156","barometer"],427:["n02795169","barrel"],428:["n02797295","barrow"],429:["n02799071","baseball"],430:["n02802426","basketball"],431:["n02804414","bassinet"],432:["n02804610","bassoon"],433:["n02807133","bathing_cap"],434:["n02808304","bath_towel"],435:["n02808440","bathtub"],436:["n02814533","beach_wagon"],437:["n02814860","beacon"],438:["n02815834","beaker"],439:["n02817516","bearskin"],440:["n02823428","beer_bottle"],441:["n02823750","beer_glass"],442:["n02825657","bell_cote"],443:["n02834397","bib"],444:["n02835271","bicycle-built-for-two"],445:["n02837789","bikini"],446:["n02840245","binder"],447:["n02841315","binoculars"],448:["n02843684","birdhouse"],449:["n02859443","boathouse"],450:["n02860847","bobsled"],451:["n02865351","bolo_tie"],452:["n02869837","bonnet"],453:["n02870880","bookcase"],454:["n02871525","bookshop"],455:["n02877765","bottlecap"],456:["n02879718","bow"],457:["n02883205","bow_tie"],458:["n02892201","brass"],459:["n02892767","brassiere"],460:["n02894605","breakwater"],461:["n02895154","breastplate"],462:["n02906734","broom"],463:["n02909870","bucket"],464:["n02910353","buckle"],465:["n02916936","bulletproof_vest"],466:["n02917067","bullet_train"],467:["n02927161","butcher_shop"],468:["n02930766","cab"],469:["n02939185","caldron"],470:["n02948072","candle"],471:["n02950826","cannon"],472:["n02951358","canoe"],473:["n02951585","can_opener"],474:["n02963159","cardigan"],475:["n02965783","car_mirror"],476:["n02966193","carousel"],477:["n02966687","carpenter's_kit"],478:["n02971356","carton"],479:["n02974003","car_wheel"],480:["n02977058","cash_machine"],481:["n02978881","cassette"],482:["n02979186","cassette_player"],483:["n02980441","castle"],484:["n02981792","catamaran"],485:["n02988304","CD_player"],486:["n02992211","cello"],487:["n02992529","cellular_telephone"],488:["n02999410","chain"],489:["n03000134","chainlink_fence"],490:["n03000247","chain_mail"],491:["n03000684","chain_saw"],492:["n03014705","chest"],493:["n03016953","chiffonier"],494:["n03017168","chime"],495:["n03018349","china_cabinet"],496:["n03026506","Christmas_stocking"],497:["n03028079","church"],498:["n03032252","cinema"],499:["n03041632","cleaver"],500:["n03042490","cliff_dwelling"],501:["n03045698","cloak"],502:["n03047690","clog"],503:["n03062245","cocktail_shaker"],504:["n03063599","coffee_mug"],505:["n03063689","coffeepot"],506:["n03065424","coil"],507:["n03075370","combination_lock"],508:["n03085013","computer_keyboard"],509:["n03089624","confectionery"],510:["n03095699","container_ship"],511:["n03100240","convertible"],512:["n03109150","corkscrew"],513:["n03110669","cornet"],514:["n03124043","cowboy_boot"],515:["n03124170","cowboy_hat"],516:["n03125729","cradle"],517:["n03126707","crane"],518:["n03127747","crash_helmet"],519:["n03127925","crate"],520:["n03131574","crib"],521:["n03133878","Crock_Pot"],522:["n03134739","croquet_ball"],523:["n03141823","crutch"],524:["n03146219","cuirass"],525:["n03160309","dam"],526:["n03179701","desk"],527:["n03180011","desktop_computer"],528:["n03187595","dial_telephone"],529:["n03188531","diaper"],530:["n03196217","digital_clock"],531:["n03197337","digital_watch"],532:["n03201208","dining_table"],533:["n03207743","dishrag"],534:["n03207941","dishwasher"],535:["n03208938","disk_brake"],536:["n03216828","dock"],537:["n03218198","dogsled"],538:["n03220513","dome"],539:["n03223299","doormat"],540:["n03240683","drilling_platform"],541:["n03249569","drum"],542:["n03250847","drumstick"],543:["n03255030","dumbbell"],544:["n03259280","Dutch_oven"],545:["n03271574","electric_fan"],546:["n03272010","electric_guitar"],547:["n03272562","electric_locomotive"],548:["n03290653","entertainment_center"],549:["n03291819","envelope"],550:["n03297495","espresso_maker"],551:["n03314780","face_powder"],552:["n03325584","feather_boa"],553:["n03337140","file"],554:["n03344393","fireboat"],555:["n03345487","fire_engine"],556:["n03347037","fire_screen"],557:["n03355925","flagpole"],558:["n03372029","flute"],559:["n03376595","folding_chair"],560:["n03379051","football_helmet"],561:["n03384352","forklift"],562:["n03388043","fountain"],563:["n03388183","fountain_pen"],564:["n03388549","four-poster"],565:["n03393912","freight_car"],566:["n03394916","French_horn"],567:["n03400231","frying_pan"],568:["n03404251","fur_coat"],569:["n03417042","garbage_truck"],570:["n03424325","gasmask"],571:["n03425413","gas_pump"],572:["n03443371","goblet"],573:["n03444034","go-kart"],574:["n03445777","golf_ball"],575:["n03445924","golfcart"],576:["n03447447","gondola"],577:["n03447721","gong"],578:["n03450230","gown"],579:["n03452741","grand_piano"],580:["n03457902","greenhouse"],581:["n03459775","grille"],582:["n03461385","grocery_store"],583:["n03467068","guillotine"],584:["n03476684","hair_slide"],585:["n03476991","hair_spray"],586:["n03478589","half_track"],587:["n03481172","hammer"],588:["n03482405","hamper"],589:["n03483316","hand_blower"],590:["n03485407","hand-held_computer"],591:["n03485794","handkerchief"],592:["n03492542","hard_disc"],593:["n03494278","harmonica"],594:["n03495258","harp"],595:["n03496892","harvester"],596:["n03498962","hatchet"],597:["n03527444","holster"],598:["n03529860","home_theater"],599:["n03530642","honeycomb"],600:["n03532672","hook"],601:["n03534580","hoopskirt"],602:["n03535780","horizontal_bar"],603:["n03538406","horse_cart"],604:["n03544143","hourglass"],605:["n03584254","iPod"],606:["n03584829","iron"],607:["n03590841","jack-o'-lantern"],608:["n03594734","jean"],609:["n03594945","jeep"],610:["n03595614","jersey"],611:["n03598930","jigsaw_puzzle"],612:["n03599486","jinrikisha"],613:["n03602883","joystick"],614:["n03617480","kimono"],615:["n03623198","knee_pad"],616:["n03627232","knot"],617:["n03630383","lab_coat"],618:["n03633091","ladle"],619:["n03637318","lampshade"],620:["n03642806","laptop"],621:["n03649909","lawn_mower"],622:["n03657121","lens_cap"],623:["n03658185","letter_opener"],624:["n03661043","library"],625:["n03662601","lifeboat"],626:["n03666591","lighter"],627:["n03670208","limousine"],628:["n03673027","liner"],629:["n03676483","lipstick"],630:["n03680355","Loafer"],631:["n03690938","lotion"],632:["n03691459","loudspeaker"],633:["n03692522","loupe"],634:["n03697007","lumbermill"],635:["n03706229","magnetic_compass"],636:["n03709823","mailbag"],637:["n03710193","mailbox"],638:["n03710637","maillot"],639:["n03710721","maillot"],640:["n03717622","manhole_cover"],641:["n03720891","maraca"],642:["n03721384","marimba"],643:["n03724870","mask"],644:["n03729826","matchstick"],645:["n03733131","maypole"],646:["n03733281","maze"],647:["n03733805","measuring_cup"],648:["n03742115","medicine_chest"],649:["n03743016","megalith"],650:["n03759954","microphone"],651:["n03761084","microwave"],652:["n03763968","military_uniform"],653:["n03764736","milk_can"],654:["n03769881","minibus"],655:["n03770439","miniskirt"],656:["n03770679","minivan"],657:["n03773504","missile"],658:["n03775071","mitten"],659:["n03775546","mixing_bowl"],660:["n03776460","mobile_home"],661:["n03777568","Model_T"],662:["n03777754","modem"],663:["n03781244","monastery"],664:["n03782006","monitor"],665:["n03785016","moped"],666:["n03786901","mortar"],667:["n03787032","mortarboard"],668:["n03788195","mosque"],669:["n03788365","mosquito_net"],670:["n03791053","motor_scooter"],671:["n03792782","mountain_bike"],672:["n03792972","mountain_tent"],673:["n03793489","mouse"],674:["n03794056","mousetrap"],675:["n03796401","moving_van"],676:["n03803284","muzzle"],677:["n03804744","nail"],678:["n03814639","neck_brace"],679:["n03814906","necklace"],680:["n03825788","nipple"],681:["n03832673","notebook"],682:["n03837869","obelisk"],683:["n03838899","oboe"],684:["n03840681","ocarina"],685:["n03841143","odometer"],686:["n03843555","oil_filter"],687:["n03854065","organ"],688:["n03857828","oscilloscope"],689:["n03866082","overskirt"],690:["n03868242","oxcart"],691:["n03868863","oxygen_mask"],692:["n03871628","packet"],693:["n03873416","paddle"],694:["n03874293","paddlewheel"],695:["n03874599","padlock"],696:["n03876231","paintbrush"],697:["n03877472","pajama"],698:["n03877845","palace"],699:["n03884397","panpipe"],700:["n03887697","paper_towel"],701:["n03888257","parachute"],702:["n03888605","parallel_bars"],703:["n03891251","park_bench"],704:["n03891332","parking_meter"],705:["n03895866","passenger_car"],706:["n03899768","patio"],707:["n03902125","pay-phone"],708:["n03903868","pedestal"],709:["n03908618","pencil_box"],710:["n03908714","pencil_sharpener"],711:["n03916031","perfume"],712:["n03920288","Petri_dish"],713:["n03924679","photocopier"],714:["n03929660","pick"],715:["n03929855","pickelhaube"],716:["n03930313","picket_fence"],717:["n03930630","pickup"],718:["n03933933","pier"],719:["n03935335","piggy_bank"],720:["n03937543","pill_bottle"],721:["n03938244","pillow"],722:["n03942813","ping-pong_ball"],723:["n03944341","pinwheel"],724:["n03947888","pirate"],725:["n03950228","pitcher"],726:["n03954731","plane"],727:["n03956157","planetarium"],728:["n03958227","plastic_bag"],729:["n03961711","plate_rack"],730:["n03967562","plow"],731:["n03970156","plunger"],732:["n03976467","Polaroid_camera"],733:["n03976657","pole"],734:["n03977966","police_van"],735:["n03980874","poncho"],736:["n03982430","pool_table"],737:["n03983396","pop_bottle"],738:["n03991062","pot"],739:["n03992509","potter's_wheel"],740:["n03995372","power_drill"],741:["n03998194","prayer_rug"],742:["n04004767","printer"],743:["n04005630","prison"],744:["n04008634","projectile"],745:["n04009552","projector"],746:["n04019541","puck"],747:["n04023962","punching_bag"],748:["n04026417","purse"],749:["n04033901","quill"],750:["n04033995","quilt"],751:["n04037443","racer"],752:["n04039381","racket"],753:["n04040759","radiator"],754:["n04041544","radio"],755:["n04044716","radio_telescope"],756:["n04049303","rain_barrel"],757:["n04065272","recreational_vehicle"],758:["n04067472","reel"],759:["n04069434","reflex_camera"],760:["n04070727","refrigerator"],761:["n04074963","remote_control"],762:["n04081281","restaurant"],763:["n04086273","revolver"],764:["n04090263","rifle"],765:["n04099969","rocking_chair"],766:["n04111531","rotisserie"],767:["n04116512","rubber_eraser"],768:["n04118538","rugby_ball"],769:["n04118776","rule"],770:["n04120489","running_shoe"],771:["n04125021","safe"],772:["n04127249","safety_pin"],773:["n04131690","saltshaker"],774:["n04133789","sandal"],775:["n04136333","sarong"],776:["n04141076","sax"],777:["n04141327","scabbard"],778:["n04141975","scale"],779:["n04146614","school_bus"],780:["n04147183","schooner"],781:["n04149813","scoreboard"],782:["n04152593","screen"],783:["n04153751","screw"],784:["n04154565","screwdriver"],785:["n04162706","seat_belt"],786:["n04179913","sewing_machine"],787:["n04192698","shield"],788:["n04200800","shoe_shop"],789:["n04201297","shoji"],790:["n04204238","shopping_basket"],791:["n04204347","shopping_cart"],792:["n04208210","shovel"],793:["n04209133","shower_cap"],794:["n04209239","shower_curtain"],795:["n04228054","ski"],796:["n04229816","ski_mask"],797:["n04235860","sleeping_bag"],798:["n04238763","slide_rule"],799:["n04239074","sliding_door"],800:["n04243546","slot"],801:["n04251144","snorkel"],802:["n04252077","snowmobile"],803:["n04252225","snowplow"],804:["n04254120","soap_dispenser"],805:["n04254680","soccer_ball"],806:["n04254777","sock"],807:["n04258138","solar_dish"],808:["n04259630","sombrero"],809:["n04263257","soup_bowl"],810:["n04264628","space_bar"],811:["n04265275","space_heater"],812:["n04266014","space_shuttle"],813:["n04270147","spatula"],814:["n04273569","speedboat"],815:["n04275548","spider_web"],816:["n04277352","spindle"],817:["n04285008","sports_car"],818:["n04286575","spotlight"],819:["n04296562","stage"],820:["n04310018","steam_locomotive"],821:["n04311004","steel_arch_bridge"],822:["n04311174","steel_drum"],823:["n04317175","stethoscope"],824:["n04325704","stole"],825:["n04326547","stone_wall"],826:["n04328186","stopwatch"],827:["n04330267","stove"],828:["n04332243","strainer"],829:["n04335435","streetcar"],830:["n04336792","stretcher"],831:["n04344873","studio_couch"],832:["n04346328","stupa"],833:["n04347754","submarine"],834:["n04350905","suit"],835:["n04355338","sundial"],836:["n04355933","sunglass"],837:["n04356056","sunglasses"],838:["n04357314","sunscreen"],839:["n04366367","suspension_bridge"],840:["n04367480","swab"],841:["n04370456","sweatshirt"],842:["n04371430","swimming_trunks"],843:["n04371774","swing"],844:["n04372370","switch"],845:["n04376876","syringe"],846:["n04380533","table_lamp"],847:["n04389033","tank"],848:["n04392985","tape_player"],849:["n04398044","teapot"],850:["n04399382","teddy"],851:["n04404412","television"],852:["n04409515","tennis_ball"],853:["n04417672","thatch"],854:["n04418357","theater_curtain"],855:["n04423845","thimble"],856:["n04428191","thresher"],857:["n04429376","throne"],858:["n04435653","tile_roof"],859:["n04442312","toaster"],860:["n04443257","tobacco_shop"],861:["n04447861","toilet_seat"],862:["n04456115","torch"],863:["n04458633","totem_pole"],864:["n04461696","tow_truck"],865:["n04462240","toyshop"],866:["n04465501","tractor"],867:["n04467665","trailer_truck"],868:["n04476259","tray"],869:["n04479046","trench_coat"],870:["n04482393","tricycle"],871:["n04483307","trimaran"],872:["n04485082","tripod"],873:["n04486054","triumphal_arch"],874:["n04487081","trolleybus"],875:["n04487394","trombone"],876:["n04493381","tub"],877:["n04501370","turnstile"],878:["n04505470","typewriter_keyboard"],879:["n04507155","umbrella"],880:["n04509417","unicycle"],881:["n04515003","upright"],882:["n04517823","vacuum"],883:["n04522168","vase"],884:["n04523525","vault"],885:["n04525038","velvet"],886:["n04525305","vending_machine"],887:["n04532106","vestment"],888:["n04532670","viaduct"],889:["n04536866","violin"],890:["n04540053","volleyball"],891:["n04542943","waffle_iron"],892:["n04548280","wall_clock"],893:["n04548362","wallet"],894:["n04550184","wardrobe"],895:["n04552348","warplane"],896:["n04553703","washbasin"],897:["n04554684","washer"],898:["n04557648","water_bottle"],899:["n04560804","water_jug"],900:["n04562935","water_tower"],901:["n04579145","whiskey_jug"],902:["n04579432","whistle"],903:["n04584207","wig"],904:["n04589890","window_screen"],905:["n04590129","window_shade"],906:["n04591157","Windsor_tie"],907:["n04591713","wine_bottle"],908:["n04592741","wing"],909:["n04596742","wok"],910:["n04597913","wooden_spoon"],911:["n04599235","wool"],912:["n04604644","worm_fence"],913:["n04606251","wreck"],914:["n04612504","yawl"],915:["n04613696","yurt"],916:["n06359193","web_site"],917:["n06596364","comic_book"],918:["n06785654","crossword_puzzle"],919:["n06794110","street_sign"],920:["n06874185","traffic_light"],921:["n07248320","book_jacket"],922:["n07565083","menu"],923:["n07579787","plate"],924:["n07583066","guacamole"],925:["n07584110","consomme"],926:["n07590611","hot_pot"],927:["n07613480","trifle"],928:["n07614500","ice_cream"],929:["n07615774","ice_lolly"],930:["n07684084","French_loaf"],931:["n07693725","bagel"],932:["n07695742","pretzel"],933:["n07697313","cheeseburger"],934:["n07697537","hotdog"],935:["n07711569","mashed_potato"],936:["n07714571","head_cabbage"],937:["n07714990","broccoli"],938:["n07715103","cauliflower"],939:["n07716358","zucchini"],940:["n07716906","spaghetti_squash"],941:["n07717410","acorn_squash"],942:["n07717556","butternut_squash"],943:["n07718472","cucumber"],944:["n07718747","artichoke"],945:["n07720875","bell_pepper"],946:["n07730033","cardoon"],947:["n07734744","mushroom"],948:["n07742313","Granny_Smith"],949:["n07745940","strawberry"],950:["n07747607","orange"],951:["n07749582","lemon"],952:["n07753113","fig"],953:["n07753275","pineapple"],954:["n07753592","banana"],955:["n07754684","jackfruit"],956:["n07760859","custard_apple"],957:["n07768694","pomegranate"],958:["n07802026","hay"],959:["n07831146","carbonara"],960:["n07836838","chocolate_sauce"],961:["n07860988","dough"],962:["n07871810","meat_loaf"],963:["n07873807","pizza"],964:["n07875152","potpie"],965:["n07880968","burrito"],966:["n07892512","red_wine"],967:["n07920052","espresso"],968:["n07930864","cup"],969:["n07932039","eggnog"],970:["n09193705","alp"],971:["n09229709","bubble"],972:["n09246464","cliff"],973:["n09256479","coral_reef"],974:["n09288635","geyser"],975:["n09332890","lakeside"],976:["n09399592","promontory"],977:["n09421951","sandbar"],978:["n09428293","seashore"],979:["n09468604","valley"],980:["n09472597","volcano"],981:["n09835506","ballplayer"],982:["n10148035","groom"],983:["n10565667","scuba_diver"],984:["n11879895","rapeseed"],985:["n11939491","daisy"],986:["n12057211","yellow_lady's_slipper"],987:["n12144580","corn"],988:["n12267677","acorn"],989:["n12620546","hip"],990:["n12768682","buckeye"],991:["n12985857","coral_fungus"],992:["n12998815","agaric"],993:["n13037406","gyromitra"],994:["n13040303","stinkhorn"],995:["n13044778","earthstar"],996:["n13052670","hen-of-the-woods"],997:["n13054560","bolete"],998:["n13133613","ear"],999:["n15075141","toilet_tissue"]};async function runSqueezenetModel(t){let r=await Kp.create("/squeezenet1_1.onnx",{executionProviders:["wasm"],graphOptimizationLevel:"all"});console.log("Inference session created");var[i,n]=await runInference(r,t);return[i,n]}async function runInference(t,r){let i=new Date,n={};n[t.inputNames[0]]=r;let a=await t.run(n),s=(new Date().getTime()-i.getTime())/1e3,o=a[t.outputNames[0]];var l=imagenetClassesTopK(softmax(Array.prototype.slice.call(o.data)),5);return console.log("results: ",l),[l,s]}function softmax(t){let r=Math.max(...t),i=t.map(t=>Math.exp(t-r)).reduce((t,r)=>t+r);return t.map((t,n)=>Math.exp(t-r)/i)}function imagenetClassesTopK(t,r=5){let i=__TURBOPACK__imported__module__42778__.default.isTypedArray(t)?Array.prototype.slice.call(t):t,n=__TURBOPACK__imported__module__42778__.default.reverse(__TURBOPACK__imported__module__42778__.default.sortBy(i.map((t,r)=>[t,r]),t=>t[0]));return __TURBOPACK__imported__module__42778__.default.take(n,r).map(t=>{let r=imagenetClasses[t[1]];return{id:r[0],index:parseInt(t[1].toString(),10),name:r[1].replace(/_/g," "),probability:t[0]}})}async function inferenceSqueezenet(t){let r=await getImageTensorFromPath(t),[i,n]=await runSqueezenetModel(r);return[i,n]}var __TURBOPACK__imported__module__45418__=__turbopack_context__.i(45418);let ImageCanvas=t=>{var r;let i=(0,__TURBOPACK__imported__module__71645__.useRef)(null),[n,a]=(0,__TURBOPACK__imported__module__71645__.useState)(""),[s,o]=(0,__TURBOPACK__imported__module__71645__.useState)(""),[l,u]=(0,__TURBOPACK__imported__module__71645__.useState)(""),h=()=>IMAGE_URLS[Math.floor(10*Math.random()+0)],f=()=>{r=new Image;var n=h();r.src=n.value,a("Inferencing..."),o(""),u("");let s=i.current.getContext("2d");r.onload=()=>{s.drawImage(r,0,0,t.width,t.height)},d()},d=async()=>{var[t,i]=await inferenceSqueezenet(r.src),n=t[0];a(n.name.toUpperCase()),o(n.probability),u(`Inference speed: ${i} seconds`)};return(0,__TURBOPACK__imported__module__43476__.jsxs)(__TURBOPACK__imported__module__43476__.Fragment,{children:[(0,__TURBOPACK__imported__module__43476__.jsx)("button",{className:__TURBOPACK__imported__module__45418__.default.grid,onClick:f,children:"Run Squeezenet inference"}),(0,__TURBOPACK__imported__module__43476__.jsx)("br",{}),(0,__TURBOPACK__imported__module__43476__.jsx)("canvas",{ref:i,width:t.width,height:t.height}),(0,__TURBOPACK__imported__module__43476__.jsxs)("span",{children:[n," ",s]}),(0,__TURBOPACK__imported__module__43476__.jsx)("span",{children:l})]})},__TURBOPACK__default__export__=ImageCanvas;__turbopack_context__.s(["default",0,__TURBOPACK__default__export__],44486)}]);